<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>WSL2 on ykikoqAq</title><link>https://ykiko.top/tags/wsl2/</link><description>Recent content in WSL2 on ykikoqAq</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Fri, 01 Dec 2023 00:00:00 +0000</lastBuildDate><atom:link href="https://ykiko.top/tags/wsl2/index.xml" rel="self" type="application/rss+xml"/><item><title>WSL2使用技巧</title><link>https://ykiko.top/p/wsl2%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/</link><pubDate>Fri, 01 Dec 2023 00:00:00 +0000</pubDate><guid>https://ykiko.top/p/wsl2%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/</guid><description>&lt;h1 id="wsl2使用技巧">WSL2使用技巧&lt;/h1>
&lt;h3 id="0x00-常用配置">0x00 常用配置&lt;/h3>
&lt;p>&lt;strong>配置.wslconfig（比较常用）&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>.wslconfig&lt;/strong> 用于在 WSL 2 上运行的所有已安装发行版中配置&lt;strong>全局设置&lt;/strong>。&lt;/p>
&lt;/blockquote>
&lt;p>存放在目录 C:\Users[username] 下&lt;/p>
&lt;p>示例文件&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Settings apply across all Linux distros running on WSL 2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>wsl2&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Limits VM memory to use no more than 4 GB, this can be set as whole numbers using GB or MB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">memory&lt;/span>&lt;span class="o">=&lt;/span>4GB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Sets the VM to use two virtual processors&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">processors&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Specify a custom Linux kernel to use with your installed distros. The default kernel used can be found at https://github.com/microsoft/WSL2-Linux-Kernel&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">kernel&lt;/span>&lt;span class="o">=&lt;/span>C:&lt;span class="se">\\&lt;/span>temp&lt;span class="se">\\&lt;/span>myCustomKernel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Sets additional kernel parameters, in this case enabling older Linux base images such as Centos 6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">kernelCommandLine&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">vsyscall&lt;/span>&lt;span class="o">=&lt;/span>emulate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Sets amount of swap storage space to 8GB, default is 25% of available RAM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">swap&lt;/span>&lt;span class="o">=&lt;/span>8GB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Sets swapfile path location, default is %USERPROFILE%\AppData\Local\Temp\swap.vhdx&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">swapfile&lt;/span>&lt;span class="o">=&lt;/span>C:&lt;span class="se">\\&lt;/span>temp&lt;span class="se">\\&lt;/span>wsl-swap.vhdx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Disable page reporting so WSL retains all allocated memory claimed from Windows and releases none back when free&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">pageReporting&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Turn on default connection to bind WSL 2 localhost to Windows localhost&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">localhostforwarding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Disables nested virtualization&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">nestedVirtualization&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Turns on output console showing contents of dmesg when opening a WSL 2 distro for debugging&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">debugConsole&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Enable experimental features&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>experimental&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">sparseVhd&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>配置wsl.conf&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>• &lt;strong>wsl.conf&lt;/strong> 用于为在 WSL 1 或 WSL 2 上运行的每个 Linux 发行版按各个发行版配置&lt;strong>本地设置&lt;/strong>。&lt;/p>
&lt;/blockquote>
&lt;p>放在发行版的/etc/下&lt;/p>
&lt;h3 id="0x01-自编译内核">0x01 自编译内核&lt;/h3>
&lt;p>WSL2支持使用自编译的内核运行&lt;/p>
&lt;ol>
&lt;li>
&lt;p>下载Kernel → &lt;a class="link" href="https://github.com/microsoft/WSL2-Linux-Kernel" target="_blank" rel="noopener"
>microsoft/WSL2-Linux-Kernel: The source for the Linux kernel used in Windows Subsystem for Linux 2 (WSL2) (github.com)&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>安装依赖&lt;/p>
&lt;p>&lt;code>$ sudo apt install build-essential flex bison dwarves libssl-dev libelf-dev&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>修改需要的配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>编译安装&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="0x02-使用usbip连接usb设备">0x02 使用USBIP连接USB设备&lt;/h3>
&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/dorssel/usbipd-win" target="_blank" rel="noopener"
>dorssel/usbipd-win: Windows software for sharing locally connected USB devices to other machines, including Hyper-V guests and WSL 2. (github.com)&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="0x03-使用vhd解决卡顿问题">0x03 使用VHD解决卡顿问题&lt;/h3>
&lt;h3 id="0x04-在wsl2上编译aosp">0x04 在WSL2上编译AOSP&lt;/h3>
&lt;h3 id="0x05-使用wslg图形界面">0x05 使用WSLg图形界面&lt;/h3>
&lt;h3 id="0x06-使用cancanfd协议">0x06 使用CAN/CANFD协议&lt;/h3>
&lt;h3 id="0x07-wsl常用命令">0x07 WSL常用命令&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">~ &amp;gt; wsl --version 01/11/2024 01:45:41 PM
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WSL 版本： 2.0.9.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">内核版本： 5.15.133.1-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WSLg 版本： 1.0.59
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">MSRDC 版本： 1.2.4677
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Direct3D 版本： 1.611.1-81528511
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DXCore 版本： 10.0.25131.1002-220531-1700.rs-onecore-base2-hyp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Windows 版本： 10.0.19045.2965
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>使用root作为默认用户&lt;/p>
&lt;p>wsl —&lt;/p>
&lt;/li>
&lt;li>
&lt;p>升级WSL2/降级为WSL&lt;/p>
&lt;ul>
&lt;li>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>WSL2备份/恢复&lt;/p>
&lt;p>导出：&lt;code>wsl -export &amp;lt;Distro&amp;gt; &amp;lt;FileName&amp;gt;&lt;/code> [选项] → &lt;code>wsl -export Ubuntu D:/bak/wslUbuntu.tar&lt;/code>&lt;/p>
&lt;pre>&lt;code> 选项为 -vhd 可以将指定应将分发版导出为 .vhdx 文件
&lt;/code>&lt;/pre>
&lt;p>导入：&lt;code>wsl -import &amp;lt;Distro&amp;gt; &amp;lt;InstallLocation&amp;gt; &amp;lt;FileName&amp;gt;&lt;/code> → &lt;code>wsl -import Ubuntu D:/wsl2/ubuntu D:/bak/wslUbuntu.tar&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="0x08-wsl2上使用cuda">0x08 WSL2上使用CUDA&lt;/h3></description></item></channel></rss>